(window["matrixElement_jsonp"]=window["matrixElement_jsonp"]||[]).push([[4],{"01e2":function(e,t,a){"use strict";a.r(t);var s=a("fdaf");for(var o in s)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(o)},"0417":function(e,t,a){var s=a("4cd5");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var o=a("35d6").default;e.exports.__inject__=function(e){o("5d90cea9",s,e)}},"0538d":function(e,t,a){var s=a("50fc");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var o=a("35d6").default;e.exports.__inject__=function(e){o("70a04820",s,e)}},"0826":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"typingBlock",staticStyle:{position:"relative"}},[t("div",{staticClass:"typingBlockWrapper"},[t("div",[t("span",[e._v(e._s(e.$t("caption.typing")))])]),t("div",[t("PulseLoader",{attrs:{color:e.color,size:e.size,loading:!0}})],1)])])},o=[],n=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"v-spinner"},[t("div",{staticClass:"v-pulse v-pulse1",style:[e.spinnerStyle,e.spinnerDelay1]}),t("div",{staticClass:"v-pulse v-pulse2",style:[e.spinnerStyle,e.spinnerDelay2]}),t("div",{staticClass:"v-pulse v-pulse3",style:[e.spinnerStyle,e.spinnerDelay3]})])},i=[],r={name:"PulseLoader",props:{loading:{type:Boolean,default:!0},color:{type:String,default:"#5dc596"},size:{type:String,default:"15px"},margin:{type:String,default:"2px"},radius:{type:String,default:"100%"}},data(){return{spinnerStyle:{backgroundColor:this.color,width:this.size,height:this.size,margin:this.margin,borderRadius:this.radius,display:"inline-block",animationName:"v-pulseStretchDelay",animationDuration:"0.75s",animationIterationCount:"infinite",animationTimingFunction:"cubic-bezier(.2,.68,.18,1.08)",animationFillMode:"both"},spinnerDelay1:{animationDelay:"0.12s"},spinnerDelay2:{animationDelay:"0.24s"},spinnerDelay3:{animationDelay:"0.36s"}}}},c=r,l=a("2877");function d(e){var t=a("2e6b");t.__inject__&&t.__inject__(e)}var h=Object(l["a"])(c,n,i,!1,d,null,null,!0),u=h.exports,f={name:"typing",props:{},components:{PulseLoader:u},data:()=>({color:"#868686",size:"2px",loading:!0}),methods:{},computed:{}},p=f;function m(e){var t=a("8228");t.__inject__&&t.__inject__(e)}var v=Object(l["a"])(p,s,o,!1,m,null,null,!0);t["a"]=v.exports},"2e6b":function(e,t,a){"use strict";a.r(t);var s=a("467a");for(var o in s)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(o)},"467a":function(e,t,a){var s=a("5f4b");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var o=a("35d6").default;e.exports.__inject__=function(e){o("9a086d26",s,e)}},"4cd5":function(e,t,a){var s=a("24fb");t=s(!1),t.push([e.i,".typingBlock{position:relative}.typingBlock .typingBlockWrapper{position:absolute;left:50%;transform:translateX(-50%);top:-5px;display:flex;align-items:center}.typingBlock .typingBlockWrapper>div{padding:0 .5em}.typingBlock .typingBlockWrapper span{font-size:.7em;color:rgb(var(--neutral-grad-3));opacity:.8}",""]),e.exports=t},"50fc":function(e,t,a){var s=a("24fb");t=s(!1),t.push([e.i,".topheader[data-v-193bd206]{width:100%;top:0;z-index:999}.aboutContact[data-v-193bd206]{position:absolute;left:0;right:0;top:100px;bottom:0;z-index:999;background:#fff}.chat.mobile[data-v-193bd206] #maincontent .headerSpacerWrapper{bottom:0;overflow:visible}.chat.mobile[data-v-193bd206] #maincontent .headerSpacerWrapperOvf{overflow:visible}",""]),e.exports=t},"5f4b":function(e,t,a){var s=a("24fb");t=s(!1),t.push([e.i,"@keyframes v-pulseStretchDelay{0%,80%{transform:scale(1);-webkit-opacity:1;opacity:1}45%{transform:scale(.1);-webkit-opacity:.7;opacity:.7}}",""]),e.exports=t},6357:function(e,t,a){"use strict";a.r(t);var s=a("0538d");for(var o in s)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(o)},8228:function(e,t,a){"use strict";a.r(t);var s=a("0417");for(var o in s)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(o)},"8c07":function(e,t,a){var s=a("24fb");t=s(!1),t.push([e.i,'.call[data-v-66e7a2eb]{font-size:.8em;outline:none;position:relative;-webkit-tap-highlight-color:transparent}.call[data-v-66e7a2eb]:after{content:"";display:block;width:100%;height:100%;opacity:0;transition:all .5s;box-shadow:0 0 10px 40px rgba(var(--neutral-grad-2),.4)}.call[data-v-66e7a2eb]:active:after,.call[data-v-66e7a2eb]:after{position:absolute;border-radius:4em;left:0;top:0}.call[data-v-66e7a2eb]:active:after{box-shadow:0 0 0 0 rgba(var(--neutral-grad-2),.4);opacity:1;transition:0s}.call.disabled[data-v-66e7a2eb]{color:rgb(var(--neutral-grad-1));cursor:not-allowed}.call.disabled[data-v-66e7a2eb]:after{display:none}.call.wait[data-v-66e7a2eb]{color:rgb(var(--color-star-yellow));cursor:not-allowed}.call.wait[data-v-66e7a2eb]:after{display:none}.nameWrapper[data-v-66e7a2eb]{display:flex;align-items:center;justify-content:center}.roomMuted[data-v-66e7a2eb]{margin-left:.25em;color:rgb(var(--neutral-grad-4))}.roomMuted i[data-v-66e7a2eb]{font-size:.8em}.editButton[data-v-66e7a2eb]{display:flex;justify-content:center;align-items:center}.editButton i[data-v-66e7a2eb]{font-size:1.5em}.nameline[data-v-66e7a2eb],[data-v-66e7a2eb] .nameline{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}[data-v-66e7a2eb] .nameline{max-width:250px}[data-v-66e7a2eb] #topheader.minimized.fix{background:transparent;overflow:inherit}[data-v-66e7a2eb] #search{padding-left:.5em;padding-right:.5em}.donationModalBody[data-v-66e7a2eb]{padding:1em;display:flex;flex-direction:column}.donationModalBody span[data-v-66e7a2eb]{color:rgb(var(--color-txt-ac))}.donationModalBody input[data-v-66e7a2eb],.donationModalBody select[data-v-66e7a2eb]{margin-top:.5em;margin-bottom:1.5em;border:1px solid rgb(var(--color-txt-ac));border-radius:3px;padding:.5em}.donationModalBody input.disabled[data-v-66e7a2eb],.donationModalBody select.disabled[data-v-66e7a2eb]{color:rgb(var(--neutral-grad-2));border:1px solid rgba(var(--neutral-grad-2),.5)}.donationModalBody button[data-v-66e7a2eb]{margin-top:1em}.donationModalBody button i[data-v-66e7a2eb]{margin-right:.2em}.donationModalBody .totalAmount[data-v-66e7a2eb]{font-weight:700;margin-left:.5em;margin-top:.5em;margin-bottom:1em}.donationModalBody .error[data-v-66e7a2eb]{color:rgb(var(--color-bad));text-align:center}.donationModalBody .linepreloader[data-v-66e7a2eb]{text-align:center;height:29px;margin-top:1em}#simpleSearch .matches[data-v-66e7a2eb]{display:flex;align-items:center;height:100%}#simpleSearch .matches i[data-v-66e7a2eb],#simpleSearch .matches span[data-v-66e7a2eb]{font-size:.8em;padding:.5em}#simpleSearch .matches i[data-v-66e7a2eb]{cursor:pointer}#simpleSearch .matches i[data-v-66e7a2eb]:hover{color:rgb(var(--color-txt-ac))}.encrypted[data-v-66e7a2eb]{z-index:2;color:rgb(var(--color-good));padding:.25em .5em}.encrypted i[data-v-66e7a2eb]{font-size:.8em;cursor:pointer}.encryptedInfo[data-v-66e7a2eb]{cursor:default;margin-left:-25px;position:absolute;top:50%;transform:translateY(-50%);z-index:9999;display:flex;justify-content:center;align-items:center;flex-direction:column}.encryptedInfo #slide[data-v-66e7a2eb]{border-radius:8px;padding:0 .5em;position:absolute;left:0;background:#fff;-webkit-animation:slide-66e7a2eb .1s forwards;-webkit-animation-delay:.3s;animation:slide-66e7a2eb .1s forwards;animation-delay:.3s;box-shadow:0 5px 7px -5px rgba(var(--color-shadow-base),.7)}@keyframes slide-66e7a2eb{to{left:0}}.encryptedInfo button[data-v-66e7a2eb]{cursor:pointer;display:flex;align-items:center;justify-content:flex-start;text-align:left}.encryptedInfo button i[data-v-66e7a2eb]{margin-right:5px}.encryptedInfo .encryptedTxtIcon[data-v-66e7a2eb]{flex-direction:column;align-items:center;justify-content:center;padding:.25em .25em;text-align:center}.encryptedInfo .encryptedTxtIcon span[data-v-66e7a2eb]{color:rgb(var(--color-good));font-size:.8em}.encryptedInfo .encryptedTxtIcon i[data-v-66e7a2eb]{color:rgb(var(--color-good));display:none}',""]),e.exports=t},ee79:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"page chat",class:{mobile:e.mobile}},[t("topheader",{directives:[{name:"show",rawName:"v-show",value:!e.hideHeader||!e.ios,expression:"!hideHeader || !ios"}],key:e.k,staticClass:"topheader",attrs:{u:e.u,chat:e.chat,search:e.search,focusedevent:e.focusedevent,process:e.processid,searchresults:e.processresult},on:{searching:e.searching,addMember:e.addMemberModal,tosearchevent:e.tosearchevent}}),t("maincontent",{scopedSlots:e._u([{key:"content",fn:function(){return[t("chat",{key:e.k,ref:"chat",attrs:{u:e.u,chat:e.chat,toevent:e.toevent,search:e.search,searchresults:e.processresult},on:{sending:e.sending,newchat:e.newchat,removeBrokenRoom:e.creatorLeft,getEvents:e.eventsRoom,menuIsVisible:e.menuIsVisibleHandler,toeventscrolled:e.toeventscrolled}})]},proxy:!0}])}),e.openInviteModal?t("modal",{on:{close:e.closeModal},scopedSlots:e._u([{key:"header",fn:function(){return[t("span",[e._v(e._s(e.$t("caption.inviteUser")))])]},proxy:!0},{key:"body",fn:function(){return[t("contacts",{attrs:{mode:"inviteUsers",chatRoomId:e.chat.roomId},on:{closeModal:e.closeContactModal}})]},proxy:!0},{key:"footer",fn:function(){},proxy:!0}],null,!1,1321158477)}):e._e()],1)},o=[],n=a("b163"),i=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{attrs:{id:"chatTopheader"}},[e.chat||e.u?t("topheader",{scopedSlots:e._u([{key:"left",fn:function(){return[t("backButton",{attrs:{action:"chats"}})]},proxy:!0},{key:"leftadd",fn:function(){return[t("div",{staticClass:"iconbuttonsmall",on:{click:e.tosearch}},[t("i",{staticClass:"fas fa-search"})])]},proxy:!0},{key:"info",fn:function(){return[e.chat?t("router-link",{attrs:{to:"chatInfo?id="+e.chat.roomId}},[e.m_chat?t("div",[t("div",{staticClass:"nameWrapper"},[e.roomInfo?e._e():t("chatName",{attrs:{preview:!0,chat:e.chat,m_chat:e.m_chat}}),e.roomMuted?t("div",{staticClass:"roomMuted"},[t("i",{staticClass:"fas fa-bell-slash"})]):e._e()],1),t("transition",{attrs:{name:"fade"}},[e.m_chat_typing?t("chatTyping"):e._e()],1)],1):e._e(),!e.m_chat&&e.userinfo?t("div",[t("span",{staticClass:"nameline"},[e._v(e._s(e.userinfo.name))])]):e._e()]):e._e()]},proxy:!0},e.callsEnabled&&e.m_chat?{key:"rightadd",fn:function(){return[e.isCallsActive&&!e.isGroup?t("div",{staticClass:"call btn iconbutton",class:"wait"===e.checkCallsEnabled||e.wait?"wait":e.checkCallsEnabled?"":"disabled",attrs:{title:"wait"===e.checkCallsEnabled||e.wait?e.$t("caption.wait"):e.checkCallsEnabled?"":e.$t("caption.disabled")},on:{click:e.bcCall}},[t("i",{staticClass:"fas fa-video"})]):e._e()]},proxy:!0}:null,{key:"right",fn:function(){return[e.chat?t("router-link",{attrs:{to:"chatInfo?id="+e.chat.roomId}},[t("div",{staticClass:"iconbutton"},[t("i",{staticClass:"fas fa-ellipsis-h"})])]):e._e()]},proxy:!0}],null,!0)}):e._e(),e.chat&&e.searchactive?t("topheader",{attrs:{classstyle:"noiconsButWithL"},scopedSlots:e._u([{key:"left",fn:function(){return[t("backButton",{on:{back:e.backfromsearch}})]},proxy:!0},{key:"info",fn:function(){return[t("simpleSearch",{ref:"search",attrs:{value:e.search,controlKeys:!0},on:{search:e.searching,controlKey:e.searchControlKey},scopedSlots:e._u([e.searchresults&&e.searchresults.length?{key:"default",fn:function(){return[t("div",{staticClass:"matches"},[t("span",{staticClass:"current-match"},[e._v(e._s(e.searchresults.length-e.focusedeventIndex)+"/"+e._s(e.searchresults.length))]),t("i",{staticClass:"prev-match fas fa-chevron-up",on:{click:e.tobottomsearch}}),t("i",{staticClass:"next-match fas fa-chevron-down",on:{click:e.toupsearch}})]),e.search?t("div",{staticClass:"iconWrapper",on:{click:()=>{e.searching("")}}},[t("i",{staticClass:"fas fa-times"})]):e._e()]},proxy:!0}:null],null,!0)})]},proxy:!0}],null,!1,3516297580)}):e._e()],1)},r=[],c=a("1da1"),l=(a("14d9"),a("2f62")),d=a("aa20"),h=a("3094"),u=a("0826"),f=a("71da"),p=a("3139"),m={name:"chatTopheader",props:{chat:Object,u:String,roomInfo:!1,aboutUser:!1,search:String,process:String,searchresults:null,focusedevent:null},inject:["matches"],components:{chatName:d["a"],chatIcon:h["a"],chatTyping:u["a"],contacts:f["a"]},data:function(){return{menuItems:[{click:"callupVideoHandler",title:this.$i18n.t("caption.videocall"),icon:"fas fa-camera"},{click:"callupHandler",title:this.$i18n.t("caption.call"),icon:"fas fa-phone"}],menuItemsRoom:[{click:"AddMember",title:this.$i18n.t("caption.add"),icon:"fas fa-user-plus"},{click:"MuteRoom",title:this.$i18n.t("caption.mute"),icon:"fas fa-bell-slash"},{click:"LeaveFromRoom",title:this.$i18n.t("caption.leaveAndDelete"),icon:"fas fa-sign-out-alt"}],menuItemsRoomMuted:[{click:"AddMember",title:this.$i18n.t("caption.add"),icon:"fas fa-user-plus"},{click:"MuteRoom",title:this.$i18n.t("caption.unmute"),icon:"fas fa-bell"},{click:"LeaveFromRoom",title:this.$i18n.t("caption.leaveAndDelete"),icon:"fas fa-sign-out-alt"}],oneToOne:[{click:"MuteRoom",title:this.$i18n.t("caption.mute"),icon:"fas fa-bell-slash"},{click:"Donate",title:this.$i18n.t("caption.donate"),icon:"fas fa-money-bill-wave"}],oneToOneMuted:[{click:"MuteRoom",title:this.$i18n.t("caption.unmute"),icon:"fas fa-bell"},{click:"LeaveFromRoom",title:this.$i18n.t("caption.leaveAndDelete"),icon:"fas fa-sign-out-alt"},{click:"Donate",title:this.$i18n.t("caption.donate"),icon:"fas fa-money-bill-wave"}],donateMenu:[{click:"Donate",title:this.$i18n.t("caption.donate"),icon:"fas fa-money-bill-wave"}],wait:!1,loading:!1,typing:!1,userinfo:null,aboutUserShow:!1,roomBanned:!1,roomMuted:!1,searchactive:!1,donateUserOpened:!1,receiver:null,donationAmount:0,donationMessage:"",calculatedFees:null,showFeesError:"",showTransactionError:"",calculatingFees:!1,sending:!1,feesDirection:"include",feesDirectionPossibleValues:[{value:"include",label:this.$i18n.t("caption.toBePaidByReceiver")},{value:"exclude",label:this.$i18n.t("caption.toBePaidBySender")}],hoverEncrypt:!1}},watch:{},mounted:function(){this.getuserinfo(),this.search&&(this.searchactive=!0)},computed:Object(l["c"])({focusedeventIndex:function(){if(!this.searchresults||!this.focusedevent)return null;var e=-1;return _.find(this.searchresults,(t,a)=>{if(t.event.event_id==this.focusedevent.event.event_id)return e=a,!0}),e},callsEnabled:e=>e.isCallsEnabled,checkCallsEnabled:function(){var e,t;return null!==(e=this.$store.state.ChatStatuses[this.m_chat.roomId])&&void 0!==e&&e.enabled?(this.wait=!1,!0):null!==(t=this.$store.state.ChatStatuses[this.m_chat.roomId])&&void 0!==t&&t.isWaiting?"wait":(this.wait=!1,!1)},isGroup:function(){var e;return"@"===(null===(e=this.m_chat)||void 0===e?void 0:e.name.slice(0,1))},auth:e=>e.auth,isCallsActive:e=>e.isCallsActive,m_chat:function(){if(this.chat&&this.chat.roomId){let t=this.core.mtrx.client._pushProcessor.getPushRuleById(this.chat.roomId);null!==t&&(this.roomMuted=!0);var e=this.core.mtrx.client.getRoom(this.chat.roomId);return e||{}}},m_chat_typing:function(){if(!this.chat)return!1;var e=this.chat.roomId,t=this.$store.state.typing[e]||{},a=_.find(t,(e,t)=>{var a;if(e)return t!=(null===(a=this.core.user.userinfo)||void 0===a?void 0:a.id)});return a||!1},totalDonationAmount:function(){return"include"==this.feesDirection?this.donationAmount:this.donationAmount+this.calculatedFees}}),methods:{searchControlKey:function(e){"up"==e&&this.tobottomsearch(),"down"==e&&this.toupsearch()},toupsearch:function(){if(this.searchresults){var e=this.focusedeventIndex;e<=this.searchresults.length-2?this.$emit("tosearchevent",this.searchresults[this.focusedeventIndex+1]):this.$emit("tosearchevent",this.searchresults[0])}},tobottomsearch:function(){if(this.searchresults||!this.searchresults.length){var e=this.focusedeventIndex;e>0?this.$emit("tosearchevent",this.searchresults[this.focusedeventIndex-1]):this.$emit("tosearchevent",this.searchresults[this.searchresults.length-1])}},backfromsearch:function(){this.process?this.$router.push("chats?process="+this.process).catch(e=>{}):(this.searchactive=!1,this.searching(""))},tosearch:function(){this.searchactive=!0,setTimeout(()=>{this.$refs.search&&this.$refs.search.focus()},100)},searching:function(e){this.$emit("searching",e),e||(this.searchactive=!1)},bcCall:function(){if(!this.checkCallsEnabled)return void this.$dialog.confirm(this.$t("caption.request"),{okText:this.$t("yes"),cancelText:this.$t("cancel")}).then(()=>{this.core.mtrx.client.sendStateEvent(this.chat.roomId,"m.room.callsEnabled",{enabled:!0},this.core.user.userinfo.id),this.wait=!0,this.requestCallsAccess()});if("wait"===this.checkCallsEnabled)return;let e=document.querySelector("body");this.core.mtrx.bastyonCalls.initCall(this.chat.roomId,e).then(e=>{console.log("matrixCall",e)}).catch(e=>{console.log("error",e)})},requestCallsAccess(){this.core.mtrx.client.sendStateEvent(this.m_chat.roomId,"m.room.request_calls_access",{accepted:null})},navigateToProfile(e){this.$router.push({path:"/contact?id="+p["a"].getmatrixid(e)}).catch(e=>{})},getuserinfo:function(){this.u&&this.core.user.usersInfo(this.u).then(e=>{this.userinfo=e[0]})},findOtherUser:function(){let e,t=this.m_chat.myUserId,a=this.m_chat.currentState.getMembers();return a.forEach((function(a){a&&a.userId!==t&&(e=a)})),e},addMember(){this.modalInviteUser()},menuItemClickHandler(e,t){if("AddMember"===e.click&&(this.$emit("addMember",!0),this.$refs.dropdownMenu.hidePopup()),"MuteRoom"===e.click){var a=this.chat.roomId;this.core.mtrx.client.deviceId;let e=this,t=this.core.mtrx.client._pushProcessor.getPushRuleById(this.chat.roomId);null!==t?(e.core.mtrx.client.deletePushRule("global","room",a),this.roomMuted=!1):(e.core.mtrx.client.setRoomMutePushRule("global",a,"true"),this.roomMuted=!0),this.$refs.dropdownMenu.hidePopup()}if("LeaveFromRoom"===e.click){this.core.mtrx.client.leave(this.chat.roomId).then(e=>{this.core.mtrx.client.forget(this.chat.roomId,!0).then(e=>{this.$store.commit("DELETE_ROOM",this.chat.roomId)}).then(e=>{this.$router.push({path:"/chats"}).catch(e=>{})})}),this.$refs.dropdownMenu.hidePopup()}if("BanRoom"===e.click){let e="",t=this.findOtherUser();t&&t.userId&&(e=t.userId);let a=this.chat.roomId;this.core.mtrx.client.ban(a,e,"ban").then(e=>{}),this.roomBanned=!0,this.$refs.dropdownMenu.hidePopup()}if("Unban"===e.click){let e="",t=this.findOtherUser();t&&t.userId&&(e=t.userId),this.core.mtrx.client.unban(this.chat.roomId,e).then(t=>{this.core.mtrx.client.invite(this.chat.roomId,e)}),this.roomBanned=!1,this.$refs.dropdownMenu.hidePopup()}if("Donate"===e.click){this.donateUserOpened=!0,this.$refs.dropdownMenu.hidePopup();let e=this.findOtherUser();this.receiver=e?this.$f.deep(this,"$store.state.users."+this.$f.getmatrixid(e.name)):null}},closeDonateModal(){this.donateUserOpened=!1},onCalculateFeesClick(){this.calculatingFees=!0,this.calculateFees().finally(()=>this.calculatingFees=!1)},calculateFees(){var e=this;return this.showFeesError="",new Promise((t,a)=>{if(this.donationAmount<=0||!this.receiver||!this.receiver.source||!this.receiver.source.address)return this.showFeesError="invalid",a("Missing amount or receiver");try{var s=window.POCKETNETINSTANCE.platform.sdk;s.node.fee.estimate((function(o){var n=[{address:e.receiver.source.address,amount:e.donationAmount}];s.wallet.txbase([s.address.pnet().address],n,0,e.feesDirection,(function(n,i,r){if(n)return console.error(n),e.showFeesError=n,a(n);var c=s.node.transactions.create.wallet(i,r),l=Math.min(c.virtualSize()*o.feerate,.0999);return e.calculatedFees=l,t()}))}))}catch(o){return console.error(o),e.showFeesError=o,a(o)}})},sendDonation(){var e=this;return Object(c["a"])((function*(){var t=e;e.sending=!0,e.showTransactionError="";try{yield e.calculateFees()}catch(s){return e.showTransactionError="error",void(e.sending=!1)}var a=window.POCKETNETINSTANCE.platform.sdk;a.node.transactions.get.canSpend(a.address.pnet().address,e=>{if(!e||isNaN(e)||e<t.totalDonationAmount)return t.showTransactionError="balance too low",void(t.sending=!1);try{var o=[{address:t.receiver.source.address,amount:t.donationAmount}];a.wallet.embed(o,t.donationMessage),a.wallet.txbase([a.address.pnet().address],o,t.calculatedFees,t.feesDirection,(function(e,s,o){if(e)return console.error(e),t.showTransactionError="error",t.sending=!1,reject(e);var n=a.node.transactions.create.wallet(s,o);s.forEach(e=>{e.cantspend=!0}),a.node.transactions.send(n,(function(e,n){if(n)return a.node.transactions.releaseCS(s),t.showTransactionError="error",void(t.sending=!1);var i=s.map(e=>e.txid);a.node.transactions.clearUnspents(i),a.wallet.saveTempInfoWallet(e,s,o),t.core.mtrx.client.sendEvent(t.chat.roomId,"m.room.message",{from:t.$f.getmatrixid(t.m_chat.myUserId),to:t.receiver.id,amount:t.donationAmount,txId:e,msgtype:"m.notice"},""),t.closeDonateModal()}))}))}catch(s){console.error(s),t.showTransactionError="error",t.sending=!1}})}))()},resetDonation(){this.calculatedFees=null,this.showFeesError="",this.showTransactionError=""}}},v=m,b=a("2877");function g(e){var t=a("01e2");t.__inject__&&t.__inject__(e)}var y=Object(b["a"])(v,i,r,!1,g,"66e7a2eb",null,!0),x=y.exports,w={name:"pagechat",components:{chat:n["a"],topheader:x,contacts:f["a"]},data:()=>({events:[],openInviteModal:!1,brokenRoom:!1,hideHeader:!1,hastoeventscrolled:!1,hasprocesscleared:!1,searchchanged:void 0,process:null,processresult:null,focusedevent:null}),computed:{u(){return this.$route.query.u},chat(){var e=this.$route.query.id;return this.$store.state.chatsMap[e]},k(){return this.u+this.$route.query.id},processid(){return this.hasprocesscleared?null:this.$route.query.process},search(){return("undefined"==typeof this.searchchanged?this.$route.query.search:this.searchchanged)||""},toevent(){return this.hastoeventscrolled?null:this.$route.query.toevent},ios(){return p["a"].isios()},...Object(l["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,mobile:e=>e.mobile})},mounted(){setTimeout(()=>{this.leaveIfBroken()},2e3),this.toevent},beforeDestroy:function(){this.process&&this.process.stop()},watch:{search:{immediate:!0,handler:function(){pretry(()=>this.chat).then(()=>{this.searchingProcess()})}}},methods:{tosearchevent(e){console.log("event",e),this.focusedevent=e,this.$refs["chat"].scrollToEvent(e)},searchingProcess(){if(console.log("HERE",this.search,this.chat),this.search.length>1&&this.chat){if(this.processresult=null,this.process)return void this.process.updateText(this.search);console.log("INITTEXT"),this.process=this.core.mtrx.searchEngine.execute(this.search,[this.chat],e=>{let{results:t}=e;return!1},{chat:e=>{if(console.log("RESULT",e),this.processresult=e.results[this.chat.roomId]||null,this.processresult&&!this.focusedevent&&this.processresult[0])if(this.toevent){var t=_.find(this.processresult,e=>e.event.event_id==this.toevent);console.log("this.toevent",t,this.toevent),t&&(this.toeventscrolled(),this.tosearchevent(t))}else this.tosearchevent(this.processresult[0])}}),this.process.execute().catch(e=>{console.error(e)})}else this.process&&this.process.stop(),this.processresult=null,this.focusedevent=null,this.processcleared()},searching(e){this.searchchanged=e},processcleared(){this.hasprocesscleared=!0},toeventscrolled(){this.hastoeventscrolled=!0},creatorLeft(e){this.brokenRoom=e},closeModal(){this.openInviteModal=!1},closeContactModal(e){this.openInviteModal=e},addMemberModal(e){this.openInviteModal=e},newchat(e){},sending(){},eventsRoom(e){this.events=e},menuIsVisibleHandler(e){this.hideHeader=e},leaveIfBroken(){return!!this.brokenRoom&&(this.core.mtrx.client.leave(from.query.id).then(e=>{this.core.mtrx.client.forget(from.query.id,!0).then(e=>e).then(e=>{this.$store.commit("DELETE_ROOM",from.query.id)})}),!0)}}},k=w;function I(e){var t=a("6357");t.__inject__&&t.__inject__(e)}var M=Object(b["a"])(k,s,o,!1,I,"193bd206",null,!0);t["default"]=M.exports},fdaf:function(e,t,a){var s=a("8c07");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var o=a("35d6").default;e.exports.__inject__=function(e){o("5fda6366",s,e)}}}]);
//# sourceMappingURL=matrix-element.4.min.js.map