(window["matrixElement_jsonp"]=window["matrixElement_jsonp"]||[]).push([[6],{"0a92":function(e,t,i){var n=i("5ce7");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("35d6").default;e.exports.__inject__=function(e){r("06c84aee",n,e)}},"23c6":function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,".input_component[data-v-e98d4fac]{width:100%;display:flex;justify-content:center;align-items:center;padding:0 1em;padding-right:0}.input_component[data-v-e98d4fac] .emoji-mart .emoji-mart-emoji{width:25%;height:40px;cursor:pointer}.input_component[data-v-e98d4fac] .emoji-mart .emoji-mart-emoji span{cursor:pointer}.input_component[data-v-e98d4fac] .emoji-mart .emoji-mart-emoji:hover{background:none;box-shadow:none}.input_component[data-v-e98d4fac] .emoji-mart .emoji-mart-emoji:hover:before{display:none}.input_component .input-wrapper[data-v-e98d4fac]{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;position:relative;width:100%}.input_component .right[data-v-e98d4fac]{margin:0 .5em}.input_component .iconbutton .leftdummy[data-v-e98d4fac]{width:20px}.input_component .iconbutton .rightdummy[data-v-e98d4fac]{width:35px}.input_component .iconbutton .idummy[data-v-e98d4fac]{width:100%;height:35px;line-height:35px}.input_component .iconbutton .idummy i[data-v-e98d4fac]{line-height:35px!important}.input_component .previews[data-v-e98d4fac]{width:100%;max-width:198px;height:30px;display:flex;align-items:flex-start;padding:2px 0;overflow:hidden}.input_component .previews[data-v-e98d4fac]:first-child{margin-left:0}.input_component .textarea[data-v-e98d4fac]{width:100%;display:flex;justify-content:flex-start;align-items:center}.chat-input[data-v-e98d4fac]{width:100%;max-height:100px;overflow-y:auto;resize:none}.chat-input[data-v-e98d4fac]::-webkit-scrollbar{width:0!important}.fade-enter-active[data-v-e98d4fac],.fade-leave-active[data-v-e98d4fac]{transition:all .2s ease-in}.fade-enter[data-v-e98d4fac],.fade-leave-to[data-v-e98d4fac]{opacity:0}",""]),e.exports=t},"44f7":function(e,t,i){"use strict";i.r(t);var n=i("a105");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r)},"5ce7":function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,".wrapper[data-v-4b882d9f]{position:relative}.fas[data-v-4b882d9f]{position:absolute;right:-8px;top:-8px}.preview-picture[data-v-4b882d9f]{width:50px;height:50px;border-radius:10px}",""]),e.exports=t},a105:function(e,t,i){var n=i("23c6");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("35d6").default;e.exports.__inject__=function(e){r("191f9b68",n,e)}},cd70:function(e,t,i){var n=i("d9c8");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("35d6").default;e.exports.__inject__=function(e){r("689bb725",n,e)}},cf20:function(e,t,i){var n=i("ee23");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("35d6").default;e.exports.__inject__=function(e){r("707928b0",n,e)}},cff80:function(e,t,i){"use strict";i.r(t);var n=i("0a92");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r)},d0a4:function(e,t,i){"use strict";i.r(t);var n=i("cf20");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r)},d9c8:function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,"#chatInput[data-v-22eb6a42]{padding-bottom:.5em}[data-v-22eb6a42] #modal.minimized .modal-wrapper{left:0}[data-v-22eb6a42] .previewWrapper{padding-left:.5em!important;padding-right:.5em!important}.inputWrapper[data-v-22eb6a42]{display:flex}.inputWrapper .left[data-v-22eb6a42]{width:35px;display:flex;justify-content:flex-end;align-items:center;text-align:center}.inputWrapper .left .iconbutton[data-v-22eb6a42]{display:flex;align-items:center;justify-content:center;height:35px;width:35px;-webkit-tap-highlight-color:transparent}.inputWrapper .extended[data-v-22eb6a42]{width:70px;margin-left:7px}.inputWrapper .leftdummy[data-v-22eb6a42]{width:.5em}.inputWrapper>div[data-v-22eb6a42]{transition:.3s}.inputWrapper .center[data-v-22eb6a42]{max-height:110px;max-width:100%;display:flex;justify-content:center;align-items:center;flex-grow:1;border:1px solid transparent;border-radius:30px;background:rgb(var(--background-secondary-theme))}.inputWrapper input[data-v-22eb6a42]{border:1px solid rgb(var(--neutral-grad-0));background:rgba(var(--background-main),.5);border-radius:30px;width:100%;padding:.5em 1em}.notready[data-v-22eb6a42],.waitjoined[data-v-22eb6a42]{padding:.5em 0;text-align:center}.waitjoined span[data-v-22eb6a42]{font-size:.8em}.greetings[data-v-22eb6a42]{padding:.5em 0}.greetings[data-v-22eb6a42],[data-v-22eb6a42] .iconWrapper{text-align:center}.menu-item[data-v-22eb6a42]{padding:.5em;background:rgb(var(--background-total-theme));line-height:44px;border-radius:5px;display:flex}.menu-item .title[data-v-22eb6a42]{flex-grow:2;padding-right:44px;text-align:center}.menu-item .iconWrapper[data-v-22eb6a42]{width:44px}.tipusers[data-v-22eb6a42]{position:absolute;max-height:300px;border-radius:.5em;border:1px solid rgba(var(--neutral-grad-0),.9);overflow-y:overlay;background-color:rgba(var(--background-total-theme),.95);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);padding:.25em 0;bottom:100%;margin-bottom:.5em;left:.25em;right:.25em}.tipusers .previewWrapperExt[data-v-22eb6a42]{border-radius:.75em;margin-left:.25em;margin-right:.25em;padding-top:.25em;padding-bottom:.25em}.tipusers .previewWrapperExt[data-v-22eb6a42] .previewWrapper{padding-left:.25em!important;padding-right:.25em!important}.tipusers .previewWrapperExt.selected[data-v-22eb6a42]{background:rgb(var(--background-main))}.disabled[data-v-22eb6a42]{display:flex;justify-content:center;align-items:center;width:35px;height:35px;color:rgb(var(--neutral-grad-3))}.disabled i[data-v-22eb6a42]{padding-top:1px}",""]),e.exports=t},e423:function(e,t,i){"use strict";i.r(t);var n=i("cd70");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r)},ee23:function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,".recordProgress[data-v-5cbd823e]{display:flex;position:relative;height:20px;justify-content:flex-start;padding:0 1em;align-items:center;max-width:90%;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.recordProgress .indicator[data-v-5cbd823e]{margin-right:1em;min-width:8px;height:8px;background:red;border-radius:50%}.recordProgress .indicator.recording[data-v-5cbd823e]{-webkit-animation:pulse-data-v-5cbd823e 1.2s ease infinite;animation:pulse-data-v-5cbd823e 1.2s ease infinite}.recordProgress .del[data-v-5cbd823e]{cursor:pointer;display:flex;justify-content:center;align-items:center;width:20px;height:20px;margin-right:1em}.recordProgress .del i[data-v-5cbd823e]{color:red;font-size:13px}.recordProgress .timer[data-v-5cbd823e]{margin-right:1em}.recordProgress .graph[data-v-5cbd823e]{width:calc(100vw - 150px);min-width:100px}.cancel[data-v-5cbd823e],.recordProgress .graph[data-v-5cbd823e]{display:flex;justify-content:center}.cancel[data-v-5cbd823e]{position:absolute;left:80px;right:0;top:0;bottom:0;background:#fff;opacity:0}@-webkit-keyframes pulse-data-v-5cbd823e{0%{opacity:1}50%{opacity:.1}to{opacity:1}}@keyframes pulse-data-v-5cbd823e{0%{opacity:1}50%{opacity:.1}to{opacity:1}}",""]),e.exports=t},fe01:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"chatInput"}},[e.ready?i("div",{staticClass:"work"},[e.chat?i("div",{staticClass:"inputWrapper"},[e.tipusers.length?i("div",{staticClass:"tipusers"},e._l(e.tipusers,(function(t,n){return i("div",{key:t.id,staticClass:"previewWrapperExt",class:{selected:e.tipuserindex==n},on:{click:function(i){return e.insertuser(t)}}},[i("preview",{attrs:{contact:t,mode:""}})],1)})),0):e._e(),i("div",{staticClass:"center"},[e.voiceEnable&&(e.isRecording||e.recordViewData.length)?i("record-progress",{attrs:{recordTime:e.recordTime,isRecording:e.isRecording,rmsData:e.recordViewData,opacity:e.cancelOpacity},on:{onClear:e.clear}}):i("InputField",{ref:"newinput",attrs:{storagekey:"chatinput"+e.chat.roomId,tipusers:e.tipusers},on:{transaction:e.sendtransaction,chatMessage:e.sendinput,setMetaUrl:e.emitUrl,emptyInput:e.emitInputData,FilledInput:e.HideUploadPic,base64:e.pasteImage,focused:e.focused,tipsearchrequest:e.tipBySearch,browsetip:e.browsetip,selectcurrenttip:e.selectcurrenttip}}),e.upload&&e.chat?i("div",{staticClass:"left",class:{extended:e.voiceEnable}},[e.isRecording||e.recordViewData.length?e._e():i("div",{staticClass:"iconbutton"},[i("dropdownMenu",{ref:"dropdownMenu",attrs:{menuItems:e.menuItems,rowObject:{},icon:"fas fa-plus"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.item.upload?i("upload",{attrs:{multiple:t.item.upload.multiple,extensions:t.item.upload.extensions,images:t.item.upload.images},on:{start:function(i){return e.uploadStart(t.item,i)},uploaded:function(i){return e.uploadUploaded(t.item,i)},uploadedAll:function(i){return e.uploadUploadedAll(t.item,i)},error:function(i){return e.uploadError(t.item,i)}},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"menu-item"},[i("div",{staticClass:"iconWrapper"},[t.item.icon?i("i",{class:t.item.icon}):e._e()]),i("div",{staticClass:"title"},[e._v(" "+e._s(t.item.title)+" ")])])]},proxy:!0},{key:"dropzone",fn:function(){},proxy:!0}],null,!0)}):i("div",{staticClass:"menu-item",on:{click:function(i){return e.menuItemClick(t.item)}}},[i("div",{staticClass:"iconWrapper"},[t.item.icon?i("i",{class:t.item.icon}):e._e()]),i("div",{staticClass:"title"},[e._v(" "+e._s(t.item.title)+" ")])])]}}],null,!1,2831926823)})],1),e.voiceEnable?[!e.isRecording&&e.recordRmsData.length||e.microphoneDisabled?e._e():i("div",{staticClass:"iconbutton"},[i("recordVoice",{attrs:{isRecording:e.isRecording},on:{onRecordingStart:e.initRecording,onRecordingStop:e.stopRecording,onClear:e.clear,canceling:e.setOpacity}})],1),e.microphoneDisabled?i("div",{staticClass:"disabled"},[i("i",{staticClass:"icon fas fa-microphone-slash",on:{click:e.initRecording}})]):e._e()]:e._e(),!e.isRecording&&e.recordViewData.length?i("div",{staticClass:"iconbutton",on:{click:e.sendVoiceMessage}},[e._m(0)]):e._e()],2):e._e()],1)]):e._e()]):i("div",{staticClass:"notready"},[i("linepreloader")],1)])},r=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("i",{staticClass:"icon fas fa-paper-plane"})])}],a=i("1da1"),s=i("5530"),o=i("a34a"),c=i.n(o),d=(i("d9e2"),i("907a"),i("3139")),u=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"input_component"},[i("div",{staticClass:"input-wrapper"},[i("div",{staticClass:"textarea"},[i("textarea",{ref:"textarea",staticClass:"chat-input",attrs:{id:"textInput",type:"text",row:"1",spellcheck:"true",autocorrect:"on",placeholder:e.$t("caption.sendmessage")},domProps:{value:e.text},on:{focus:e.focused,blur:e.blured,keydown:e.keydown,input:e.textchange,keyup:e.keyup,click:e.keyup,paste:e.paste_image}}),e.mobile?e._e():i("transition",{attrs:{name:"fade",mode:"out-in"}},[i("picker",{directives:[{name:"show",rawName:"v-show",value:e.display_emoji,expression:"display_emoji"},{name:"click-outside",rawName:"v-click-outside",value:e.close_emoji_picker,expression:"close_emoji_picker"}],style:{width:"325px",position:"absolute",bottom:"32px",right:e.recording?"-100px":"-60px",fontSize:"0.8em",fontFamily:"Segoe UI"},attrs:{data:e.emojiIndex,exclude:e.exclude,showPreview:!1,showSearch:!1,native:!0,set:"emojione"},on:{select:e.insert_emoji}})],1)],1)]),e.mobile?e._e():i("div",{staticClass:"iconbutton emojipicker",on:{click:function(t){return e.toggle_emoji_picker()}}},[i("div",{staticClass:"leftdummy"},[i("div",{staticClass:"idummy"},[e.display_emoji?i("i",{staticClass:"fas fa-times"}):i("i",{staticClass:"far fa-smile"})])])]),e.send?i("div",{staticClass:"iconbutton",on:{click:function(t){return e.send_text(t)}}},[e._m(0)]):e._e()])},l=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"rightdummy"},[i("div",{staticClass:"idummy"},[i("i",{staticClass:"far fa-paper-plane"})])])}],p=i("5059"),h=i("364d"),f=(i("01ce"),i("41fb")),m=i("c28b"),v=i.n(m),g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.is_opened?i("div",{staticClass:"wrapper"},[i("img",{staticClass:"preview-picture",attrs:{src:e.base64,alt:"picture preview"}}),i("i",{staticClass:"fas fa-times fa-sm",on:{click:e.hide}})]):e._e()},x=[],b={name:"picturePreview",props:["base64"],data:function(){return{is_opened:!0}},methods:{hide:function(){this.is_opened=!1}}},y=b,w=i("2877");function _(e){var t=i("cff80");t.__inject__&&t.__inject__(e)}var k=Object(w["a"])(y,g,x,!1,_,"4b882d9f",null,!0),$=k.exports,j=new p["a"],C={name:"InputField",components:{Picker:f["Picker"],picturePreview:$},directives:{clickOutside:v.a.directive},watch:{text:{immediately:!0,handler:function(e,t){e?(this.send=!0,this.$emit("FilledInput")):(this.send=!1,this.$emit("emptyInput")),this.textarea_resize()}}},computed:{mobile:function(){return!this.$store.state.pocketnet&&this.$store.state.mobile},recording:function(){return"true"===this.$store.state.voiceMessagesEnabled},emojiIndex:function(){return window.emojiIndex||(window.emojiIndex=new f["EmojiIndex"](h)),window.emojiIndex}},methods:{setText:function(e){var t=this;this.text=e,this.savetextinstorage(),setTimeout((function(){t.textarea_resize(),t.focus()}))},focused:function(){this.$emit("focused")},textchange:function(e){this.text=e.target.value||""},savetextinstorage:function(){this.storagekey&&(localStorage[this.storagekey]=this.text||"")},send_empty_array:function(){this.$emit("userSearched",[])},focus:function(){this.$refs["textarea"].focus()},blur:function(){this.$refs["textarea"].blur()},blurifempty:function(){this.text||this.blur()},close_emoji_picker:function(e){"i"!==e.target.localName&&"matrix-element"!==e.target.localName&&(this.display_emoji=!1)},textarea_resize:function(){this.text?(this.$refs.textarea.style.height="1px",this.$refs.textarea.style.height=this.$refs.textarea.scrollHeight+"px",this.display_emoji=!1):this.textarea_resize_reset()},textarea_resize_reset:function(){this.$refs.textarea.style.height="26px"},toggle_emoji_picker:function(){this.display_emoji=!this.display_emoji},send_text:function(e){this.text&&"\n"!==this.text&&(this.display_emoji=!1,this.$emit("chatMessage",this.text),this.$emit("emptyInput"),this.send=!1,this.text=""),this.savetextinstorage()},insert_emoji:function(e){this.text+=e.native,this.savetextinstorage()},paste_image:function(e){this.get_base64(e)},get_base64:function(e){var t=this;if(this.pasted_data=e.clipboardData.items,this.pasted_data.length){var i=function(e){var i=t.pasted_data[e],n=t.upload.extensions.includes(i.type);n&&(r=i.getAsFile(),a=new FileReader,a.onload=function(e){t.$dialog.confirm("Do you really want to send attachment?",{okText:"Yes",cancelText:"No, cancel"}).then((function(n){var r=e.target.result;t.resize_image(r,i.type)}))},a.readAsDataURL(r))};for(var n in this.pasted_data){var r,a;i(n)}}},resize_image:function(e,t){var i=this;return j.autorotation(null,e).then((function(e){var n=i.upload.images.resize.type||"def";return j.resize[n](e,1024,1024,t,.9).then((function(e){i.$emit("base64",e)})).catch((function(e){return console.error("Failed to resize image",e)}))})).catch((function(e){return console.error("Failed to resize image",e)}))},getsearchposition:function(e){if(!e.start||!this.text.length)return null;var t={start:e.start,middle:0,end:e.end},i=e.start,n=!1,r=!1,a=/[a-zA-Z0-9]{1}/;t.middle=i;do{var s=this.text[i];"@"==s?e.start==i||i>0&&a.test(this.text[i-1])?r=!0:n=!0:a.test(s)?t.start=i:r=!0,i--}while(i>=0&&i<=e.start&&!n&&!r);if(n){r=!1,i=e.end;do{!this.text[i]||a.test(this.text[i])?t.end=i:r=!0,i++}while(i<=this.text.length&&!r)}else t=null;return t},getsearch:function(e){var t=this.getsearchposition(e);return t?this.text.substring(t.start,t.middle):null},keydown:function(e){return(40===e.keyCode||38===e.keyCode)&&this.tipusers&&this.tipusers.length?(this.$emit("browsetip",40===e.keyCode),e.preventDefault(),!1):(39===e.keyCode||13===e.keyCode)&&this.tipusers&&this.tipusers.length?(this.$emit("selectcurrenttip"),e.preventDefault(),!1):13===e.keyCode?(this.mobile?this.text=this.text+"\n":this.send_text(e),e.preventDefault(),!1):void 0},keyup:function(e){if(this.block)return e.preventDefault(),!1;var t=d["a"].getCaretPosition(this.$refs["textarea"]),i=this.getsearch(t);this.$emit("tipsearchrequest",i),this.savetextinstorage()},blured:function(){var e=this;setTimeout((function(){e.$emit("tipsearchrequest",null)}),300)},inserttip:function(e){var t=this;this.$emit("tipsearchrequest",null),this.block=!0,this.$refs["textarea"];var i=this.getsearchposition(d["a"].getCaretPosition(this.$refs["textarea"]));this.text=this.text.substring(0,i.start)+e+this.text.substring(i.end+1),this.text[i.end+1]||(this.text=this.text+" ")," "==!this.text[i.end+1]&&i.end++,d["a"].setCaretPosition(this.$refs["textarea"],i.end+1,i.end+1),setTimeout((function(){t.block=!1}),350)}},props:{storagekey:String,tipusers:Array},data:function(){return{send:!1,toMatch:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i],isPhone:!0,heightUp:40,areaValue:"",ready:!1,text:"",exclude:["flags"],display_emoji:!1,content_height:26,pasted_data:[],block:!1,upload:{multiple:!0,extensions:["image/jpg","image/jpeg","image/png"],images:{resize:{type:"fit"}}},hidden_previews:null}},creared:function(){},mounted:function(){this.mobile||this.focus(),this.isPhone=this.toMatch.some((function(e){return navigator.userAgent.match(e)})),this.$refs.textarea.style.height="26px",this.storagekey&&localStorage[this.storagekey]&&(this.text=localStorage[this.storagekey])}},E=C;function R(e){var t=i("44f7");t.__inject__&&t.__inject__(e)}var I=Object(w["a"])(E,u,l,!1,R,"e98d4fac",null,!0),P=I.exports,M=i("c46f"),D=i("2f62"),T=i("f978"),S=i("92a6"),z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"recordProgress"},[e.isRecording?i("div",{staticClass:"indicator",class:{recording:e.isRecording}}):i("div",{staticClass:"del",on:{click:e.clear}},[i("i",{staticClass:"fas fa-trash"})]),i("div",{staticClass:"timer"},[e._v(e._s(e.timer))]),i("div",{ref:"graph",staticClass:"graph"},[i("canvas",{ref:"canvas",attrs:{id:"canvas",width:e.width,height:"60"}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isRecording&&e.opacity,expression:"isRecording && opacity"}],ref:"cancel",staticClass:"cancel"},[i("i"),e._v(" "),i("span",[e._v("Slide left to cancel")])])])},O=[],A={name:"recordProgress",props:{recordTime:{type:Number,required:!0},rmsData:{type:Array,required:!0},isRecording:{type:Boolean},opacity:{}},data:function(){return{width:0}},computed:{timer:function(){var e=Math.floor(this.recordTime/6e4),t=Math.floor(this.recordTime/1e3)%60;return"".concat(e?e+":":"0:").concat(t<10?"0"+t:t)}},mounted:function(){this.$refs.cancel.style.opacity=0;var e=this.$refs.graph.offsetWidth;this.width=e-e%100,window.addEventListener("resize",this.resize)},beforeDestroy:function(){window.removeEventListener("resize",this.resize)},updated:function(){var e=this;this.draw(),this.$nextTick((function(){e.$refs.cancel.style.opacity=e.opacity}))},methods:{resize:function(){var e=null;function t(){var t=this;e||(e=setTimeout((function(){e=null;var i=t.$refs.graph.offsetWidth;t.width=i-i%100}),50))}t.call(this)},draw:function(){var e=this.$refs.canvas.getContext("2d"),t=this.width/200;e.clearRect(0,0,this.width,60);for(var i=0;i<this.rmsData.length;i++)e.fillStyle="#00a4ff",e.fillRect(2*i*t,30-this.rmsData[i]/8,t,this.rmsData[i]/4+1)},clear:function(){this.$emit("onClear")}}},U=A;function W(e){var t=i("d0a4");t.__inject__&&t.__inject__(e)}var F=Object(w["a"])(U,z,O,!1,W,"5cbd823e",null,!0),V=F.exports,L=i("0319"),N={name:"chatInput",props:{chat:Object,u:String,relationEvent:Object},components:{InputField:P,contacts:T["default"],preview:S["a"],recordProgress:V},data:function(){return{upload:!0,test:[],loading:!1,text:"",file:{},fileInfo:{},ready:!1,creating:!1,userId:"",showuserselect:null,anyUrlMeta:String,joinedMembers:[],tipvalue:null,tipuserindex:0,record:null,recordRmsData:[],isRecording:!1,mediaRecorder:null,audioContext:null,audioAnalyser:null,audioDataArray:null,recordTime:0,interval:null,cancelOpacity:0,microphoneDisabled:!1}},inject:["blockTextSelection","unblockTextSelection"],watch:{usersForKeysHash:{handler:function(){}},tipusers:function(){this.tipusers.length?this.tipuserindex>this.tipusers.length-1&&(this.tipuserindex=this.tipusers.length-1):this.tipuserindex=0}},computed:Object(s["a"])(Object(s["a"])({voiceEnable:function(){return this.$store.state.voiceMessagesEnabled},connect:function(){return this.$store.state.contact},menuItems:function(){var e=[];return this.relationEvent||(e.push({click:"cameraHandler",title:this.$i18n.t("button.takePhotoOrVideo"),icon:"fas fa-camera",upload:{multiple:!0,extensions:["jpg","jpeg","png","webp"],maxsize:100,images:{resize:{type:"fit"}}}}),e.push({click:"fileHandler",title:this.$i18n.t("button.sendFile"),icon:"fas fa-sticky-note",upload:{multiple:!0,extensions:[],maxsize:25,images:{resize:{type:"fit"}}}})),this.transaction&&e.unshift({click:"sendtransactionWrapper",title:this.$i18n.t("button.sendCoins"),icon:"fas fa-wallet"}),e}},Object(D["c"])(["chats"])),{},{userlist:function(){return this.chat?this.core.mtrx.chatUsersInfo(this.chat.roomId,"anotherChatUsers"):[]},transaction:function(){return d["a"].deep(window,"POCKETNETINSTANCE.platform.ui.wallet.send")},uusers:function(){return this.u?M["default"].map(this.u.split(","),(function(e){return e})):[]},ausers:function(){var e=this;return this.u?M["default"].map(this.u.split(","),(function(t){return e.core.user.matrixId(t)})):[]},stateChat:function(){var e=this.$route.query.id;return this.$store.state.chatsMap[e]},invited:function(){return this.chat?M["default"].map(M["default"].filter(this.chat.currentState.getMembers(),(function(e,t){return"invite"===e.membership})),(function(e){return e.userId})):this.u?this.ausers:[]},joined:function(){if(!this.chat)return[];this.chat.roomId;var e=[];return this.chat.currentState.getMembers().forEach((function(t){"join"===t.membership&&e.push(t.userId)})),e},tipusers:function(){if(null===this.tipvalue)return[];if(""===this.tipvalue)return this.userlist;var e=this.tipvalue.toLowerCase(),t=M["default"].filter(this.userlist,(function(t){return 0==t.name.toLowerCase().indexOf(e)&&t.name.toLowerCase()!=e}));return t},maintipuser:function(){return this.tipusers.length?this.tipusers[this.tipuserindex||0]:null},recordViewData:function(){if(this.recordRmsData.length){var e=this.recordRmsData.length,t=this.recordRmsData.length/100;if(e>100){for(var i=[],n=0;n<100;n++)i.push(this.recordRmsData[Math.round(n*t)]);return i}}return this.recordRmsData}}),created:function(){},mounted:function(){this.ready=!0,!this.chat&&this.core.mtrx.client&&this.newchat().catch((function(e){return Promise.resolve()}))},methods:{wait:function(){var e=this;return this.$f.pretry((function(){return e.core.mtrx.client&&e.core.mtrx.access}))},browsetip:function(e){e?this.tipuserindex++:this.tipuserindex--,this.tipuserindex>this.tipusers.length-1&&(this.tipuserindex=0),this.tipuserindex<0&&(this.tipuserindex=this.tipusers.length-1)},selectcurrenttip:function(){this.insertuser(this.tipusers[this.tipuserindex||0])},insertuser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name||"";this.$refs["newinput"].inserttip(t)},tipBySearch:function(e){this.tipvalue=e},showuserselected:function(e,t){this[t](e)},sendtransactionWrapper:function(){var e=this;this.menuIsVisible=!1;var t=M["default"].filter(M["default"].map(this.joined,(function(t){return e.$f.deep(e,"$store.state.users."+e.$f.getmatrixid(t))||null})),(function(t){var i;return t&&t.source&&t.id!=(null===(i=e.core.user.userinfo)||void 0===i?void 0:i.id)}));if(!t.length)return"users.length";t.length>1?this.core.store.commit("setmodal",{caption:this.$i18n.t("caption.sendTransactionTo"),type:"showuserselect",data:{users:t,action:"sendtransaction",userselected:function(t){e.showuserselected(t,"sendtransaction")}}}):this.sendtransaction(t[0]),this.$refs.dropdownMenu.hidePopup()},sendtransaction:function(e){var t=this.transaction;t({roomid:this.chat.roomId,address:e.source.address})},emitInputData:function(){this.$emit("emptyInput"),this.upload=!0},HideUploadPic:function(){this.upload=!1},emitUrl:function(e){this.$emit("setMetaUrl",e)},newchat:function(){var e=this;if(this.u){this.$store.state.globalpreloader=!0;var t=null,i=null,n="";return this.creating=!0,this.core.user.usersInfo(this.uusers).then((function(i){if(1==e.uusers.length){var r=i[0];if(!r||!r.keys||r.keys.length<12)return e.$emit("cantchatcrypto"),Promise.reject("ny2")}if(e.core.user.userinfo.keys.length<12)return e.$emit("cantchatcrypto"),Promise.reject("ny2");n=e.core.mtrx.kit.tetatetid(i[0],e.core.user.userinfo),t=e.core.user.matrixId(i[0].id),e.core.user.matrixId(e.core.user.userinfo.id);var a=[{type:"m.set.encrypted",state_key:"",content:{encrypted:!0}}];return e.core.mtrx.client.createRoom({room_alias_name:n,visibility:"private",invite:[t],name:"#"+n,initial_state:a})})).then((function(n){i=n,e.$store.state.globalpreloader=!1;var r=e.core.mtrx.client.getRoom(n.room_id),a=r.currentState.getStateEvents("m.room.power_levels");return e.core.mtrx.client.setPowerLevel(i.room_id,t,100,a[0]).catch((function(e){}))})).then((function(t){return e.creating=!1,e.connect&&e.connect==n&&e.greetings(),e.$store.commit("CONTACT",!1),Promise.resolve()})).catch((function(t){return e.creating=!1,e.$store.state.globalpreloader=!1,t&&"M_ROOM_IN_USE"==t.errcode?e.core.mtrx.client.joinRoom("#"+n+":"+e.core.mtrx.baseUrl.replace("https://","")).then((function(){})).catch((function(e){})):Promise.reject(t)}))}return Promise.reject("u")},maySendMessage:function(){return this.chat&&this.chat.maySendMessage()},greetings:function(){this.send("👋").then((function(e){return Promise.resolve(e)}))},sendinput:function(e){this.send(e).then((function(e){return Promise.resolve(e)}))},textCutLimit:function(e,t){return e=e.trim(),e.length<=t?e:(e=e.slice(0,t),e.trim()+"...")},replaceMentions:function(e){return M["default"].each(this.userlist,(function(t){e=e.replace(new RegExp("@"+t.name,"g"),"@"+t.id+":"+t.name)})),e},send:function(e){var t=this;return this.chat||this.newchat().catch((function(e){})),this.$emit("sending"),this.relationEvent||this.focus(),this.$f.pretry((function(){return t.chat&&!t.creating})).then((function(i){return t.$emit("sent"),e=t.replaceMentions(e),t.relationEvent&&"m.replace"==t.relationEvent.type&&t.relationEvent.event?t.core.mtrx.textEvent(t.chat,e).then((function(e){e["m.relates_to"]={rel_type:"m.replace",event_id:t.core.mtrx.clearEventId(t.relationEvent.event)||d["a"].makeid()};var i=e;return t.relationEvent.event.event.content.body=e.body,t.relationEvent.event.event.content.block=e.block,t.relationEvent.event.event.content.msgtype=e.msgtype,delete t.relationEvent.event.event.decryptKey,delete t.relationEvent.event.event.decrypted,t.core.mtrx.client.sendEvent(t.chat.roomId,"m.room.message",i)})).then((function(e){return t.core.store.dispatch("FETCH_EVENTS"),t.$emit("clearRelationEvent"),t.$emit("force"),Promise.resolve()})).catch((function(e){return Promise.reject(e)})):t.core.mtrx.sendtext(t.chat,e,{relation:t.relationEvent})})).catch((function(e){t.$emit("sentMessageError",{error:e})}))},pasteImage:function(e){this.sendImage({base64:e})},sendImage:function(e){var t=this,i=e.base64,n=(e.file,d["a"].makeid()),r={type:"image",id:n,base64:i};this.$emit("sendingData",r),this.$f.pretry((function(){return t.chat})).then((function(){return r.aborted?Promise.reject("aborted"):t.core.mtrx.sendImage(t.chat,i,null,r,{relation:t.relationEvent})})).then((function(e){return t.$emit("sentData",{id:n}),Promise.resolve()})).catch((function(e){return t.$emit("sentError",{id:n,error:e}),Promise.resolve()}))},canencryptfilesize:function(e){var t=10485760;return this.chat.pcrypto.canBeEncrypt()&&e.size>t?this.$dialog.confirm("Files larger than 10 megabytes are not encrypted. Do you want to send the file unencrypted?",{okText:"Yes",cancelText:"No, cancel"}).then((function(e){return Promise.resolve(!0)})).catch((function(e){return Promise.reject("cancel")})):Promise.resolve(!1)},sendFile:function(e){var t=this,i=e.file,n=d["a"].makeid(),r={type:"file",id:n,info:{name:i.name,size:i.size}};this.$emit("sendingData",r),this.$f.pretry((function(){return t.chat})).then((function(){return t.canencryptfilesize(i)})).then((function(e){return t.core.mtrx.sendFile(t.chat,i,r,{relation:t.relationEvent},e)})).then((function(){return t.$emit("sentData",{id:n}),Promise.resolve()})).catch((function(e){t.$emit("sentError",{id:n,error:e})}))},focus:function(){this.$refs["newinput"]&&this.$refs["newinput"].focus()},focused:function(){this.$emit("focused")},blur:function(){this.$refs["newinput"]&&this.$refs["newinput"].blur()},blurifempty:function(){this.$refs["newinput"]&&this.$refs["newinput"].blurifempty()},change:function(){},setText:function(e){this.text=e,this.$refs["newinput"]&&this.$refs["newinput"].setText(e)},keyup:function(e){var t=e.target.value;""!==t?(this.$emit("inputClean",!0),this.text=t,this.anyUrlMeta=d["a"].getUrl(this.text),void 0!==this.anyUrlMeta?this.$emit("setMetaUrl",this.anyUrlMeta):this.$emit("inputClean",!1),this.chat&&this.core.mtrx.client.sendTyping(this.chat.roomId,!0,100)):this.$emit("inputClean",!1)},menuItemClick:function(e,t){this[e.click](t)},menuItemLoadedHandler:function(e){return this.menuIsVisible=e,this.menuIsVisible},uploadStart:function(e,t){},uploadError:function(e,t){this.$store.commit("icon",{icon:"error",message:t.text})},getImg:function(){return this.imgs=!0},uploadSizeError:function(e){e||this.$refs.dropdownMenu.hidePopup()},uploadUploaded:function(e,t){var i=["image/gif","image/jpeg","image/png","image/webp"];if(i.includes(t.file.type))return this.sendImage(t);this.sendFile(t)},imageWH:function(e){var t=new Image,i={};return new Promise((function(n,r){t.onload=function(){i.w=this.width,i.h=this.height,n(i)},t.onerror=function(e){r(e)},t.src=e.base64}))},uploadUploadedAll:function(e,t){this.$store.state.loading=!1,this.$refs.dropdownMenu.hidePopup()},initMediaRecorder:function(){var e=this;return Object(a["a"])(c.a.mark((function t(){return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){t.next=5;break}return console.log("getUserMedia supported."),t.abrupt("return",navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){var t=new L["a"](e,{mimeType:"audio/wav"});return t.stream=e,t})).catch((function(e){throw console.log("The following getUserMedia error occured: "+e),this.microphoneDisabled=!0,new Error(e)})));case 5:return console.log("getUserMedia not supported on your browser!"),e.microphoneDisabled=!0,t.abrupt("return",!1);case 8:case"end":return t.stop()}}),t)})))()},initRecording:function(){var e=this;return Object(a["a"])(c.a.mark((function t(){return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.mediaRecorder){t.next=12;break}return console.log("init recorder"),t.next=5,e.initMediaRecorder();case 5:e.mediaRecorder=t.sent,e.audioContext=new(window.AudioContext||window.webkitAudioContext),e.audioAnalyser=e.audioContext.createAnalyser(),e.audioDataArray=new Uint8Array(e.audioAnalyser.frequencyBinCount),e.mediaRecorder.ondataavailable=function(){var t=Object(a["a"])(c.a.mark((function t(i){return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",e.createVoiceMessage(i));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.src=e.audioContext.createMediaStreamSource(e.mediaRecorder.stream),e.src.connect(e.audioAnalyser);case 12:if(!e.microphoneDisabled||!e.mediaRecorder){t.next=15;break}return e.microphoneDisabled=!1,t.abrupt("return");case 15:e.isRecording=!0,t.next=22;break;case 18:return t.prev=18,t.t0=t["catch"](0),e.microphoneDisabled=!0,t.abrupt("return",e.$dialog.confirm("Access to the microphone is restricted, please check your browser settings.",{okText:"Yes"}));case 22:e.startRecording();case 23:case"end":return t.stop()}}),t,null,[[0,18]])})))()},startRecording:function(){var e=this;try{this.blockTextSelection(),this.cancelOpacity=0,this.recordRmsData=[],this.recordTime=0,this.record=null,this.mediaRecorder.stream.getTracks().forEach((function(e){e.enabled=!0})),this.mediaRecorder.start(),this.interval=setInterval((function(){e.dataArray=new Uint8Array(e.audioAnalyser.frequencyBinCount),e.audioAnalyser.getByteFrequencyData(e.dataArray),e.recordRmsData.push(e.generateRms(e.dataArray)),e.recordTime=e.recordTime+50}),50)}catch(t){this.unblockTextSelection(),console.log("startRecord",t)}},createVoiceMessage:function(e){var t=this;return Object(a["a"])(c.a.mark((function i(){var n,r,a,s;return c.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:console.log("createVoiceMessage",e),n=URL.createObjectURL(e.data),r=new Audio(n),a=t.audioContext.createMediaElementSource(r),s=d["a"].makeid(),r.addEventListener("loadedmetadata",(function(){var e=function e(){r.removeEventListener("timeupdate",e),r.currentTime=0,r.duration<1?t.clear():t.record.duration=r.duration.toPrecision(4)};r.duration===1/0&&(r.currentTime=1e101,r.addEventListener("timeupdate",e))})),t.record={audio:r,file:e.data,track:a,id:s,isPlaying:!1},console.log("create message",t.record);case 8:case"end":return i.stop()}}),i)})))()},generateRms:function(e){return+Math.sqrt(e.reduce((function(e,t){return e+Math.pow(t,2)}))/e.length).toPrecision(4)},stopRecording:function(){this.mediaRecorder.stream.getTracks().forEach((function(e){e.enabled=!1})),this.mediaRecorder.stop(),this.isRecording=!1,clearInterval(this.interval),console.log("stop recording",this.record),this.unblockTextSelection()},sendVoiceMessage:function(){var e=this;return Object(a["a"])(c.a.mark((function t(){var i,n,r;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.recordRmsData=[],t.next=3,e.convertAudioToBase64(e.record.file);case 3:i=t.sent,n=d["a"].makeid(),r={type:"audio",id:n,base64:i},e.$f.pretry((function(){return e.chat})).then((function(){return e.core.mtrx.sendAudio(e.chat,i,null,r,{relation:e.relationEvent})})).catch((function(t){return e.$emit("sentError",{id:n,error:t}),Promise.resolve()})),console.log("message sended");case 8:case"end":return t.stop()}}),t)})))()},clear:function(){this.record=null,this.recordRmsData=[]},convertAudioToBase64:function(e){return Object(a["a"])(c.a.mark((function t(){var i;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new FileReader,i.readAsDataURL(e),t.abrupt("return",new Promise((function(e){i.onloadend=function(){e(i.result)}})));case 3:case"end":return t.stop()}}),t)})))()},setOpacity:function(e){this.cancelOpacity=e}}},q=N;function B(e){var t=i("e423");t.__inject__&&t.__inject__(e)}var H=Object(w["a"])(q,n,r,!1,B,"22eb6a42",null,!0);t["default"]=H.exports}}]);
//# sourceMappingURL=matrix-element.6.min.js.map