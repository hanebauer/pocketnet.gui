(window["matrixElement_jsonp"]=window["matrixElement_jsonp"]||[]).push([[6],{"0a92":function(t,e,i){var n=i("5ce7");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=i("35d6").default;t.exports.__inject__=function(t){r("666bb0a0",n,t)}},1050:function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,"#matrix-root[theme=white] .inputWrapper>div[data-v-27b50ebe]{transition:.3s}#matrix-root[theme=white] .inputWrapper .center[data-v-27b50ebe]{border:1px solid transparent;background:#fafafa}#matrix-root[theme=white] .inputWrapper input[data-v-27b50ebe]{border:1px solid hsla(0,0%,43.9%,.3);background:hsla(0,0%,92.5%,.5)}#matrix-root[theme=white] .menu-item[data-v-27b50ebe]{background:#fff}#matrix-root[theme=white] .tipusers[data-v-27b50ebe]{border:1px solid hsla(0,0%,92.5%,.9);background-color:hsla(0,0%,100%,.95)}#matrix-root[theme=white] .tipusers .previewWrapperExt.selected[data-v-27b50ebe]{background:rgba(0,42,82,.05)}",""]),t.exports=e},"1b4c":function(t,e,i){"use strict";i.r(e);var n=i("8479");for(var r in n)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(r)},2816:function(t,e,i){var n=i("c4a4");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=i("35d6").default;t.exports.__inject__=function(t){r("7023ce0a",n,t)}},"51a6":function(t,e,i){var n=i("1050");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=i("35d6").default;t.exports.__inject__=function(t){r("33f28408",n,t)}},"5ce7":function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,".wrapper[data-v-4b882d9f]{position:relative}.fas[data-v-4b882d9f]{position:absolute;right:-8px;top:-8px}.preview-picture[data-v-4b882d9f]{width:50px;height:50px;border-radius:10px}",""]),t.exports=e},8479:function(t,e,i){var n=i("a6ce");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=i("35d6").default;t.exports.__inject__=function(t){r("f363ce8a",n,t)}},8510:function(t,e,i){var n=i("f163");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var r=i("35d6").default;t.exports.__inject__=function(t){r("1976caaf",n,t)}},"8d1e":function(t,e,i){"use strict";i.r(e);var n=i("51a6");for(var r in n)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(r)},9544:function(t,e,i){"use strict";i.r(e);var n=i("8510");for(var r in n)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(r)},a6ce:function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,"#matrix-root[theme=black] .inputWrapper>div[data-v-27b50ebe]{transition:.3s}#matrix-root[theme=black] .inputWrapper .center[data-v-27b50ebe]{border:1px solid transparent;background:#00162c}#matrix-root[theme=black] .inputWrapper input[data-v-27b50ebe]{border:1px solid rgba(121,130,132,.3);background:rgba(11,21,32,.5)}#matrix-root[theme=black] .menu-item[data-v-27b50ebe]{background:#00060c}#matrix-root[theme=black] .tipusers[data-v-27b50ebe]{border:1px solid rgba(11,21,32,.9);background-color:rgba(0,6,12,.95)}#matrix-root[theme=black] .tipusers .previewWrapperExt.selected[data-v-27b50ebe]{background:hsla(0,0%,75.3%,.05)}",""]),t.exports=e},c4a4:function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,"#chatInput[data-v-27b50ebe]{padding-bottom:.5em}[data-v-27b50ebe] #modal.minimized .modal-wrapper{left:0}[data-v-27b50ebe] .previewWrapper{padding-left:.5em!important;padding-right:.5em!important}.inputWrapper[data-v-27b50ebe]{display:flex}.inputWrapper .left[data-v-27b50ebe]{width:35px;text-align:center}.inputWrapper .left .iconbutton[data-v-27b50ebe]{width:35px}.inputWrapper .leftdummy[data-v-27b50ebe]{width:.5em}.inputWrapper>div[data-v-27b50ebe]{transition:.3s}.inputWrapper .center[data-v-27b50ebe]{max-height:110px;display:flex;justify-content:center;align-items:center;flex-grow:1;border:1px solid transparent;border-radius:30px;padding-right:.5em;background:#fafafa}.inputWrapper input[data-v-27b50ebe]{border:1px solid hsla(0,0%,43.9%,.3);background:hsla(0,0%,92.5%,.5);border-radius:30px;width:100%;padding:.5em 1em}.notready[data-v-27b50ebe],.waitjoined[data-v-27b50ebe]{padding:.5em 0;text-align:center}.waitjoined span[data-v-27b50ebe]{font-size:.8em}.greetings[data-v-27b50ebe]{padding:.5em 0}.greetings[data-v-27b50ebe],[data-v-27b50ebe] .iconWrapper{text-align:center}.menu-item[data-v-27b50ebe]{padding:.5em;background:#fff;line-height:44px;border-radius:5px;display:flex}.menu-item .title[data-v-27b50ebe]{flex-grow:2;padding-right:44px;text-align:center}.menu-item .iconWrapper[data-v-27b50ebe]{width:44px}.tipusers[data-v-27b50ebe]{position:absolute;max-height:300px;border-radius:.5em;border:1px solid hsla(0,0%,92.5%,.9);overflow-y:overlay;background-color:hsla(0,0%,100%,.95);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);padding:.25em 0;bottom:100%;margin-bottom:.5em;left:.25em;right:.25em}.tipusers .previewWrapperExt[data-v-27b50ebe]{border-radius:.75em;margin-left:.25em;margin-right:.25em;padding-top:.25em;padding-bottom:.25em}.tipusers .previewWrapperExt[data-v-27b50ebe] .previewWrapper{padding-left:.25em!important;padding-right:.25em!important}.tipusers .previewWrapperExt.selected[data-v-27b50ebe]{background:rgba(0,42,82,.05)}",""]),t.exports=e},cff80:function(t,e,i){"use strict";i.r(e);var n=i("0a92");for(var r in n)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(r)},d421:function(t,e,i){"use strict";i.r(e);var n=i("2816");for(var r in n)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(r)},f163:function(t,e,i){var n=i("24fb");e=n(!1),e.push([t.i,".input-component[data-v-1e026521]{width:100%;display:flex;justify-content:center;align-items:center;padding:0 1em;padding-right:0}.input-component[data-v-1e026521] .emoji-mart .emoji-mart-emoji{width:25%;height:40px;cursor:pointer}.input-component[data-v-1e026521] .emoji-mart .emoji-mart-emoji span{cursor:pointer}.input-component[data-v-1e026521] .emoji-mart .emoji-mart-emoji:hover{background:none;box-shadow:none}.input-component[data-v-1e026521] .emoji-mart .emoji-mart-emoji:hover:before{display:none}.input-component .input-wrapper[data-v-1e026521]{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;position:relative;width:100%}.input-component .right[data-v-1e026521]{margin:0 .5em}.input-component .iconbutton .leftdummy[data-v-1e026521]{width:20px}.input-component .iconbutton .rightdummy[data-v-1e026521]{width:35px}.input-component .iconbutton .idummy[data-v-1e026521]{width:100%;height:35px;line-height:35px}.input-component .iconbutton .idummy i[data-v-1e026521]{line-height:35px!important}.input-component .previews[data-v-1e026521]{width:100%;max-width:198px;height:30px;display:flex;align-items:flex-start;padding:2px 0;overflow:hidden}.input-component .previews[data-v-1e026521]:first-child{margin-left:0}.input-component .textarea[data-v-1e026521]{width:100%;display:flex;justify-content:flex-start;align-items:center}.chat-input[data-v-1e026521]{width:100%;max-height:100px;overflow-y:auto;resize:none}.chat-input[data-v-1e026521]::-webkit-scrollbar{width:0!important}.fade-enter-active[data-v-1e026521],.fade-leave-active[data-v-1e026521]{transition:all .2s ease-in}.fade-enter[data-v-1e026521],.fade-leave-to[data-v-1e026521]{opacity:0}",""]),t.exports=e},fe01:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"chatInput"}},[t.ready?i("div",{staticClass:"work"},[t.chat?i("div",{staticClass:"inputWrapper"},[t.tipusers.length?i("div",{staticClass:"tipusers"},t._l(t.tipusers,(function(e,n){return i("div",{key:e.id,staticClass:"previewWrapperExt",class:{selected:t.tipuserindex==n},on:{click:function(i){return t.insertuser(e)}}},[i("preview",{attrs:{contact:e,mode:""}})],1)})),0):t._e(),i("div",{staticClass:"center"},[i("InputField",{ref:"newinput",attrs:{storagekey:"chatinput"+t.chat.roomId,tipusers:t.tipusers},on:{transaction:t.sendtransaction,chatMessage:t.sendinput,setMetaUrl:t.emitUrl,emptyInput:t.emitInputData,FilledInput:t.HideUploadPic,base64:t.pasteImage,focused:t.focused,tipsearchrequest:t.tipBySearch,browsetip:t.browsetip,selectcurrenttip:t.selectcurrenttip}}),t.upload&&t.chat?i("div",{staticClass:"left"},[i("div",{staticClass:"iconbutton"},[i("dropdownMenu",{ref:"dropdownMenu",attrs:{menuItems:t.menuItems,rowObject:{},icon:"fas fa-plus"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.item.upload?i("upload",{attrs:{multiple:e.item.upload.multiple,extensions:e.item.upload.extensions,images:e.item.upload.images},on:{start:function(i){return t.uploadStart(e.item,i)},uploaded:function(i){return t.uploadUploaded(e.item,i)},uploadedAll:function(i){return t.uploadUploadedAll(e.item,i)},error:function(i){return t.uploadError(e.item,i)}},scopedSlots:t._u([{key:"content",fn:function(){return[i("div",{staticClass:"menu-item"},[i("div",{staticClass:"iconWrapper"},[e.item.icon?i("i",{class:e.item.icon}):t._e()]),i("div",{staticClass:"title"},[t._v(" "+t._s(e.item.title)+" ")])])]},proxy:!0},{key:"dropzone",fn:function(){},proxy:!0}],null,!0)}):i("div",{staticClass:"menu-item",on:{click:function(i){return t.menuItemClick(e.item)}}},[i("div",{staticClass:"iconWrapper"},[e.item.icon?i("i",{class:e.item.icon}):t._e()]),i("div",{staticClass:"title"},[t._v(" "+t._s(e.item.title)+" ")])])]}}],null,!1,2831926823)})],1)]):t._e()],1)]):t._e()]):i("div",{staticClass:"notready"},[i("linepreloader")],1)])},r=[],a=i("5530"),s=(i("d81d"),i("ac1f"),i("1276"),i("4de4"),i("159b"),i("b0c0"),i("d3b7"),i("e6cf"),i("e260"),i("ddb0"),i("5319"),i("498a"),i("fb6a"),i("4d63"),i("25f0"),i("caad"),i("3139")),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"input-component"},[i("div",{staticClass:"input-wrapper"},[i("div",{staticClass:"textarea"},[i("textarea",{ref:"textarea",staticClass:"chat-input",attrs:{id:"textInput",type:"text",row:"1",spellcheck:"true",autocorrect:"on",placeholder:"Send message"},domProps:{value:t.text},on:{focus:t.focused,blur:t.blured,keydown:t.keydown,input:t.textchange,keyup:t.keyup,click:t.keyup,paste:t.paste_image}}),t.mobile?t._e():i("transition",{attrs:{name:"fade",mode:"out-in"}},[i("picker",{directives:[{name:"show",rawName:"v-show",value:t.display_emoji,expression:"display_emoji"},{name:"click-outside",rawName:"v-click-outside",value:t.close_emoji_picker,expression:"close_emoji_picker"}],style:{width:"325px",position:"absolute",bottom:"32px",right:"-60px",fontSize:"0.8em",fontFamily:"Segoe UI"},attrs:{data:t.emojiIndex,exclude:t.exclude,showPreview:!1,showSearch:!1,native:!0,set:"emojione"},on:{select:t.insert_emoji}})],1)],1)]),t.mobile?t._e():i("div",{staticClass:"iconbutton emojipicker",on:{click:function(e){return t.toggle_emoji_picker()}}},[i("div",{staticClass:"leftdummy"},[i("div",{staticClass:"idummy"},[t.display_emoji?i("i",{staticClass:"fas fa-times"}):i("i",{staticClass:"far fa-smile"})])])]),t.send?i("div",{staticClass:"iconbutton",on:{click:function(e){return t.send_text(e)}}},[t._m(0)]):t._e()])},c=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"rightdummy"},[i("div",{staticClass:"idummy"},[i("i",{staticClass:"far fa-paper-plane"})])])}],u=(i("2532"),i("466d"),i("5059")),d=i("364d"),l=(i("01ce"),i("41fb")),p=i("c28b"),h=i.n(p),m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.is_opened?i("div",{staticClass:"wrapper"},[i("img",{staticClass:"preview-picture",attrs:{src:t.base64,alt:"picture preview"}}),i("i",{staticClass:"fas fa-times fa-sm",on:{click:t.hide}})]):t._e()},f=[],v={name:"picturePreview",props:["base64"],data:function(){return{is_opened:!0}},methods:{hide:function(){this.is_opened=!1}}},g=v,x=i("2877");function b(t){var e=i("cff80");e.__inject__&&e.__inject__(t)}var _=Object(x["a"])(g,m,f,!1,b,"4b882d9f",null,!0),y=_.exports,w=new l["EmojiIndex"](d),k=new u["a"],$={name:"InputField",components:{Picker:l["Picker"],picturePreview:y},directives:{clickOutside:h.a.directive},watch:{text:{immediately:!0,handler:function(t,e){t?(this.send=!0,this.$emit("FilledInput")):(this.send=!1,this.$emit("emptyInput")),this.textarea_resize()}}},computed:{mobile:function(){return!this.$store.state.pocketnet&&this.$store.state.mobile}},methods:{setText:function(t){var e=this;this.text=t,this.savetextinstorage(),setTimeout((function(){e.textarea_resize(),e.focus()}))},focused:function(){this.$emit("focused")},textchange:function(t){this.text=t.target.value||""},savetextinstorage:function(){this.storagekey&&(localStorage[this.storagekey]=this.text||"")},send_empty_array:function(){this.$emit("userSearched",[])},focus:function(){this.$refs["textarea"].focus()},blur:function(){this.$refs["textarea"].blur()},blurifempty:function(){this.text||this.blur()},close_emoji_picker:function(t){"i"!==t.target.localName&&"matrix-element"!==t.target.localName&&(this.display_emoji=!1)},textarea_resize:function(){this.text?(this.$refs.textarea.style.height="1px",this.$refs.textarea.style.height=this.$refs.textarea.scrollHeight+"px",this.display_emoji=!1):this.textarea_resize_reset()},textarea_resize_reset:function(){this.$refs.textarea.style.height="26px"},toggle_emoji_picker:function(){this.display_emoji=!this.display_emoji},send_text:function(t){this.text&&"\n"!==this.text&&(this.display_emoji=!1,this.$emit("chatMessage",this.text),this.$emit("emptyInput"),this.send=!1,this.text=""),this.savetextinstorage()},insert_emoji:function(t){this.text+=t.native,this.savetextinstorage()},paste_image:function(t){this.get_base64(t)},get_base64:function(t){var e=this;if(this.pasted_data=t.clipboardData.items,this.pasted_data.length){var i=function(t){var i=e.pasted_data[t],n=e.upload.extensions.includes(i.type);n&&(r=i.getAsFile(),a=new FileReader,a.onload=function(t){e.$dialog.confirm("Do you really want to send attachment?",{okText:"Yes",cancelText:"No, cancel"}).then((function(n){var r=t.target.result;e.resize_image(r,i.type)}))},a.readAsDataURL(r))};for(var n in this.pasted_data){var r,a;i(n)}}},resize_image:function(t,e){var i=this;return k.autorotation(null,t).then((function(t){var n=i.upload.images.resize.type||"def";return k.resize[n](t,1024,1024,e,.9).then((function(t){i.$emit("base64",t)})).catch((function(t){return console.error("Failed to resize image",t)}))})).catch((function(t){return console.error("Failed to resize image",t)}))},getsearchposition:function(t){if(!t.start||!this.text.length)return null;var e={start:t.start,middle:0,end:t.end},i=t.start,n=!1,r=!1,a=/[a-zA-Z0-9]{1}/;e.middle=i;do{var s=this.text[i];"@"==s?t.start==i||i>0&&a.test(this.text[i-1])?r=!0:n=!0:a.test(s)?e.start=i:r=!0,i--}while(i>=0&&i<=t.start&&!n&&!r);if(n){r=!1,i=t.end;do{!this.text[i]||a.test(this.text[i])?e.end=i:r=!0,i++}while(i<=this.text.length&&!r)}else e=null;return e},getsearch:function(t){var e=this.getsearchposition(t);return e?this.text.substring(e.start,e.middle):null},keydown:function(t){return(40===t.keyCode||38===t.keyCode)&&this.tipusers&&this.tipusers.length?(this.$emit("browsetip",40===t.keyCode),t.preventDefault(),!1):(39===t.keyCode||13===t.keyCode)&&this.tipusers&&this.tipusers.length?(this.$emit("selectcurrenttip"),t.preventDefault(),!1):13===t.keyCode?(this.mobile?this.text=this.text+"\n":this.send_text(t),t.preventDefault(),!1):void 0},keyup:function(t){if(this.block)return t.preventDefault(),!1;var e=s["a"].getCaretPosition(this.$refs["textarea"]),i=this.getsearch(e);this.$emit("tipsearchrequest",i),this.savetextinstorage()},blured:function(){var t=this;setTimeout((function(){t.$emit("tipsearchrequest",null)}),300)},inserttip:function(t){var e=this;this.$emit("tipsearchrequest",null),this.block=!0,this.$refs["textarea"];var i=this.getsearchposition(s["a"].getCaretPosition(this.$refs["textarea"]));this.text=this.text.substring(0,i.start)+t+this.text.substring(i.end+1),this.text[i.end+1]||(this.text=this.text+" ")," "==!this.text[i.end+1]&&i.end++,s["a"].setCaretPosition(this.$refs["textarea"],i.end+1,i.end+1),setTimeout((function(){e.block=!1}),350)}},props:{storagekey:String,tipusers:Array},data:function(){return{emojiIndex:w,send:!1,toMatch:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i],isPhone:!0,heightUp:40,areaValue:"",ready:!1,text:"",exclude:["flags"],display_emoji:!1,content_height:26,pasted_data:[],block:!1,upload:{multiple:!0,extensions:["image/jpg","image/jpeg","image/png"],images:{resize:{type:"fit"}}},hidden_previews:null}},creared:function(){},mounted:function(){this.mobile||this.focus(),this.isPhone=this.toMatch.some((function(t){return navigator.userAgent.match(t)})),this.$refs.textarea.style.height="26px",this.storagekey&&localStorage[this.storagekey]&&(this.text=localStorage[this.storagekey])}},j=$;function C(t){var e=i("9544");e.__inject__&&e.__inject__(t)}var I=Object(x["a"])(j,o,c,!1,C,"1e026521",null,!0),E=I.exports,P=i("c46f"),M=i("2f62"),W=i("f978"),z=i("92a6"),S={name:"chatInput",props:{chat:Object,u:String,relationEvent:Object},components:{InputField:E,contacts:W["default"],preview:z["a"]},data:function(){return{upload:!0,test:[],loading:!1,text:"",file:{},fileInfo:{},ready:!1,creating:!1,userId:"",showuserselect:null,anyUrlMeta:String,joinedMembers:[],tipvalue:null,tipuserindex:0}},watch:{usersForKeysHash:{handler:function(){}},tipusers:function(){this.tipusers.length?this.tipuserindex>this.tipusers.length-1&&(this.tipuserindex=this.tipusers.length-1):this.tipuserindex=0}},computed:Object(a["a"])(Object(a["a"])({connect:function(){return this.$store.state.contact},menuItems:function(){var t=[];return this.relationEvent||(t.push({click:"cameraHandler",title:this.$i18n.t("button.takePhotoOrVideo"),icon:"fas fa-camera",upload:{multiple:!0,extensions:["jpg","jpeg","png","webp"],maxsize:100,images:{resize:{type:"fit"}}}}),t.push({click:"fileHandler",title:this.$i18n.t("button.sendFile"),icon:"fas fa-sticky-note",upload:{multiple:!0,extensions:[],maxsize:25,images:{resize:{type:"fit"}}}})),this.transaction&&t.unshift({click:"sendtransactionWrapper",title:this.$i18n.t("button.sendCoins"),icon:"fas fa-wallet"}),t}},Object(M["c"])(["chats"])),{},{userlist:function(){return this.chat?this.core.mtrx.chatUsersInfo(this.chat.roomId,"anotherChatUsers"):[]},transaction:function(){return s["a"].deep(window,"POCKETNETINSTANCE.platform.ui.wallet.send")},uusers:function(){return this.u?P["default"].map(this.u.split(","),(function(t){return t})):[]},ausers:function(){var t=this;return this.u?P["default"].map(this.u.split(","),(function(e){return t.core.user.matrixId(e)})):[]},stateChat:function(){var t=this.$route.query.id;return this.$store.state.chatsMap[t]},invited:function(){return this.chat?P["default"].map(P["default"].filter(this.chat.currentState.getMembers(),(function(t,e){return"invite"===t.membership})),(function(t){return t.userId})):this.u?this.ausers:[]},joined:function(){if(!this.chat)return[];this.chat.roomId;var t=[];return this.chat.currentState.getMembers().forEach((function(e){"join"===e.membership&&t.push(e.userId)})),t},tipusers:function(){if(null===this.tipvalue)return[];if(""===this.tipvalue)return this.userlist;var t=this.tipvalue.toLowerCase(),e=P["default"].filter(this.userlist,(function(e){return 0==e.name.toLowerCase().indexOf(t)&&e.name.toLowerCase()!=t}));return e},maintipuser:function(){return this.tipusers.length?this.tipusers[this.tipuserindex||0]:null}}),created:function(){},mounted:function(){this.ready=!0,!this.chat&&this.core.mtrx.client&&this.newchat().catch((function(t){return Promise.resolve()}))},methods:{wait:function(){var t=this;return this.$f.pretry((function(){return t.core.mtrx.client&&t.core.mtrx.access}))},browsetip:function(t){t?this.tipuserindex++:this.tipuserindex--,this.tipuserindex>this.tipusers.length-1&&(this.tipuserindex=0),this.tipuserindex<0&&(this.tipuserindex=this.tipusers.length-1)},selectcurrenttip:function(){this.insertuser(this.tipusers[this.tipuserindex||0])},insertuser:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.name||"";this.$refs["newinput"].inserttip(e)},tipBySearch:function(t){this.tipvalue=t},showuserselected:function(t,e){this[e](t)},sendtransactionWrapper:function(){var t=this;this.menuIsVisible=!1;var e=P["default"].filter(P["default"].map(this.joined,(function(e){return t.$f.deep(t,"$store.state.users."+t.$f.getmatrixid(e))||null})),(function(e){var i;return e&&e.source&&e.id!=(null===(i=t.core.user.userinfo)||void 0===i?void 0:i.id)}));if(!e.length)return"users.length";e.length>1?this.core.store.commit("setmodal",{caption:this.$i18n.t("caption.sendTransactionTo"),type:"showuserselect",data:{users:e,action:"sendtransaction",userselected:function(e){t.showuserselected(e,"sendtransaction")}}}):this.sendtransaction(e[0]),this.$refs.dropdownMenu.hidePopup()},sendtransaction:function(t){var e=this.transaction;e({roomid:this.chat.roomId,address:t.source.address})},emitInputData:function(){this.$emit("emptyInput"),this.upload=!0},HideUploadPic:function(){this.upload=!1},emitUrl:function(t){this.$emit("setMetaUrl",t)},newchat:function(){var t=this;if(this.u){this.$store.state.globalpreloader=!0;var e=null,i=null,n="";return this.creating=!0,this.core.user.usersInfo(this.uusers).then((function(i){if(1==t.uusers.length){var r=i[0];if(!r||!r.keys||r.keys.length<12)return t.$emit("cantchatcrypto"),Promise.reject("ny2")}if(t.core.user.userinfo.keys.length<12)return t.$emit("cantchatcrypto"),Promise.reject("ny2");n=t.core.mtrx.kit.tetatetid(i[0],t.core.user.userinfo),e=t.core.user.matrixId(i[0].id),t.core.user.matrixId(t.core.user.userinfo.id);var a=[{type:"m.set.encrypted",state_key:"",content:{encrypted:!0}}];return t.core.mtrx.client.createRoom({room_alias_name:n,visibility:"private",invite:[e],name:"#"+n,initial_state:a})})).then((function(n){i=n,t.$store.state.globalpreloader=!1;var r=t.core.mtrx.client.getRoom(n.room_id),a=r.currentState.getStateEvents("m.room.power_levels");return t.core.mtrx.client.setPowerLevel(i.room_id,e,100,a[0]).catch((function(t){}))})).then((function(e){return t.creating=!1,t.connect&&t.connect==n&&t.greetings(),t.$store.commit("CONTACT",!1),Promise.resolve()})).catch((function(e){return t.creating=!1,t.$store.state.globalpreloader=!1,e&&"M_ROOM_IN_USE"==e.errcode?t.core.mtrx.client.joinRoom("#"+n+":"+t.core.mtrx.baseUrl.replace("https://","")).then((function(){})).catch((function(t){})):Promise.reject(e)}))}return Promise.reject("u")},maySendMessage:function(){return this.chat&&this.chat.maySendMessage()},greetings:function(){this.send("👋").then((function(t){return Promise.resolve(t)}))},sendinput:function(t){this.send(t).then((function(t){return Promise.resolve(t)}))},textCutLimit:function(t,e){return t=t.trim(),t.length<=e?t:(t=t.slice(0,e),t.trim()+"...")},replaceMentions:function(t){return P["default"].each(this.userlist,(function(e){t=t.replace(new RegExp("@"+e.name,"g"),"@"+e.id+":"+e.name)})),t},send:function(t){var e=this;return this.chat||this.newchat().catch((function(t){})),this.$emit("sending"),this.relationEvent||this.focus(),this.$f.pretry((function(){return e.chat&&!e.creating})).then((function(i){return e.$emit("sent"),t=e.replaceMentions(t),e.relationEvent&&"m.replace"==e.relationEvent.type&&e.relationEvent.event?e.core.mtrx.textEvent(e.chat,t).then((function(t){t["m.relates_to"]={rel_type:"m.replace",event_id:e.core.mtrx.clearEventId(e.relationEvent.event)||s["a"].makeid()};var i=t;return e.relationEvent.event.event.content.body=t.body,e.relationEvent.event.event.content.block=t.block,e.relationEvent.event.event.content.msgtype=t.msgtype,delete e.relationEvent.event.event.decryptKey,delete e.relationEvent.event.event.decrypted,e.core.mtrx.client.sendEvent(e.chat.roomId,"m.room.message",i)})).then((function(t){return e.core.store.dispatch("FETCH_EVENTS"),e.$emit("clearRelationEvent"),e.$emit("force"),Promise.resolve()})).catch((function(t){return Promise.reject(t)})):e.core.mtrx.sendtext(e.chat,t,{relation:e.relationEvent})})).catch((function(t){e.$emit("sentMessageError",{error:t})}))},pasteImage:function(t){this.sendImage({base64:t})},sendImage:function(t){var e=this,i=t.base64,n=(t.file,s["a"].makeid()),r={type:"image",id:n,base64:i};this.$emit("sendingData",r),this.$f.pretry((function(){return e.chat})).then((function(){return r.aborted?Promise.reject("aborted"):e.core.mtrx.sendImage(e.chat,i,null,r,{relation:e.relationEvent})})).then((function(t){return e.$emit("sentData",{id:n}),Promise.resolve()})).catch((function(t){return e.$emit("sentError",{id:n,error:t}),Promise.resolve()}))},canencryptfilesize:function(t){var e=10485760;return this.chat.pcrypto.canBeEncrypt()&&t.size>e?this.$dialog.confirm("Files larger than 10 megabytes are not encrypted. Do you want to send the file unencrypted?",{okText:"Yes",cancelText:"No, cancel"}).then((function(t){return Promise.resolve(!0)})).catch((function(t){return Promise.reject("cancel")})):Promise.resolve(!1)},sendFile:function(t){var e=this,i=t.file,n=s["a"].makeid(),r={type:"file",id:n,info:{name:i.name,size:i.size}};this.$emit("sendingData",r),this.$f.pretry((function(){return e.chat})).then((function(){return e.canencryptfilesize(i)})).then((function(t){return e.core.mtrx.sendFile(e.chat,i,r,{relation:e.relationEvent},t)})).then((function(){return e.$emit("sentData",{id:n}),Promise.resolve()})).catch((function(t){e.$emit("sentError",{id:n,error:t})}))},focus:function(){this.$refs["newinput"]&&this.$refs["newinput"].focus()},focused:function(){this.$emit("focused")},blur:function(){this.$refs["newinput"]&&this.$refs["newinput"].blur()},blurifempty:function(){this.$refs["newinput"]&&this.$refs["newinput"].blurifempty()},change:function(){},setText:function(t){this.text=t,this.$refs["newinput"]&&this.$refs["newinput"].setText(t)},keyup:function(t){var e=t.target.value;""!==e?(this.$emit("inputClean",!0),this.text=e,this.anyUrlMeta=s["a"].getUrl(this.text),void 0!==this.anyUrlMeta?this.$emit("setMetaUrl",this.anyUrlMeta):this.$emit("inputClean",!1),this.chat&&this.core.mtrx.client.sendTyping(this.chat.roomId,!0,100)):this.$emit("inputClean",!1)},menuItemClick:function(t,e){this[t.click](e)},menuItemLoadedHandler:function(t){return this.menuIsVisible=t,this.menuIsVisible},uploadStart:function(t,e){},uploadError:function(t,e){this.$store.commit("icon",{icon:"error",message:e.text})},getImg:function(){return this.imgs=!0},uploadSizeError:function(t){t||this.$refs.dropdownMenu.hidePopup()},uploadUploaded:function(t,e){var i=["image/gif","image/jpeg","image/png","image/webp"];if(i.includes(e.file.type))return this.sendImage(e);this.sendFile(e)},imageWH:function(t){var e=new Image,i={};return new Promise((function(n,r){e.onload=function(){i.w=this.width,i.h=this.height,n(i)},e.onerror=function(t){r(t)},e.src=t.base64}))},uploadUploadedAll:function(t,e){this.$store.state.loading=!1,this.$refs.dropdownMenu.hidePopup()}}},U=S;function O(t){var e=i("d421");e.__inject__&&e.__inject__(t);var n=i("8d1e");n.__inject__&&n.__inject__(t);var r=i("1b4c");r.__inject__&&r.__inject__(t)}var T=Object(x["a"])(U,n,r,!1,O,"27b50ebe",null,!0);e["default"]=T.exports}}]);
//# sourceMappingURL=matrix-element.6.min.js.map