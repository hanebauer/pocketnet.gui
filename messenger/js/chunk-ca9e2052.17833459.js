(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ca9e2052"],{"266d":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page chatInfo"},[t.chat?i("topheader",{staticClass:"topheader",attrs:{chat:t.chat}}):t._e(),i("maincontent",{scopedSlots:t._u([{key:"content",fn:function(){return[t.chat?i("chatInfo",{attrs:{chat:t.chat}}):t._e()]},proxy:!0}])})],1)},n=[],o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"chatTopheader"}},[i("topheader",{scopedSlots:t._u([{key:"left",fn:function(){return[i("backButton",{attrs:{action:"back"}})]},proxy:!0},{key:"info",fn:function(){return[t.chat&&t.cog?i("router-link",{attrs:{to:"/chatSettings?id="+t.chat.roomId.replace("!","%")}},[i("span",[t._v(t._s(t.$t("caption.Info")))])]):i("span",[t._v(t._s(t.$t("caption.Info")))])]},proxy:!0},{key:"right",fn:function(){return[t.chat&&t.cog?i("router-link",{attrs:{to:"/chatSettings?id="+t.chat.roomId.replace("!","%")}},[i("i",{staticClass:"fas fa-cog"})]):t._e()]},proxy:!0}])})],1)},a=[],r={data:function(){return{cog:!1}},props:{chat:{}},mounted(){var t=this.core.mtrx.client.getRoom(this.chat.roomId);100!==t.getMember(this.core.mtrx.client.credentials.userId).powerLevel||t.tetatet||(this.cog=!0)}},c=r,l=i("2877"),m=Object(l["a"])(c,o,a,!1,null,"4f9c01ab",null),h=m.exports,u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"maskedtop",class:{minimized:t.minimized,active:t.active},attrs:{id:"chatInfo"}},[i("info",{attrs:{chat:t.chat}})],1)},d=[],p=i("2f62"),f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"aboutRoom"},[i("div",{staticClass:"roomInfoWrapper noSwipe"},[i("div",{class:{chatIconWrapper:"chatIconWrapper"}},[i("chatIcon",{attrs:{slidesPerView:4,dontuseslides:t.minimized&&!t.active,chat:t.chat,m_chat:t.m_chat,hideunseen:!1}})],1),i("chatName",{staticClass:"roomNameLine",attrs:{preview:!0,chat:t.chat,m_chat:t.m_chat}}),t.topicTxt?i("div",{staticClass:"roomInfo"},[i("span",{staticClass:"topicTxt"},[t._v(t._s(t.topicTxt))])]):t._e()],1),i("div",{staticClass:"roomAccordionsList"},[t._l(t.accordionList,(function(e,s){return i("div",{key:s,staticClass:"accordion",class:{active:t.isActive===s}},[i("div",{staticClass:"aHeader",on:{click:function(e){return t.toggleItem(s)}}},[i("div",{staticClass:"head"},[i("div",{staticClass:"leftBlock"},["members"===e.id?i("i",{staticClass:"fas fa-users"}):t._e(),"media"===e.id?i("i",{staticClass:"far fa-image"}):t._e(),"files"===e.id?i("i",{staticClass:"fas fa-folder"}):t._e(),t._v(" "+t._s(e.title)+" ")]),"members"===e.id?i("div",{staticClass:"rightBlock"},[t.membersList?i("div",{staticClass:"membersCount"},[i("span",[t._v(t._s(t.membersList.length))])]):t._e()]):t._e()])]),i("div",{staticClass:"body"},[t.isActive===s&&"members"===e.id?i("members",{attrs:{membersList:t.membersList},on:{admin:t.makeAdmin,kick:t.kickUser,ban:t.banUser}}):t._e(),t.isActive===s&&"media"===e.id?i("images",{attrs:{chat:t.m_chat}}):t._e(),t.isActive===s&&"files"===e.id?i("files",{attrs:{chat:t.m_chat,fileEvents:t.fileEvents}}):t._e()],1)])})),t.public?i("div",{staticClass:"publicRoomElements"},[i("div",{staticClass:"linkwrapper"},[i("div",{staticClass:"linkPlace"},[i("i",{staticClass:"fas fa-link",on:{click:function(e){return t.copyShareLink()}}}),i("span",{on:{click:function(e){return t.copyShareLink()}}},[t._v(t._s(t.shareRoomLink))])]),i("div",{staticClass:"sharelink"},[i("button",{staticClass:"button small rounded ghost",on:{click:t.sharelink}},[t._v(" Share "),i("i",{staticClass:"fas fa-share-alt"})])])])]):t._e()],2),i("div",{staticClass:"roomActionsList"},[t.canInvite?i("button",{staticClass:"button small rounded",on:{click:t.modalInviteUser}},[t._v(" "+t._s(t.$t("caption.add"))+" "),i("i",{staticClass:"fas fa-user-plus"})]):t._e(),i("button",{staticClass:"button small black rounded",on:{click:t.muteRoom}},[t.roomMuted?t._e():i("span",[t._v(" "+t._s(t.$t("caption.mute"))+" "),i("i",{staticClass:"fas fa-bell-slash"})]),t.roomMuted?i("span",[t._v(" "+t._s(t.$t("caption.unmute"))+" "),i("i",{staticClass:"fas fa-bell"})]):t._e()]),t.tetatet?t._e():i("button",{staticClass:"button small  rounded badbutton",on:{click:function(e){return t.forgetRoom()}}},[t._v(" "+t._s(t.$t("caption.leave"))+" "),i("i",{staticClass:"fas fa-sign-out-alt"})]),t.tetatet&&!t.blockedCheck?i("button",{staticClass:"button small  rounded badbutton",on:{click:function(e){return t.blockUser()}}},[t._v(" "+t._s(t.$t("button.block"))+" "),i("i",{staticClass:"fas fa-sign-out-alt"})]):t._e(),t.tetatet&&t.blockedCheck?i("button",{staticClass:"button small rounded",on:{click:function(e){return t.unblock()}}},[t._v(" "+t._s(t.$t("button.unblock"))+" "),i("i",{staticClass:"fas fa-sign-out-alt"})]):t._e(),t.curation?i("button",{staticClass:"button small rounded badbutton",on:{click:function(e){return t.complain()}}},[t._v(" "+t._s(t.$t("button.Complain"))+" "),i("i",{staticClass:"fas fa-exclamation-triangle"})]):t._e()]),t.inviteUserOpened?i("modal",{on:{close:t.closeModal},scopedSlots:t._u([{key:"header",fn:function(){return[i("span",[t._v(t._s(t.$t("caption.inviteUser")))])]},proxy:!0},{key:"body",fn:function(){return[i("invite",{attrs:{chatRoomId:t.chat.roomId},on:{completed:t.closeContactModal}})]},proxy:!0},{key:"footer",fn:function(){},proxy:!0}],null,!1,2878587737)}):t._e()],1)},v=[],b=i("1da1"),g=i("aa20"),k=i("3094"),I=i("0826"),w=i("71da"),y=i("3139"),C={name:"chatTopheader",props:{chat:Object,u:String,roomInfo:!1,aboutUser:!1},components:{chatName:g["a"],chatIcon:k["a"],chatTyping:I["a"],contacts:w["a"]},data:function(){return{menuItems:[{click:"callupVideoHandler",title:this.$i18n.t("caption.videocall"),icon:"fas fa-camera"},{click:"callupHandler",title:this.$i18n.t("caption.call"),icon:"fas fa-phone"}],menuItemsRoom:[{click:"AddMember",title:this.$i18n.t("caption.add"),icon:"fas fa-user-plus"},{click:"MuteRoom",title:this.$i18n.t("caption.mute"),icon:"fas fa-bell-slash"},{click:"LeaveFromRoom",title:this.$i18n.t("caption.leaveAndDelete"),icon:"fas fa-sign-out-alt"}],menuItemsRoomMuted:[{click:"AddMember",title:this.$i18n.t("caption.add"),icon:"fas fa-user-plus"},{click:"MuteRoom",title:this.$i18n.t("caption.unmute"),icon:"fas fa-bell"},{click:"LeaveFromRoom",title:this.$i18n.t("caption.leaveAndDelete"),icon:"fas fa-sign-out-alt"}],oneToOne:[{click:"MuteRoom",title:this.$i18n.t("caption.mute"),icon:"fas fa-bell-slash"},{click:"Donate",title:this.$i18n.t("caption.donate"),icon:"fas fa-money-bill-wave"}],oneToOneMuted:[{click:"MuteRoom",title:this.$i18n.t("caption.unmute"),icon:"fas fa-bell"},{click:"LeaveFromRoom",title:this.$i18n.t("caption.leaveAndDelete"),icon:"fas fa-sign-out-alt"},{click:"Donate",title:this.$i18n.t("caption.donate"),icon:"fas fa-money-bill-wave"}],donateMenu:[{click:"Donate",title:this.$i18n.t("caption.donate"),icon:"fas fa-money-bill-wave"}],loading:!1,typing:!1,userinfo:null,aboutUserShow:!1,roomBanned:!1,roomMuted:!1,donateUserOpened:!1,receiver:null,donationAmount:0,donationMessage:"",calculatedFees:null,showFeesError:"",showTransactionError:"",calculatingFees:!1,sending:!1,feesDirection:"include",feesDirectionPossibleValues:[{value:"include",label:this.$i18n.t("caption.toBePaidByReceiver")},{value:"exclude",label:this.$i18n.t("caption.toBePaidBySender")}]}},watch:{},mounted:function(){this.getuserinfo()},computed:Object(p["c"])({auth:t=>t.auth,m_chat:function(){if(this.chat&&this.chat.roomId){let e=this.core.mtrx.client._pushProcessor.getPushRuleById(this.chat.roomId);null!==e&&(this.roomMuted=!0);var t=this.core.mtrx.client.getRoom(this.chat.roomId);return t||{}}},m_chat_typing:function(){if(!this.chat)return!1;var t=this.chat.roomId,e=this.$store.state.typing[t]||{},i=_.find(e,(t,e)=>{var i;if(t)return e!=(null===(i=this.core.user.userinfo)||void 0===i?void 0:i.id)});return i||!1},totalDonationAmount:function(){return"include"==this.feesDirection?this.donationAmount:this.donationAmount+this.calculatedFees}}),methods:{navigateToProfile(t){this.$router.push({path:"/contact?id="+y["a"].getmatrixid(t)}).catch(t=>{})},getuserinfo:function(){this.u&&this.core.user.usersInfo(this.u).then(t=>{this.userinfo=t[0]})},findOtherUser:function(){let t,e=this.m_chat.myUserId,i=this.m_chat.currentState.getMembers();return i.forEach((function(i){i&&i.userId!==e&&(t=i)})),t},addMember(){this.modalInviteUser()},menuItemClickHandler(t,e){if("AddMember"===t.click&&(this.$emit("addMember",!0),this.$refs.dropdownMenu.hidePopup()),"MuteRoom"===t.click){var i=this.chat.roomId;this.core.mtrx.client.deviceId;let t=this,e=this.core.mtrx.client._pushProcessor.getPushRuleById(this.chat.roomId);null!==e?(t.core.mtrx.client.deletePushRule("global","room",i),this.roomMuted=!1):(t.core.mtrx.client.setRoomMutePushRule("global",i,"true"),this.roomMuted=!0),this.$refs.dropdownMenu.hidePopup()}if("LeaveFromRoom"===t.click){this.core.mtrx.client.leave(this.chat.roomId).then(t=>{this.core.mtrx.client.forget(this.chat.roomId,!0).then(t=>{this.$store.commit("DELETE_ROOM",this.chat.roomId)}).then(t=>{this.$router.push({path:"/chats"}).catch(t=>{})})}),this.$refs.dropdownMenu.hidePopup()}if("BanRoom"===t.click){let t="",e=this.findOtherUser();e&&e.userId&&(t=e.userId);let i=this.chat.roomId;this.core.mtrx.client.ban(i,t,"ban").then(t=>{}),this.roomBanned=!0,this.$refs.dropdownMenu.hidePopup()}if("Unban"===t.click){let t="",e=this.findOtherUser();e&&e.userId&&(t=e.userId),this.core.mtrx.client.unban(this.chat.roomId,t).then(e=>{this.core.mtrx.client.invite(this.chat.roomId,t)}),this.roomBanned=!1,this.$refs.dropdownMenu.hidePopup()}if("Donate"===t.click){this.donateUserOpened=!0,this.$refs.dropdownMenu.hidePopup();let t=this.findOtherUser();this.receiver=t?this.$f.deep(this,"$store.state.users."+this.$f.getmatrixid(t.name)):null}},closeDonateModal(){this.donateUserOpened=!1},onCalculateFeesClick(){this.calculatingFees=!0,this.calculateFees().finally(()=>this.calculatingFees=!1)},calculateFees(){var t=this;return this.showFeesError="",new Promise((e,i)=>{if(this.donationAmount<=0||!this.receiver||!this.receiver.source||!this.receiver.source.address)return this.showFeesError="invalid",i("Missing amount or receiver");try{var s=window.POCKETNETINSTANCE.platform.sdk;s.node.fee.estimate((function(n){var o=[{address:t.receiver.source.address,amount:t.donationAmount}];s.wallet.txbase([s.address.pnet().address],o,0,t.feesDirection,(function(o,a,r){if(o)return console.error(o),t.showFeesError=o,i(o);var c=s.node.transactions.create.wallet(a,r),l=Math.min(c.virtualSize()*n.feerate,.0999);return t.calculatedFees=l,e()}))}))}catch(n){return console.error(n),t.showFeesError=n,i(n)}})},sendDonation(){var t=this;return Object(b["a"])((function*(){var e=t;t.sending=!0,t.showTransactionError="";try{yield t.calculateFees()}catch(s){return t.showTransactionError="error",void(t.sending=!1)}var i=window.POCKETNETINSTANCE.platform.sdk;i.node.transactions.get.canSpend(i.address.pnet().address,t=>{if(!t||isNaN(t)||t<e.totalDonationAmount)return e.showTransactionError="balance too low",void(e.sending=!1);try{var n=[{address:e.receiver.source.address,amount:e.donationAmount}];i.wallet.embed(n,e.donationMessage),i.wallet.txbase([i.address.pnet().address],n,e.calculatedFees,e.feesDirection,(function(t,s,n){if(t)return console.error(t),e.showTransactionError="error",e.sending=!1,reject(t);var o=i.node.transactions.create.wallet(s,n);s.forEach(t=>{t.cantspend=!0}),i.node.transactions.send(o,(function(t,o){if(o)return i.node.transactions.releaseCS(s),e.showTransactionError="error",void(e.sending=!1);var a=s.map(t=>t.txid);i.node.transactions.clearUnspents(a),i.wallet.saveTempInfoWallet(t,s,n),e.core.mtrx.client.sendEvent(e.chat.roomId,"m.room.message",{from:e.$f.getmatrixid(e.m_chat.myUserId),to:e.receiver.id,amount:e.donationAmount,txId:t,msgtype:"m.notice"},""),e.closeDonateModal()}))}))}catch(s){console.error(s),e.showTransactionError="error",e.sending=!1}})}))()},resetDonation(){this.calculatedFees=null,this.showFeesError="",this.showTransactionError=""}}},$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{minimized:t.minimized,active:t.active},attrs:{id:"chatinvite"}},[i("div",{staticClass:"selectedtype"},[i("div",{staticClass:"completewrapper"},[i("button",{staticClass:"button small rounded",class:{orange:t.cancomplete,ghost:!t.cancomplete},on:{click:function(e){return t.complete()}}},[t._v(" Invite ")])])]),i("div",{staticClass:"creationbody"},[i("div",{staticClass:"contactswrapper"},[i("contacts",{attrs:{mode:"Selectmany"},on:{selectedUsers:t.selectedUsers}})],1)])])},x=[],E={name:"chatinvite",props:{chatRoomId:String},components:{contacts:w["a"]},data:function(){return{loading:!1,selected:{}}},created:()=>{},watch:{},computed:Object(p["c"])({auth:t=>t.auth,cancomplete:function(){return this.selectedLength},selectedLength:function(){return _.toArray(this.selected).length},active:t=>t.active,minimized:t=>t.minimized}),methods:{selectedUsers:function(t){this.selected=t},complete(){this.inviteUserAction(this.selected).then(()=>{this.$emit("completed"),this.$store.commit("icon",{icon:"success",message:""})}).catch(t=>{console.error(t);var e="An unexpected error occurred";"cancomplete"==t&&(e="Please select at least one contact"),this.$store.commit("icon",{icon:"error",message:e})})},inviteUserAction(t){if(!this.chatRoomId)return Promise.reject("chatRoomId");if(!this.cancomplete)return Promise.reject("cancomplete");var e=this.chatRoomId;return Promise.all(_.map(t,t=>{var i="@"+t+":"+this.core.domain;return this.core.mtrx.client.invite(e,i)})).then(t=>Promise.resolve())}}},R=E,M=(i("f972"),Object(l["a"])(R,$,x,!1,null,"070fe94e",null)),L=M.exports,A=i("ecec"),S={name:"userspic",props:{users:Array,single:{},unseen:Number,slidesPerView:Number,status:{type:Object,default:{}}},data:function(){return{}},components:{many:A["a"]}},O=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.membersList?i("div",{staticClass:"membersList"},t._l(t.membersList,(function(e,s){return i("div",{key:e.userId,staticClass:"roomMember",class:e.membership,on:{click:function(i){t.core.mtrx.opencontact(t.userinfo(e))}}},[i("div",{staticClass:"leftWrapper"},[i("div",{staticClass:"avatarNameWrapper"},[i("userpic",{attrs:{userinfo:t.userinfo(e),status:e.membership}})],1),i("div",{staticClass:"nameRole"},[i("span",{staticClass:"name"},[t._v(t._s(t.userinfo(e).name||""))]),e.powerLevel?i("span",{staticClass:"memberRole"},[t._v(t._s(t.$t("caption."+t.role(e))))]):t._e(),e.userId==t.meid?i("span",{staticClass:"memberRole"},[t._v("You")]):t._e()])]),t.menu(e).length?i("div",[i("div",{staticClass:"rightWrapper"},[i("dropdownMenu",{ref:"dropdownMenu",refInFor:!0,attrs:{menuItems:t.menu(e),rowObject:{user:e,index:s},icon:"fas fa-ellipsis-h"},on:{itemClicked:t.menuItemClickHandler}})],1)]):t._e()])})),0):i("div",{staticClass:"empty"},[i("span",[t._v("List Empty")])])},P=[],T={components:{chatIcon:k["a"]},data:function(){return{moderItems:[{click:"adminBan",title:this.$i18n.t("caption.ban"),icon:"fas fa-ban",upload:{multiple:!0}},{click:"adminKick",title:this.$i18n.t("caption.kick"),icon:"fas fa-user-times"}],menuItems:[{click:"adminMakeModer",title:this.$i18n.t("caption.makeModerator"),icon:"fas fa-user-shield"},{click:"adminBan",title:this.$i18n.t("caption.ban"),icon:"fas fa-ban",upload:{multiple:!0}},{click:"adminKick",title:this.$i18n.t("caption.kick"),icon:"fas fa-user-times"}]}},props:{membersList:Array},computed:{meid:function(){return this.core.user.userinfo.id},me:function(){return _.find(this.membersList,t=>t.userId==this.core.user.userinfo.id)||{}}},methods:{userinfo:function(t){return y["a"].deep(this,"core.store.state.users."+t.userId)||{}},role:function(t){var e="member";return t.powerLevel>=50&&(e="moderator"),t.powerLevel>=100&&(e="admin"),e},menu:function(t){var e={setAdmin:{click:"setAdmin",title:this.$i18n.t("caption.makeModerator"),icon:"fas fa-user-shield"},kick:{click:"kick",title:this.$i18n.t("caption.kick"),icon:"fas fa-user-times"},ban:{click:"ban",title:this.$i18n.t("caption.ban"),icon:"fas fa-user-times"}},i=[];return"ban"===t.membership&&(e.ban.title=this.$i18n.t("caption.removeBan")),0===t.powerLevel&&this.me.powerLevel>=50&&this.core.user.userinfo.id!==t.id&&(i=[e.ban]),0===t.powerLevel&&100===this.me.powerLevel&&this.core.user.userinfo.id!==t.id&&(i=[e.setAdmin,e.ban]),50===t.powerLevel&&this.core.user.userinfo.id!==t.id&&100===this.me.powerLevel&&(e.setAdmin.title=this.$i18n.t("caption.cancelModeration"),i=[e.setAdmin,e.ban]),i},navigateToProfile(t){this.$router.push({path:"/contact?id="+y["a"].getmatrixid(t)}).catch(t=>{})},menuItemClickHandler(t,e,i){return this[t.click]?(this["menu"+t.click](e).then(t=>{i.hidePopup()}).catch(t=>{i.showPopup()}),this[t.click](e.user)):Promise.resolve()},menusetAdmin(t){return this.$emit("admin",t.user),Promise.resolve()},menukick(t){return this.$emit("kick",t.user),Promise.resolve()},menuban(t){return this.$emit("ban",t.user),Promise.resolve()},setAdmin:function(t){return this.$emit("setAdmin",t.id),Promise.resolve()},ban:function(t){return this.$emit("adminKick",t.id),Promise.resolve()},kick:function(t){return this.$emit("adminKick",t.id),Promise.resolve()}}},U=T,N=(i("936b"),Object(l["a"])(U,O,P,!1,null,"1f8aeb6f",null)),F=N.exports,j=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chatInfoMedia"},[t.empty?i("div",{staticClass:"emptyBlock"},[i("span",[t._v(t._s(t.$t("caption.noImages")))])]):i("imageEvents",{ref:"list",staticClass:"roomAboutWrapper",attrs:{chat:t.chat,filterType:"images"},on:{eventImage:function(e){return t.galleryImage(e)},getEvents:t.eventsList}})],1)},D=[],B=i("4e29"),z={data:function(){return{events:[],empty:!1}},components:{imageEvents:B["a"]},props:{images:Array,chat:Object},computed:{},mounted:function(){this.core.mtrx.kit.prepareChat(this.chat).then(t=>{_.each(this.imageEvents,t=>{this.encrypted(t)&&this.core.mtrx.getImage(this.chat,t).catch(t=>{console.error(t)})})})},methods:{galleryImage(t){this.core.store.dispatch("SHOW_GALLERY_FROMEVENTS",{events:this.events,event:t})},eventsList(t){0===t.length&&(this.empty=!0),this.events=t},showPhotoSwipe(t){this.core.store.dispatch("SHOW_GALLERY_FROMEVENTS",{events:this.imageEvents,event:t})},encrypted:function(t){return!!y["a"].deep(t,"event.content.info.secrets")}}},W=z,K=(i("cff81"),Object(l["a"])(W,j,D,!1,null,"61d32c10",null)),H=K.exports,V=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[0!==t.fileEvents.length?i("div",{staticClass:"aboutRoomFileWrapper"},t._l(t.fileEvents,(function(e){return i("div",{key:e.event_id,staticClass:"aboutRoomFile"},[i("div",{staticClass:"filePreview"},[i("fileMessage",{attrs:{encryptedData:t.encryptedData(e),file:t.file(e)},on:{download:function(i){return t.download(e)}}}),t.encryptedData?i("div",{staticClass:"encryptedDataIcon"},[i("i",{staticClass:"fas fa-lock"})]):t._e()],1)])})),0):i("div",{staticClass:"emptyBlock"},[i("span",[t._v(t._s(t.$t("caption.noFiles")))])])])},J=[],Y=i("696c2"),q={props:{fileEvents:Array,chat:Object},components:{fileMessage:Y["a"]},computed:{},methods:{encryptedData:function(t){return!(!y["a"].deep(t,"event.content.info.secrets")&&!y["a"].deep(t,"event.content.pbody.secrets"))},jsonConvertor(t){return JSON.parse(t)},humanReadableSize(t){return y["a"].formatBytes(t)},content:function(t){return t.event.content},file:function(t){if("m.file"===this.content(t).msgtype)return this.body(t)},body:function(t){var e=t.event.content;return"m.encrypted"==t.event.content.msgtype&&(e=this.decryptEvent),e.pbody||e.body||""},download(t){this.downloading=!0,this.core.mtrx.downloadFile(this.chat,t).catch(t=>(this.error=t.toString(),Promise.resolve(t))).then(t=>{this.downloading=!1}).catch(t=>{console.error(t)})}}},G=q,Q=(i("7628"),Object(l["a"])(G,V,J,!1,null,"138294c4",null)),X=Q.exports,Z=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.membersList.length>1?i("div",{staticClass:"aboutRoomAvatar"},[2===t.membersList.length?i("div",{staticClass:"userspicwrapper twoAvatars"},[t._l(t.membersList,(function(e){return"invite"===e.roomStatus?i("bgimage",{key:e.id,staticClass:"bgImage invited",attrs:{src:e.image}}):t._e()})),t._l(t.membersList,(function(e){return"join"===e.roomStatus?i("bgimage",{key:e.id,staticClass:"bgImage",attrs:{src:e.image}}):t._e()}))],2):t._e(),3===t.membersList.length?i("div",{staticClass:"userspicwrapper threeAvatars"},[t._l(t.membersList,(function(e){return"invite"===e.roomStatus?i("bgimage",{key:e.id,staticClass:"bgImage invited",attrs:{src:e.image}}):t._e()})),t._l(t.membersList,(function(e){return"join"===e.roomStatus?i("bgimage",{key:e.id,staticClass:"bgImage",attrs:{src:e.image}}):t._e()}))],2):t._e(),4===t.membersList.length?i("div",{staticClass:"userspicwrapper fourAvatars"},[t._l(t.membersList,(function(e){return"invite"===e.roomStatus?i("bgimage",{key:e.id,staticClass:"bgImage invited",attrs:{src:e.image}}):t._e()})),t._l(t.membersList,(function(e){return"join"===e.roomStatus?i("bgimage",{key:e.id,staticClass:"bgImage",attrs:{src:e.image}}):t._e()}))],2):t._e(),t.membersList.length>4?i("swiper",{staticClass:"swiper",attrs:{options:t.swiperOption}},[t._l(t.membersList,(function(e){return i("swiper-slide",{key:e.id},["join"===e.roomStatus?i("div",{staticClass:"imageSwiper"},[i("img",{attrs:{src:e.image,alt:""}})]):t._e(),"invite"===e.roomStatus?i("div",{staticClass:"imageSwiper invited"},[i("img",{attrs:{src:e.image,alt:""}})]):t._e()])})),i("div",{staticClass:"swiper-pagination",attrs:{slot:"pagination"},slot:"pagination"})],2):t._e()],1):t._e()},tt=[],et=i("7212"),it={props:{membersList:Array},data:function(){return{swiperOption:{watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:5,direction:"horizontal",pagination:{el:".swiper-pagination",clickable:!0}}}},components:{Swiper:et["Swiper"],SwiperSlide:et["SwiperSlide"]}},st=it,nt=(i("b71a"),Object(l["a"])(st,Z,tt,!1,null,"53c7b98a",null)),ot=nt.exports,at={data:function(){return{usr:{},ind:0,topicTxt:"",roomMuted:!1,publicRoom:{},public:!1,encryptedEvents:[],imageEvents:[],pics:!1,fileEvents:[],inputActive:!1,menuItems:[{click:"adminMakeModer",title:this.$i18n.t("caption.makeModerator"),icon:"fas fa-user-shield"},{click:"adminBan",title:this.$i18n.t("caption.ban"),icon:"fas fa-ban",upload:{multiple:!0}},{click:"adminKick",title:this.$i18n.t("caption.kick"),icon:"fas fa-user-times"}],menuItemsModer:[{click:"moderBan",title:this.$i18n.t("caption.ban"),icon:"fas fa-ban"},{click:"moderKick",title:this.$i18n.t("caption.kick"),icon:"fas fa-user-times"}],admin:String,imagesList:[],localRoomName:"",humanSize:Number,inviteUserOpened:!1,msList:[],isOpen:!1,actionMemberShow:!1,options:{index:0,arrowEl:!1,fullscreenEl:!1,shareEl:!1},roomName:"",nameEdit:!1,accordionList:[{title:this.$i18n.t("caption.members"),id:"members"},{title:this.$i18n.t("caption.media"),id:"media"},{title:this.$i18n.t("caption.files"),id:"files"}],isActive:null,isActiveAction:null,currentUser:"",actionUser:{},actionUserMenu:!1,chatMembers:[]}},props:{chat:{}},components:{images:H,members:F,files:X,topheader:C,avatarsList:ot,invite:L,userspic:S,contacts:w["a"],chatName:g["a"],chatIcon:k["a"]},watch:{m_chat:{immediate:!0,handler:function(){this.m_chat&&!_.isEmpty(this.m_chat)&&this.core.mtrx.kit.prepareChat(this.m_chat).then(t=>{this.ready=!0,this.encrypted=this.m_chat.pcrypto.canBeEncrypt()})}},chat:{immediate:!0,handler:function(){this.chat?this.$store.commit("SET_CURRENT_ROOM",this.chat.roomId):this.$store.commit("SET_CURRENT_ROOM",!1)}}},computed:{...Object(p["c"])(["minimized","active"]),m_chat:function(){if(this.chat&&this.chat.roomId){let t=this.core.mtrx.client._pushProcessor.getPushRuleById(this.chat.roomId);null!==t&&(this.roomMuted=!0);let e=this.core.mtrx.client.getRoom(this.chat.roomId);return e||{}}},curation:function(){if(window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.curation())return!0},canchangeChatName:function(){return!this.tetatet&&this.me.powerLevel>0},canInvite:function(){return!this.tetatet&&this.me.powerLevel>0},shareRoomLink:function(){return"https://bastyon.com/welcome?publicroom="+this.chat.roomId},me:function(){return _.find(this.membersList,t=>t.userId==this.core.user.userinfo.id)||{}},events:function(){var t=this.core.mtrx.client._pushProcessor.getPushRuleById(this.chat.roomId);return null!==t&&(this.roomMuted=!0),this.m_chat.timeline||{}},customRoomType:function(){var t=this.core.mtrx.customRoomType(this.chat.roomId);return t},blockedCheck:function(){var t=this.core.mtrx.anotherChatUsers(this.chat.roomId);if(1==t.length)return this.core.mtrx.blockeduser(t[0].userId)},membersCount:function(){return this.users.length},users:function(){var t;return this.core.mtrx.chatUsersInfo(null===(t=this.chat)||void 0===t?void 0:t.roomId)||[]},galleryImages:function(){var t=[];return this.imageEvents.forEach((function(e){"m.image"===e.event.content.msgtype&&t.push({src:e.event.content.url,w:e.event.content.info.w,h:e.event.content.info.h})})),t},membersList:function(){return this.core.mtrx.chatUsers(this.chat.roomId).filter(t=>"leave"!==t.membership)},tetatet:function(){return this.core.mtrx.kit.tetatetchat(this.m_chat)},changeRoomName:function(){var t=this.m_chat.name;return t.replace("_"," ")},groupAvatar:function(){var t;return null===(t=this.m_chat.currentState.getStateEvents("m.room.avatar")[0])||void 0===t?void 0:t.event.content.avatarUrl},clearRoom(){}},mounted(){this.events;this.eventsList(),"public"===this.m_chat.getJoinRule()&&(this.public=!0,this.getPublicRoom())},methods:{complain:function(){if(this.curation){var t={address1:this.core.user.userinfo.source.address};if(this.tetatet){var e=_.find(this.core.mtrx.chatUsersInfo(this.chat.roomId)||[],t=>t.id!=this.core.user.userinfo.id);e&&(t.address2=e.source.address)}else t.roomid=this.chat.roomId;this.core.mtrx.complain(this.$t("button.Complain"),t)}},getPublicRoom(){this.core.mtrx.client.publicRooms().then(t=>{if(this.publicRoom=t.chunk.filter(t=>t.room_id===this.chat.roomId)[0],this.publicRoom.topic)return this.topicTxt=this.publicRoom.topic.replace(/_/g," ")})},banForgetRoom(){var t="",e=this.m_chat.myUserId,i=this.m_chat.currentState.getMembers();i.forEach((function(i){i!==e&&(t=i.userId)})),this.core.mtrx.client.ban(this.chat.roomId,t,"leave").then(t=>t)},muteRoom(){var t=this.chat.roomId,e=(this.core.mtrx.client.deviceId,this);this.roomMuted?(e.core.mtrx.client.deletePushRule("global","room",t),e.roomMuted=!1):(e.core.mtrx.client.setRoomMutePushRule("global",t,"true"),e.roomMuted=!0)},blockUser(){var t=this.core.mtrx.anotherChatUsers(this.chat.roomId);t.length>1||this.core.mtrx.blockUser(t[0].userId).catch(t=>{})},unblock(){var t=this.core.mtrx.anotherChatUsers(this.chat.roomId);t.length>1||this.core.mtrx.unblockUser(t[0].userId).catch(t=>{})},eventsList(){"function"==typeof this.events.filter&&(this.imageEvents=this.events.filter(t=>"m.image"===t.event.content.msgtype||"m.room.encrypted"===t.event.type&&"m.image"===t.getClearContent().msgtype),this.fileEvents=this.events.filter(t=>"m.file"===t.event.content.msgtype))},toggleItem(t){this.isActive=this.isActive===t?null:t,this.actionMemberShow=null},forgetRoom(){this.$dialog.confirm("Do you really want to leave room?",{okText:this.$i18n.t("yes"),cancelText:this.$i18n.t("cancel")}).then(t=>{this.core.mtrx.client.leave(this.chat.roomId).then(t=>{this.core.mtrx.client.forget(this.chat.roomId,!0).then(t=>t).then(t=>{this.$store.commit("DELETE_ROOM",this.chat.roomId),this.$router.push({path:"/chats"}).catch(t=>{})})})})},changeName(){this.localRoomName=this.m_chat.name.replace(/@/g,""),this.localRoomName.replace("_"," ")},saveRoomName(){this.nameEdit=!1,this.inputActive=!1,this.core.mtrx.client.setRoomName(this.m_chat.roomId,"@"+this.roomName.replace(/[@]*/g,""))},banUser(t){"ban"===t.membership?this.core.mtrx.client.unban(this.m_chat.roomId,y["a"].getMatrixIdFull(t.userId,this.core.domain)).then(e=>{this.core.mtrx.client.invite(this.m_chat.roomId,y["a"].getMatrixIdFull(t.userId,this.core.domain)).then(t=>{})}):this.core.mtrx.client.ban(this.m_chat.roomId,y["a"].getMatrixIdFull(t.userId,this.core.domain),"admin ban").then(t=>{})},kickUser(t){this.core.mtrx.client.kick(this.m_chat.roomId,y["a"].getMatrixIdFull(t.userId,this.core.domain),"admin kicked").then(this.$nextTick((function(){})))},makeAdmin(t){var e=50;50===t.powerLevel&&(e=0);var i=this.m_chat.currentState.getStateEvents("m.room.power_levels");this.core.mtrx.client.setPowerLevel(this.m_chat.roomId,y["a"].getMatrixIdFull(t.userId,this.core.domain),e,i[0]).then(t=>{})},showEditRoomName(){this.nameEdit=!0,this.roomName=this.m_chat.name,this.inputActive=!0},editRoomName(){},showPhotoSwipe(t){this.isOpen=!0,this.$set(this.options,"index",t)},accordion:function(t){t.target.classList.toggle("active")},hidePhotoSwipe(){this.isOpen=!1},focus(){return $event.target.select()},showUserAbout(t){this.$emit("showAbout",t)},getClick(t){this.$emit("showRoomInfo",t)},modalInviteUser(){this.inviteUserOpened=!0},closeModal(){this.inviteUserOpened=!1},closeContactModal(t){this.inviteUserOpened=t},addTopic(){this.core.mtrx.client.setRoomTopic(this.chat.roomId,this.topicTxt.replace(/ /g,"_")).then(t=>{this.getPublicRoom()})},copyShareLink(){this.$f.copytext(this.shareRoomLink),this.core.sitemessage("The link was copied successfully")},sharelink(){this.core.share({urls:[this.shareRoomLink],route:"chatInfo?id="+this.chat.roomId})},clearRoom(){}}},rt=at,ct=(i("6427"),Object(l["a"])(rt,f,v,!1,null,"f8d80bf2",null)),lt=ct.exports,mt={name:"chatInfo",components:{info:lt},props:{chat:{},events:{}},data:function(){return{}},created(){},mounted(){this.$store.commit("blockactive",{value:!0,item:"chatinfo"})},destroyed(){this.$store.commit("blockactive",{value:!1,item:"chatinfo"})},watch:{},computed:Object(p["c"])({pocketnet:t=>t.pocketnet,minimized:t=>t.minimized,active:t=>t.active,auth:t=>t.auth,m_chat:function(){if(this.chat&&this.chat.roomId){var t=this.core.mtrx.client.getRoom(this.chat.roomId);return t||{}}}})},ht=mt,ut=(i("593d"),Object(l["a"])(ht,u,d,!1,null,"02904b2d",null)),dt=ut.exports,pt=i("d3ff"),ft={name:"chatinfo",data:function(){return{}},components:{topheader:h,contact:pt["default"],chatInfo:dt},computed:Object(p["c"])({pocketnet:t=>t.pocketnet,minimized:t=>t.minimized,u(){return this.$route.query.u},chat(){var t=this.$route.query.id;return this.$store.state.chatsMap[t]}}),methods:{}},vt=ft,bt=(i("3c6c"),Object(l["a"])(vt,s,n,!1,null,"37303cac",null));e["default"]=bt.exports},"27e9":function(t,e,i){},"3c6c":function(t,e,i){"use strict";i("81c7")},"47ed":function(t,e,i){},"593d":function(t,e,i){"use strict";i("b6c5")},6427:function(t,e,i){"use strict";i("936f")},7628:function(t,e,i){"use strict";i("8f8d")},"81c7":function(t,e,i){},"850a":function(t,e,i){},"8f8d":function(t,e,i){},"936b":function(t,e,i){"use strict";i("27e9")},"936f":function(t,e,i){},a7dd:function(t,e,i){},b6c5:function(t,e,i){},b71a:function(t,e,i){"use strict";i("850a")},cff81:function(t,e,i){"use strict";i("47ed")},f972:function(t,e,i){"use strict";i("a7dd")}}]);
//# sourceMappingURL=chunk-ca9e2052.17833459.js.map