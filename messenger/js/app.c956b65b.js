(function(e){function t(t){for(var i,r,a=t[0],c=t[1],l=t[2],u=0,d=[];u<a.length;u++)r=a[u],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&d.push(o[r][0]),o[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);h&&h(t);while(d.length)d.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,r=1;r<n.length;r++){var a=n[r];0!==o[a]&&(i=!1)}i&&(s.splice(t--,1),e=c(c.s=n[0]))}return e}var i={},r={app:0},o={app:0},s=[];function a(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-0019dc28":"13cf1898","chunk-32cdda30":"3d53be04","chunk-ca9e2052":"17833459","chunk-1d706d8a":"8478e0a9","chunk-2d21b867":"c884c4a5","chunk-37dd8fd7":"c738ab95","chunk-383dfa01":"9a59f4d9","chunk-5bf57b8c":"439a90f2","chunk-5f9613c9":"bfe54627","chunk-6ec41fe0":"5389a6fc","chunk-6f115af6":"f5a4fa0a","chunk-6f87535e":"414d9154","chunk-e832edc6":"dad40e9f","chunk-4a6a5c58":"ceeb1ae3"}[e]+".js"}function c(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={"chunk-0019dc28":1,"chunk-32cdda30":1,"chunk-ca9e2052":1,"chunk-1d706d8a":1,"chunk-37dd8fd7":1,"chunk-383dfa01":1,"chunk-5bf57b8c":1,"chunk-5f9613c9":1,"chunk-6ec41fe0":1,"chunk-6f115af6":1,"chunk-6f87535e":1,"chunk-e832edc6":1,"chunk-4a6a5c58":1};r[e]?t.push(r[e]):0!==r[e]&&n[e]&&t.push(r[e]=new Promise((function(t,n){for(var i="css/"+({}[e]||e)+"."+{"chunk-0019dc28":"b93cf74e","chunk-32cdda30":"9064a86e","chunk-ca9e2052":"0acd21b1","chunk-1d706d8a":"b9c2857b","chunk-2d21b867":"31d6cfe0","chunk-37dd8fd7":"bb174a1b","chunk-383dfa01":"5e0f133f","chunk-5bf57b8c":"8cb31bd6","chunk-5f9613c9":"0e433876","chunk-6ec41fe0":"af4c7bdc","chunk-6f115af6":"dd20a5ea","chunk-6f87535e":"89c39ea4","chunk-e832edc6":"4283f883","chunk-4a6a5c58":"5613c582"}[e]+".css",o=c.p+i,s=document.getElementsByTagName("link"),a=0;a<s.length;a++){var l=s[a],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===i||u===o))return t()}var d=document.getElementsByTagName("style");for(a=0;a<d.length;a++){l=d[a],u=l.getAttribute("data-href");if(u===i||u===o)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var i=t&&t.target&&t.target.src||o,s=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");s.code="CSS_CHUNK_LOAD_FAILED",s.request=i,delete r[e],h.parentNode.removeChild(h),n(s)},h.href=o;var m=document.getElementsByTagName("head")[0];m.appendChild(h)})).then((function(){r[e]=0})));var i=o[e];if(0!==i)if(i)t.push(i[2]);else{var s=new Promise((function(t,n){i=o[e]=[t,n]}));t.push(i[2]=s);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=a(e);var d=new Error;l=function(t){u.onerror=u.onload=null,clearTimeout(h);var n=o[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+i+": "+r+")",d.name="ChunkLoadError",d.type=i,d.request=r,n[1](d)}o[e]=void 0}};var h=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(t)},c.m=e,c.c=i,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)c.d(n,i,function(t){return e[t]}.bind(null,i));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var h=u;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0023":function(e,t,n){"use strict";function i(e,t){const n=`Store is invalid because ${e}, please stop the client, delete all data and start the client again`,i=Reflect.construct(Error,[n]);return Reflect.setPrototypeOf(i,Reflect.getPrototypeOf(this)),i.reason=e,i.value=t,i}function r(e){const t=`Crypto store is invalid because ${e}, please stop the client, delete all data and start the client again`,n=Reflect.construct(Error,[t]);return Reflect.setPrototypeOf(n,Reflect.getPrototypeOf(this)),n.reason=e,n.name="InvalidCryptoStoreError",n}n("d9e2"),Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStoreError=i,t.InvalidCryptoStoreError=r,t.KeySignatureUploadError=void 0,i.TOGGLED_LAZY_LOADING="TOGGLED_LAZY_LOADING",i.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(i,Error),r.TOO_NEW="TOO_NEW",r.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!0,configurable:!0}}),Reflect.setPrototypeOf(r,Error);class o extends Error{constructor(e,t){super(e),this.value=t}}t.KeySignatureUploadError=o},"0095":function(e,t,n){"use strict";n("5bc6")},"00e4":function(e,t,n){"use strict";n("e2ff")},"0357":function(e,t,n){},"0594":function(e,t,n){"use strict";var i=n("c973").default;n("d9e2");var r=n("dbce"),o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.Room=w;var s=o(n("9523")),a=n("faa1"),c=n("6386"),l=n("e685"),u=n("07df"),d=r(n("3987")),h=n("a120"),m=n("2b60"),p=n("4400"),f=n("63c7"),g=n("3da4"),v=n("d613");function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const b="6",E=["1","2","3","4","5","6"];function S(e,t,n){const i={content:{},type:"m.receipt",room_id:t.getRoomId()};return i.content[t.getId()]={},i.content[t.getId()][n]={},i.content[t.getId()][n][e]={ts:t.getTs()},new h.MatrixEvent(i)}function w(e,t,n,r){var o=this;if(r=r||{},r.pendingEventOrdering=r.pendingEventOrdering||"chronological",this._client=t,this.setMaxListeners(100),this.reEmitter=new g.ReEmitter(this),-1===["chronological","detached"].indexOf(r.pendingEventOrdering))throw new Error("opts.pendingEventOrdering MUST be either 'chronological' or 'detached'. Got: '"+r.pendingEventOrdering+"'");if(this.myUserId=n,this.roomId=e,this.name=e,this.tags={},this.accountData={},this.summary=null,this.storageToken=r.storageToken,this._opts=r,this._txnToEvent={},this._receipts={},this._receiptCacheByEventId={},this._realReceipts={},this._notificationCounts={},this._timelineSets=[new c.EventTimelineSet(this,r)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),["Room.timeline","Room.timelineReset"]),this._fixUpLegacyTimelineFields(),this._filteredTimelineSets={},"detached"==this._opts.pendingEventOrdering){this._pendingEventList=[];const e=t._sessionStore.store.getItem(C(this.roomId));e&&JSON.parse(e).forEach(function(){var e=i((function*(e){const t=new h.MatrixEvent(e);"m.room.encrypted"===t.getType()&&(yield t.attemptDecryption(o._client._crypto)),t.setStatus(h.EventStatus.NOT_SENT),o.addPendingEvent(t,t.getTxnId())}));return function(t){return e.apply(this,arguments)}}())}this._blacklistUnverifiedDevices=null,this._selfMembership=null,this._summaryHeroes=null,this._opts.lazyLoadMembers?this._membersPromise=null:this._membersPromise=Promise.resolve()}function C(e){return"mx_pending_events_"+e}d.inherits(w,a.EventEmitter),w.prototype.getVersion=function(){const e=this.currentState.getStateEvents("m.room.create","");if(!e)return f.logger.warn("Room "+this.roomId+" does not have an m.room.create event"),"1";const t=e.getContent()["room_version"];return void 0===t?"1":t},w.prototype.shouldUpgradeToVersion=function(){return E.includes(this.getVersion())?null:b},w.prototype.getRecommendedVersion=i((function*(){const e=yield this._client.getCapabilities();let t=e["m.room_versions"];if(!t){t={default:b,available:{}};for(const e of E)t.available[e]="stable"}let n=this._checkVersionAgainstCapability(t);if(n.urgent&&n.needsUpgrade){f.logger.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");const e=yield this._client.getCapabilities(!0);if(t=e["m.room_versions"],!t)return f.logger.warn("No room version capability - assuming upgrade required."),n;n=this._checkVersionAgainstCapability(t)}return n})),w.prototype._checkVersionAgainstCapability=function(e){const t=this.getVersion();f.logger.log(`[${this.roomId}] Current version: ${t}`),f.logger.log(`[${this.roomId}] Version capability: `,e);const n={version:t,needsUpgrade:!1,urgent:!1};if(t===e.default)return n;const i=Object.keys(e.available).filter(t=>"stable"===e.available[t]);return i.includes(t)||(n.version=e.default,n.needsUpgrade=!0,n.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),n.urgent?f.logger.warn("URGENT upgrade required on "+this.roomId):f.logger.warn("Non-urgent upgrade required on "+this.roomId)),n},w.prototype.userMayUpgradeRoom=function(e){return this.currentState.maySendStateEvent("m.room.tombstone",e)},w.prototype.getPendingEvents=function(){if("detached"!==this._opts.pendingEventOrdering)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this._opts.pendingEventOrdering);return this._pendingEventList},w.prototype.removePendingEvent=function(e){if("detached"!==this._opts.pendingEventOrdering)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this._opts.pendingEventOrdering);const t=d.removeElement(this._pendingEventList,(function(t){return t.getId()==e}),!1);return this._savePendingEvents(),t},w.prototype.hasPendingEvent=function(e){return"detached"===this._opts.pendingEventOrdering&&this._pendingEventList.some(t=>t.getId()===e)},w.prototype.getPendingEvent=function(e){return"detached"!==this._opts.pendingEventOrdering?null:this._pendingEventList.find(t=>t.getId()===e)},w.prototype.getLiveTimeline=function(){return this.getUnfilteredTimelineSet().getLiveTimeline()},w.prototype.getLastActiveTimestamp=function(){const e=this.getLiveTimeline(),t=e.getEvents();if(t.length){const e=t[t.length-1];return e.getTs()}return Number.MIN_SAFE_INTEGER},w.prototype.getMyMembership=function(){return this._selfMembership},w.prototype.getDMInviter=function(){if(this.myUserId){const e=this.getMember(this.myUserId);if(e)return e.getDMInviter()}if("invite"===this._selfMembership){const e=this.getInvitedAndJoinedMemberCount();if(2==e&&this._summaryHeroes.length)return this._summaryHeroes[0]}},w.prototype.guessDMUserId=function(){const e=this.getMember(this.myUserId);if(e){const t=e.getDMInviter();if(t)return t}const t=Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length;if(t)return this._summaryHeroes[0];const n=this.currentState.getMembers(),i=n.find(e=>e.userId!==this.myUserId);return i?i.userId:this.myUserId},w.prototype.getAvatarFallbackMember=function(){const e=this.getInvitedAndJoinedMemberCount();if(e>2)return;const t=Array.isArray(this._summaryHeroes)&&this._summaryHeroes.length;if(t){const e=this._summaryHeroes.map(e=>this.getMember(e)).find(e=>!!e);if(e)return e}const n=this.currentState.getMembers();if(n.length<=2){const e=n.find(e=>e.userId!==this.myUserId);if(e)return e}if(t){const e=this._summaryHeroes.map(e=>this._client.getUser(e)).find(e=>!!e);if(e){const t=new m.RoomMember(this.roomId,e.userId);return t.user=e,t}}},w.prototype.updateMyMembership=function(e){const t=this._selfMembership;this._selfMembership=e,t!==e&&("leave"===e&&this._cleanupAfterLeaving(),this.emit("Room.myMembership",this,e,t))},w.prototype._loadMembersFromServer=i((function*(){const e=this._client.store.getSyncToken(),t=d.encodeParams({not_membership:"leave",at:e}),n=d.encodeUri("/rooms/$roomId/members?"+t,{$roomId:this.roomId}),i=this._client._http,r=yield i.authedRequest(void 0,"GET",n);return r.chunk})),w.prototype._loadMembers=i((function*(){let e=!1,t=yield this._client.store.getOutOfBandMembers(this.roomId);null===t&&(e=!0,t=yield this._loadMembersFromServer(),f.logger.log(`LL: got ${t.length} members from server for room `+this.roomId));const n=t.map(this._client.getEventMapper());return{memberEvents:n,fromServer:e}})),w.prototype.loadMembersIfNeeded=function(){if(this._membersPromise)return this._membersPromise;this.currentState.markOutOfBandMembersStarted();const e=this._loadMembers().then(e=>(this.currentState.setOutOfBandMembers(e.memberEvents),this._client.isCryptoEnabled()&&this._client.isRoomEncrypted(this.roomId)&&this._client._crypto.trackRoomDevices(this.roomId),e.fromServer)).catch(e=>{throw this._membersPromise=null,this.currentState.markOutOfBandMembersFailed(),e});return e.then(e=>{if(e){const e=this.currentState.getMembers().filter(e=>e.isOutOfBand()).map(e=>e.events.member.event);f.logger.log("LL: telling store to write "+e.length+" members for room "+this.roomId);const t=this._client.store;return t.setOutOfBandMembers(this.roomId,e).catch(e=>{f.logger.log("LL: storing OOB room members failed, oh well",e)})}}).catch(e=>{f.logger.error(e)}),this._membersPromise=e,this._membersPromise},w.prototype.clearLoadedMembersIfNeeded=i((function*(){this._opts.lazyLoadMembers&&this._membersPromise&&(yield this.loadMembersIfNeeded(),yield this._client.store.clearOutOfBandMembers(this.roomId),this.currentState.clearOutOfBandMembers(),this._membersPromise=null)})),w.prototype._cleanupAfterLeaving=function(){this.clearLoadedMembersIfNeeded().catch(e=>{f.logger.error(`error after clearing loaded members from room ${this.roomId} after leaving`),f.logger.log(e)})},w.prototype.resetLiveTimeline=function(e,t){for(let n=0;n<this._timelineSets.length;n++)this._timelineSets[n].resetLiveTimeline(e,t);this._fixUpLegacyTimelineFields()},w.prototype._fixUpLegacyTimelineFields=function(){this.timeline=this.getLiveTimeline().getEvents(),this.oldState=this.getLiveTimeline().getState(l.EventTimeline.BACKWARDS),this.currentState=this.getLiveTimeline().getState(l.EventTimeline.FORWARDS)},w.prototype.hasUnverifiedDevices=i((function*(){if(!this._client.isRoomEncrypted(this.roomId))return!1;const e=yield this.getEncryptionTargetMembers();for(const t of e){const e=this._client.getStoredDevicesForUser(t.userId);if(e.some(e=>e.isUnverified()))return!0}return!1})),w.prototype.getTimelineSets=function(){return this._timelineSets},w.prototype.getUnfilteredTimelineSet=function(){return this._timelineSets[0]},w.prototype.getTimelineForEvent=function(e){return this.getUnfilteredTimelineSet().getTimelineForEvent(e)},w.prototype.addTimeline=function(){return this.getUnfilteredTimelineSet().addTimeline()},w.prototype.findEventById=function(e){return this.getUnfilteredTimelineSet().findEventById(e)},w.prototype.getUnreadNotificationCount=function(e){return e=e||"total",this._notificationCounts[e]},w.prototype.setUnreadNotificationCount=function(e,t){this._notificationCounts[e]=t},w.prototype.setSummary=function(e){const t=e["m.heroes"],n=e["m.joined_member_count"],i=e["m.invited_member_count"];Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),Number.isInteger(i)&&this.currentState.setInvitedMemberCount(i),Array.isArray(t)&&(this._summaryHeroes=t.filter(e=>e!==this.myUserId))},w.prototype.setBlacklistUnverifiedDevices=function(e){this._blacklistUnverifiedDevices=e},w.prototype.getBlacklistUnverifiedDevices=function(){return this._blacklistUnverifiedDevices},w.prototype.getAvatarUrl=function(e,t,n,i,r){const o=this.currentState.getStateEvents(v.EventType.RoomAvatar,"");if(void 0===r&&(r=!0),!o&&!r)return null;const s=o?o.getContent().url:null;return s?(0,u.getHttpUriForMxc)(e,s,t,n,i):null},w.prototype.getMxcAvatarUrl=function(){const e=this.currentState.getStateEvents(v.EventType.RoomAvatar,"");return e?e.getContent().url:null},w.prototype.getAliases=function(){const e=[],t=this.currentState.getStateEvents("m.room.aliases");if(t)for(let n=0;n<t.length;++n){const i=t[n];if(d.isArray(i.getContent().aliases)){const t=i.getContent().aliases.filter(e=>"string"===typeof e&&("#"===e[0]&&!!e.endsWith(":"+i.getStateKey())));Array.prototype.push.apply(e,t)}}return e},w.prototype.getCanonicalAlias=function(){const e=this.currentState.getStateEvents("m.room.canonical_alias","");return e&&e.getContent().alias||null},w.prototype.getAltAliases=function(){const e=this.currentState.getStateEvents("m.room.canonical_alias","");return e&&e.getContent().alt_aliases||[]},w.prototype.addEventsToTimeline=function(e,t,n,i){n.getTimelineSet().addEventsToTimeline(e,t,n,i)},w.prototype.getMember=function(e){return this.currentState.getMember(e)},w.prototype.getJoinedMembers=function(){return this.getMembersWithMembership("join")},w.prototype.getJoinedMemberCount=function(){return this.currentState.getJoinedMemberCount()},w.prototype.getInvitedMemberCount=function(){return this.currentState.getInvitedMemberCount()},w.prototype.getInvitedAndJoinedMemberCount=function(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()},w.prototype.getMembersWithMembership=function(e){return d.filter(this.currentState.getMembers(),(function(t){return t.membership===e}))},w.prototype.getEncryptionTargetMembers=i((function*(){yield this.loadMembersIfNeeded();let e=this.getMembersWithMembership("join");return this.shouldEncryptForInvitedMembers()&&(e=e.concat(this.getMembersWithMembership("invite"))),e})),w.prototype.shouldEncryptForInvitedMembers=function(){const e=this.currentState.getStateEvents("m.room.history_visibility","");return e&&e.getContent()&&"joined"!==e.getContent().history_visibility},w.prototype.getDefaultRoomName=function(e){return T(this,e,!0)},w.prototype.hasMembershipState=function(e,t){const n=this.getMember(e);return!!n&&n.membership===t},w.prototype.getOrCreateFilteredTimelineSet=function(e){if(this._filteredTimelineSets[e.filterId])return this._filteredTimelineSets[e.filterId];const t=Object.assign({filter:e},this._opts),n=new c.EventTimelineSet(this,t);this.reEmitter.reEmit(n,["Room.timeline","Room.timelineReset"]),this._filteredTimelineSets[e.filterId]=n,this._timelineSets.push(n);const i=this.getLiveTimeline();i.getEvents().forEach((function(e){n.addLiveEvent(e)}));let r=i;while(r.getNeighbouringTimeline(l.EventTimeline.BACKWARDS))r=r.getNeighbouringTimeline(l.EventTimeline.BACKWARDS);return n.getLiveTimeline().setPaginationToken(r.getPaginationToken(l.EventTimeline.BACKWARDS),l.EventTimeline.BACKWARDS),n},w.prototype.removeFilteredTimelineSet=function(e){const t=this._filteredTimelineSets[e.filterId];delete this._filteredTimelineSets[e.filterId];const n=this._timelineSets.indexOf(t);n>-1&&this._timelineSets.splice(n,1)},w.prototype._addLiveEvent=function(e,t,n){if(e.isRedaction()){const t=e.event.redacts,n=this.getUnfilteredTimelineSet().findEventById(t);if(n){if(n.makeRedacted(e),n.getStateKey()){const e=this.currentState.getStateEvents(n.getType(),n.getStateKey());e.getId()===n.getId()&&this.currentState.setStateEvents([n])}this.emit("Room.redaction",e,this)}}if(e.getUnsigned().transaction_id){const t=this._txnToEvent[e.getUnsigned().transaction_id];if(t)return void this._handleRemoteEcho(e,t)}for(let i=0;i<this._timelineSets.length;i++)this._timelineSets[i].addLiveEvent(e,t,n);e.sender&&"m.room.redaction"!==e.getType()&&this.addReceipt(S(e.sender.userId,e,"m.read"),!0)},w.prototype.addPendingEvent=function(e,t){if(e.status!==h.EventStatus.SENDING&&e.status!==h.EventStatus.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this._txnToEvent[t])throw new Error("addPendingEvent called on an event with known txnId "+t);if(l.EventTimeline.setEventMetadata(e,this.getLiveTimeline().getState(l.EventTimeline.FORWARDS),!1),this._txnToEvent[t]=e,"detached"==this._opts.pendingEventOrdering){if(this._pendingEventList.some(e=>e.status===h.EventStatus.NOT_SENT)&&(f.logger.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(h.EventStatus.NOT_SENT)),this._pendingEventList.push(e),this._savePendingEvents(),e.isRelation()&&this._aggregateNonLiveRelation(e),e.isRedaction()){const t=e.event.redacts;let n=this._pendingEventList&&this._pendingEventList.find(e=>e.getId()===t);n||(n=this.getUnfilteredTimelineSet().findEventById(t)),n&&(n.markLocallyRedacted(e),this.emit("Room.redaction",e,this))}}else for(let n=0;n<this._timelineSets.length;n++){const t=this._timelineSets[n];t.getFilter()?t.getFilter().filterRoomTimeline([e]).length&&t.addEventToTimeline(e,t.getLiveTimeline(),!1):t.addEventToTimeline(e,t.getLiveTimeline(),!1)}this.emit("Room.localEchoUpdated",e,this,null,null)},w.prototype._savePendingEvents=function(){if(this._pendingEventList){const e=this._pendingEventList.map(e=>_(_({},e.event),{},{txn_id:e.getTxnId()})).filter(e=>{const t="m.room.encrypted"===e.type,n=this._client.isRoomEncrypted(this.roomId);return t||!n}),{store:t}=this._client._sessionStore;this._pendingEventList.length>0?t.setItem(C(this.roomId),JSON.stringify(e)):t.removeItem(C(this.roomId))}},w.prototype._aggregateNonLiveRelation=function(e){for(let t=0;t<this._timelineSets.length;t++){const n=this._timelineSets[t];n.getFilter()?n.getFilter().filterRoomTimeline([e]).length&&n.aggregateRelations(e):n.aggregateRelations(e)}},w.prototype._handleRemoteEcho=function(e,t){const n=t.getId(),i=e.getId(),r=t.status;f.logger.debug(`Got remote echo for event ${n} -> ${i} old status `+r),delete this._txnToEvent[e.getUnsigned().transaction_id],this._pendingEventList&&this.removePendingEvent(n),t.handleRemoteEcho(e.event);for(let o=0;o<this._timelineSets.length;o++){const e=this._timelineSets[o];e.handleRemoteEcho(t,n,i)}this.emit("Room.localEchoUpdated",t,this,n,r)};const k={};function T(e,t,n){if(!n){const t=e.currentState.getStateEvents("m.room.name","");if(t&&t.getContent()&&t.getContent().name)return t.getContent().name}let i=e.getCanonicalAlias();if(!i){const t=e.getAltAliases();t.length&&(i=t[0])}if(i)return i;const r=e.currentState.getJoinedMemberCount(),o=e.currentState.getInvitedMemberCount(),s=r+o-1;let a=null;if(e._summaryHeroes)a=e._summaryHeroes.map(t=>{const n=e.getMember(t);return n?n.name:t});else{let n=e.currentState.getMembers().filter(e=>e.userId!==t&&("invite"===e.membership||"join"===e.membership));n.sort((e,t)=>e.userId.localeCompare(t.userId)),n=n.slice(0,5),a=n.map(e=>e.name)}if(s)return I(a,s);const c=e.getMyMembership();if("join"==c){const t=e.currentState.getStateEvents("m.room.third_party_invite");if(t&&t.length){const e=t.map(e=>e.getContent().display_name);return"Inviting "+I(e)}}let l=a;return l.length||(l=e.currentState.getMembers().filter(e=>e.userId!==t&&"invite"!==e.membership&&"join"!==e.membership).map(e=>e.name)),l.length?`Empty room (was ${I(l)})`:"Empty room"}function I(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length+1;const n=t-1;if(e.length){if(1===e.length&&n<=1)return e[0];if(2===e.length&&n<=2)return`${e[0]} and ${e[1]}`;{const t=n>1;return t?`${e[0]} and ${n} others`:e[0]+" and 1 other"}}return"Empty room"}k[h.EventStatus.ENCRYPTING]=[h.EventStatus.SENDING,h.EventStatus.NOT_SENT],k[h.EventStatus.SENDING]=[h.EventStatus.ENCRYPTING,h.EventStatus.QUEUED,h.EventStatus.NOT_SENT,h.EventStatus.SENT],k[h.EventStatus.QUEUED]=[h.EventStatus.SENDING,h.EventStatus.CANCELLED],k[h.EventStatus.SENT]=[],k[h.EventStatus.NOT_SENT]=[h.EventStatus.SENDING,h.EventStatus.QUEUED,h.EventStatus.CANCELLED],k[h.EventStatus.CANCELLED]=[],w.prototype.updatePendingEvent=function(e,t,n){if(f.logger.log(`setting pendingEvent status to ${t} in ${e.getRoomId()} event ID ${e.getId()} -> ${n}`),t==h.EventStatus.SENT&&!n)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(t==h.EventStatus.SENT){const e=this.getUnfilteredTimelineSet().eventIdToTimeline(n);if(e)return}const i=e.status,r=e.getId();if(!i)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");const o=k[i];if(!o||o.indexOf(t)<0)throw new Error("Invalid EventStatus transition "+i+"->"+t);if(e.setStatus(t),t==h.EventStatus.SENT){e.replaceLocalEventId(n);for(let e=0;e<this._timelineSets.length;e++)this._timelineSets[e].replaceEventId(r,n)}else if(t==h.EventStatus.CANCELLED){if(this._pendingEventList){const e=this._pendingEventList.findIndex(e=>e.getId()===r);if(-1!==e){const[t]=this._pendingEventList.splice(e,1);t.isRedaction()&&this._revertRedactionLocalEcho(t)}}this.removeEvent(r)}this._savePendingEvents(),this.emit("Room.localEchoUpdated",e,this,r,i)},w.prototype._revertRedactionLocalEcho=function(e){const t=e.event.redacts;if(!t)return;const n=this.getUnfilteredTimelineSet().findEventById(t);n&&(n.unmarkLocallyRedacted(),this.emit("Room.redactionCancelled",e,this),n.isRelation()&&this._aggregateNonLiveRelation(n))},w.prototype.addLiveEvents=function(e,t,n){let i;if(t&&-1===["replace","ignore"].indexOf(t))throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");for(i=0;i<this._timelineSets.length;i++){const e=this._timelineSets[i].getLiveTimeline();if(e.getPaginationToken(l.EventTimeline.FORWARDS))throw new Error("live timeline "+i+" is no longer live - it has a pagination token ("+e.getPaginationToken(l.EventTimeline.FORWARDS)+")");if(e.getNeighbouringTimeline(l.EventTimeline.FORWARDS))throw new Error("live timeline "+i+" is no longer live - it has a neighbouring timeline")}for(i=0;i<e.length;i++)this._addLiveEvent(e[i],t,n)},w.prototype.addEphemeralEvents=function(e){for(const t of e)"m.typing"===t.getType()?this.currentState.setTypingEvent(t):"m.receipt"===t.getType()&&this.addReceipt(t)},w.prototype.removeEvents=function(e){for(let t=0;t<e.length;++t)this.removeEvent(e[t])},w.prototype.removeEvent=function(e){let t=!1;for(let n=0;n<this._timelineSets.length;n++){const i=this._timelineSets[n].removeEvent(e);i&&(i.isRedaction()&&this._revertRedactionLocalEcho(i),t=!0)}return t},w.prototype.recalculate=function(){const e=this,t=this.currentState.getStateEvents("m.room.member",this.myUserId);if(t&&"invite"===t.getContent().membership){const n=t.event.invite_room_state||[];d.forEach(n,(function(t){const n=e.currentState.getStateEvents(t.type,t.state_key);n||e.currentState.setStateEvents([new h.MatrixEvent({type:t.type,state_key:t.state_key,content:t.content,event_id:"$fake"+Date.now(),room_id:e.roomId,user_id:e.myUserId})])}))}const n=this.name;this.name=T(this,this.myUserId),this.summary=new p.RoomSummary(this.roomId,{title:this.name}),n!==this.name&&this.emit("Room.name",this)},w.prototype.getUsersReadUpTo=function(e){return this.getReceiptsForEvent(e).filter((function(e){return"m.read"===e.type})).map((function(e){return e.userId}))},w.prototype.getEventReadUpTo=function(e,t){let n=this._receipts;return t&&(n=this._realReceipts),void 0===n["m.read"]||void 0===n["m.read"][e]?null:n["m.read"][e].eventId},w.prototype.hasUserReadEvent=function(e,t){const n=this.getEventReadUpTo(e,!1);if(n===t)return!0;if(this.timeline.length&&this.timeline[this.timeline.length-1].getSender()&&this.timeline[this.timeline.length-1].getSender()===e)return!0;for(let i=this.timeline.length-1;i>=0;--i){const e=this.timeline[i];if(e.getId()===t)return!1;if(e.getId()===n)return!0}return!1},w.prototype.getReceiptsForEvent=function(e){return this._receiptCacheByEventId[e.getId()]||[]},w.prototype.addReceipt=function(e,t){void 0===t&&(t=!1),t||this._addReceiptsToStructure(e,this._realReceipts),this._addReceiptsToStructure(e,this._receipts),this._receiptCacheByEventId=this._buildReceiptCache(this._receipts),this.emit("Room.receipt",e,this)},w.prototype._addReceiptsToStructure=function(e,t){const n=this;d.keys(e.getContent()).forEach((function(i){d.keys(e.getContent()[i]).forEach((function(r){d.keys(e.getContent()[i][r]).forEach((function(o){const s=e.getContent()[i][r][o];t[r]||(t[r]={});const a=t[r][o];if(a){const e=n.getUnfilteredTimelineSet().compareEventOrdering(a.eventId,i);if(null!==e&&e>=0)return}else t[r][o]={};t[r][o]={eventId:i,data:s}}))}))}))},w.prototype._buildReceiptCache=function(e){const t={};return d.keys(e).forEach((function(n){d.keys(e[n]).forEach((function(i){const r=e[n][i];t[r.eventId]||(t[r.eventId]=[]),t[r.eventId].push({userId:i,type:n,data:r.data})}))})),t},w.prototype._addLocalEchoReceipt=function(e,t,n){this.addReceipt(S(e,t,n),!0)},w.prototype.addTags=function(e){this.tags=e.getContent().tags||{},this.emit("Room.tags",e,this)},w.prototype.addAccountData=function(e){for(let t=0;t<e.length;t++){const n=e[t];"m.tag"===n.getType()&&this.addTags(n);const i=this.accountData[n.getType()];this.accountData[n.getType()]=n,this.emit("Room.accountData",n,this,i)}},w.prototype.getAccountData=function(e){return this.accountData[e]},w.prototype.maySendMessage=function(){return"join"===this.getMyMembership()&&this.currentState.maySendEvent("m.room.message",this.myUserId)},w.prototype.canInvite=function(e){let t="join"===this.getMyMembership();const n=this.currentState.getStateEvents(v.EventType.RoomPowerLevels,""),i=n&&n.getContent(),r=this.getMember(e);return i&&r&&i.invite>r.powerLevel&&(t=!1),t},w.prototype.getJoinRule=function(){return this.currentState.getJoinRule()},w.prototype.getType=function(){const e=this.currentState.getStateEvents("m.room.create","");if(e)return e.getContent()[v.RoomCreateTypeField];f.logger.warn("Room "+this.roomId+" does not have an m.room.create event")},w.prototype.isSpaceRoom=function(){return this.getType()===v.RoomType.Space}},"0745":function(e,t,n){"use strict";n("53a0")},"07df":function(e,t,n){"use strict";var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.getHttpUriForMxc=o;var r=i(n("3987"));function o(e,t,n,i,o,s){if("string"!==typeof t||!t)return"";if(0!==t.indexOf("mxc://"))return s?t:"";let a=t.slice(6),c="/_matrix/media/r0/download/";const l={};n&&(l.width=Math.round(n)),i&&(l.height=Math.round(i)),o&&(l.method=o),r.keys(l).length>0&&(c="/_matrix/media/r0/thumbnail/");const u=a.indexOf("#");let d="";return u>=0&&(d=a.substr(u),a=a.substr(0,u)),e+c+a+(0===r.keys(l).length?"":"?"+r.encodeParams(l))+d}},"0825":function(e){e.exports=JSON.parse('{"caption":{"create":"Crea","addGroupNamePlaceHolder":"Aggiungi il nome del gruppo","addPublicChatName":"Aggiungi nome chat pubblica","createPublicChat":"Crea chat pubblica","chatTopic":"Argomento rinominato","publicRoomTitle":"Stanza pubblica","asModerator":"come moderatore","marked":"contrassegnato","unmarked":"non segnato","removeBan":"Rimuovi divieto","cancelModeration":"Rimuovere la moderazione","uploadFiles":"Carica file","header":"intestazione","dragAndDropAFile":"Drag and drop file","chatInvite":"Sei stato invitato a chattare con:","cantJoin":"Non puoi entrare in chat con:","chatInviteDecline":"Puoi unirti in chat o declinare l\'invito","creatorLeft":"Perché il creatore ha lasciato la chat","encrypted":"Criptato","noImages":"Non ci sono ancora immagini in questa chat","noFiles":"Non ci sono ancora files in questa chat","inviteUser":"Invita utente","invite":"Invita","add":"Aggiungi","mute":"Disattiva audio","unmute":"Riattiva audio","leave":"Lascia","Info":"Info","new":"Nuovo","typing":"sta scrivendo","accNotFound":"La tua registrazione è in corso, attendi...","emptyList":"la lista è vuota (filtrata o semplicemente vuota)","welcome":"Benvenuto in chat","startNewChat":"Inizia una nuova chat","chats":"Chat","shareWith":"Condividi con","newChat":"Nuova chat","moveToChat":"Sposta in chat","queryNoResults":"La ricerca non ha dato risultati","needMoreCharacters":"Scrivi più caratteri","createGroup":"Crea gruppo","unabletoDecrypt":"* Impossibile decifrare","messageDeleted":"Messaggio eliminato","sentImage":"Immagine inviata","sentVoiceMessage":"inviato un messaggio vocale","invitationToChat":"Invito alla chat","invitationToRoom":"Invitation to room","leftChat":"ha lasciato la chat","joined":"si è aggiunto","chatRenamed":"Chat rinominata in ","recentComment":"Commento recente: ","share":"CONDIVIDI","followers":"Followers","reputation":"Reputazione","unsubscribe":"Annullare l\'iscrizione","following":"Following","theme":"Tema:","contacts":"Contatti","phoneContacts":"Contatti del telefono","chooseInviteMedia":"Scegli come vuoi invitare:","admin":"Admin","moderator":"Moderatore","videocall":"Videochiamata","call":"Chiama","leaveAndDelete":"Lascia e Cancella","donate":"Dona","makeModerator":"Rendi moderatore","ban":"Ban","kick":"Butta fuori","members":"Membri","media":"Media","files":"Files","contactsList":"Lista contatti","send":"invia","pageCaption":"Didascalia pagina","caption":"didascalia","text":"testo","placeholder":"placeholder","sendTransactionTo":"Invia transazione a","toBePaidByReceiver":"Da pagare da parte del ricevente","toBePaidBySender":"Da pagare da parte del mittente","source":"Fonte","amount":"Importo","receiver":"Ricevente","message":"Messaggio","includeFeesInAmount":"Includere le commissioni nell\'importo","transactionFees":"Commissioni di transazione","totalAmount":"Importo totale","balanceTooLow":"Saldo non sufficiente","transactionError":"Errore. non è possibile effettuare la transazione","calculateFees":"Calcolare le commissioni","startChatWith":"Iniziare la chat con","searchResult":"Risultato della ricerca","joinedInTheChat":"si è unito alla chat","invited":"invitato ","hasInvited":"invitato ","inTheChat":" nella chat","banned":"bannato","andRoom":"e stanza","left":"ha lasciato","theChat":" la chat ","made":"ha rest ","aModerator":" un moderatore","editedChatNameTo ":"ha modificato il nome della chat in ","somebody":"qualcuno","sent":"inviato","PKOINto":" PKOIN a ","response":"Risposta","messagefrom":"Messaggio inoltrato da","edited":"Modificato","settings":"Impostazioni","unauthorized":"Non autorizzato","search":"Ricerca","replyOnMessage":"Rispondi","editMessage":"Modifica messaggio","inviteFriend":"Invita amici","emptyContactList":"La lista dei contatti è vuota","joinApp":"Connettiti in una chat privata con me","hasInvitedToJoin":"È privata e NON è collegata al tuo numero di telefono. Chattiamo!","contactsempty":"Non hai ancora contatti, cercali e aggiungili","usernotgen":"L\'utente non ha ancora generato le sue chiavi di crittografia. Potrai chattare con loro quando le loro chiavi saranno generate..","younotgen":"Per favore aspetta un minuto mentre generiamo le tue chiavi crittografiche","messageRead":"Messaggio letto","open":"Apri","You":"Tu","chatsearchingempty":"No chats found for the specified filter","sendmessage":"Send message","clearHistory":"Clear history"},"input":{"patientEmailPlaceholder":"Email","refillNamePlaceholder":"Refill name"},"message":{},"button":{"starChatButton":"Iniziare la chat","decline":"Rifiuta","declineandignore":"Ignora utente","join":"Unisciti","ok":"Ok","save":"Salva","copy":"Copia","forward":"Inoltra","delete":"Elimina","reply":"Rispondi","share":"Condividere","download":"Download","downloaded":"Scaricato","goToPocketnetProfile":"Vai al profilo","sendFile":"Invia file","takePhotoOrVideo":"Invia immagine","sendCoins":"Invia PKOIN","edit":"Modifica","select":"Selezionare","block":"Blocca","unblock":"Sblocca","blockUser":"Blocca utente","Complain":"Segnala"},"type":{"publicgroup":"Crea gruppo pubblico","privategroup":"Crea gruppo privato","one":"Chat privata con un utente"},"typelabel":{"publicgroup":"Creazione gruppo pubblico","privategroup":"Creazione gruppo privato","one":"Creazione di una chat privata"},"yes":"Sì","cancel":"Annulla","teamMessages":{"1-title":"Benvenuti nella chat privata di Bastyon","1-list1":"Chat privata NON collegata al tuo numero di telefono","1-list2":"Crittografia End-To-End di ogni conversazione 1-on-1 di default","1-list3":"Tutte le immagini inviate o ricevute attraverso la chat sono memorizzate in modo criptato","1-list4":"La cronologia dei messaggi viene salvata solo per 7 giorni","2-title":"Annuncio importante!! L\'applicazione Pocketnet è ora chiamata Bastyon!","2-message1":"Il dominio sarà spostato su Bastyon.com. Recentemente abbiamo rilasciato i seguenti importanti aggiornamenti:","2-list1":"Chat privata criptata non collegata al tuo numero di telefono","2-list2":"Possibilità di donare PKOIN ai blogger","2-list3":"Video e Live Streaming","2-message2":"Invita i tuoi amici ora e fai parte del grande futuro dell\'internet decentralizzato!","2-button":"Invita i tuoi amici"},"sendingerror":"An error occurred while sending the message","details":"Details","settings_pin":"Pin chat window","checked":"Yes","unchecked":"No","settings_read":"Send read receipts","messagewasburn":"This message remains only in the memory of your device","messagewillburn":"The message will be deleted soon","micaccessbrowser":"Access to the microphone is restricted, please check your browser settings.","micaccesscommonproblem":"Sorry, for some reason it is not possible to record voice messages on the device","micaccesscordova":"Access to the microphone is restricted, please check your device settings.","micdevicenotfound":"Audio recording device not found"}')},"087d":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chatsPreview",class:{minimized:e.minimized,active:e.active}},[n("div",{staticClass:"work"},[n("div",{staticClass:"previewWrapper"},[n("div",{staticClass:"iconWrapper"},[e.dummy?n("div",{staticClass:"dummyicon loadinggradient"}):n("chatIcon",{key:e.key,attrs:{m_chat:e.m_chat,chat:e.chat,dontuseslides:!0}})],1),n("div",{staticClass:"infoWrapper"},[!e.dummy&&e.ready?n("div",{staticClass:"summaryLine"},[n("div",{staticClass:"caption flexBlock"},[n("chatName",{attrs:{preview:!0,chat:e.chat,m_chat:e.m_chat}}),e.roomMuted?n("div",{staticClass:"roomMuted"},[n("i",{staticClass:"fas fa-bell-slash"})]):e._e()],1),n("div",{staticClass:"time"},[n("chatTime",{attrs:{chat:e.chat,m_chat:e.m_chat}})],1)]):e._e(),!e.dummy&&e.ready?n("div",{staticClass:"eventsLine maxwidth"},[e.event?n("eventsEvent",{attrs:{event:e.matrixevent,chat:e.m_chat,preview:!0}}):e._e()],1):e._e(),e.dummy?n("div",{staticClass:"eventsLine"},[n("div",{staticClass:"dummyline loadinggradient"})]):e._e()])])])])},r=[],o=n("2f62"),s=n("aa20"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chatTime"},[e.time?n("date",{attrs:{date:e.time}}):n("span",{staticClass:"new"},[e._v(e._s(e.$t("caption.new")))])],1)},c=[],l={name:"chatTime",props:{chat:Object,m_chat:{}},computed:{time:function(){var e=this.chat.lastModified;if("invite"===this.m_chat._selfMembership){var t=moment(moment.utc(e).toDate()).local().fromNow();return"in a few seconds"!==t&&"a few seconds ago"!==t?e:(e=-1,e<0?null:e)}return e}}},u=l,d=(n("ff6c"),n("2877")),h=Object(d["a"])(u,a,c,!1,null,"9218004e",null),m=h.exports,p=n("3094"),f={name:"preview",props:{chat:Object,dummy:Boolean},components:{chatName:s["a"],chatTime:m,chatIcon:p["a"]},data:function(){return{loading:!1,roomMuted:!1,ready:!1,lastEvent:{},userStatusRoom:String}},watch:{m_chat:{immediate:!0,handler:function(){this.ready=!1,this.m_chat&&!_.isEmpty(this.m_chat)&&this.core.mtrx.kit.prepareChat(this.m_chat).then(e=>{this.ready=!0})}}},mounted:function(){},computed:Object(o["c"])({auth:e=>e.auth,blockedCheck:function(){var e=this.core.mtrx.anotherChatUsers(this.m_chat.roomId);if(1==e.length)return this.core.mtrx.blockeduser(e[0].userId)},m_chat:function(){if(!this.core.mtrx.client||!this.chat)return null;let e=this.core.mtrx.client._pushProcessor.getPushRuleById(this.chat.roomId);if(null!==e&&(this.roomMuted=!0),this.chat.roomId){var t=this.core.mtrx.client.getRoom(this.chat.roomId);return t||null}},chatevents:function(){return(this.events[this.chat.roomId]||{}).timeline||[]},key:function(){return this.event?this.event.event_id:"key"},unknowngroupusers:function(){return this.core.mtrx.kit.unknowngroupusers(this.chat)},matrixevent:function(){var e=this.event;if(e)return e.get()},event:function(){if(this.chat&&this.chat.roomId){var e=this.m_chat.currentState.getMembers(),t=_.filter(this.chatevents,t=>!(e.length<=2&&("m.room.power_levels"===t.event.type||"m.room.member"===t.event.type&&"invite"!==t.event.content.membership))&&("m.room.redaction"!==t.event.type&&!(t.event.content["m.relates_to"]&&"m.replace"===t.event.content["m.relates_to"]["rel_type"])));if(t=_.sortBy(t,(function(e){return e.event.origin_server_ts})),t.length)return t[t.length-1]}},...Object(o["c"])(["minimized","active","events"])}),methods:{}},g=f,v=(n("f024"),Object(d["a"])(g,i,r,!1,null,"33d22462",null));t["a"]=v.exports},"08da":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fixedOnPageTop",class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active},attrs:{id:"topheader"},on:{mouseleave:e.mouseleave}},[n("div",{staticClass:"topheader "},[n("div",{staticClass:"work"},[n("div",{staticClass:"headerLine"},[n("div",{staticClass:"leftIcon icon",on:{mouseenter:e.mouseenter}},[e._t("left",(function(){return[e._v("   ")]}))],2),n("div",{staticClass:"leftaddIcon iconsmall"},[e._t("leftadd",(function(){return[e._v("   ")]}))],2),n("div",{staticClass:"infoPart",on:{mouseenter:e.mouseenter}},[n("div",[e._t("info",(function(){return[e._v("   ")]}))],2)]),n("div",{staticClass:"rightaddIcons iconsmall"},[e._t("rightadd",(function(){return[e._v("   ")]}))],2),n("div",{staticClass:"rightIcons icon"},[e._t("right",(function(){return[e._v("   ")]}))],2)]),e._t("additional")],2)])])},r=[],o=n("2f62"),s={name:"topheader",props:{},data:function(){return{loading:!1}},created:function(){},watch:{},computed:Object(o["c"])({auth:e=>e.auth,pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active}),methods:{mouseenter:function(){this.$store.commit("active",!0),this.$store.commit("blockactive",{value:!0,item:"header"})},mouseleave:function(){this.$store.state.autohide&&this.$store.commit("active",!1),this.$store.commit("blockactive",{value:!1,item:"header"})}}},a=s,c=(n("5b71"),n("2877")),l=Object(c["a"])(a,i,r,!1,null,"212cbfcc",null);t["a"]=l.exports},"0a00":function(t,n,i){"use strict";(function(t){var r=i("4ea4"),o=i("dbce");Object.defineProperty(n,"__esModule",{value:!0});var s={};n.default=void 0;var a=o(i("3901"));Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(s,e)||e in n&&n[e]===a[e]||Object.defineProperty(n,e,{enumerable:!0,get:function(){return a[e]}}))}));var c=r(i("722a")),l=r(i("4328"));let u;a.request((function(e,t){return e.qs=l.default.stringify(e.qs||{},e.qsStringifyOptions),(0,c.default)(e,t)}));try{u=t.indexedDB}catch(e){}u&&a.setCryptoStoreFactory((function(){return new a.IndexedDBCryptoStore(u,"matrix-js-sdk:crypto")}));var d=a;n.default=d,t.matrixcs=a}).call(this,i("c8ba"))},"0adc":function(e,t,n){"use strict";n("421b")},"0b9e":function(e,t,n){"use strict";n("d9e2"),Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteIndexedDBStoreBackend=o;var i=n("63c7"),r=n("3987");function o(e,t,n){this._workerScript=e,this._dbName=t,this._workerApi=n,this._worker=null,this._nextSeq=0,this._inFlight={},this._startPromise=null}o.prototype={connect:function(){return this._ensureStarted().then(()=>this._doCmd("connect"))},clearDatabase:function(){return this._ensureStarted().then(()=>this._doCmd("clearDatabase"))},isNewlyCreated:function(){return this._doCmd("isNewlyCreated")},getSavedSync:function(){return this._doCmd("getSavedSync")},getNextBatchToken:function(){return this._doCmd("getNextBatchToken")},setSyncData:function(e){return this._doCmd("setSyncData",[e])},syncToDatabase:function(e){return this._doCmd("syncToDatabase",[e])},getOutOfBandMembers:function(e){return this._doCmd("getOutOfBandMembers",[e])},setOutOfBandMembers:function(e,t){return this._doCmd("setOutOfBandMembers",[e,t])},clearOutOfBandMembers:function(e){return this._doCmd("clearOutOfBandMembers",[e])},getClientOptions:function(){return this._doCmd("getClientOptions")},storeClientOptions:function(e){return this._doCmd("storeClientOptions",[e])},getUserPresenceEvents:function(){return this._doCmd("getUserPresenceEvents")},_ensureStarted:function(){return null===this._startPromise&&(this._worker=new this._workerApi(this._workerScript),this._worker.onmessage=this._onWorkerMessage.bind(this),this._startPromise=this._doCmd("_setupWorker",[this._dbName]).then(()=>{i.logger.log("IndexedDB worker is ready")})),this._startPromise},_doCmd:function(e,t){return Promise.resolve().then(()=>{const n=this._nextSeq++,i=(0,r.defer)();return this._inFlight[n]=i,this._worker.postMessage({command:e,seq:n,args:t}),i.promise})},_onWorkerMessage:function(e){const t=e.data;if("cmd_success"==t.command||"cmd_fail"==t.command){if(void 0===t.seq)return void i.logger.error("Got reply from worker with no seq");const e=this._inFlight[t.seq];if(void 0===e)return void i.logger.error("Got reply for unknown seq "+t.seq);if(delete this._inFlight[t.seq],"cmd_success"==t.command)e.resolve(t.result);else{const n=new Error(t.error.message);n.name=t.error.name,e.reject(n)}}else i.logger.warn("Unrecognised message from worker: "+t)}}},"0e7d":function(e,t,n){},1:function(e,t){},"12df":function(e,t,n){"use strict";n("56a3")},1426:function(e,t,n){},1570:function(e,t,n){"use strict";n("3917")},1623:function(e,t,n){"use strict";n("19a2")},"16e5":function(t,n,i){"use strict";var r=i("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.CallEventHandler=void 0;var o=r(i("9523")),s=i("63c7"),a=i("3134"),c=i("d613");const l=3e3;class u{constructor(t){(0,o.default)(this,"client",void 0),(0,o.default)(this,"calls",void 0),(0,o.default)(this,"callEventBuffer",void 0),(0,o.default)(this,"candidateEventsByCall",void 0),(0,o.default)(this,"evaluateEventBuffer",()=>{if("SYNCING"===this.client.getSyncState()){if(this.callEventBuffer.some(e=>e.isBeingDecrypted()))return;const t=new Set;for(const e of this.callEventBuffer)e.getType()!==c.EventType.CallAnswer&&e.getType()!==c.EventType.CallHangup||t.add(e.getContent().call_id);for(const n of this.callEventBuffer)if(n.getType()!==c.EventType.CallInvite||!t.has(n.getContent().call_id))try{this.handleCallEvent(n)}catch(e){s.logger.error("Caught exception handling call event",e)}this.callEventBuffer=[]}}),(0,o.default)(this,"onEvent",t=>{(0===t.getType().indexOf("m.call.")||t.isBeingDecrypted())&&this.callEventBuffer.push(t),(t.isBeingDecrypted()||t.isDecryptionFailure())&&t.once("Event.decrypted",()=>{if(-1!==t.getType().indexOf("m.call."))if(this.callEventBuffer.includes(t))this.evaluateEventBuffer();else try{this.handleCallEvent(t)}catch(e){s.logger.error("Caught exception handling call event",e)}})}),this.client=t,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map,this.client.on("sync",this.evaluateEventBuffer),this.client.on("event",this.onEvent)}stop(){this.client.removeListener("sync",this.evaluateEventBuffer),this.client.removeListener("event",this.onEvent)}handleCallEvent(e){const t=e.getContent();let n=t.call_id?this.calls.get(t.call_id):void 0;if(e.getType()===c.EventType.CallInvite){if(e.getSender()===this.client.credentials.userId)return;if(e.getLocalAge()>t.lifetime-l)return;if(n&&n.state===a.CallState.Ended)return;n&&s.logger.log(`WARN: Already have a MatrixCall with id ${t.call_id} but got an invite. Clobbering.`);const i=this.client.getTurnServersExpiry()-Date.now();if(s.logger.info("Current turn creds expire in "+i+" ms"),n=(0,a.createNewMatrixCall)(this.client,e.getRoomId(),{forceTURN:this.client._forceTURN}),!n)return void s.logger.log("Incoming call ID "+t.call_id+" but this client doesn't support WebRTC");if(n.callId=t.call_id,n.initWithInvite(e),this.calls.set(n.callId,n),this.candidateEventsByCall.get(n.callId))for(const e of this.candidateEventsByCall.get(n.callId))n.onRemoteIceCandidatesReceived(e);let r;for(const e of this.calls.values()){const t=[a.CallState.WaitLocalMedia,a.CallState.CreateOffer,a.CallState.InviteSent].includes(e.state);if(n.roomId===e.roomId&&e.direction===a.CallDirection.Outbound&&t){r=e;break}}r?r.state===a.CallState.WaitLocalMedia||r.state===a.CallState.CreateOffer||r.callId>n.callId?(s.logger.log("Glare detected: answering incoming call "+n.callId+" and canceling outgoing call "+r.callId),r.replacedBy(n),n.answer()):(s.logger.log("Glare detected: rejecting incoming call "+n.callId+" and keeping outgoing call "+r.callId),n.hangup(a.CallErrorCode.Replaced,!0)):this.client.emit("Call.incoming",n)}else if(e.getType()===c.EventType.CallAnswer){if(!n)return;e.getSender()===this.client.credentials.userId?n.state===a.CallState.Ringing&&n.onAnsweredElsewhere(t):n.onAnswerReceived(e)}else if(e.getType()===c.EventType.CallCandidates){if(e.getSender()===this.client.credentials.userId)return;n?n.onRemoteIceCandidatesReceived(e):(this.candidateEventsByCall.has(t.call_id)||this.candidateEventsByCall.set(t.call_id,[]),this.candidateEventsByCall.get(t.call_id).push(e))}else if([c.EventType.CallHangup,c.EventType.CallReject].includes(e.getType()))n?n.state!==a.CallState.Ended&&(e.getType()===c.EventType.CallHangup?n.onHangupReceived(t):n.onRejectReceived(t),this.calls.delete(t.call_id)):(n=(0,a.createNewMatrixCall)(this.client,e.getRoomId()),n&&(n.callId=t.call_id,n.initWithHangup(e),this.calls.set(t.call_id,n)));else if(e.getType()===c.EventType.CallSelectAnswer){if(!n)return;if(e.getContent().party_id===n.ourPartyId)return;n.onSelectAnswerReceived(e)}else if(e.getType()===c.EventType.CallNegotiate){if(!n)return;if(e.getContent().party_id===n.ourPartyId)return;n.onNegotiateReceived(e)}}}n.CallEventHandler=u},"17e1":function(e,t,n){"use strict";n("d591")},"195d":function(e,t,n){},"19a2":function(e,t,n){},"1b79":function(e,t,n){"use strict";n("31a4")},"1c8f":function(t,n,i){"use strict";(function(t){var r=i("c973").default;i("d9e2");var o=i("dbce"),s=i("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.MatrixHttpApi=_,n.retryNetworkOperation=T,n.AbortError=n.ConnectionError=n.MatrixError=n.PREFIX_MEDIA_R0=n.PREFIX_IDENTITY_V2=n.PREFIX_IDENTITY_V1=n.PREFIX_UNSTABLE=n.PREFIX_R0=void 0;var a=s(i("9523")),c=i("b40f"),l=o(i("3987")),u=i("63c7"),d=o(i("38f4"));function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const p="/_matrix/client/r0";n.PREFIX_R0=p;const f="/_matrix/client/unstable";n.PREFIX_UNSTABLE=f;const g="/_matrix/identity/api/v1";n.PREFIX_IDENTITY_V1=g;const v="/_matrix/identity/v2";n.PREFIX_IDENTITY_V2=v;const y="/_matrix/media/r0";function _(e,t){l.checkObjectHasKeys(t,["baseUrl","request","prefix"]),t.onlyData=t.onlyData||!1,this.event_emitter=e,this.opts=t,this.useAuthorizationHeader=Boolean(t.useAuthorizationHeader),this.uploads=[]}n.PREFIX_MEDIA_R0=y,_.prototype={setIdBaseUrl:function(e){this.opts.idBaseUrl=e},getContentUri:function(){const e={access_token:this.opts.accessToken};return{base:this.opts.baseUrl,path:"/_matrix/media/r0/upload",params:e}},uploadContent:function(e,n){l.isFunction(n)?n={callback:n}:void 0===n&&(n={});const i=!1!==n.includeFilename,r=n.type||e.type||"application/octet-stream",o=n.name||e.name;let s=e;s.stream&&"function"!==typeof s.stream&&(u.logger.warn("Using `file.stream` as the content to upload. Future versions of the js-sdk will change this to expect `file` to be the content directly."),s=s.stream);let a=n.rawResponse;var c=t._XMLHttpRequest||t.XMLHttpRequest;void 0===a&&(c?a=!1:(u.logger.warn("Returning the raw JSON from uploadContent(). Future versions of the js-sdk will change this default, to return the parsed object. Set opts.rawResponse=false to change this behaviour now."),a=!0));let h=n.onlyContentUri;a||void 0!==h||(c?(u.logger.warn("Returning only the content-uri from uploadContent(). Future versions of the js-sdk will change this default, to return the whole response object. Set opts.onlyContentUri=false to change this behaviour now."),h=!0):h=!1);const m={loaded:0,total:0};let p,f=null;if(a||(f=function(e){let t=JSON.parse(e);if(h&&(t=t.content_uri,void 0===t))throw Error("Bad response");return t}),c){const e=l.defer(),t=new c;m.xhr=t;const a=b(e,n.callback,this.opts.onlyData),u=function(){t.abort(),a(new Error("Timeout"))};t.timeout_timer=d.setTimeout(u,3e4),t.onreadystatechange=function(){let e;switch(t.readyState){case c.DONE:d.clearTimeout(t.timeout_timer);try{if(0===t.status)throw new k;if(!t.responseText)throw new Error("No response body.");e=t.responseText,f&&(e=f(e))}catch(n){return n.http_status=t.status,void a(n)}a(void 0,t,e);break}},t.upload.addEventListener("progress",(function(e){d.clearTimeout(t.timeout_timer),m.loaded=e.loaded,m.total=e.total,t.timeout_timer=d.setTimeout(u,3e4),n.progressHandler&&n.progressHandler({loaded:e.loaded,total:e.total})}));let h=this.opts.baseUrl+"/_matrix/media/r0/upload";const g=[];i&&o&&g.push("filename="+encodeURIComponent(o)),this.useAuthorizationHeader||g.push("access_token="+encodeURIComponent(this.opts.accessToken)),g.length>0&&(h+="?"+g.join("&")),t.open("POST",h),this.useAuthorizationHeader&&t.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),t.setRequestHeader("Content-Type",r),t.send(s),p=e.promise,p.abort=t.abort.bind(t)}else{const e={};i&&o&&(e.filename=o),p=this.authedRequest(n.callback,"POST","/upload",e,s,{prefix:"/_matrix/media/r0",headers:{"Content-Type":r},json:!1,bodyParser:f})}const g=this,v=p.finally((function(){for(let e=0;e<g.uploads.length;++e)if(g.uploads[e]===m)return void g.uploads.splice(e,1)}));return v.abort=p.abort,m.promise=v,this.uploads.push(m),v},cancelUpload:function(e){return!!e.abort&&(e.abort(),!0)},getCurrentUploads:function(){return this.uploads},idServerRequest:function(e,t,n,i,r,o){if(!this.opts.idBaseUrl)throw new Error("No Identity Server base URL set");const s=this.opts.idBaseUrl+r+n;if(void 0!==e&&!l.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);const a={uri:s,method:t,withCredentials:!1,json:!0,_matrix_opts:this.opts,headers:{}};"GET"===t?a.qs=i:"object"===typeof i&&(a.json=i),o&&(a.headers["Authorization"]="Bearer "+o);const c=l.defer();return this.opts.request(a,b(c,e,this.opts.onlyData)),c.promise},authedRequest:function(e,t,n,i,r,o){i||(i={}),this.useAuthorizationHeader?(isFinite(o)&&(o={localTimeoutMs:o}),o||(o={}),o.headers||(o.headers={}),o.headers.Authorization||(o.headers.Authorization="Bearer "+this.opts.accessToken),i.access_token&&delete i.access_token):i.access_token||(i.access_token=this.opts.accessToken);const s=this.request(e,t,n,i,r,o),a=this;return s.catch((function(e){"M_UNKNOWN_TOKEN"==e.errcode?a.event_emitter.emit("Session.logged_out",e):"M_CONSENT_NOT_GIVEN"==e.errcode&&a.event_emitter.emit("no_consent",e.message,e.data.consent_uri)})),s},request:function(e,t,n,i,r,o){o=o||{};const s=void 0!==o.prefix?o.prefix:this.opts.prefix,a=this.opts.baseUrl+s+n;return this.requestOtherUrl(e,t,a,i,r,o)},requestOtherUrl:function(e,t,n,i,r,o){return void 0===o||null===o?o={}:isFinite(o)&&(o={localTimeoutMs:o}),this._request(e,t,n,i,r,o)},getUrl:function(e,t,n){let i="";return t&&(i="?"+l.encodeParams(t)),this.opts.baseUrl+n+e+i},_request:function(e,t,n,i,r,o){if(void 0!==e&&!l.isFunction(e))throw Error("Expected callback to be a function but got "+typeof e);o=o||{};const s=this;this.opts.extraParams&&(i=m(m({},i),this.opts.extraParams));const a=l.extend({},o.headers||{}),c=void 0===o.json||o.json;let u=o.bodyParser;c&&(r&&(r=JSON.stringify(r),a["content-type"]="application/json"),a["accept"]||(a["accept"]="application/json"),void 0===u&&(u=function(e){return JSON.parse(e)}));const h=l.defer();let p,f,g=!1;const v=o.localTimeoutMs||this.opts.localTimeoutMs,y=()=>{v&&(p&&d.clearTimeout(p),p=d.setTimeout((function(){g=!0,f&&f.abort&&f.abort(),h.reject(new w({error:"Locally timed out waiting for a response",errcode:"ORG.MATRIX.JSSDK_TIMEOUT",timeout:v}))}),v))};y();const _=h.promise;try{f=this.opts.request({uri:n,method:t,withCredentials:!1,qs:i,qsStringifyOptions:o.qsStringifyOptions,useQuerystring:!0,body:r,json:!1,timeout:v,headers:a||{},_matrix_opts:this.opts},(function(t,n,i){if(v&&(d.clearTimeout(p),g))return;const r=b(h,e,s.opts.onlyData,u);r(t,n,i)})),f&&("onprogress"in f&&(f.onprogress=e=>{y()}),f.abort&&(_.abort=f.abort.bind(f)))}catch(E){h.reject(E),e&&e(E)}return _}};const b=function(t,n,i,r){return n=n||function(){},function(o,s,a){if(o){const e="AbortError"===o.name||"aborted"===o;e||o instanceof w||(o=new C("request failed",o))}if(!o)try{s.statusCode>=400?o=E(s,a):r&&(a=r(a))}catch(e){o=new Error("Error parsing server response: "+e)}if(o)t.reject(o),n(o);else{const e={code:s.statusCode,headers:s.headers,data:a};t.resolve(i?a:e),n(null,i?a:e)}}};function E(e,t){const n=e.statusCode,i=S(e);let r;if(i)if("application/json"===i.type){const e="object"===typeof t?t:JSON.parse(t);r=new w(e)}else"text/plain"===i.type&&(r=new Error(`Server returned ${n} error: ${t}`));return r||(r=new Error(`Server returned ${n} error`)),r.httpStatus=n,r}function S(t){let n;if(t.getResponseHeader?n=t.getResponseHeader("Content-Type"):t.headers&&(n=t.headers["content-type"]||null),!n)return null;try{return(0,c.parse)(n)}catch(e){throw new Error(`Error parsing Content-Type '${n}': ${e}`)}}class w extends Error{constructor(e){e=e||{},super("MatrixError: "+e.errcode),this.errcode=e.errcode,this.name=e.errcode||"Unknown error code",this.message=e.error||"Unknown message",this.data=e}}n.MatrixError=w;class C extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;super(e+(t?": "+t.message:"")),this._cause=t}get name(){return"ConnectionError"}get cause(){return this._cause}}n.ConnectionError=C;class k extends Error{constructor(){super("Operation aborted")}get name(){return"AbortError"}}function T(e,t){return I.apply(this,arguments)}function I(){return I=r((function*(e,t){let n=0,i=null;while(n<e)try{if(n>0){const e=1e3*Math.pow(2,n);u.logger.log(`network operation failed ${n} times, retrying in ${e}ms...`),yield new Promise(t=>setTimeout(t,e))}return yield t()}catch(r){if(!(r instanceof C))throw r;n+=1,i=r}throw i})),I.apply(this,arguments)}n.AbortError=k}).call(this,i("c8ba"))},"1c95":function(e,t,n){},2:function(e,t){},2200:function(e,t,n){"use strict";n("2dc1")},"2b60":function(e,t,n){"use strict";var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.RoomMember=a;var r=n("faa1"),o=n("07df"),s=i(n("3987"));function a(e,t){this.roomId=e,this.userId=t,this.typing=!1,this.name=t,this.rawDisplayName=t,this.powerLevel=0,this.powerLevelNorm=0,this.user=null,this.membership=null,this.events={member:null},this._isOutOfBand=!1,this._updateModifiedTime()}s.inherits(a,r.EventEmitter),a.prototype.markOutOfBand=function(){this._isOutOfBand=!0},a.prototype.isOutOfBand=function(){return this._isOutOfBand},a.prototype.setMembershipEvent=function(e,t){if("m.room.member"!==e.getType())return;this._isOutOfBand=!1,this.events.member=e;const n=this.membership;this.membership=e.getDirectionalContent().membership;const i=this.name;this.name=u(this.userId,e.getDirectionalContent().displayname,t),this.rawDisplayName=e.getDirectionalContent().displayname||this.userId,n!==this.membership&&(this._updateModifiedTime(),this.emit("RoomMember.membership",e,this,n)),i!==this.name&&(this._updateModifiedTime(),this.emit("RoomMember.name",e,this,i))},a.prototype.setPowerLevelEvent=function(e){if("m.room.power_levels"!==e.getType())return;const t=e.getDirectionalContent();let n=t.users_default||0;s.forEach(s.values(t.users),(function(e){n=Math.max(n,e)}));const i=this.powerLevel,r=this.powerLevelNorm;t.users&&void 0!==t.users[this.userId]?this.powerLevel=t.users[this.userId]:void 0!==t.users_default?this.powerLevel=t.users_default:this.powerLevel=0,this.powerLevelNorm=0,n>0&&(this.powerLevelNorm=100*this.powerLevel/n),i===this.powerLevel&&r===this.powerLevelNorm||(this._updateModifiedTime(),this.emit("RoomMember.powerLevel",e,this))},a.prototype.setTypingEvent=function(e){if("m.typing"!==e.getType())return;const t=this.typing;this.typing=!1;const n=e.getContent().user_ids;s.isArray(n)&&(-1!==n.indexOf(this.userId)&&(this.typing=!0),t!==this.typing&&(this._updateModifiedTime(),this.emit("RoomMember.typing",e,this)))},a.prototype._updateModifiedTime=function(){this._modified=Date.now()},a.prototype.getLastModifiedTime=function(){return this._modified},a.prototype.isKicked=function(){return"leave"===this.membership&&this.events.member.getSender()!==this.events.member.getStateKey()},a.prototype.getDMInviter=function(){if(this.events.member){const e=this.events.member;let t=e.getContent(),n=e.getSender();if("join"===t.membership&&(t=e.getPrevContent(),n=e.getUnsigned().prev_sender),"invite"===t.membership&&t.is_direct)return n}},a.prototype.getAvatarUrl=function(e,t,n,i,r,s){void 0===r&&(r=!0);const a=this.getMxcAvatarUrl();if(!a&&!r)return null;const c=(0,o.getHttpUriForMxc)(e,a,t,n,i,s);return c||null},a.prototype.getMxcAvatarUrl=function(){return this.events.member?this.events.member.getDirectionalContent().avatar_url:this.user?this.user.avatarUrl:null};const c=/@.+:.+/,l=/[\u200E\u200F\u202A-\u202F]/;function u(e,t,n){if(!t||t===e)return e;if(!s.removeHiddenChars(t))return e;if(!n)return t;let i=c.test(t);if(i||(i=l.test(t)),!i){const r=n.getUserIdsWithDisplayName(t);i=r.some(t=>t!==e)}return i?t+" ("+e+")":t}},"2d78":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncAccumulator=void 0;var i=n("63c7"),r=n("3987");class o{constructor(e){e=e||{},e.maxTimelineEntries=e.maxTimelineEntries||50,this.opts=e,this.accountData={},this.inviteRooms={},this.joinRooms={},this.nextBatch=null,this.groups={invite:{},join:{},leave:{}}}accumulate(e,t){this._accumulateRooms(e,t),this._accumulateGroups(e),this._accumulateAccountData(e),this.nextBatch=e.next_batch}_accumulateAccountData(e){e.account_data&&e.account_data.events&&e.account_data.events.forEach(e=>{this.accountData[e.type]=e})}_accumulateRooms(e,t){e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(n=>{this._accumulateRoom(n,"invite",e.rooms.invite[n],t)}),e.rooms.join&&Object.keys(e.rooms.join).forEach(n=>{this._accumulateRoom(n,"join",e.rooms.join[n],t)}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(n=>{this._accumulateRoom(n,"leave",e.rooms.leave[n],t)}))}_accumulateRoom(e,t,n,r){switch(t){case"invite":this._accumulateInviteState(e,n);break;case"join":this.inviteRooms[e]&&delete this.inviteRooms[e],this._accumulateJoinState(e,n,r);break;case"leave":this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:i.logger.error("Unknown cateogory: ",t)}}_accumulateInviteState(e,t){if(!t.invite_state||!t.invite_state.events)return;if(!this.inviteRooms[e])return void(this.inviteRooms[e]={invite_state:t.invite_state});const n=this.inviteRooms[e];t.invite_state.events.forEach(e=>{let t=!1;for(let i=0;i<n.invite_state.events.length;i++){const r=n.invite_state.events[i];r.type===e.type&&r.state_key==e.state_key&&(n.invite_state.events[i]=e,t=!0)}t||n.invite_state.events.push(e)})}_accumulateJoinState(e,t,n){this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_summary:{},_readReceipts:{}});const i=this.joinRooms[e];if(t.account_data&&t.account_data.events&&t.account_data.events.forEach(e=>{i._accountData[e.type]=e}),t.unread_notifications&&(i._unreadNotifications=t.unread_notifications),t.summary){const e="m.heroes",n="m.invited_member_count",r="m.joined_member_count",o=i._summary,s=t.summary;o[e]=s[e]||o[e],o[r]=s[r]||o[r],o[n]=s[n]||o[n]}if(t.ephemeral&&t.ephemeral.events&&t.ephemeral.events.forEach(e=>{"m.receipt"===e.type&&e.content&&Object.keys(e.content).forEach(t=>{e.content[t]["m.read"]&&Object.keys(e.content[t]["m.read"]).forEach(n=>{i._readReceipts[n]={data:e.content[t]["m.read"][n],eventId:t}})})}),t.timeline&&t.timeline.limited&&(i._timeline=[]),t.state&&t.state.events&&t.state.events.forEach(e=>{s(i._currentState,e)}),t.timeline&&t.timeline.events&&t.timeline.events.forEach((e,r)=>{let o;if(s(i._currentState,e),n)o=e;else{o=Object.assign({},e),void 0!==o.unsigned&&(o.unsigned=Object.assign({},o.unsigned));const t=e.unsigned?e.unsigned.age:e.age;void 0!==t&&(o._localTs=Date.now()-t)}i._timeline.push({event:o,token:0===r?t.timeline.prev_batch:null})}),i._timeline.length>this.opts.maxTimelineEntries){const e=i._timeline.length-this.opts.maxTimelineEntries;for(let t=e;t<i._timeline.length;t++)if(i._timeline[t].token){i._timeline=i._timeline.slice(t,i._timeline.length);break}}}_accumulateGroups(e){e.groups&&(e.groups.invite&&Object.keys(e.groups.invite).forEach(t=>{this._accumulateGroup(t,"invite",e.groups.invite[t])}),e.groups.join&&Object.keys(e.groups.join).forEach(t=>{this._accumulateGroup(t,"join",e.groups.join[t])}),e.groups.leave&&Object.keys(e.groups.leave).forEach(t=>{this._accumulateGroup(t,"leave",e.groups.leave[t])}))}_accumulateGroup(e,t,n){for(const i of["invite","join","leave"])delete this.groups[i][e];this.groups[t][e]=n}getJSON(e){const t={join:{},invite:{},leave:{}};Object.keys(this.inviteRooms).forEach(e=>{t.invite[e]=this.inviteRooms[e]}),Object.keys(this.joinRooms).forEach(n=>{const i=this.joinRooms[n],o={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:i._unreadNotifications,summary:i._summary};Object.keys(i._accountData).forEach(e=>{o.account_data.events.push(i._accountData[e])});const a={type:"m.receipt",room_id:n,content:{}};Object.keys(i._readReceipts).forEach(e=>{const t=i._readReceipts[e];a.content[t.eventId]||(a.content[t.eventId]={"m.read":{}}),a.content[t.eventId]["m.read"][e]=t.data}),Object.keys(a.content).length>0&&o.ephemeral.events.push(a),i._timeline.forEach(t=>{if(!o.timeline.prev_batch){if(!t.token)return;o.timeline.prev_batch=t.token}let n;!e&&t.event._localTs?(n=Object.assign({},t.event),void 0!==n.unsigned&&(n.unsigned=Object.assign({},n.unsigned)),delete n._localTs,n.unsigned=n.unsigned||{},n.unsigned.age=Date.now()-t.event._localTs):n=t.event,o.timeline.events.push(n)});const c=Object.create(null);for(let e=o.timeline.events.length-1;e>=0;e--){const t=o.timeline.events[e];if(null===t.state_key||void 0===t.state_key)continue;const n=(0,r.deepCopy)(t);n.unsigned&&(n.unsigned.prev_content&&(n.content=n.unsigned.prev_content),n.unsigned.prev_sender&&(n.sender=n.unsigned.prev_sender)),s(c,n)}Object.keys(i._currentState).forEach(e=>{Object.keys(i._currentState[e]).forEach(t=>{let n=i._currentState[e][t];c[e]&&c[e][t]&&(n=c[e][t]),o.state.events.push(n)})}),t.join[n]=o});const n=[];return Object.keys(this.accountData).forEach(e=>{n.push(this.accountData[e])}),{nextBatch:this.nextBatch,roomsData:t,groupsData:this.groups,accountData:n}}getNextBatchToken(){return this.nextBatch}}function s(e,t){null!==t.state_key&&void 0!==t.state_key&&t.type&&(e[t.type]||(e[t.type]=Object.create(null)),e[t.type][t.state_key]=t)}t.SyncAccumulator=o},"2d81":function(e,t,n){},"2db5":function(e,t,n){var i={"./cmn.json":"96ee","./de.json":"6ce2","./en.json":"edd4","./es.json":"a306","./fr.json":"f693","./it.json":"0825","./kr.json":"c1af","./ru.json":"7704"};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}r.keys=function(){return Object.keys(i)},r.resolve=o,e.exports=r,r.id="2db5"},"2db5b":function(e,t,n){"use strict";n("9916")},"2dc1":function(e,t,n){},"2e4b":function(e,t,n){},3:function(e,t){},3094:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chatIcon",class:{unknowngroupusers:e.unknowngroupusers}},[e.groupAvatar?n("div",{staticClass:"chatGroupIcon"},[n("img",{attrs:{src:e.groupAvatar,alt:""}})]):e._e(),n("userspic",{key:e.allnotifications,class:{opacity:e.groupAvatar},attrs:{slidesPerView:e.slidesPerView,users:e.usersinfo,status:e.status,unseen:e.unseen,single:e.singleAvatar}}),e.unknowngroupusers?n("div",{staticClass:"unknowngroupusersicon"},[n("i",{staticClass:"fas fa-question"})]):e._e()],1)},r=[],o=n("3139"),s={name:"chatIcon",data:function(){return{single:[]}},props:{chat:{},m_chat:{},slidesPerView:Number,hideunseen:Boolean,dontuseslides:Boolean},computed:{allnotifications:function(){return this.$store.state.allnotifications||"0"},unseen:function(){return this.hideunseen||this.blockedCheck?0:"invite"===this.m_chat._selfMembership&&o["a"].date.addseconds(moment.utc(this.m_chat.summary.lastModified).toDate(),86400)>new Date?1:(this.allnotifications,this.m_chat.getUnreadNotificationCount())},users:function(){if(!this.chat)return[];var e=this.core.mtrx.anotherChatUsers(this.chat.roomId);return this.dontuseslides&&(e=_.first(e,4)),e},singleAvatar:function(){if(!this.chat&&!this.m_chat)return{};if("public"===this.m_chat.getJoinRule()&&1===this.m_chat.currentState.getMembers().length){var e=this.m_chat.currentState.getMembers()[0],t=this.$store.state.users[o["a"].getmatrixid(e.userId)];if(t)return t.status=e.membership,t.image=t.source.i,t}return{}},blockedCheck:function(){var e=this.core.mtrx.anotherChatUsers(this.m_chat.roomId);if(1==e.length)return this.core.mtrx.blockeduser(e[0].userId)},usersinfo:function(){var e=this.core.mtrx.chatUsersInfo(this.chat.roomId,"anotherChatUsers");return this.dontuseslides&&(e=_.first(e,4)),e},status:function(){var e={};return _.each(this.users,t=>{e[t.userId]=this.core.mtrx.blockeduser(t.userId)?"blocked":t.membership}),e},unknowngroupusers:function(){return this.core.mtrx.kit.unknowngroupusers(this.m_chat)},groupAvatar:function(){var e;const t=null===(e=this.m_chat.currentState.getStateEvents("m.room.avatar")[0])||void 0===e?void 0:e.event.content.avatarUrl;return""!==t?t:""}}},a=s,c=(n("a071"),n("2877")),l=Object(c["a"])(a,i,r,!1,null,"332740e2",null);t["a"]=l.exports},3134:function(t,n,i){"use strict";var r=i("c973").default;i("d9e2");var o=i("dbce"),s=i("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.getDesktopCapturerSources=w,n.setAudioOutput=N,n.setAudioInput=D,n.setVideoInput=j,n.createNewMatrixCall=U,n.MatrixCall=n.CallError=n.CallErrorCode=n.CallEvent=n.CallParty=n.CallDirection=n.CallType=n.CallState=void 0;var a=s(i("9523")),c=i("63c7"),l=i("faa1"),u=o(i("3987")),d=i("d613"),h=i("f408");let m,p,f,g,v,y;var _;n.CallState=m,function(e){e["Fledgling"]="fledgling",e["InviteSent"]="invite_sent",e["WaitLocalMedia"]="wait_local_media",e["CreateOffer"]="create_offer",e["CreateAnswer"]="create_answer",e["Connecting"]="connecting",e["Connected"]="connected",e["Ringing"]="ringing",e["Ended"]="ended"}(m||(n.CallState=m={})),n.CallType=p,function(e){e["Voice"]="voice",e["Video"]="video"}(p||(n.CallType=p={})),n.CallDirection=f,function(e){e["Inbound"]="inbound",e["Outbound"]="outbound"}(f||(n.CallDirection=f={})),n.CallParty=g,function(e){e["Local"]="local",e["Remote"]="remote"}(g||(n.CallParty=g={})),n.CallEvent=v,function(e){e["Hangup"]="hangup",e["State"]="state",e["Error"]="error",e["Replaced"]="replaced",e["LocalHoldUnhold"]="local_hold_unhold",e["RemoteHoldUnhold"]="remote_hold_unhold",e["HoldUnhold"]="hold_unhold"}(v||(n.CallEvent=v={})),n.CallErrorCode=y,function(e){e["UserHangup"]="user_hangup",e["LocalOfferFailed"]="local_offer_failed",e["NoUserMedia"]="no_user_media",e["UnknownDevices"]="unknown_devices",e["SendInvite"]="send_invite",e["CreateAnswer"]="create_answer",e["SendAnswer"]="send_answer",e["SetRemoteDescription"]="set_remote_description",e["SetLocalDescription"]="set_local_description",e["AnsweredElsewhere"]="answered_elsewhere",e["IceFailed"]="ice_failed",e["InviteTimeout"]="invite_timeout",e["Replaced"]="replaced",e["SignallingFailed"]="signalling_timeout"}(y||(n.CallErrorCode=y={})),function(e){e["Audio"]="audio",e["Video"]="video"}(_||(_={}));const b=1,E="stun:turn.matrix.org",S=6e4;function w(){const e={thumbnailSize:{height:176,width:312},types:["screen","window"]};return window.electron.getDesktopCapturerSources(e)}class C extends Error{constructor(e,t,n){super(t+": "+n),(0,a.default)(this,"code",void 0),this.code=e}}function k(){return Date.now().toString()+(0,h.randomString)(16)}n.CallError=C;class T extends l.EventEmitter{constructor(t){var n;super(),n=this,(0,a.default)(this,"roomId",void 0),(0,a.default)(this,"type",void 0),(0,a.default)(this,"callId",void 0),(0,a.default)(this,"state",void 0),(0,a.default)(this,"hangupParty",void 0),(0,a.default)(this,"hangupReason",void 0),(0,a.default)(this,"direction",void 0),(0,a.default)(this,"ourPartyId",void 0),(0,a.default)(this,"client",void 0),(0,a.default)(this,"forceTURN",void 0),(0,a.default)(this,"turnServers",void 0),(0,a.default)(this,"candidateSendQueue",void 0),(0,a.default)(this,"candidateSendTries",void 0),(0,a.default)(this,"sentEndOfCandidates",void 0),(0,a.default)(this,"peerConn",void 0),(0,a.default)(this,"localVideoElement",void 0),(0,a.default)(this,"remoteVideoElement",void 0),(0,a.default)(this,"remoteAudioElement",void 0),(0,a.default)(this,"screenSharingStream",void 0),(0,a.default)(this,"remoteStream",void 0),(0,a.default)(this,"localAVStream",void 0),(0,a.default)(this,"inviteOrAnswerSent",void 0),(0,a.default)(this,"waitForLocalAVStream",void 0),(0,a.default)(this,"config",void 0),(0,a.default)(this,"successor",void 0),(0,a.default)(this,"opponentMember",void 0),(0,a.default)(this,"opponentVersion",void 0),(0,a.default)(this,"opponentPartyId",void 0),(0,a.default)(this,"opponentCaps",void 0),(0,a.default)(this,"inviteTimeout",void 0),(0,a.default)(this,"remoteOnHold",void 0),(0,a.default)(this,"unholdingRemote",void 0),(0,a.default)(this,"micMuted",void 0),(0,a.default)(this,"vidMuted",void 0),(0,a.default)(this,"callStatsAtEnd",void 0),(0,a.default)(this,"makingOffer",void 0),(0,a.default)(this,"ignoreOffer",void 0),(0,a.default)(this,"remoteCandidateBuffer",new Map),(0,a.default)(this,"gotUserMediaForInvite",function(){var t=r((function*(t){if(n.successor)return void n.successor.gotUserMediaForAnswer(t);if(n.callHasEnded())return void n.stopAllMedia();n.localAVStream=t,c.logger.info("Got local AV stream with id "+n.localAVStream.id),n.setState(m.CreateOffer),c.logger.debug("gotUserMediaForInvite -> "+n.type);const i=n.getLocalVideoElement();if(i&&n.type===p.Video){i.autoplay=!0,n.screenSharingStream?(c.logger.debug("Setting screen sharing stream to the local video element"),i.srcObject=n.screenSharingStream):i.srcObject=t,i.muted=!0;try{yield i.play()}catch(e){c.logger.info("Failed to play local video element",e)}}I(t.getAudioTracks(),!0);for(const e of t.getAudioTracks())c.logger.info("Adding audio track with id "+e.id),n.peerConn.addTrack(e,t);for(const e of(n.screenSharingStream||t).getVideoTracks())c.logger.info("Adding video track with id "+e.id),n.peerConn.addTrack(e,t)}));return function(e){return t.apply(this,arguments)}}()),(0,a.default)(this,"gotUserMediaForAnswer",function(){var t=r((function*(t){if(n.callHasEnded())return;const i=n.getLocalVideoElement();if(i&&n.type===p.Video){i.autoplay=!0,i.srcObject=t,i.muted=!0;try{yield i.play()}catch(e){c.logger.info("Failed to play local video element",e)}}n.localAVStream=t,c.logger.info("Got local AV stream with id "+n.localAVStream.id),I(t.getAudioTracks(),!0);for(const e of t.getTracks())n.peerConn.addTrack(e,t);let r;n.setState(m.CreateAnswer);try{r=yield n.peerConn.createAnswer()}catch(o){return c.logger.debug("Failed to create answer: ",o),void n.terminate(g.Local,y.CreateAnswer,!0)}try{yield n.peerConn.setLocalDescription(r),n.setState(m.Connecting),yield new Promise(e=>{setTimeout(e,200)}),n.sendAnswer()}catch(o){return c.logger.debug("Error setting local description!",o),void n.terminate(g.Local,y.SetLocalDescription,!0)}}));return function(e){return t.apply(this,arguments)}}()),(0,a.default)(this,"gotLocalIceCandidate",e=>{if(e.candidate){if(c.logger.debug("Call "+this.callId+" got local ICE "+e.candidate.sdpMid+" candidate: "+e.candidate.candidate),this.callHasEnded())return;""===e.candidate.candidate&&this.sentEndOfCandidates||(this.queueCandidate(e.candidate),""===e.candidate.candidate&&(this.sentEndOfCandidates=!0))}}),(0,a.default)(this,"onIceGatheringStateChange",e=>{if(c.logger.debug("ice gathering state changed to "+this.peerConn.iceGatheringState),"complete"===this.peerConn.iceGatheringState&&!this.sentEndOfCandidates){const e={candidate:""};this.queueCandidate(e),this.sentEndOfCandidates=!0}}),(0,a.default)(this,"gotLocalOffer",function(){var e=r((function*(e){if(c.logger.debug("Created offer: ",e),n.callHasEnded())return void c.logger.debug("Ignoring newly created offer on call ID "+n.callId+" because the call has ended");try{yield n.peerConn.setLocalDescription(e)}catch(r){return c.logger.debug("Error setting local description!",r),void n.terminate(g.Local,y.SetLocalDescription,!0)}if("gathering"===n.peerConn.iceGatheringState&&(yield new Promise(e=>{setTimeout(e,200)})),n.callHasEnded())return;const t=n.state===m.CreateOffer?d.EventType.CallInvite:d.EventType.CallNegotiate,i={lifetime:S};n.state===m.CreateOffer?i.offer=n.peerConn.localDescription:i.description=n.peerConn.localDescription,n.client._supportsCallTransfer&&(i.capabilities={"m.call.transferee":!0}),c.logger.info(`Discarding ${n.candidateSendQueue.length} candidates that will be sent in offer`),n.candidateSendQueue=[];try{yield n.sendVoipEvent(t,i)}catch(o){c.logger.error("Failed to send invite",o),o.event&&n.client.cancelPendingEvent(o.event);let e=y.SignallingFailed,t="Signalling failed";return n.state===m.CreateOffer&&(e=y.SendInvite,t="Failed to send invite"),"UnknownDeviceError"==o.name&&(e=y.UnknownDevices,t="Unknown devices present in the room"),n.emit(v.Error,new C(e,t,o)),void n.terminate(g.Local,e,!1)}n.sendCandidateQueue(),n.state===m.CreateOffer&&(n.inviteOrAnswerSent=!0,n.setState(m.InviteSent),n.inviteTimeout=setTimeout(()=>{n.inviteTimeout=null,n.state===m.InviteSent&&n.hangup(y.InviteTimeout,!1)},S))}));return function(t){return e.apply(this,arguments)}}()),(0,a.default)(this,"getLocalOfferFailed",e=>{c.logger.error("Failed to get local offer",e),this.emit(v.Error,new C(y.LocalOfferFailed,"Failed to get local offer!",e)),this.terminate(g.Local,y.LocalOfferFailed,!1)}),(0,a.default)(this,"getUserMediaFailed",e=>{this.successor?this.successor.getUserMediaFailed(e):(c.logger.warn("Failed to get user media - ending call",e),this.emit(v.Error,new C(y.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",e)),this.terminate(g.Local,y.NoUserMedia,!1))}),(0,a.default)(this,"onIceConnectionStateChanged",()=>{this.callHasEnded()||(c.logger.debug("Call ID "+this.callId+": ICE connection state changed to: "+this.peerConn.iceConnectionState),"connected"==this.peerConn.iceConnectionState?this.setState(m.Connected):"failed"==this.peerConn.iceConnectionState&&this.hangup(y.IceFailed,!1))}),(0,a.default)(this,"onSignallingStateChanged",()=>{c.logger.debug("call "+this.callId+": Signalling state changed to: "+this.peerConn.signalingState)}),(0,a.default)(this,"onTrack",e=>{0!==e.streams.length?this.remoteStream&&e.streams[0].id!==this.remoteStream.id?c.logger.warn(`Ignoring new stream ID ${e.streams[0].id}: we already have stream ID ${this.remoteStream.id}`):(this.remoteStream||c.logger.info("Got remote stream with id "+e.streams[0].id),this.remoteStream=e.streams[0],c.logger.debug(`Track id ${e.track.id} of kind ${e.track.kind} added`),"video"===e.track.kind?this.remoteVideoElement&&this.playRemoteVideo():this.remoteAudioElement&&this.playRemoteAudio()):c.logger.warn(`Streamless ${e.track.kind} found: ignoring.`)}),(0,a.default)(this,"onNegotiationNeeded",r((function*(){if(c.logger.info("Negotation is needed!"),n.state===m.CreateOffer||0!==n.opponentVersion){n.makingOffer=!0;try{const e=yield n.peerConn.createOffer();yield n.gotLocalOffer(e)}catch(e){return void n.getLocalOfferFailed(e)}finally{n.makingOffer=!1}}else c.logger.info("Opponent does not support renegotiation: ignoring negotiationneeded event")}))),(0,a.default)(this,"onHangupReceived",e=>{c.logger.debug("Hangup received for call ID "+this.callId),this.partyIdMatches(e)||this.state===m.Ringing?this.terminate(g.Remote,e.reason||y.UserHangup,!0):c.logger.info(`Ignoring message from party ID ${e.party_id}: our partner is ${this.opponentPartyId}`)}),(0,a.default)(this,"onRejectReceived",e=>{c.logger.debug("Reject received for call ID "+this.callId);const t=[m.InviteSent,m.Ringing].includes(this.state)||this.state===m.Fledgling&&this.direction===f.Inbound;t?this.terminate(g.Remote,y.UserHangup,!0):c.logger.debug(`Call is in state: ${this.state}: ignoring reject`)}),(0,a.default)(this,"onAnsweredElsewhere",e=>{c.logger.debug("Call ID "+this.callId+" answered elsewhere"),this.terminate(g.Remote,y.AnsweredElsewhere,!0)}),this.roomId=t.roomId,this.client=t.client,this.type=null,this.forceTURN=t.forceTURN,this.ourPartyId=this.client.deviceId,this.turnServers=t.turnServers||[],0===this.turnServers.length&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[E]});for(const e of this.turnServers)u.checkObjectHasKeys(e,["urls"]);this.callId=k(),this.state=m.Fledgling,this.candidateSendQueue=[],this.candidateSendTries=0,this.sentEndOfCandidates=!1,this.inviteOrAnswerSent=!1,this.makingOffer=!1,this.remoteOnHold=!1,this.unholdingRemote=!1,this.micMuted=!1,this.vidMuted=!1}placeVoiceCall(){var e=this;return r((function*(){c.logger.debug("placeVoiceCall"),e.checkForErrorListener();const t=R(_.Audio);e.type=p.Voice,yield e.placeCallWithConstraints(t)}))()}placeVideoCall(e,t){var n=this;return r((function*(){c.logger.debug("placeVideoCall"),n.checkForErrorListener(),n.localVideoElement=t,n.remoteVideoElement=e;const i=R(_.Video);n.type=p.Video,yield n.placeCallWithConstraints(i)}))()}placeScreenSharingCall(e,t,n){var i=this;return r((function*(){c.logger.debug("placeScreenSharingCall"),i.checkForErrorListener(),i.localVideoElement=t,i.remoteVideoElement=e;try{var r;const e=yield P(n);if(!e)return void i.terminate(g.Local,y.NoUserMedia,!1);null!==(r=window.electron)&&void 0!==r&&r.getDesktopCapturerSources?(c.logger.debug("Getting screen stream using getUserMedia()..."),i.screenSharingStream=yield navigator.mediaDevices.getUserMedia(e)):(c.logger.debug("Getting screen stream using getDisplayMedia()..."),i.screenSharingStream=yield navigator.mediaDevices.getDisplayMedia(e)),c.logger.debug("Got screen stream, requesting audio stream...");const t=R(_.Audio);i.placeCallWithConstraints(t)}catch(o){i.emit(v.Error,new C(y.NoUserMedia,"Failed to get screen-sharing stream: ",o)),i.terminate(g.Local,y.NoUserMedia,!1)}i.type=p.Video}))()}getOpponentMember(){return this.opponentMember}opponentCanBeTransferred(){return Boolean(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}getLocalVideoElement(){return this.localVideoElement}getRemoteVideoElement(){return this.remoteVideoElement}getRemoteAudioElement(){return this.remoteAudioElement}setLocalVideoElement(t){var n=this;return r((function*(){if(n.localVideoElement=t,t&&n.localAVStream&&n.type===p.Video){t.autoplay=!0,t.srcObject=n.localAVStream,t.muted=!0;try{yield t.play()}catch(e){c.logger.info("Failed to play local video element",e)}}}))()}setRemoteVideoElement(e){e!==this.remoteVideoElement&&(e.autoplay=!0,this.remoteAudioElement&&(e.muted=!0),this.remoteVideoElement=e,this.remoteStream&&this.playRemoteVideo())}setRemoteAudioElement(e){var t=this;return r((function*(){e!==t.remoteAudioElement&&(t.remoteAudioElement=e,t.remoteStream&&t.playRemoteAudio())}))()}getCurrentCallStats(){var e=this;return r((function*(){return e.callHasEnded()?e.callStatsAtEnd:e.collectCallStats()}))()}collectCallStats(){var e=this;return r((function*(){if(!e.peerConn)return;const t=yield e.peerConn.getStats(),n=[];for(const e of t)n.push(e[1]);return n}))()}initWithInvite(t){var n=this;return r((function*(){const i=t.getContent();n.direction=f.Inbound;const r=yield n.client._checkTurnServers();r||c.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),n.peerConn=n.createPeerConnection(),n.chooseOpponent(t);try{yield n.peerConn.setRemoteDescription(i.offer),yield n.addBufferedIceCandidates()}catch(e){return c.logger.debug("Failed to set remote description",e),void n.terminate(g.Local,y.SetRemoteDescription,!1)}if(!n.remoteStream||0===n.remoteStream.getTracks().length)return c.logger.error("No remote stream or no tracks after setting remote description!"),void n.terminate(g.Local,y.SetRemoteDescription,!1);n.type=n.remoteStream.getTracks().some(e=>"video"===e.kind)?p.Video:p.Voice,n.setState(m.Ringing),t.getLocalAge()&&setTimeout(()=>{n.state==m.Ringing&&(c.logger.debug("Call invite has expired. Hanging up."),n.hangupParty=g.Remote,n.setState(m.Ended),n.stopAllMedia(),"closed"!=n.peerConn.signalingState&&n.peerConn.close(),n.emit(v.Hangup))},i.lifetime-t.getLocalAge())}))()}initWithHangup(e){this.setState(m.Ended)}answer(){var t=this;return r((function*(){if(!t.inviteOrAnswerSent)if(c.logger.debug(`Answering call ${t.callId} of type ${t.type}`),t.localAVStream||t.waitForLocalAVStream)t.localAVStream?t.gotUserMediaForAnswer(t.localAVStream):t.waitForLocalAVStream&&t.setState(m.WaitLocalMedia);else{const n=R(t.type==p.Video?_.Video:_.Audio);c.logger.log("Getting user media with constraints",n),t.setState(m.WaitLocalMedia),t.waitForLocalAVStream=!0;try{const e=yield navigator.mediaDevices.getUserMedia(n);t.waitForLocalAVStream=!1,t.gotUserMediaForAnswer(e)}catch(e){return void t.getUserMediaFailed(e)}}}))()}replacedBy(e){c.logger.debug(this.callId+" being replaced by "+e.callId),this.state===m.WaitLocalMedia?(c.logger.debug("Telling new call to wait for local media"),e.waitForLocalAVStream=!0):(this.state===m.CreateOffer||this.state===m.InviteSent)&&(c.logger.debug("Handing local stream to new call"),e.gotUserMediaForAnswer(this.localAVStream),delete this.localAVStream),e.localVideoElement=this.localVideoElement,e.remoteVideoElement=this.remoteVideoElement,e.remoteAudioElement=this.remoteAudioElement,this.successor=e,this.emit(v.Replaced,e),this.hangup(y.Replaced,!0)}hangup(e,t){if(this.callHasEnded())return;if(c.logger.debug("Ending call "+this.callId),this.terminate(g.Local,e,!t),this.state===m.WaitLocalMedia)return;const n={};e!==y.UserHangup&&(n["reason"]=e),this.sendVoipEvent(d.EventType.CallHangup,{})}reject(){if(this.state!==m.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion<1)return c.logger.info(`Opponent version is less than 1 (${this.opponentVersion}): sending hangup instead of reject`),void this.hangup(y.UserHangup,!0);c.logger.debug("Rejecting call: "+this.callId),this.terminate(g.Local,y.UserHangup,!0),this.sendVoipEvent(d.EventType.CallReject,{})}setLocalVideoMuted(e){this.vidMuted=e,this.updateMuteStatus()}isLocalVideoMuted(){return this.vidMuted}setMicrophoneMuted(e){this.micMuted=e,this.updateMuteStatus()}isMicrophoneMuted(){return this.micMuted}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e,e||(this.unholdingRemote=!0);for(const t of this.peerConn.getTransceivers())t.direction=e?"inactive":"sendrecv";this.updateMuteStatus(),e||this.playRemoteAudio(),this.emit(v.RemoteHoldUnhold,this.remoteOnHold)}}isLocalOnHold(){if(this.state!==m.Connected)return!1;if(this.unholdingRemote)return!1;let e=!0;for(const t of this.peerConn.getTransceivers()){const n=["inactive","recvonly"].includes(t.currentDirection);n||(e=!1)}return e}sendDtmfDigit(e){for(const t of this.peerConn.getSenders())if("audio"===t.track.kind&&t.dtmf)return void t.dtmf.insertDTMF(e);throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){if(!this.localAVStream)return;const e=this.micMuted||this.remoteOnHold;I(this.localAVStream.getAudioTracks(),!e);const t=this.vidMuted||this.remoteOnHold;I(this.localAVStream.getVideoTracks(),!t),this.remoteOnHold?this.remoteAudioElement&&this.remoteAudioElement.srcObject===this.remoteStream?this.remoteAudioElement.muted=!0:this.remoteVideoElement&&this.remoteVideoElement.srcObject===this.remoteStream&&(this.remoteVideoElement.muted=!0):this.playRemoteAudio()}sendAnswer(){var e=this;return r((function*(){const t={answer:{sdp:e.peerConn.localDescription.sdp,type:e.peerConn.localDescription.type}};e.client._supportsCallTransfer&&(t.capabilities={"m.call.transferee":!0}),c.logger.info(`Discarding ${e.candidateSendQueue.length} candidates that will be sent in answer`),e.candidateSendQueue=[];try{yield e.sendVoipEvent(d.EventType.CallAnswer,t),e.inviteOrAnswerSent=!0}catch(n){e.setState(m.Ringing),e.client.cancelPendingEvent(n.event);let t=y.SendAnswer,i="Failed to send answer";throw"UnknownDeviceError"==n.name&&(t=y.UnknownDevices,i="Unknown devices present in the room"),e.emit(v.Error,new C(t,i,n)),n}e.sendCandidateQueue()}))()}onRemoteIceCandidatesReceived(e){var t=this;return r((function*(){if(t.callHasEnded())return;const n=e.getContent().candidates;if(!n)return void c.logger.info("Ignoring candidates event with no candidates!");const i=0===e.getContent().version?null:e.getContent().party_id||null;if(void 0===t.opponentPartyId){c.logger.info(`Bufferring ${n.length} candidates until we pick an opponent`);const e=t.remoteCandidateBuffer.get(i)||[];return e.push(...n),void t.remoteCandidateBuffer.set(i,e)}t.partyIdMatches(e.getContent())?yield t.addIceCandidates(n):c.logger.info(`Ignoring candidates from party ID ${e.getContent().party_id}: we have chosen party ID `+t.opponentPartyId)}))()}onAnswerReceived(t){var n=this;return r((function*(){if(c.logger.debug(`Got answer for call ID ${n.callId} from party ID ${t.getContent().party_id}`),n.callHasEnded())c.logger.debug(`Ignoring answer because call ID ${n.callId} has ended`);else if(void 0===n.opponentPartyId){n.chooseOpponent(t),yield n.addBufferedIceCandidates(),n.setState(m.Connecting);try{yield n.peerConn.setRemoteDescription(t.getContent().answer)}catch(e){return c.logger.debug("Failed to set remote description",e),void n.terminate(g.Local,y.SetRemoteDescription,!1)}if(null!==n.opponentPartyId)try{yield n.sendVoipEvent(d.EventType.CallSelectAnswer,{selected_party_id:n.opponentPartyId})}catch(i){c.logger.warn("Failed to send select_answer event",i)}}else c.logger.info(`Ignoring answer from party ID ${t.getContent().party_id}: we already have an answer/reject from `+n.opponentPartyId)}))()}onSelectAnswerReceived(e){var t=this;return r((function*(){if(t.direction!==f.Inbound)return void c.logger.warn("Got select_answer for an outbound call: ignoring");const n=e.getContent().selected_party_id;void 0!==n&&null!==n?n!==t.ourPartyId&&(c.logger.info(`Got select_answer for party ID ${n}: we are party ID ${t.ourPartyId}.`),t.terminate(g.Remote,y.AnsweredElsewhere,!0)):c.logger.warn("Got nonsensical select_answer with null/undefined selected_party_id: ignoring")}))()}onNegotiateReceived(e){var t=this;return r((function*(){const n=e.getContent().description;if(!n||!n.sdp||!n.type)return void c.logger.info("Ignoring invalid m.call.negotiate event");const i=t.direction===f.Inbound,r="offer"===n.type&&(t.makingOffer||"stable"!=t.peerConn.signalingState);if(t.ignoreOffer=!i&&r,t.ignoreOffer)return void c.logger.info("Ignoring colliding negotiate event because we're impolite");const o=t.isLocalOnHold();"answer"===n.type&&(t.unholdingRemote=!1);try{if(yield t.peerConn.setRemoteDescription(n),"offer"===n.type){for(const n of t.peerConn.getTransceivers())n.direction=t.isRemoteOnHold()?"inactive":"sendrecv";const e=yield t.peerConn.createAnswer();yield t.peerConn.setLocalDescription(e);for(const n of t.peerConn.getTransceivers())n.direction=n.currentDirection;t.sendVoipEvent(d.EventType.CallNegotiate,{description:t.peerConn.localDescription})}}catch(a){c.logger.warn("Failed to complete negotiation",a)}const s=t.isLocalOnHold();o!==s&&(t.emit(v.LocalHoldUnhold,s),t.emit(v.HoldUnhold,s))}))()}callHasEnded(){return this.state===m.Ended}playRemoteAudio(){var t=this;return r((function*(){t.remoteVideoElement&&(t.remoteVideoElement.muted=!0),t.remoteAudioElement.muted=!1,t.remoteAudioElement.srcObject=t.remoteStream;try{x&&(c.logger.info("Setting audio sink to "+x+", was "+t.remoteAudioElement.sinkId),yield t.remoteAudioElement.setSinkId(x))}catch(e){c.logger.warn("Couldn't set requested audio output device: using default",e)}try{yield t.remoteAudioElement.play()}catch(e){c.logger.error("Failed to play remote audio element",e)}}))()}playRemoteVideo(){var t=this;return r((function*(){t.remoteVideoElement.srcObject=t.remoteStream,c.logger.info("playing remote video. stream active? "+t.remoteStream.active);try{yield t.remoteVideoElement.play()}catch(e){c.logger.info("Failed to play remote video element",e)}}))()}setState(e){const t=this.state;this.state=e,this.emit(v.State,e,t)}sendVoipEvent(e,t){return this.client.sendEvent(this.roomId,e,Object.assign({},t,{version:b,call_id:this.callId,party_id:this.ourPartyId}))}queueCandidate(e){if(this.candidateSendQueue.push(e),this.state===m.Ringing||!this.inviteOrAnswerSent)return;const t=this.direction===f.Inbound?500:2e3;0===this.candidateSendTries&&setTimeout(()=>{this.sendCandidateQueue()},t)}transfer(e){var t=this;return r((function*(){const n=yield t.client.getProfileInfo(e),i=k(),r={replacement_id:k(),target_user:{id:e,display_name:n.display_name,avatar_url:n.avatar_url},create_call:i};yield t.sendVoipEvent(d.EventType.CallReplaces,r),yield t.terminate(g.Local,y.Replaced,!0)}))()}transferToCall(e){var t=this;return r((function*(){const n=yield t.client.getProfileInfo(e.getOpponentMember().userId),i=yield t.client.getProfileInfo(t.getOpponentMember().userId),r=k(),o={replacement_id:k(),target_user:{id:t.getOpponentMember().userId,display_name:i.display_name,avatar_url:i.avatar_url},await_call:r};yield e.sendVoipEvent(d.EventType.CallReplaces,o);const s={replacement_id:k(),target_user:{id:e.getOpponentMember().userId,display_name:n.display_name,avatar_url:n.avatar_url},create_call:r};yield t.sendVoipEvent(d.EventType.CallReplaces,s),yield t.terminate(g.Local,y.Replaced,!0),yield e.terminate(g.Local,y.Replaced,!0)}))()}terminate(t,n,i){var o=this;return r((function*(){if(o.callHasEnded())return;o.callStatsAtEnd=yield o.collectCallStats(),o.inviteTimeout&&(clearTimeout(o.inviteTimeout),o.inviteTimeout=null);const r=o.getRemoteVideoElement(),s=o.getRemoteAudioElement(),a=o.getLocalVideoElement();if(r&&(r.pause(),r.srcObject=null),s){s.pause(),s.srcObject=null;try{yield o.remoteAudioElement.setSinkId("")}catch(e){c.logger.warn("Failed to set sink ID back to default")}}a&&(a.pause(),a.srcObject=null),o.hangupParty=t,o.hangupReason=n,o.setState(m.Ended),o.stopAllMedia(),o.peerConn&&"closed"!==o.peerConn.signalingState&&o.peerConn.close(),i&&o.emit(v.Hangup,o)}))()}stopAllMedia(){if(c.logger.debug(`stopAllMedia (stream=${this.localAVStream})`),this.localAVStream)for(const e of this.localAVStream.getTracks())e.stop();if(this.screenSharingStream)for(const e of this.screenSharingStream.getTracks())e.stop();if(this.remoteStream)for(const e of this.remoteStream.getTracks())e.stop()}checkForErrorListener(){if(0===this.listeners("error").length)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}sendCandidateQueue(){var e=this;return r((function*(){if(0===e.candidateSendQueue.length)return;const t=e.candidateSendQueue;e.candidateSendQueue=[],++e.candidateSendTries;const n={candidates:t};c.logger.debug("Attempting to send "+t.length+" candidates");try{yield e.sendVoipEvent(d.EventType.CallCandidates,n)}catch(i){if(i.event&&e.client.cancelPendingEvent(i.event),e.candidateSendQueue.push(...t),e.candidateSendTries>5){c.logger.debug("Failed to send candidates on attempt "+e.candidateSendTries+". Giving up on this call.",i);const t=y.SignallingFailed,n="Signalling failed";return e.emit(v.Error,new C(t,n,i)),void e.hangup(t,!1)}const n=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,c.logger.debug("Failed to send candidates. Retrying in "+n+"ms",i),setTimeout(()=>{e.sendCandidateQueue()},n)}}))()}placeCallWithConstraints(t){var n=this;return r((function*(){c.logger.log("Getting user media with constraints",t),n.client._callEventHandler.calls.set(n.callId,n),n.setState(m.WaitLocalMedia),n.direction=f.Outbound,n.config=t;const i=yield n.client._checkTurnServers();i||c.logger.warn("Failed to get TURN credentials! Proceeding with call anyway..."),n.peerConn=n.createPeerConnection();try{const e=yield navigator.mediaDevices.getUserMedia(t);n.gotUserMediaForInvite(e)}catch(e){return void n.getUserMediaFailed(e)}}))()}createPeerConnection(){const e=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers,iceCandidatePoolSize:this.client._iceCandidatePoolSize});return e.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),e.addEventListener("signalingstatechange",this.onSignallingStateChanged),e.addEventListener("icecandidate",this.gotLocalIceCandidate),e.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),e.addEventListener("track",this.onTrack),e.addEventListener("negotiationneeded",this.onNegotiationNeeded),e}partyIdMatches(e){const t=0===e.version?null:e.party_id||null;return t===this.opponentPartyId}chooseOpponent(e){const t=e.getContent();c.logger.debug(`Choosing party ID ${t.party_id} for call ID ${this.callId}`),this.opponentVersion=t.version,0===this.opponentVersion?this.opponentPartyId=null:this.opponentPartyId=t.party_id||null,this.opponentCaps=t.capabilities||{},this.opponentMember=e.sender}addBufferedIceCandidates(){var e=this;return r((function*(){const t=e.remoteCandidateBuffer.get(e.opponentPartyId);t&&(c.logger.info(`Adding ${t.length} buffered candidates for opponent ${e.opponentPartyId}`),yield e.addIceCandidates(t)),e.remoteCandidateBuffer=null}))()}addIceCandidates(e){var t=this;return r((function*(){for(const i of e)if(null!==i.sdpMid&&void 0!==i.sdpMid||null!==i.sdpMLineIndex&&void 0!==i.sdpMLineIndex){c.logger.debug("Call "+t.callId+" got remote ICE "+i.sdpMid+" candidate: "+i.candidate);try{yield t.peerConn.addIceCandidate(i)}catch(n){t.ignoreOffer||c.logger.info("Failed to add remote ICE candidate",n)}}else c.logger.debug("Ignoring remote ICE candidate with no sdpMid or sdpMLineIndex")}))()}}function I(e,t){for(let n=0;n<e.length;n++)e[n].enabled=t}function R(e){const t=!!navigator.webkitGetUserMedia;switch(e){case _.Audio:return{audio:{deviceId:M?{ideal:M}:void 0},video:!1};case _.Video:return{audio:{deviceId:M?{ideal:M}:void 0},video:{deviceId:A?{ideal:A}:void 0,width:t?{exact:640}:{ideal:640},height:t?{exact:360}:{ideal:360}}}}}function P(e){return O.apply(this,arguments)}function O(){return O=r((function*(e){var t;if(null!==(t=window.electron)&&void 0!==t&&t.getDesktopCapturerSources&&e){c.logger.debug("Electron getDesktopCapturerSources() is available...");const t=yield e();return t?{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.id}}}:null}return c.logger.debug("Electron desktopCapturer is not available..."),{audio:!1,video:!0}})),O.apply(this,arguments)}let x,M,A;function N(e){x=e}function D(e){M=e}function j(e){A=e}function U(t,n,i){if("undefined"===typeof window||"undefined"===typeof document)return null;try{const e=Boolean(window.RTCPeerConnection||window.RTCSessionDescription||window.RTCIceCandidate||navigator.mediaDevices);if(!e)return c.logger.error("WebRTC is not supported in this browser / environment"),null}catch(e){return c.logger.error("Exception thrown when trying to access WebRTC",e),null}const r=!!i&&i.forceTURN,o={client:t,roomId:n,turnServers:t.getTurnServers(),forceTURN:t._forceTURN||r},s=new T(o);return t.reEmitter.reEmit(s,Object.values(v)),s}n.MatrixCall=T},3139:function(t,n,i){"use strict";(function(t){i("907a"),i("3c5d"),i("b7ef"),i("d9e2");var r=null,o={sha224:function(e){r||(r=i("98e6"));var t=r("sha224");return t.update(e),t.digest()},language:function(){var e;return e=window.navigator.languages?window.navigator.languages[0]:window.navigator.userLanguage||window.navigator.language,e},deep:function(e,t){var n=_.isArray(t)?t:t.split("."),i=n[0];if("undefined"!=typeof e&&e)return"undefined"!=typeof e[i]?(n.splice(0,1),0===n.length?e[i]:o.deep(e[i],n)):void 0}},s=function(e,t,n,i,r,o){r||(r={r:25,g:250,b:50}),o||(o={x:25,offset:[0,0]});var a,c=e.width,l=e.height,u=n.frequencyBinCount,d=new Uint8Array(u),h=c/u/2.5,m=o.x;n.getByteFrequencyData(d),t.clearRect(0,0,c,l);for(var p=0;p<u;p++){a=d[p];var f=a+r.r*(p/u),g=r.g*(p/u),v=r.b,y=-Math.abs(p-u/2)/u+.5;p>o.offset[0]&&p<u-o.offset[1]&&(t.fillStyle="rgba("+f+","+g+","+v+","+2*y+")",t.fillRect(m,l/2-a*y,h,a*y*2)),m+=h+1}requestAnimationFrame((function(){i()?t.clearRect(0,0,c,l):s(e,t,n,i,r,o)}))},a=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e};o.permutations=function(e,t){t||(t=1);var n=[],i=[],r=[],o=e.length;function s(a){for(var c=0;c<o;c++)r[c]||(r[c]=!0,i[a]=e[c],a<t-1?s(a+1,c+1):n.push([].concat(i)),r[c]=!1)}return s(0),n};var c=function(e){if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(n){return console.warn("Copy to clipboard failed.",n),!1}finally{document.body.removeChild(t)}}},l=function(e){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}if(!e)return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t();for(var n="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",r=0;r<16;r++)n+=i.charAt(Math.floor(Math.random()*i.length));return n},u=function(e){if(!e||!e.split)return e;var t=["2ndEdison, 3dCarbon","A-Pmcs"],n=["TO","K","X","10X","THE","AN","AND","OR","AT","BUT","BY","FOR","IN","OF","OFF","ON","OUT","PER","UP","VIA","AS","FOR"],i=["2MCBL","USA","TONS","BHCC","LLC","LTD","1BWK","AGMA","VIII","XIII","BHCC"],r=["LAS","LAW","SON","DEE","ST","PET","BIG","WAY","AIR","ALL","TOP","JOY","CO","INC","INC.","AVE","PAY","ST.","FOX","CAR","TAX","DAY","MAN","CO.","NEW"],o=new RegExp(r.join("|")),s=new RegExp(i.join("|")),a=e.split(" ").map((function(e){if(t.some((function(t){return t.toUpperCase()===e})))return t.find((function(t){return t.toUpperCase()===e}));if(n.some((function(t){if(t===e)return!0;for(var n=t.split(" "),i=0;i<n.length;i++)if(/[0-9]/.test(n[i])&&/ST|ND|RD|TH|K/.test(n[i+1]+n[i+2]))return!0;return!1})))return e.toLowerCase();if(o.test(e))return e[0]+e.slice(1).toLowerCase();if(e.replace(/\(|\)/g,"").length<=3||s.test(e))return e;var i=e.toLowerCase().replace(/[A-Za-z]/,(function(e){return e.toUpperCase()})),r=[];r.push(i[0]);for(var a=0;a<i.length;a++)i[a+1]&&(/\.|\/|[0-9]|\&|\-|\s/.test(i[a])||"mc"===(i[a-1]+i[a]).toLowerCase())?r.push(i[a+1].toUpperCase()):i[a+1]&&r.push(i[a+1]);return r.join("")}));return d(a.join(" "))},d=function(e){return e[0].toUpperCase()+e.substr(1)},h=function(e){return e[0].toUpperCase()+e.substr(1).toLowerCase()},m=function(e){var t=e.split(" ");return _.map(t,(function(e){return h(e)})).join(" ")},p=function(e,t){var n={};return _.each(e,(function(e,i){var r=t(e,i);r&&(n[r]||(n[r]=[]),n[r].push(e))})),n},f=function(e,t,n){t||(t=$("body,html")),n||(n=200),t.animate({scrollTop:e},n)},g=function(e,t,n){e||(e=$(this));var i=e.offset(),r=(e.height()-$(window).height())/2;if(i){var o=i.top+r;f(o,t,n)}},v=function(e,t){e||(e=""),t||(t="");var n=function(e){return e.split(/[ \t\v\r\n\f,.]+/)},i=function(e){var t=n(e).join(" ");return t.toLowerCase().replace(/[^a-zа-я0-9&]*/g,"")},r=function(e){for(var t={},n=function(t){var n;return n=t<0||t>=e.length?"_":e[t],n},i=-1;i<=e.length;i++){for(var r="",o=i-1;o<=i+1;o++)r+=n(o);t[r]=1}return t},o=r(i(e)),s=r(i(t)),a=0,c=Math.max(_.toArray(o).length,_.toArray(s).length);return _.each(o,(function(e,t){s[t]&&a++})),a/c},y=function(e,t,n){return new Promise((i,r)=>{b(e,i,t,n)})},b=function(e,t,n,i){if(e())t&&t();else{n||(n=20);var r=0,o=setInterval((function(){(e()||i&&i<=r)&&(clearInterval(o),t&&t()),r+=n}),n)}},E=function(e){var t=S(C(k(w(e),8*e.length)));return t.toLowerCase()};function S(e){for(var t,n="0123456789ABCDEF",i="",r=0;r<e.length;r++)t=e.charCodeAt(r),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function w(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function C(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function k(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,i=-271733879,r=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=n,c=i,l=r,u=o;i=O(i=O(i=O(i=O(i=P(i=P(i=P(i=P(i=R(i=R(i=R(i=R(i=I(i=I(i=I(i=I(i,r=I(r,o=I(o,n=I(n,i,r,o,e[s+0],7,-680876936),i,r,e[s+1],12,-389564586),n,i,e[s+2],17,606105819),o,n,e[s+3],22,-1044525330),r=I(r,o=I(o,n=I(n,i,r,o,e[s+4],7,-176418897),i,r,e[s+5],12,1200080426),n,i,e[s+6],17,-1473231341),o,n,e[s+7],22,-45705983),r=I(r,o=I(o,n=I(n,i,r,o,e[s+8],7,1770035416),i,r,e[s+9],12,-1958414417),n,i,e[s+10],17,-42063),o,n,e[s+11],22,-1990404162),r=I(r,o=I(o,n=I(n,i,r,o,e[s+12],7,1804603682),i,r,e[s+13],12,-40341101),n,i,e[s+14],17,-1502002290),o,n,e[s+15],22,1236535329),r=R(r,o=R(o,n=R(n,i,r,o,e[s+1],5,-165796510),i,r,e[s+6],9,-1069501632),n,i,e[s+11],14,643717713),o,n,e[s+0],20,-373897302),r=R(r,o=R(o,n=R(n,i,r,o,e[s+5],5,-701558691),i,r,e[s+10],9,38016083),n,i,e[s+15],14,-660478335),o,n,e[s+4],20,-405537848),r=R(r,o=R(o,n=R(n,i,r,o,e[s+9],5,568446438),i,r,e[s+14],9,-1019803690),n,i,e[s+3],14,-187363961),o,n,e[s+8],20,1163531501),r=R(r,o=R(o,n=R(n,i,r,o,e[s+13],5,-1444681467),i,r,e[s+2],9,-51403784),n,i,e[s+7],14,1735328473),o,n,e[s+12],20,-1926607734),r=P(r,o=P(o,n=P(n,i,r,o,e[s+5],4,-378558),i,r,e[s+8],11,-2022574463),n,i,e[s+11],16,1839030562),o,n,e[s+14],23,-35309556),r=P(r,o=P(o,n=P(n,i,r,o,e[s+1],4,-1530992060),i,r,e[s+4],11,1272893353),n,i,e[s+7],16,-155497632),o,n,e[s+10],23,-1094730640),r=P(r,o=P(o,n=P(n,i,r,o,e[s+13],4,681279174),i,r,e[s+0],11,-358537222),n,i,e[s+3],16,-722521979),o,n,e[s+6],23,76029189),r=P(r,o=P(o,n=P(n,i,r,o,e[s+9],4,-640364487),i,r,e[s+12],11,-421815835),n,i,e[s+15],16,530742520),o,n,e[s+2],23,-995338651),r=O(r,o=O(o,n=O(n,i,r,o,e[s+0],6,-198630844),i,r,e[s+7],10,1126891415),n,i,e[s+14],15,-1416354905),o,n,e[s+5],21,-57434055),r=O(r,o=O(o,n=O(n,i,r,o,e[s+12],6,1700485571),i,r,e[s+3],10,-1894986606),n,i,e[s+10],15,-1051523),o,n,e[s+1],21,-2054922799),r=O(r,o=O(o,n=O(n,i,r,o,e[s+8],6,1873313359),i,r,e[s+15],10,-30611744),n,i,e[s+6],15,-1560198380),o,n,e[s+13],21,1309151649),r=O(r,o=O(o,n=O(n,i,r,o,e[s+4],6,-145523070),i,r,e[s+11],10,-1120210379),n,i,e[s+2],15,718787259),o,n,e[s+9],21,-343485551),n=x(n,a),i=x(i,c),r=x(r,l),o=x(o,u)}return Array(n,i,r,o)}function T(e,t,n,i,r,o){return x(M(x(x(t,e),x(i,o)),r),n)}function I(e,t,n,i,r,o,s){return T(t&n|~t&i,e,t,r,o,s)}function R(e,t,n,i,r,o,s){return T(t&i|n&~i,e,t,r,o,s)}function P(e,t,n,i,r,o,s){return T(t^n^i,e,t,r,o,s)}function O(e,t,n,i,r,o,s){return T(n^(t|~i),e,t,r,o,s)}function x(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function M(e,t){return e<<t|e>>>32-t}var A=function(e,t,n){n||(n=200);var i=function(){e((function(e){e?t&&t():setTimeout(i,n)}))};i()},N=function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("android")>-1;if(t)return!0},D=function(){return $("html").hasClass("mobile")},j=function(){return $("html").hasClass("mobile")||$("html").hasClass("tablet")},U=function(e,t,n){return n||(n=20),t&&clearTimeout(t),t=setTimeout(e,n),t},L=(a=function(e,t){return e=parseInt(e),t=parseInt(t),Math.floor(Math.random()*(t-e+1))+e},function(e){return F(B(e))}),B=function(e){return(e||"").replace(/^\s+/,"")},F=function(e){return(e||"").replace(/\s+$/,"")},K=function(e){for(var t=0,n="",i=0;i<e.length;i++){t=e.charCodeAt(i),t>255&&(t-=848),t=t.toString(16);while(t.length<2)t="0"+t;n+=t}return n},q=function(e){if(!e)return null;if(e.toString){var t=e.toString();if("[object Object]"!=t)return t}return _.isObject(e)?JSON.stringify(e):e},G={},z=function(e){if(G[e])return G[e];for(var t=0,n="",i=2;i<=e.length;i+=2)t=parseInt(e.substring(i-2,i),16),t>=128&&(t+=848),t=String.fromCharCode("0x"+t.toString(16)),n+=t;return G[e]=n,n},V=function(e){let t=new Image;return t.src=e.base64,e.width=t.width,e.height=t.height,e},H=["bastyon.com","pocketnet.app","zoom.us","youtube","facebook","instagram","vk.com","twitter","pinterest","vimeo","ask.fm","change.org","wikipedia","livejournal","linkedin","myspace","reddit","tumblr","ok.ru","flickr","google","yandex","yahoo","bing","gmail","mail"],W=function(e){return _.find(H,(function(t){return e.indexOf(t)>-1}))},J=function(e){var t=linkify.find(e);if(t.length)return t[0].href},Y=function(e){return e.replace(/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/g,"")},Q=function(e){return e.split(":")[0].replace("@","")},X=function(e,t){return e||(e=""),0==e.indexOf("@")?e:"@"+e+":"+t},Z=function(e,t){var n={};Object.keys(e).filter((function(n){return e[n]!==t[n]})).map((function(t){var i={};i[t]=e[t],n=Object.assign(n,i)}));return n},ee=function(e,t){var n=e.map((function(e){return e.id})),i=t.map((function(e){return e.id})),r=[];return n.forEach((function(e){r.push(t[i.indexOf(e)])})),r},te=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";const n=1024,i=t<0?0:t,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,o)).toFixed(i))+" "+r[o]},ne=function(e){var t=new URL(e);return{post:t.searchParams.get("s"),user:t.pathname.replace("/","")}},ie=function(e){var t=["www.youtube.com","youtube.com","youtu.be"],n=["www.vimeo.com","vimeo.com"],i=["peer.tube","peertube.social"],r=new URL(e);return t.indexOf(r.hostname)>-1?"https://www.youtube.com/embed/"+r.searchParams.get("v"):n.indexOf(r.hostname)>-1?"https://player.vimeo.com/video"+r.pathname:i.indexOf(r.hostname)>-1?"https://pocketnetpeertube1.nohost.me/"+r.pathname.replace("watch","embed"):void 0},re=function(e,t){return e.slice(0,t)+"..."},oe=function(e){var t=J(e);return e.replace(t,"")},se=function(e){var t=new Date(1e3*e),n=t.getFullYear(),i=t.getMonth(),r=t.getDate(),o=t.getHours()>13?"PM":"AM",s=t.getHours()>13?t.getHours()-12:t.getHours(),a=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`${c[i]} ${r}, ${n} at ${s}:${a} ${o}`},ae=function(e,t){var n=e/t,i='<i class="fas fa-star"></i>',r='<i class="fas fa-star-half-alt"></i>',o='<i class="far fa-star"></i>',s=["","","","",""];return 0===e?s.map(e=>o):s.map(e=>n>=1?(n--,i):n<1&&n>=.5?(n--,r):n<.5?(n--,o):void 0)},ce=function(e){var t=e.getBoundingClientRect().top,n=e.getBoundingClientRect().bottom,i=document.documentElement.clientHeight,r=n-t,o=n>=.8*r,s=n<=i+.2*r;return!(!o||!s)},le=function(e){for(var t="",n=new Uint8Array(e),i=n.byteLength,r=0;r<i;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)},ue=function(e){for(var t=window.atob(e),n=t.length,i=new Uint8Array(n),r=0;r<n;r++)i[r]=t.charCodeAt(r);return i.buffer},de={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,i,r,o,s,a,c="",l=0;e=de._utf8_encode(e);while(l<e.length)t=e.charCodeAt(l++),n=e.charCodeAt(l++),i=e.charCodeAt(l++),r=t>>2,o=(3&t)<<4|n>>4,s=(15&n)<<2|i>>6,a=63&i,isNaN(n)?s=a=64:isNaN(i)&&(a=64),c=c+de._keyStr.charAt(r)+de._keyStr.charAt(o)+de._keyStr.charAt(s)+de._keyStr.charAt(a);return c},decode:function(e){var t,n,i,r,o,s,a,c="",l=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<e.length)r=de._keyStr.indexOf(e.charAt(l++)),o=de._keyStr.indexOf(e.charAt(l++)),s=de._keyStr.indexOf(e.charAt(l++)),a=de._keyStr.indexOf(e.charAt(l++)),t=r<<2|o>>4,n=(15&o)<<4|s>>2,i=(3&s)<<6|a,c+=String.fromCharCode(t),64!=s&&(c+=String.fromCharCode(n)),64!=a&&(c+=String.fromCharCode(i));return c=de._utf8_decode(c),c},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},_utf8_decode:function(e){var t="",n=0,i=0,r=0;while(n<e.length)i=e.charCodeAt(n),i<128?(t+=String.fromCharCode(i),n++):i>191&&i<224?(r=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&r),n+=2):(r=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&c3),n+=3);return t},fromFile:e=>new Promise((t,n)=>{const i=new FileReader;i.readAsDataURL(e),i.onloadend=()=>t(i.result),i.onerror=e=>n(e)}),toFileFetch:function(e){return fetch(e).then(e=>e.blob()).then(e=>new(window.wFile||window.File)([e],"File name",{type:"image/png"}))},toFile:function(t){try{var n=t.split(","),i=n[0].match(/:(.*?);/)[1],r=atob(n[1]),o=r.length,s=new Uint8Array(o);while(o--)s[o]=r.charCodeAt(o);var a=new(window.wFile||window.File)([s],"Filename",{type:i});return Promise.resolve(a)}catch(e){return Promise.reject(e)}}};function he(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}o.copyArrayBuffer=function(e){var t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t},o.readFile=function(e){let t=new FileReader;return t.readAsArrayBuffer(e),new Promise((e,n)=>{t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})},o.fetchLocal=function(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.onload=function(){var e=i.getResponseHeader("content-type");t({data:new Blob([i.response],{type:e,name:"file"})})},i.onerror=function(t){console.error(t,e),n(new TypeError("Local request failed"))},i.open("GET",e),i.responseType="arraybuffer",i.send(null)}))},o.saveFileCordova=function(e,t,n,i){var r="";switch(device.platform){case"Android":r="file:///storage/emulated/0/";break;case"iOS":r=cordova.file.cacheDirectory;break}var o=function(i){i.getDirectory("Download",{exclusive:!1},(function(i){i.getFile(t,{create:!0,exclusive:!1},(function(i){var r=i.toURL();i.createWriter((function(i){i.onwriteend=function(e){window.galleryRefresh&&window.galleryRefresh.refresh(r,(function(e){}),(function(e){})),n&&n({name:t,url:r})},i.onerror=function(e){n&&n(null,e)},i.seek(0),i.write(e)}),(function(e){n&&n(null,e)}))}),(function(e){n&&n(null,e)}))}))},s=function(e){n&&n(null,e)};i?window.requestFileSystem(LocalFileSystem.PERSISTENT,0,(function(e){o(e.root)}),s):window.resolveLocalFileSystemURL(r,o,s)},o.isios=function(){return window.cordova&&window.device&&"iOS"==deep(window,"device.platform")||he()},o.now=function(e){var t=e||new Date,n=t.getTime()+60*t.getTimezoneOffset()*1e3,i=new Date(n);return i.toString(),i},o.date={addseconds:function(e,t){e||(e=new Date);var n=e.getTime()+1e3*t,i=new Date(n);return i}},o.getservers=function(e,t,n){if(!e.length)return[];t||(t=1),t>e.length&&(t=e.length);var i=o.permutations(e,t),r=o.helpers.base58.decode(n)%i.length;return i[r]},o.helpers={base58:{ALPHABET:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",ALPHABET_MAP:{},i:0,encode(e){const{ALPHABET:t,ALPHABET_MAP:n}=this;let{i:i}=this;if(!Object.keys(n).length)while(i<t.length)n[t.charAt(i)]=i,i++;var r,o,s;if(0===e.length)return"";i=void 0,s=void 0,o=[0],i=0;while(i<e.length){s=0;while(s<o.length)o[s]<<=8,s++;o[0]+=e[i],r=0,s=0;while(s<o.length)o[s]+=r,r=o[s]/58|0,o[s]%=58,++s;while(r)o.push(r%58),r=r/58|0;i++}i=0;while(0===e[i]&&i<e.length-1)o.push(0),i++;return o.reverse().map((function(e){return t[e]})).join("")},decode(e){const{ALPHABET:n,ALPHABET_MAP:i}=this;let{i:r}=this;if(!Object.keys(i).length)while(r<n.length)i[n.charAt(r)]=r,r++;var o,s,a,c;if(0===e.length)return new("undefined"!==typeof Uint8Array&&null!==Uint8Array?Uint8Array:t)(0);r=void 0,c=void 0,o=[0],r=0;while(r<e.length){if(s=e[r],!(s in i))throw"Base58.decode received unacceptable input. Character '"+s+"' is not in the Base58 alphabet.";c=0;while(c<o.length)o[c]*=58,c++;o[0]+=i[s],a=0,c=0;while(c<o.length)o[c]+=a,a=o[c]>>8,o[c]&=255,++c;while(a)o.push(255&a),a>>=8;r++}r=0;while("1"===e[r]&&r<e.length-1)o.push(0),r++;const l=new Uint8Array(o.reverse());let u=t.from(l);return u.readUIntBE(0,l.length)}}},o.getCaretPosition=function(e){if(document.selection){e.focus();var t=document.selection.createRange(),n=t.text.length;t.moveStart("character",-e.value.length);var i=t.text.length-n;return{start:i,end:i+n}}return e.selectionStart||"0"==e.selectionStart?{start:e.selectionStart,end:e.selectionEnd}:{start:0,end:0}},o.setCaretPosition=function(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i.select()}},o.ObjDiff=Z,o._arrayBufferToBase64=le,o._base64ToArrayBuffer=ue,o.Base64=de,o.getmatrixid=Q,o.getMatrixIdFull=X,o.formatBytes=te,o.filterByUserId=ee,o.trim=L,o.isAndroid=N,o.isMobile=D,o.isTablet=j,o.rand=a,o.group=p,o.flball=u,o.flb=d,o.flbs=h,o.flbb=m,o.makeid=l,o.scrollTo=g,o.stringEq=v,o.pretry=y,o.retry=b,o.retryLazy=A,o.slowMade=U,o.renderFrameEqualizer=s,o.hexEncode=K,o.hexDecode=z,o.imgDimensions=V,o.getUrl=J,o.getTxt=Y,o.poketnetUrlParser=ne,o.textFormatter=re,o.urlSeparator=oe,o.dateParser=se,o.setRating=ae,o.videoUrlParser=ie,o.isVisible=ce,o.copytext=c,o.md5=E,o.knsite=W,o.stringify=q,n["a"]=o}).call(this,i("b639").Buffer)},"31a4":function(e,t,n){},3700:function(t,n,i){"use strict";var r=i("c973").default;i("d9e2"),Object.defineProperty(n,"__esModule",{value:!0}),n.AutoDiscovery=void 0;var o=i("63c7"),s=i("0b16");class a{static get ERROR_INVALID(){return"Invalid homeserver discovery response"}static get ERROR_GENERIC_FAILURE(){return"Failed to get autodiscovery configuration from server"}static get ERROR_INVALID_HS_BASE_URL(){return"Invalid base_url for m.homeserver"}static get ERROR_INVALID_HOMESERVER(){return"Homeserver URL does not appear to be a valid Matrix homeserver"}static get ERROR_INVALID_IS_BASE_URL(){return"Invalid base_url for m.identity_server"}static get ERROR_INVALID_IDENTITY_SERVER(){return"Identity server URL does not appear to be a valid identity server"}static get ERROR_INVALID_IS(){return"Invalid identity server discovery response"}static get ERROR_MISSING_WELLKNOWN(){return"No .well-known JSON file found"}static get ERROR_INVALID_JSON(){return"Invalid JSON"}static get ALL_ERRORS(){return[a.ERROR_INVALID,a.ERROR_GENERIC_FAILURE,a.ERROR_INVALID_HS_BASE_URL,a.ERROR_INVALID_HOMESERVER,a.ERROR_INVALID_IS_BASE_URL,a.ERROR_INVALID_IDENTITY_SERVER,a.ERROR_INVALID_IS,a.ERROR_MISSING_WELLKNOWN,a.ERROR_INVALID_JSON]}static get FAIL_ERROR(){return"FAIL_ERROR"}static get FAIL_PROMPT(){return"FAIL_PROMPT"}static get PROMPT(){return"PROMPT"}static get SUCCESS(){return"SUCCESS"}static fromDiscoveryConfig(e){var t=this;return r((function*(){const n={"m.homeserver":{state:a.FAIL_ERROR,error:a.ERROR_INVALID,base_url:null},"m.identity_server":{state:a.PROMPT,error:null,base_url:null}};if(!e||!e["m.homeserver"])return o.logger.error("No m.homeserver key in config"),n["m.homeserver"].state=a.FAIL_PROMPT,n["m.homeserver"].error=a.ERROR_INVALID,Promise.resolve(n);if(!e["m.homeserver"]["base_url"])return o.logger.error("No m.homeserver base_url in config"),n["m.homeserver"].state=a.FAIL_PROMPT,n["m.homeserver"].error=a.ERROR_INVALID_HS_BASE_URL,Promise.resolve(n);const i=t._sanitizeWellKnownUrl(e["m.homeserver"]["base_url"]);if(!i)return o.logger.error("Invalid base_url for m.homeserver"),n["m.homeserver"].error=a.ERROR_INVALID_HS_BASE_URL,Promise.resolve(n);const r=yield t._fetchWellKnownObject(i+"/_matrix/client/versions");if(!r||!r.raw["versions"])return o.logger.error("Invalid /versions response"),n["m.homeserver"].error=a.ERROR_INVALID_HOMESERVER,n["m.homeserver"].base_url=i,Promise.resolve(n);n["m.homeserver"]={state:a.SUCCESS,error:null,base_url:i};let s="";if(e["m.identity_server"]){const i={"m.homeserver":n["m.homeserver"],"m.identity_server":{state:a.FAIL_PROMPT,error:a.ERROR_INVALID_IS,base_url:null}};if(s=t._sanitizeWellKnownUrl(e["m.identity_server"]["base_url"]),!s)return o.logger.error("Invalid base_url for m.identity_server"),i["m.identity_server"].error=a.ERROR_INVALID_IS_BASE_URL,Promise.resolve(i);const r=yield t._fetchWellKnownObject(s+"/_matrix/identity/api/v1");if(!r||!r.raw||"SUCCESS"!==r.action)return o.logger.error("Invalid /api/v1 response"),i["m.identity_server"].error=a.ERROR_INVALID_IDENTITY_SERVER,i["m.identity_server"].base_url=s,Promise.resolve(i)}return s&&s.length>0&&(n["m.identity_server"]={state:a.SUCCESS,error:null,base_url:s}),Object.keys(e).map(t=>{if("m.homeserver"===t||"m.identity_server"===t){const i=["error","state","base_url"];for(const r of Object.keys(e[t]))i.includes(r)||(n[t][r]=e[t][r])}else n[t]=e[t]}),Promise.resolve(n)}))()}static findClientConfig(e){var t=this;return r((function*(){if(!e||"string"!==typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const n={"m.homeserver":{state:a.FAIL_ERROR,error:a.ERROR_INVALID,base_url:null},"m.identity_server":{state:a.PROMPT,error:null,base_url:null}},i=yield t._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return i&&"SUCCESS"===i.action?a.fromDiscoveryConfig(i.raw):(o.logger.error("No response or error when parsing .well-known"),i.reason&&o.logger.error(i.reason),"IGNORE"===i.action?n["m.homeserver"]={state:a.PROMPT,error:null,base_url:null}:(n["m.homeserver"].state=a.FAIL_PROMPT,n["m.homeserver"].error=a.ERROR_INVALID),Promise.resolve(n))}))()}static getRawClientConfig(e){var t=this;return r((function*(){if(!e||"string"!==typeof e||0===e.length)throw new Error("'domain' must be a string of non-zero length");const n=yield t._fetchWellKnownObject(`https://${e}/.well-known/matrix/client`);return n&&n.raw||{}}))()}static _sanitizeWellKnownUrl(t){if(!t)return!1;try{let n=null;try{n=s.URL?new s.URL(t):new URL(t)}catch(e){n=new URL(t)}if(!n||!n.hostname)return!1;if("http:"!==n.protocol&&"https:"!==n.protocol)return!1;const i=n.port?":"+n.port:"",r=n.pathname?n.pathname:"";let o=`${n.protocol}//${n.hostname}${i}${r}`;return o.endsWith("/")&&(o=o.substring(0,o.length-1)),o}catch(e){return o.logger.error(e),!1}}static _fetchWellKnownObject(t){return r((function*(){return new Promise((function(n,r){const o=i("3901").getRequest();if(!o)throw new Error("No request library available");o({method:"GET",uri:t,timeout:5e3},(t,i,r)=>{if(t||i&&(i.statusCode<200||i.statusCode>=300)){let e="FAIL_PROMPT",r=(t?t.message:null)||"General failure";return i&&404===i.statusCode&&(e="IGNORE",r=a.ERROR_MISSING_WELLKNOWN),void n({raw:{},action:e,reason:r,error:t})}try{n({raw:JSON.parse(r),action:"SUCCESS"})}catch(e){let i=a.ERROR_INVALID;"SyntaxError"===e.name&&(i=a.ERROR_INVALID_JSON),n({raw:{},action:"FAIL_PROMPT",reason:i,error:e})}})}))}))()}}n.AutoDiscovery=a},"38f4":function(t,n,i){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.setNow=u,n.setTimeout=h,n.clearTimeout=m;var r=i("63c7");const o=1e3;let s,a=0;const c=[],l=function(){};function u(e){d=e||Date.now}let d=Date.now;function h(e,t){t=t||0,t<0&&(t=0);const n=Array.prototype.slice.call(arguments,2),i=d()+t,r=a++;l("setTimeout: scheduling cb",r,"at",i,"(delay",t,")");const o={runAt:i,func:e,params:n,key:r},s=g(c,(function(e){return e.runAt-i}));return c.splice(s,0,o),p(),r}function m(e){if(0===c.length)return;let t;for(t=0;t<c.length;t++){const n=c[t];if(n.key==e){c.splice(t,1);break}}0===t&&p()}function p(){s&&t.clearTimeout(s);const e=c[0];if(!e)return void l("_scheduleRealCallback: no more callbacks, not rescheduling");const n=d(),i=Math.min(e.runAt-n,o);l("_scheduleRealCallback: now:",n,"delay:",i),s=t.setTimeout(f,i)}function f(){let n;const i=d();l("_runCallbacks: now:",i);const o=[];while(1){const e=c[0];if(!e||e.runAt>i)break;n=c.shift(),l("_runCallbacks: popping",n.key),o.push(n)}p();for(let s=0;s<o.length;s++){n=o[s];try{n.func.apply(t,n.params)}catch(e){r.logger.error("Uncaught exception in callback function",e.stack||e)}}}function g(e,t){let n=0,i=e.length;while(n<i){const r=n+i>>1,o=t(e[r]);o>0?i=r:n=r+1}return n}}).call(this,i("c8ba"))},3901:function(e,t,n){"use strict";(function(e){var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0});var r={request:!0,getRequest:!0,wrapRequest:!0,setCryptoStoreFactory:!0,createClient:!0,ContentHelpers:!0,createNewMatrixCall:!0,setMatrixCallAudioOutput:!0,setMatrixCallAudioInput:!0,setMatrixCallVideoInput:!0};t.request=M,t.getRequest=A,t.wrapRequest=N,t.setCryptoStoreFactory=j,t.createClient=U,Object.defineProperty(t,"createNewMatrixCall",{enumerable:!0,get:function(){return O.createNewMatrixCall}}),Object.defineProperty(t,"setMatrixCallAudioOutput",{enumerable:!0,get:function(){return O.setAudioOutput}}),Object.defineProperty(t,"setMatrixCallAudioInput",{enumerable:!0,get:function(){return O.setAudioInput}}),Object.defineProperty(t,"setMatrixCallVideoInput",{enumerable:!0,get:function(){return O.setVideoInput}}),t.ContentHelpers=void 0;var o=n("4df7");Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var s=n("696c");Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var a=n("79f0");Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var c=n("980b");Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var l=n("1c8f");Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var u=n("3700");Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var d=n("2d78");Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var h=n("0023");Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===h[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}}))}));var m=n("a120");Object.keys(m).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===m[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}}))}));var p=n("0594");Object.keys(p).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===p[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}}))}));var f=n("d15f");Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===f[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}}))}));var g=n("e685");Object.keys(g).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===g[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}}))}));var v=n("6386");Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var y=n("2b60");Object.keys(y).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===y[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}}))}));var _=n("420b");Object.keys(_).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===_[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}}))}));var b=n("87d6");Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));var E=n("c976");Object.keys(E).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===E[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}}))}));var S=n("da9d");Object.keys(S).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===S[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}}))}));var w=n("dd5f");Object.keys(w).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===w[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}}))}));var C=n("788e");Object.keys(C).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===C[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}}))}));var k=n("ed03");Object.keys(k).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===k[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}}))}));var T=n("eb25");Object.keys(T).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===T[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}}))}));var I=n("b503");Object.keys(I).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===I[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}}))}));var R=n("07df");Object.keys(R).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===R[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}}))}));var P=i(n("9730"));t.ContentHelpers=P;var O=n("3134");let x;function M(e){x=e}function A(){return x}function N(e){const t=x;x=function(n,i){return e(t,n,i)}}let D=()=>new o.MemoryCryptoStore;function j(e){D=e}function U(t){return"string"===typeof t&&(t={baseUrl:t}),t.request=t.request||x,t.store=t.store||new s.MemoryStore({localStorage:e.localStorage}),t.scheduler=t.scheduler||new a.MatrixScheduler,t.cryptoStore=t.cryptoStore||D(),new c.MatrixClient(t)}}).call(this,n("c8ba"))},3917:function(e,t,n){},3987:function(t,n,i){"use strict";var r=i("c973").default;i("d9e2");var o=i("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.encodeParams=a,n.encodeUri=c,n.map=l,n.filter=u,n.keys=d,n.values=h,n.forEach=m,n.findElement=p,n.removeElement=f,n.isFunction=g,n.isArray=v,n.checkObjectHasKeys=y,n.checkObjectHasNoAdditionalKeys=_,n.deepCopy=b,n.deepCompare=E,n.extend=S,n.runPolyfills=w,n.inherits=C,n.polyfillSuper=k,n.isNumber=T,n.removeHiddenChars=I,n.escapeRegExp=P,n.globToRegexp=O,n.ensureNoTrailingSlash=x,n.sleep=M,n.isNullOrUndefined=A,n.defer=N,n.promiseMapSeries=D,n.promiseTry=U,n.chunkPromises=L,n.setCrypto=F,n.getCrypto=K;var s=o(i("fe93"));function a(e){let t="";for(const n in e)e.hasOwnProperty(n)&&(t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.substring(1)}function c(e,t){for(const n in t)t.hasOwnProperty(n)&&(e=e.replace(n,encodeURIComponent(t[n])));return e}function l(e,t){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=t(e[i]);return n}function u(e,t){const n=[];for(let i=0;i<e.length;i++)t(e[i],i,e)&&n.push(e[i]);return n}function d(e){const t=[];for(const n in e)e.hasOwnProperty(n)&&t.push(n);return t}function h(e){const t=[];for(const n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function m(e,t){for(let n=0;n<e.length;n++)t(e[n],n)}function p(e,t,n){let i;if(n){for(i=e.length-1;i>=0;i--)if(t(e[i],i,e))return e[i]}else for(i=0;i<e.length;i++)if(t(e[i],i,e))return e[i]}function f(e,t,n){let i,r;if(n){for(i=e.length-1;i>=0;i--)if(t(e[i],i,e))return r=e[i],e.splice(i,1),r}else for(i=0;i<e.length;i++)if(t(e[i],i,e))return r=e[i],e.splice(i,1),r;return!1}function g(e){return"[object Function]"===Object.prototype.toString.call(e)}function v(e){return Array.isArray?Array.isArray(e):Boolean(e&&e.constructor===Array)}function y(e,t){for(let n=0;n<t.length;n++)if(!e.hasOwnProperty(t[n]))throw new Error("Missing required key: "+t[n])}function _(e,t){for(const n in e)if(e.hasOwnProperty(n)&&-1===t.indexOf(n))throw new Error("Unknown key: "+n)}function b(e){return JSON.parse(JSON.stringify(e))}function E(e,t){if(e===t)return!0;if(typeof e!==typeof t)return!1;if("number"===typeof e&&isNaN(e)&&isNaN(t))return!0;if(null===e||null===t)return e===t;if(!(e instanceof Object))return!1;if(e.constructor!==t.constructor||e.prototype!==t.prototype)return!1;if(e instanceof RegExp||e instanceof Date)return e.toString()===t.toString();if(e instanceof Array){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!E(e[n],t[n]))return!1}else{let n;for(n in t)if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;for(n in t){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(!E(e[n],t[n]))return!1}}return!0}function S(){const e=(arguments.length<=0?void 0:arguments[0])||{};for(let t=1;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];if(n)for(const t in n)e[t]=n[t]}return e}function w(){Array.prototype.filter||(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;const t=Object(this),n=t.length>>>0;if("function"!==typeof e)throw new TypeError;const i=[];for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];const a=o?o[0]:void 0;for(let c=0;c<n;c++)if(c in t){const n=t[c];e.call(a,n,c,t)&&i.push(n)}return i}),Array.prototype.map||(Array.prototype.map=function(e,t){let n,i;if(null===this||void 0===this)throw new TypeError(" this is null or not defined");const r=Object(this),o=r.length>>>0;if("function"!==typeof e)throw new TypeError(e+" is not a function");arguments.length>1&&(n=t);const s=new Array(o);i=0;while(i<o){let t,o;i in r&&(t=r[i],o=e.call(n,t,i,r),s[i]=o),i++}return s}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){let n,i;if(null===this||void 0===this)throw new TypeError(" this is null or not defined");const r=Object(this),o=r.length>>>0;if("function"!==typeof e)throw new TypeError(e+" is not a function");arguments.length>1&&(n=t),i=0;while(i<o){let t;i in r&&(t=r[i],e.call(n,t,i,r)),i++}})}function C(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}function k(t,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];try{n.call(t,...r)}catch(e){const o=new n(...r);Object.assign(t,o)}}function T(e){return"number"===typeof e&&isFinite(e)}function I(e){return"string"===typeof e?(0,s.default)(e.normalize("NFD").replace(R,"")):""}const R=/[\u2000-\u200F\u202A-\u202F\u0300-\u036f\uFEFF\s]/g;function P(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function O(e,t){t="boolean"!==typeof t||t;let n=P(e);return n=n.replace(/\\\*/g,".*"),n=n.replace(/\?/g,"."),t&&(n=n.replace(/\\\[(!|)(.*)\\]/g,(function(e,t,n,i,r){const o=t?"^":"",s=n.replace(/\\-/,"-");return"["+o+s+"]"}))),n}function x(e){return e&&e.endsWith("/")?e.substr(0,e.length-1):e}function M(e,t){return new Promise(n=>{setTimeout(n,e,t)})}function A(e){return null===e||void 0===e}function N(){let e,t;const n=new Promise((n,i)=>{e=n,t=i});return{resolve:e,reject:t,promise:n}}function D(e,t){return j.apply(this,arguments)}function j(){return j=r((function*(e,t){for(const n of yield e)yield t(yield n)})),j.apply(this,arguments)}function U(e){return new Promise(t=>t(e()))}function L(e,t){return $.apply(this,arguments)}function $(){return $=r((function*(e,t){const n=[];for(let i=0;i<e.length;i+=t)n.push(...yield Promise.all(e.slice(i,i+t).map(e=>e())));return n})),$.apply(this,arguments)}let B;function F(e){B=e}function K(){return B}},"3b0a":function(e,t,n){},"3bbf":function(e,t,n){},"3c2f":function(t,n,i){"use strict";var r=i("c973").default;i("d9e2");var o=i("dbce");Object.defineProperty(n,"__esModule",{value:!0}),n.upgradeDatabase=d,n.Backend=n.VERSION=void 0;var s=i("63c7"),a=o(i("3987"));const c=10;n.VERSION=c;const l=!1;class u{constructor(e){this._db=e,this._nextTxnId=0,e.onversionchange=t=>{s.logger.log(`versionchange for indexeddb ${this._dbName}: closing`),e.close()}}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return new Promise((n,i)=>{const r=this._db.transaction("outgoingRoomKeyRequests","readwrite");r.onerror=i,this._getOutgoingRoomKeyRequest(r,t,i=>{if(i)return s.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),void n(i);s.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),r.oncomplete=()=>{n(e)};const o=r.objectStore("outgoingRoomKeyRequests");o.add(e)})})}getOutgoingRoomKeyRequest(e){return new Promise((t,n)=>{const i=this._db.transaction("outgoingRoomKeyRequests","readonly");i.onerror=n,this._getOutgoingRoomKeyRequest(i,e,e=>{t(e)})})}_getOutgoingRoomKeyRequest(e,t,n){const i=e.objectStore("outgoingRoomKeyRequests"),r=i.index("session"),o=r.openCursor([t.room_id,t.session_id]);o.onsuccess=e=>{const i=e.target.result;if(!i)return void n(null);const r=i.value;a.deepCompare(r.requestBody,t)?n(r):i.continue()}}getOutgoingRoomKeyRequestByState(e){if(0===e.length)return Promise.resolve(null);let t,n=0;function i(r){const o=r.target.result;if(o)return void(t=o.value);if(n++,n>=e.length)return;const s=e[n],a=r.target.source.openCursor(s);a.onsuccess=i}const r=this._db.transaction("outgoingRoomKeyRequests","readonly"),o=r.objectStore("outgoingRoomKeyRequests"),s=e[n],a=o.index("state").openCursor(s);return a.onsuccess=i,p(r).then(()=>t)}getAllOutgoingRoomKeyRequestsByState(e){return new Promise((t,n)=>{const i=this._db.transaction("outgoingRoomKeyRequests","readonly"),r=i.objectStore("outgoingRoomKeyRequests"),o=r.index("state"),s=o.getAll(e);s.onsuccess=e=>t(e.target.result),s.onerror=e=>n(e.target.error)})}getOutgoingRoomKeyRequestsByTarget(e,t,n){let i=0;const r=[];function o(s){const a=s.target.result;if(a){const n=a.value;n.recipients.includes({userId:e,deviceId:t})&&r.push(n),a.continue()}else{if(i++,i>=n.length)return;const e=n[i],t=s.target.source.openCursor(e);t.onsuccess=o}}const s=this._db.transaction("outgoingRoomKeyRequests","readonly"),a=s.objectStore("outgoingRoomKeyRequests"),c=n[i],l=a.index("state").openCursor(c);return l.onsuccess=o,p(s).then(()=>r)}updateOutgoingRoomKeyRequest(e,t,n){let i=null;function r(e){const r=e.target.result;if(!r)return;const o=r.value;o.state==t?(Object.assign(o,n),r.update(o),i=o):s.logger.warn(`Cannot update room key request from ${t} as it was already updated to `+o.state)}const o=this._db.transaction("outgoingRoomKeyRequests","readwrite"),a=o.objectStore("outgoingRoomKeyRequests").openCursor(e);return a.onsuccess=r,p(o).then(()=>i)}deleteOutgoingRoomKeyRequest(e,t){const n=this._db.transaction("outgoingRoomKeyRequests","readwrite"),i=n.objectStore("outgoingRoomKeyRequests").openCursor(e);return i.onsuccess=e=>{const n=e.target.result;if(!n)return;const i=n.value;i.state==t?n.delete():s.logger.warn(`Cannot delete room key request in state ${i.state} (expected ${t})`)},p(n)}getAccount(t,n){const i=t.objectStore("account"),r=i.get("-");r.onsuccess=function(){try{n(r.result||null)}catch(e){m(t,e)}}}storeAccount(e,t){const n=e.objectStore("account");n.put(t,"-")}getCrossSigningKeys(t,n){const i=t.objectStore("account"),r=i.get("crossSigningKeys");r.onsuccess=function(){try{n(r.result||null)}catch(e){m(t,e)}}}getSecretStorePrivateKey(t,n,i){const r=t.objectStore("account"),o=r.get("ssss_cache:"+i);o.onsuccess=function(){try{n(o.result||null)}catch(e){m(t,e)}}}storeCrossSigningKeys(e,t){const n=e.objectStore("account");n.put(t,"crossSigningKeys")}storeSecretStorePrivateKey(e,t,n){const i=e.objectStore("account");i.put(n,"ssss_cache:"+t)}countEndToEndSessions(t,n){const i=t.objectStore("sessions"),r=i.count();r.onsuccess=function(){try{n(r.result)}catch(e){m(t,e)}}}getEndToEndSessions(t,n,i){const r=n.objectStore("sessions"),o=r.index("deviceKey"),s=o.openCursor(t),a={};s.onsuccess=function(){const t=s.result;if(t)a[t.value.sessionId]={session:t.value.session,lastReceivedMessageTs:t.value.lastReceivedMessageTs},t.continue();else try{i(a)}catch(e){m(n,e)}}}getEndToEndSession(t,n,i,r){const o=i.objectStore("sessions"),s=o.get([t,n]);s.onsuccess=function(){try{s.result?r({session:s.result.session,lastReceivedMessageTs:s.result.lastReceivedMessageTs}):r(null)}catch(e){m(i,e)}}}getAllEndToEndSessions(t,n){const i=t.objectStore("sessions"),r=i.openCursor();r.onsuccess=function(){try{const e=r.result;e?(n(e.value),e.continue()):n(null)}catch(e){m(t,e)}}}storeEndToEndSession(e,t,n,i){const r=i.objectStore("sessions");r.put({deviceKey:e,sessionId:t,session:n.session,lastReceivedMessageTs:n.lastReceivedMessageTs})}storeEndToEndSessionProblem(e,t,n){var i=this;return r((function*(){const r=i._db.transaction("session_problems","readwrite"),o=r.objectStore("session_problems");return o.put({deviceKey:e,type:t,fixed:n,time:Date.now()}),p(r)}))()}getEndToEndSessionProblem(e,t){var n=this;return r((function*(){let i;const r=n._db.transaction("session_problems","readwrite"),o=r.objectStore("session_problems"),s=o.index("deviceKey"),a=s.getAll(e);return a.onsuccess=e=>{const n=a.result;if(!n.length)return void(i=null);n.sort((e,t)=>e.time-t.time);const r=n[n.length-1];for(const o of n)if(o.time>t)return void(i=Object.assign({},o,{fixed:r.fixed}));i=r.fixed?null:r},yield p(r),i}))()}filterOutNotifiedErrorDevices(e){var t=this;return r((function*(){const n=t._db.transaction("notified_error_devices","readwrite"),i=n.objectStore("notified_error_devices"),r=[];return yield Promise.all(e.map(e=>new Promise(t=>{const{userId:n,deviceInfo:o}=e,s=i.get([n,o.deviceId]);s.onsuccess=function(){s.result||(i.put({userId:n,deviceId:o.deviceId}),r.push(e)),t()}}))),r}))()}getEndToEndInboundGroupSession(t,n,i,r){let o=!1,s=!1;const a=i.objectStore("inbound_group_sessions"),c=a.get([t,n]);c.onsuccess=function(){try{o=c.result?c.result.session:null,!1!==s&&r(o,s)}catch(e){m(i,e)}};const l=i.objectStore("inbound_group_sessions_withheld"),u=l.get([t,n]);u.onsuccess=function(){try{s=u.result?u.result.session:null,!1!==o&&r(o,s)}catch(e){m(i,e)}}}getAllEndToEndInboundGroupSessions(t,n){const i=t.objectStore("inbound_group_sessions"),r=i.openCursor();r.onsuccess=function(){const i=r.result;if(i){try{n({senderKey:i.value.senderCurve25519Key,sessionId:i.value.sessionId,sessionData:i.value.session})}catch(e){m(t,e)}i.continue()}else try{n(null)}catch(e){m(t,e)}}}addEndToEndInboundGroupSession(e,t,n,i){const r=i.objectStore("inbound_group_sessions"),o=r.add({senderCurve25519Key:e,sessionId:t,session:n});o.onerror=n=>{"ConstraintError"===o.error.name?(n.stopPropagation(),n.preventDefault(),s.logger.log("Ignoring duplicate inbound group session: "+e+" / "+t)):m(i,new Error("Failed to add inbound group session: "+o.error))}}storeEndToEndInboundGroupSession(e,t,n,i){const r=i.objectStore("inbound_group_sessions");r.put({senderCurve25519Key:e,sessionId:t,session:n})}storeEndToEndInboundGroupSessionWithheld(e,t,n,i){const r=i.objectStore("inbound_group_sessions_withheld");r.put({senderCurve25519Key:e,sessionId:t,session:n})}getEndToEndDeviceData(t,n){const i=t.objectStore("device_data"),r=i.get("-");r.onsuccess=function(){try{n(r.result||null)}catch(e){m(t,e)}}}storeEndToEndDeviceData(e,t){const n=t.objectStore("device_data");n.put(e,"-")}storeEndToEndRoom(e,t,n){const i=n.objectStore("rooms");i.put(t,e)}getEndToEndRooms(t,n){const i={},r=t.objectStore("rooms"),o=r.openCursor();o.onsuccess=function(){const r=o.result;if(r)i[r.key]=r.value,r.continue();else try{n(i)}catch(e){m(t,e)}}}getSessionsNeedingBackup(e){return new Promise((t,n)=>{const i=[],r=this._db.transaction(["sessions_needing_backup","inbound_group_sessions"],"readonly");r.onerror=n,r.oncomplete=function(){t(i)};const o=r.objectStore("sessions_needing_backup"),s=r.objectStore("inbound_group_sessions"),a=o.openCursor();a.onsuccess=function(){const t=a.result;if(t){const n=s.get(t.key);n.onsuccess=function(){i.push({senderKey:n.result.senderCurve25519Key,sessionId:n.result.sessionId,sessionData:n.result.session})},(!e||i.length<e)&&t.continue()}}})}countSessionsNeedingBackup(e){e||(e=this._db.transaction("sessions_needing_backup","readonly"));const t=e.objectStore("sessions_needing_backup");return new Promise((e,n)=>{const i=t.count();i.onerror=n,i.onsuccess=()=>e(i.result)})}unmarkSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const n=t.objectStore("sessions_needing_backup");return Promise.all(e.map(e=>new Promise((t,i)=>{const r=n.delete([e.senderKey,e.sessionId]);r.onsuccess=t,r.onerror=i})))}markSessionsNeedingBackup(e,t){t||(t=this._db.transaction("sessions_needing_backup","readwrite"));const n=t.objectStore("sessions_needing_backup");return Promise.all(e.map(e=>new Promise((t,i)=>{const r=n.put({senderCurve25519Key:e.senderKey,sessionId:e.sessionId});r.onsuccess=t,r.onerror=i})))}addSharedHistoryInboundGroupSession(e,t,n,i){i||(i=this._db.transaction("shared_history_inbound_group_sessions","readwrite"));const r=i.objectStore("shared_history_inbound_group_sessions"),o=r.get([e]);o.onsuccess=()=>{const{sessions:i}=o.result||{sessions:[]};i.push([t,n]),r.put({roomId:e,sessions:i})}}getSharedHistoryInboundGroupSessions(e,t){t||(t=this._db.transaction("shared_history_inbound_group_sessions","readonly"));const n=t.objectStore("shared_history_inbound_group_sessions"),i=n.get([e]);return new Promise((e,t)=>{i.onsuccess=()=>{const{sessions:t}=i.result||{sessions:[]};e(t)},i.onerror=t})}doTxn(e,t,n){let i,r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s.logger;if(l){const n=this._nextTxnId++;i=Date.now(),r=`${e} crypto store transaction ${n} in ${t}`,o.debug("Starting "+r)}const a=this._db.transaction(t,e),c=p(a),u=n(a);return l&&c.then(()=>{const e=Date.now()-i;o.debug(`Finished ${r}, took ${e} ms`)},()=>{const e=Date.now()-i;o.error(`Failed ${r}, took ${e} ms`)}),c.then(()=>u)}}function d(e,t){if(s.logger.log("Upgrading IndexedDBCryptoStore from version "+t+" to "+c),t<1&&h(e),t<2&&e.createObjectStore("account"),t<3){const t=e.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]});t.createIndex("deviceKey","deviceKey")}if(t<4&&e.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]}),t<5&&e.createObjectStore("device_data"),t<6&&e.createObjectStore("rooms"),t<7&&e.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]}),t<8&&e.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]}),t<9){const t=e.createObjectStore("session_problems",{keyPath:["deviceKey","time"]});t.createIndex("deviceKey","deviceKey"),e.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})}t<10&&e.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})}function h(e){const t=e.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});t.createIndex("session",["requestBody.room_id","requestBody.session_id"]),t.createIndex("state","state")}function m(e,t){e._mx_abortexception=t;try{e.abort()}catch(t){}}function p(e){return new Promise((t,n)=>{e.oncomplete=()=>{void 0!==e._mx_abortexception&&n(e._mx_abortexception),t()},e.onerror=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(s.logger.log("Error performing indexeddb txn",t),n(t.target.error))},e.onabort=t=>{void 0!==e._mx_abortexception?n(e._mx_abortexception):(s.logger.log("Error performing indexeddb txn",t),n(t.target.error))}})}n.Backend=u},"3da4":function(e,t,n){"use strict";var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.ReEmitter=void 0;var r=i(n("9523"));class o{constructor(e){(0,r.default)(this,"target",void 0),this.target=e}reEmit(e,t){var n=this;for(const i of t){const t=function(){if("error"!==i||0!==n.target.listenerCount("error")){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];n.target.emit(i,...r,e)}};e.on(i,t)}}}t.ReEmitter=o},"3ed0":function(e,t,n){"use strict";var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.Relations=void 0;var r=i(n("9523")),o=n("faa1"),s=n("a120"),a=n("63c7");class c extends o.EventEmitter{constructor(e,t,n){super(),(0,r.default)(this,"_onEventStatus",(e,t)=>{e.isSending()?t===s.EventStatus.CANCELLED&&(e.removeListener("Event.status",this._onEventStatus),this._removeEvent(e)):e.removeListener("Event.status",this._onEventStatus)}),(0,r.default)(this,"_onBeforeRedaction",e=>{this._relations.has(e)&&(this._relations.delete(e),"m.annotation"===this.relationType?this._removeAnnotationFromAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),e.removeListener("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.redaction",e))}),this.relationType=e,this.eventType=t,this._relations=new Set,this._annotationsByKey={},this._annotationsBySender={},this._sortedAnnotationsByKey=[],this._targetEvent=null}addEvent(e){if(this._relations.has(e))return;const t=e.getRelation();if(!t)return void a.logger.error("Event must have relation info");const n=t.rel_type,i=e.getType();this.relationType===n&&this.eventType===i?(e.isSending()&&e.on("Event.status",this._onEventStatus),this._relations.add(e),"m.annotation"===this.relationType?this._addAnnotationToAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),e.on("Event.beforeRedaction",this._onBeforeRedaction),this.emit("Relations.add",e)):a.logger.error("Event relation info doesn't match this container")}_removeEvent(e){if(!this._relations.has(e))return;const t=e.getRelation();if(!t)return void a.logger.error("Event must have relation info");const n=t.rel_type,i=e.getType();this.relationType===n&&this.eventType===i?(this._relations.delete(e),"m.annotation"===this.relationType?this._removeAnnotationFromAggregation(e):"m.replace"===this.relationType&&this._targetEvent&&this._targetEvent.makeReplaced(this.getLastReplacement()),this.emit("Relations.remove",e)):a.logger.error("Event relation info doesn't match this container")}getRelations(){return[...this._relations]}_addAnnotationToAggregation(e){const{key:t}=e.getRelation();if(!t)return;let n=this._annotationsByKey[t];n||(n=this._annotationsByKey[t]=new Set,this._sortedAnnotationsByKey.push([t,n])),n.add(e),this._sortedAnnotationsByKey.sort((e,t)=>{const n=e[1],i=t[1];return i.size-n.size});const i=e.getSender();let r=this._annotationsBySender[i];r||(r=this._annotationsBySender[i]=new Set),r.add(e)}_removeAnnotationFromAggregation(e){const{key:t}=e.getRelation();if(!t)return;const n=this._annotationsByKey[t];n&&(n.delete(e),this._sortedAnnotationsByKey.sort((e,t)=>{const n=e[1],i=t[1];return i.size-n.size}));const i=e.getSender(),r=this._annotationsBySender[i];r&&r.delete(e)}getSortedAnnotationsByKey(){return"m.annotation"!==this.relationType?null:this._sortedAnnotationsByKey}getAnnotationsBySender(){return"m.annotation"!==this.relationType?null:this._annotationsBySender}getLastReplacement(){if("m.replace"!==this.relationType)return null;if(!this._targetEvent)return null;const e=this._targetEvent.getServerAggregatedRelation("m.replace"),t=e&&e.origin_server_ts;return this.getRelations().reduce((e,n)=>n.getSender()!==this._targetEvent.getSender()||t&&t>n.getTs()||e&&e.getTs()>n.getTs()?e:n,null)}setTargetEvent(e){if(!this._targetEvent&&(this._targetEvent=e,"m.replace"===this.relationType)){const e=this.getLastReplacement();e&&this._targetEvent.makeReplaced(e)}}}t.Relations=c},"3f02":function(e,t,n){"use strict";n("c134")},"3f60":function(e,t,n){},4:function(e,t){},4001:function(e,t,n){"use strict";n("bed5")},4061:function(e,t,n){},"420b":function(e,t,n){"use strict";var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.RoomState=h;var r=n("faa1"),o=n("2b60"),s=n("63c7"),a=i(n("3987")),c=n("d613");const l=1,u=2,d=3;function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.roomId=e,this.members={},this.events=new Map,this.paginationToken=null,this._sentinels={},this._updateModifiedTime(),this._displayNameToUserIds={},this._userIdsToDisplayNames={},this._tokenToInvite={},this._joinedMemberCount=null,this._summaryJoinedMemberCount=null,this._invitedMemberCount=null,this._summaryInvitedMemberCount=null,t||(t={status:l}),this._oobMemberFlags=t}function m(e,t){if(!t.getContent().third_party_invite)return;const n=(t.getContent().third_party_invite.signed||{}).token;if(!n)return;const i=e.getStateEvents("m.room.third_party_invite",n);i&&(e._tokenToInvite[n]=t)}function p(e,t,n){const i=e._userIdsToDisplayNames[t];if(delete e._userIdsToDisplayNames[t],i){const n=a.removeHiddenChars(i),r=e._displayNameToUserIds[n];if(r){const i=r.filter(e=>e!==t);e._displayNameToUserIds[n]=i}}e._userIdsToDisplayNames[t]=n;const r=n&&a.removeHiddenChars(n);r&&(e._displayNameToUserIds[r]||(e._displayNameToUserIds[r]=[]),e._displayNameToUserIds[r].push(t))}a.inherits(h,r.EventEmitter),h.prototype.getJoinedMemberCount=function(){return null!==this._summaryJoinedMemberCount?this._summaryJoinedMemberCount:(null===this._joinedMemberCount&&(this._joinedMemberCount=this.getMembers().reduce((e,t)=>"join"===t.membership?e+1:e,0)),this._joinedMemberCount)},h.prototype.setJoinedMemberCount=function(e){this._summaryJoinedMemberCount=e},h.prototype.getInvitedMemberCount=function(){return null!==this._summaryInvitedMemberCount?this._summaryInvitedMemberCount:(null===this._invitedMemberCount&&(this._invitedMemberCount=this.getMembers().reduce((e,t)=>"invite"===t.membership?e+1:e,0)),this._invitedMemberCount)},h.prototype.setInvitedMemberCount=function(e){this._summaryInvitedMemberCount=e},h.prototype.getMembers=function(){return a.values(this.members)},h.prototype.getMembersExcept=function(e){return a.values(this.members).filter(t=>!e.includes(t.userId))},h.prototype.getMember=function(e){return this.members[e]||null},h.prototype.getSentinelMember=function(e){if(!e)return null;let t=this._sentinels[e];if(void 0===t){t=new o.RoomMember(this.roomId,e);const n=this.members[e];n&&t.setMembershipEvent(n.events.member,this),this._sentinels[e]=t}return t},h.prototype.getStateEvents=function(e,t){if(!this.events.has(e))return void 0===t?[]:null;if(void 0===t)return Array.from(this.events.get(e).values());const n=this.events.get(e).get(t);return n||null},h.prototype.clone=function(){const e=new h(this.roomId,this._oobMemberFlags),t=this._oobMemberFlags.status;return this._oobMemberFlags.status=l,Array.from(this.events.values()).forEach(t=>{e.setStateEvents(Array.from(t.values()))}),this._oobMemberFlags.status=t,null!==this._summaryInvitedMemberCount&&e.setInvitedMemberCount(this.getInvitedMemberCount()),null!==this._summaryJoinedMemberCount&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this._oobMemberFlags.status==d&&this.getMembers().forEach(t=>{if(t.isOutOfBand()){const n=e.getMember(t.userId);n.markOutOfBand()}}),e},h.prototype.setUnknownStateEvents=function(e){const t=e.filter(e=>!this.events.has(e.getType())||!this.events.get(e.getType()).has(e.getStateKey()));this.setStateEvents(t)},h.prototype.setStateEvents=function(e){const t=this;this._updateModifiedTime(),a.forEach(e,(function(e){if(e.getRoomId()!==t.roomId)return;if(!e.isState())return;const n=t._getStateEventMatching(e);t._setStateEvent(e),"m.room.member"===e.getType()&&(p(t,e.getStateKey(),e.getContent().displayname),m(t,e)),t.emit("RoomState.events",e,t,n)})),a.forEach(e,(function(e){if(e.getRoomId()===t.roomId&&e.isState())if("m.room.member"===e.getType()){const n=e.getStateKey();"leave"!==e.getContent().membership&&"ban"!==e.getContent().membership||(e.getContent().avatar_url=e.getContent().avatar_url||e.getPrevContent().avatar_url,e.getContent().displayname=e.getContent().displayname||e.getPrevContent().displayname);const i=t._getOrCreateMember(n,e);i.setMembershipEvent(e,t),t._updateMember(i),t.emit("RoomState.members",e,t,i)}else if("m.room.power_levels"===e.getType()){const n=a.values(t.members);a.forEach(n,(function(n){const i=n.getLastModifiedTime();n.setPowerLevelEvent(e),i!==n.getLastModifiedTime()&&t.emit("RoomState.members",e,t,n)})),t._sentinels={}}}))},h.prototype._getOrCreateMember=function(e,t){let n=this.members[e];return n||(n=new o.RoomMember(this.roomId,e),this.members[e]=n,this.emit("RoomState.newMember",t,this,n)),n},h.prototype._setStateEvent=function(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)},h.prototype._getStateEventMatching=function(e){return this.events.has(e.getType())?this.events.get(e.getType()).get(e.getStateKey()):null},h.prototype._updateMember=function(e){const t=this.getStateEvents("m.room.power_levels","");t&&e.setPowerLevelEvent(t),delete this._sentinels[e.userId],this.members[e.userId]=e,this._joinedMemberCount=null,this._invitedMemberCount=null},h.prototype.needsOutOfBandMembers=function(){return this._oobMemberFlags.status===l},h.prototype.markOutOfBandMembersStarted=function(){this._oobMemberFlags.status===l&&(this._oobMemberFlags.status=u)},h.prototype.markOutOfBandMembersFailed=function(){this._oobMemberFlags.status===u&&(this._oobMemberFlags.status=l)},h.prototype.clearOutOfBandMembers=function(){let e=0;Object.keys(this.members).forEach(t=>{const n=this.members[t];n.isOutOfBand()&&(++e,delete this.members[t])}),s.logger.log(`LL: RoomState removed ${e} members...`),this._oobMemberFlags.status=l},h.prototype.setOutOfBandMembers=function(e){s.logger.log(`LL: RoomState about to set ${e.length} OOB members ...`),this._oobMemberFlags.status===u&&(s.logger.log("LL: RoomState put in OOB_STATUS_FINISHED state ..."),this._oobMemberFlags.status=d,e.forEach(e=>this._setOutOfBandMember(e)))},h.prototype._setOutOfBandMember=function(e){if("m.room.member"!==e.getType())return;const t=e.getStateKey(),n=this.getMember(t);if(n&&!n.isOutOfBand())return;const i=this._getOrCreateMember(t,e);i.setMembershipEvent(e,this),i.markOutOfBand(),p(this,i.userId,i.name),this._setStateEvent(e),this._updateMember(i),this.emit("RoomState.members",e,this,i)},h.prototype.setTypingEvent=function(e){a.forEach(a.values(this.members),(function(t){t.setTypingEvent(e)}))},h.prototype.getInviteForThreePidToken=function(e){return this._tokenToInvite[e]||null},h.prototype._updateModifiedTime=function(){this._modified=Date.now()},h.prototype.getLastModifiedTime=function(){return this._modified},h.prototype.getUserIdsWithDisplayName=function(e){return this._displayNameToUserIds[a.removeHiddenChars(e)]||[]},h.prototype.maySendRedactionForEvent=function(e,t){const n=this.getMember(t);if(!n||"leave"===n.membership)return!1;if(e.status||e.isRedacted())return!1;const i=this.maySendEvent("m.room.redaction",t);return e.getSender()===t?i:this._hasSufficientPowerLevelFor("redact",n.powerLevel)},h.prototype._hasSufficientPowerLevelFor=function(e,t){const n=this.getStateEvents("m.room.power_levels","");let i={};n&&(i=n.getContent());let r=50;return a.isNumber(i[e])&&(r=i[e]),t>=r},h.prototype.maySendMessage=function(e){return this._maySendEventOfType("m.room.message",e,!1)},h.prototype.maySendEvent=function(e,t){return this._maySendEventOfType(e,t,!1)},h.prototype.mayClientSendStateEvent=function(e,t){return!t.isGuest()&&this.maySendStateEvent(e,t.credentials.userId)},h.prototype.maySendStateEvent=function(e,t){return this._maySendEventOfType(e,t,!0)},h.prototype._maySendEventOfType=function(e,t,n){const i=this.getStateEvents("m.room.power_levels","");let r,o={},s=0,a=0,c=0;if(i){r=i.getContent(),o=r.events||{},s=Number.isFinite(r.state_default)?r.state_default:50;const e=r.users&&r.users[t];Number.isFinite(e)?c=e:Number.isFinite(r.users_default)&&(c=r.users_default),Number.isFinite(r.events_default)&&(a=r.events_default)}let l=n?s:a;return Number.isFinite(o[e])&&(l=o[e]),c>=l},h.prototype.mayTriggerNotifOfType=function(e,t){const n=this.getMember(t);if(!n)return!1;const i=this.getStateEvents("m.room.power_levels","");let r=50;return i&&i.getContent()&&i.getContent().notifications&&a.isNumber(i.getContent().notifications[e])&&(r=i.getContent().notifications[e]),n.powerLevel>=r},h.prototype.getJoinRule=function(){const e=this.getStateEvents(c.EventType.RoomJoinRules,""),t=e?e.getContent():{};return t["join_rule"]||"invite"}},"421b":function(e,t,n){},"42cd":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{isBlocked:e.blocked},attrs:{id:"userViewPnuser"}},[e.userinfo.keys&&e.userinfo.keys.length?n("div",{staticClass:"haskeys"},[n("i",{staticClass:"fas fa-lock"})]):e._e(),n("div",{staticClass:"name"},[n("span",[e._v(" "+e._s(e.userinfo.name)+" ")])]),n("div",{staticClass:"imageWrapper"},[n("userpic",{attrs:{mode:"Contact",userinfo:e.userinfo,blocked:e.blocked}})],1),e.activeuser.id!=e.userinfo.id?n("div",{staticClass:"gotoprofile"},[n("button",{staticClass:"button small black rounded",on:{click:e.gotopocketnetprofile}},[e._v(" "+e._s(e.$t("button.goToPocketnetProfile"))+" ")])]):e._e(),n("div",{staticClass:"info"},[e.userinfo.source?n("div",{staticClass:"infoPart"},[n("div",{staticClass:"label"},[n("span",[e._v(" "+e._s(e.$t("caption.followers"))+" ")])]),n("div",{staticClass:"value"},[n("span",[e._v(e._s(e.userinfo.source.subscribers_count))])])]):e._e(),e.userinfo.source&&e.userinfo.source.reputation.toFixed?n("div",{staticClass:"infoPart"},[n("div",{staticClass:"label"},[n("span",[e._v(" "+e._s(e.$t("caption.reputation"))+" ")])]),n("div",{staticClass:"value"},[n("span",[e._v(e._s(e.userinfo.source.reputation.toFixed(1)))])])]):e._e(),e.userinfo.source?n("div",{staticClass:"infoPart"},[n("div",{staticClass:"label"},[n("span",[e._v(" "+e._s(e.$t("caption.following"))+" ")])]),n("div",{staticClass:"value"},[n("span",[e._v(e._s(e.userinfo.source.subscribes_count))])])]):e._e()])])},r=[],o=n("2f62"),s={name:"userViewPnuser",props:{userinfo:Object,blocked:!1},data:function(){return{loading:!1}},created:()=>{},watch:{},computed:Object(o["c"])({auth:e=>e.auth,activeuser:function(){return this.core.user.userinfo},href:function(){var e=window.pocketnetdomain||"pocketnet.app";return"https://"+e+"/"+this.userinfo.source.name}}),methods:{gotopocketnetprofile:function(){this.core.backtoapp?this.core.backtoapp(this.href):window.open(this.href,"_blank")}}},a=s,c=(n("5588"),n("2877")),l=Object(c["a"])(a,i,r,!1,null,"d18e99d2",null);t["a"]=l.exports},4382:function(e,t,n){"use strict";n("8975")},4400:function(e,t,n){"use strict";function i(e,t){this.roomId=e,this.info=t}Object.defineProperty(t,"__esModule",{value:!0}),t.RoomSummary=i},4578:function(e,t,n){"use strict";n("880e")},4606:function(e,t,n){"use strict";n("a0261")},4784:function(e,t,n){"use strict";n("0357")},4871:function(e,t,n){"use strict";n("7284")},"4a1e":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("transition",{attrs:{name:e.transition,mode:e.mode}},[e._t("default")],2),n("div",{staticClass:"overlay-top"}),n("div",{staticClass:"overlay-right"}),n("div",{staticClass:"overlay-bottom"}),n("div",{staticClass:"overlay-left"})],1)},r=[],o={name:"vue-page-transition",props:["name"],data(){return{transition:"fade",mode:"out-in"}},created(){this.$router.beforeEach((e,t,n)=>{this.transition=e.meta.transition?e.meta.transition:this.$props.name,n()})}},s=o,a=(n("2200"),n("1b79"),n("2877")),c=Object(a["a"])(s,i,r,!1,null,"108c57b8",null);t["a"]=c.exports},"4a44":function(e,t,n){},"4b41":function(e,t,n){"use strict";n("1c95")},"4bf6":function(e,t,n){"use strict";n("2d81")},"4df7":function(e,t,n){"use strict";var i=n("c973").default,r=n("dbce"),o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryCryptoStore=void 0;var s=o(n("9523")),a=n("63c7"),c=r(n("3987"));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,s.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class d{constructor(){this._outgoingRoomKeyRequests=[],this._account=null,this._crossSigningKeys=null,this._privateKeys={},this._backupKeys={},this._sessions={},this._sessionProblems={},this._notifiedErrorDevices={},this._inboundGroupSessions={},this._inboundGroupSessionsWithheld={},this._deviceData=null,this._rooms={},this._sessionsNeedingBackup={},this._sharedHistoryInboundGroupSessions={}}startup(){var e=this;return i((function*(){return e}))()}deleteAllData(){return Promise.resolve()}getOrAddOutgoingRoomKeyRequest(e){const t=e.requestBody;return c.promiseTry(()=>{const n=this._getOutgoingRoomKeyRequest(t);return n?(a.logger.log(`already have key request outstanding for ${t.room_id} / ${t.session_id}: not sending another`),n):(a.logger.log(`enqueueing key request for ${t.room_id} / `+t.session_id),this._outgoingRoomKeyRequests.push(e),e)})}getOutgoingRoomKeyRequest(e){return Promise.resolve(this._getOutgoingRoomKeyRequest(e))}_getOutgoingRoomKeyRequest(e){for(const t of this._outgoingRoomKeyRequests)if(c.deepCompare(t.requestBody,e))return t;return null}getOutgoingRoomKeyRequestByState(e){for(const t of this._outgoingRoomKeyRequests)for(const n of e)if(t.state===n)return Promise.resolve(t);return Promise.resolve(null)}getAllOutgoingRoomKeyRequestsByState(e){return Promise.resolve(this._outgoingRoomKeyRequests.filter(t=>t.state==e))}getOutgoingRoomKeyRequestsByTarget(e,t,n){const i=[];for(const r of this._outgoingRoomKeyRequests)for(const o of n)r.state===o&&r.recipients.includes({userId:e,deviceId:t})&&i.push(r);return Promise.resolve(i)}updateOutgoingRoomKeyRequest(e,t,n){for(const i of this._outgoingRoomKeyRequests)if(i.requestId===e)return i.state!=t?(a.logger.warn(`Cannot update room key request from ${t} as it was already updated to `+i.state),Promise.resolve(null)):(Object.assign(i,n),Promise.resolve(i));return Promise.resolve(null)}deleteOutgoingRoomKeyRequest(e,t){for(let n=0;n<this._outgoingRoomKeyRequests.length;n++){const i=this._outgoingRoomKeyRequests[n];if(i.requestId===e)return i.state!=t?(a.logger.warn(`Cannot delete room key request in state ${i.state} (expected ${t})`),Promise.resolve(null)):(this._outgoingRoomKeyRequests.splice(n,1),Promise.resolve(i))}return Promise.resolve(null)}getAccount(e,t){t(this._account)}storeAccount(e,t){this._account=t}getCrossSigningKeys(e,t){t(this._crossSigningKeys)}getSecretStorePrivateKey(e,t,n){const i=this._privateKeys[n];return t(i||null)}storeCrossSigningKeys(e,t){this._crossSigningKeys=t}storeSecretStorePrivateKey(e,t,n){this._privateKeys[t]=n}countEndToEndSessions(e,t){return Object.keys(this._sessions).length}getEndToEndSession(e,t,n,i){const r=this._sessions[e]||{};i(r[t]||null)}getEndToEndSessions(e,t,n){n(this._sessions[e]||{})}getAllEndToEndSessions(e,t){Object.entries(this._sessions).forEach(e=>{let[n,i]=e;Object.entries(i).forEach(e=>{let[i,r]=e;t(u(u({},r),{},{deviceKey:n,sessionId:i}))})})}storeEndToEndSession(e,t,n,i){let r=this._sessions[e];void 0===r&&(r={},this._sessions[e]=r),r[t]=n}storeEndToEndSessionProblem(e,t,n){var r=this;return i((function*(){const i=r._sessionProblems[e]=r._sessionProblems[e]||[];i.push({type:t,fixed:n,time:Date.now()}),i.sort((e,t)=>e.time-t.time)}))()}getEndToEndSessionProblem(e,t){var n=this;return i((function*(){const i=n._sessionProblems[e]||[];if(!i.length)return null;const r=i[i.length-1];for(const e of i)if(e.time>t)return Object.assign({},e,{fixed:r.fixed});return r.fixed?null:r}))()}filterOutNotifiedErrorDevices(e){var t=this;return i((function*(){const n=t._notifiedErrorDevices,i=[];for(const t of e){const{userId:e,deviceInfo:r}=t;e in n?r.deviceId in n[e]||(i.push(t),n[e][r.deviceId]=!0):(i.push(t),n[e]={[r.deviceId]:!0})}return i}))()}getEndToEndInboundGroupSession(e,t,n,i){const r=e+"/"+t;i(this._inboundGroupSessions[r]||null,this._inboundGroupSessionsWithheld[r]||null)}getAllEndToEndInboundGroupSessions(e,t){for(const n of Object.keys(this._inboundGroupSessions))t({senderKey:n.substr(0,43),sessionId:n.substr(44),sessionData:this._inboundGroupSessions[n]});t(null)}addEndToEndInboundGroupSession(e,t,n,i){const r=e+"/"+t;void 0===this._inboundGroupSessions[r]&&(this._inboundGroupSessions[r]=n)}storeEndToEndInboundGroupSession(e,t,n,i){this._inboundGroupSessions[e+"/"+t]=n}storeEndToEndInboundGroupSessionWithheld(e,t,n,i){const r=e+"/"+t;this._inboundGroupSessionsWithheld[r]=n}getEndToEndDeviceData(e,t){t(this._deviceData)}storeEndToEndDeviceData(e,t){this._deviceData=e}storeEndToEndRoom(e,t,n){this._rooms[e]=t}getEndToEndRooms(e,t){t(this._rooms)}getSessionsNeedingBackup(e){const t=[];for(const n in this._sessionsNeedingBackup)if(this._inboundGroupSessions[n]&&(t.push({senderKey:n.substr(0,43),sessionId:n.substr(44),sessionData:this._inboundGroupSessions[n]}),e&&n.length>=e))break;return Promise.resolve(t)}countSessionsNeedingBackup(){return Promise.resolve(Object.keys(this._sessionsNeedingBackup).length)}unmarkSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;delete this._sessionsNeedingBackup[e]}return Promise.resolve()}markSessionsNeedingBackup(e){for(const t of e){const e=t.senderKey+"/"+t.sessionId;this._sessionsNeedingBackup[e]=!0}return Promise.resolve()}addSharedHistoryInboundGroupSession(e,t,n){const i=this._sharedHistoryInboundGroupSessions[e]||[];i.push([t,n]),this._sharedHistoryInboundGroupSessions[e]=i}getSharedHistoryInboundGroupSessions(e){return Promise.resolve(this._sharedHistoryInboundGroupSessions[e]||[])}doTxn(e,t,n){return Promise.resolve(n(null))}}t.MemoryCryptoStore=d},"4ec4":function(e,t,n){"use strict";function i(e,t){if(t.endsWith("*")){const n=t.slice(0,-1);return e.substr(0,n.length)===n}return e===t}function r(e){this.filter_json=e,this.types=e.types||null,this.not_types=e.not_types||[],this.rooms=e.rooms||null,this.not_rooms=e.not_rooms||[],this.senders=e.senders||null,this.not_senders=e.not_senders||[],this.contains_url=e.contains_url||null}Object.defineProperty(t,"__esModule",{value:!0}),t.FilterComponent=r,r.prototype.check=function(e){return this._checkFields(e.getRoomId(),e.getSender(),e.getType(),!!e.getContent()&&void 0!==e.getContent().url)},r.prototype._checkFields=function(e,t,n,r){const o={rooms:function(t){return e===t},senders:function(e){return t===e},types:function(e){return i(n,e)}},s=this;for(let i=0;i<Object.keys(o).length;i++){const e=Object.keys(o)[i],t=o[e],n="not_"+e,r=s[n];if(r.filter(t).length>0)return!1;const a=s[e];if(a&&a.length>0){const e=a.some(t);if(!e)return!1}}const a=this.filter_json.contains_url;return void 0===a||a===r},r.prototype.filter=function(e){return e.filter(this.check,this)},r.prototype.limit=function(){return void 0!==this.filter_json.limit?this.filter_json.limit:10}},"4f09":function(e,t,n){},"4f5a":function(e,t,n){"use strict";var i=n("3139");class r{constructor(e,t){t||(t={}),this.core=e,this.state=0,this.keysupdatetimeout=null,this.userinfo={image:"",name:"",id:"",keys:[]},this.private=[]}destroy(){this.keysupdatetimeout&&clearTimeout(this.keysupdatetimeout),this.keysupdatetimeout=null,this.state=0,this.userinfo={image:"",name:"",id:"",keys:[]},this.private=[]}setCredentials(e){e&&(this.credentials=e)}setUsersInfo(e,t){_.each(e||[],e=>{this.core.store.commit("SET_USERINFO",{info:e,reload:t})})}setContacts(e){}myMatrixId(){return this.matrixId(this.userinfo.id)}matrixId(e,t){return e||(e=""),0==e.indexOf("@")?e:"@"+e+":"+(t||this.core.domain)}fromMatrixId(e){return i["a"].getmatrixid(e)}}t["a"]=r},"4fd2":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chats-list",class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active,empty:e.empty}},[e.unauthorized?n("div",{staticClass:"dmdv"}):n("div",[!e.minimized||e.active?n("div",{staticClass:"work searchWrapperEA"},[n("search",{attrs:{minimize:e.minimized},on:{search:e.search}})],1):e._e(),!e.searchText&&this.chats.length<=2&&1==e.chatsready?n("teamroom",{on:{click:e.openTeamRoom}}):e._e(),!0!==e.chatsready?n("div",{staticClass:"listChatLoading"},[n("dummypreviews")],1):n("div",{staticClass:"Swipes"},[n("transition",{attrs:{name:"fade"}},[e.showchatslist||e.mobile?n("div",{staticClass:"desktopList"},[e.filteredchats.length||!e.searchText?n("div",{staticClass:"chatswrapper"},[n("RecycleScroller",{staticClass:"scroller",attrs:{"page-mode":"",items:e.filteredchats,"item-size":e.pocketnet?60:70,"key-field":"roomId",buffer:e.pocketnet?400:700},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item,r=t.active;return[i?n("div",{ref:"content",staticClass:"card-content",on:{click:function(t){return e.itemClick(i)}}},[r?n("preview",{attrs:{chat:i}}):e._e()],1):e._e()]}}],null,!1,127139565)})],1):n("div",{staticClass:"work"},[n("div",{staticClass:"chatsearchingempty"},[n("span",[e._v(e._s(e.$t("caption.chatsearchingempty")))])])])]):e._e()])],1)],1)])},r=[],o=n("2f62"),s=n("a54c"),a=n("087d"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active,mobile:e.mobile},attrs:{id:"teamroom"}},[n("div",{staticClass:"teamChatWrapper",on:{click:e.click}},[n("div",{staticClass:"iconWrapper"},[e._m(0),e.teamNotifications>0?n("div",{staticClass:"unseen"},[e._v(" "+e._s(e.teamNotifications))]):e._e()]),n("div",{staticClass:"infoWrapper"},[e._m(1),n("div",{staticClass:"previewMessage"},[e.pocketteammessages&&e.pocketteammessages.length>0?n("span",[e._v(" "+e._s(e.pocketteammessages[e.pocketteammessages.length-1].previewText)+" ")]):e._e()])])])])},l=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"logo"},[n("img",{attrs:{src:"https://pocketnet.app/img/logo20.svg"}})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"infoName"},[n("span",[e._v("Bastyon")])])}],u={name:"teamroom",props:{},data:function(){return{}},created:()=>{},watch:{},computed:Object(o["c"])({...Object(o["c"])(["minimized","active","pocketnet","pocketteammessages","readedteammessages"]),mobile:function(){return this.$store.state.mobile},teamNotifications:function(){var e=this;return _.filter(this.pocketteammessages,(function(t){return!e.readedteammessages[t.id]})).length}}),methods:{click:function(){this.$emit("click")}}},d=u,h=(n("f9d6"),n("2877")),m=Object(h["a"])(d,c,l,!1,null,"9b340a7a",null),p=m.exports,f=n("3139"),g={name:"list",data:function(){return{loading:!1,enabled:!0,page:0,revealed:{},lastEventDescription:"",blocked:!1,searchText:""}},components:{preview:a["a"],dummypreviews:s["a"],teamroom:p},props:{user_data:{type:String,default:()=>{}}},created:()=>{},watch:{topchatid:function(){this.hmode&&this.$emit("scrolltop")},active:function(){this.searchText=""}},beforeDestroy(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},computed:Object(o["c"])({window:function(){return window},auth:e=>e.auth,teamNotifications:function(){var e=this;return _.filter(this.pocketteammessages,(function(t){return!e.readedteammessages[t.id]})).length},...Object(o["c"])(["minimized","mobile","active","pocketnet","chatsready","prechats","chats","unauthorized","share","pocketteammessages","readedteammessages","deletedrooms","hideOptimization","wasunhidden"]),showchatslist:function(){return!this.hideOptimization},rooms:function(){return this.core.mtrx.client.getRooms()},empty:function(){return this.core.mtrx.ready&&0===this.chats.length},topchatid:function(){if(this.chats&&this.chats.length)return this.chats[this.chats.length-1].roomId},chats:function(e){var t=this,n=[];return _.each(e.chats,e=>{if(!this.deletedrooms[e.roomId]){this.core.mtrx.kit.tetatetchat(this.m_chat);var i=this.core.mtrx.chatUsersInfo(e.roomId,"anotherChatUsers");1===i.length&&i[0]&&t.core.mtrx.client.isUserIgnored(f["a"].getMatrixIdFull(i[0].id,t.core.domain))||n.push(e)}}),_.sortBy(n,(function(e){return e.lastModified})).reverse()},filteredchats:function(){var e=this.chats;if(this.searchText){var t=_.filter(_.map(e,e=>{var t=this.core.mtrx.chatUsersInfo(e.roomId,"anotherChatUsers"),n=this.core.mtrx.client.getRoom(e.roomId),i=_.reduce(t,(function(e,t){return e+t.name.toLowerCase()}),""),r="";n&&"public"===n.getJoinRule()&&n.currentState.getStateEvents("m.room.name").length>0&&(r=n.currentState.getStateEvents("m.room.name")[0].getContent().name),r||(r=n.name,"#"==r[0]&&(r=""));var o=(r+i).toLowerCase(),s=0;return o.indexOf(this.searchText)>-1&&(s=this.searchText.length/o.length),{chat:n.summary,point:s}}),(function(e){return e.point}));t=_.sortBy(t,(function(e){return e.point})).reverse(),e=_.map(t,e=>e.chat)}return e},withoutBlockedChats:function(){var e=this;this.share&&_.map(e.chats,(function(e){}))},activeuser:function(){return this.core.user.userinfo},hmode(){return this.pocketnet&&this.minimized&&!this.active}}),methods:{search(e){this.searchText=e.toLowerCase()},invitepnt(){this.core.invitepnt()},generatekeys:function(){},moment(){return moment()},dd(e){},revealFirstRight(){this.$refs.list.revealRight(0)},revealFirstLeft(){this.$refs.list.revealLeft(0)},remove(e){this.$set(this.mockSwipeList,this.page,this.mockSwipeList[this.page].filter(t=>t!==e))},setLastEvent(e,t){let{item:n,index:i}=t;this.lastEventDescription={name:e,index:i,id:n.id}},itemClick(e){if(this.hmode)this.$store.commit("active",!0),this.$store.commit("blockactive",{value:!0,item:"main"}),this.$store.commit("setiteraction",!0);else if(this.share){var t=this.share;this.$store.commit("SHARE",null),this.$store.commit("icon",{icon:"loading",message:"",manual:!0}),this.core.mtrx.shareInChat(e.roomId,t).then(t=>{this.$store.commit("icon",{icon:"success",message:""}),this.$router.push({path:"chat",query:{...this.$route.query,id:e.roomId}})}).catch(n=>{console.error(n),this.$store.commit("icon",{icon:"error",message:""}),t.route&&this.$router.push({path:"chat",query:{...this.$route.query,id:e.roomId}})})}else this.$router.push("chat?id="+e.roomId).catch(e=>{})},fbClick(e){},sbClick(e){},openTeamRoom:function(){this.hmode?(this.$store.commit("active",!0),this.$store.commit("blockactive",{value:!0,item:"main"}),this.$store.commit("setiteraction",!0)):(setTimeout(()=>{this.$store.commit("SET_READEDTEAMMESSAGES",this.pocketteammessages),this.$store.commit("ALL_NOTIFICATIONS_COUNT",this.core.mtrx.client.getRooms())},500),this.$router.push("/teamroom").catch(e=>{}))},onKeyDown(e){16===e.keyCode&&(this.enabled=!1)},onKeyUp(e){16===e.keyCode&&(this.enabled=!0)},removeRoom(e){this.$dialog.confirm("Do you really want to leave room?",{okText:this.$i18n.t("yes"),cancelText:this.$i18n.t("cancel")}).then(t=>{this.core.mtrx.client.leave(e).then(t=>{this.core.mtrx.client.forget(e,!0).then(e=>e).then(t=>{this.$store.commit("DELETE_ROOM",e),this.$router.push({path:"/chats"}).catch(e=>{})})})})},tetatetchat(e){if(!e)return!0;var t=this.core.mtrx.client.getRoom(e.roomId);return!t||this.core.mtrx.kit.tetatetchat(this.core.mtrx.client.getRoom(e.roomId))}},mounted(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.hmode||this.$store.commit("SET_LAST_ROOM",null)}},v=g,y=(n("a853"),n("b551"),Object(h["a"])(v,i,r,!1,null,"448124e6",null));t["a"]=y.exports},5:function(e,t){},5059:function(e,t,n){"use strict";var i=n("3139"),r=n("6f45"),o=function(){var e=this;return e.orientation=function(e,t){return new Promise((n,i)=>{if(!t.orientation)return n(e);var r=new Image,o=document.createElement("canvas"),s=o.getContext("2d");r.src=srcData,r.onload=function(){var e=r.width,i=r.height;switch($.inArray(t.orientation,[5,6,7,8])>-1?(o.width=i,o.height=e):(o.width=e,o.height=i),t.orientation){case 1:s.drawImage(this,0,0,e,i);break;case 2:s.translate(e,0),s.scale(-1,1),s.drawImage(this,0,0,e,i);break;case 3:s.translate(e,i),s.rotate(Math.PI),s.drawImage(this,0,0,e,i);break;case 4:s.translate(0,i),s.scale(1,-1),s.drawImage(this,0,0,e,i);break;case 5:s.rotate(Math.PI/2),s.scale(1,-1),s.drawImage(this,0,0,e,i);break;case 6:s.rotate(Math.PI/2),s.translate(0,-i),s.drawImage(this,0,0,e,i);break;case 7:s.rotate(Math.PI/2),s.translate(e,-i),s.scale(-1,1),s.drawImage(this,0,0,e,i);break;case 8:s.rotate(-Math.PI/2),s.translate(-e,0),s.drawImage(this,0,0,e,i);break;default:return void s.drawImage(this,0,0,e,i)}var a=o.toDataURL("image/jpeg",.95);$(o).remove(),n(a)}})},e.autorotation=function(t,n){return new Promise((o,s)=>{if(!t||i["a"].isios())return o(n);r.getData(t,(function(){var t=r.getAllTags(this);e.orientation(n,t).then(e=>o(e))}))})},e.srcToData=function(e,t){var n=new XMLHttpRequest;n.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n.response)},n.onerror=function(){},n.open("GET",e),n.responseType="blob",n.send()},e.resize={fit:function(e,t,n,i,r){var o,s,a,c=new Image,l=document.createElement("canvas"),u=l.getContext("2d");return c.crossOrigin="Anonymous",c.src=e,i||(i="image/jpeg"),r||(r=1),new Promise((e,d)=>{c.onload=function(){if(o=c.height/c.width,a=c.height,s=c.width,a<=n&&s<=t);else{s>t&&(s=t,a=t*o),a>n&&(a=n,s=a/o);var d=Math.max((a-n)/a,(s-t)/s);d>0&&(a*=d+1,s*=d+1)}l.width=s,l.height=a,u.drawImage(c,0,0,s,a);var h=l.toDataURL(i,r);$(l).remove(),e(h)}})},def:function(e,t,n,i,r){var o,s,a,c=new Image,l=document.createElement("canvas"),u=l.getContext("2d");return c.crossOrigin="Anonymous",c.src=e,i||(i="image/jpeg"),r||(r=1),new Promise((e,d)=>{c.onload=function(){o=c.height/c.width,a=c.height,s=c.width,a<=n&&s<=t||(s>t&&(s=t,a=t*o),a>n&&(a=n,s=a/o)),l.width=s,l.height=a,u.drawImage(c,0,0,s,a);var d=l.toDataURL(i,r);$(l).remove(),e(d)}})}},e.grayscaleImage=function(e,t){var n=new Image;return n.src=e,new Promise((e,t)=>{n.onload=function(){var t=document.createElement("canvas"),i=t.getContext("2d"),r=n.width,o=n.height;t.width=r,t.height=o,i.drawImage(n,0,0);var s=i.getImageData(0,0,r,o),a=0,c=0;for(c=0;c<s.height;c++)for(a=0;a<s.width;a++){var l=4*c*s.width+4*a,u=s.data[l],d=s.data[l+1],h=s.data[l+2],m=s.data[l+3],p=(3*u+d+h)/3;s.data[l]=p,s.data[l+1]=p,s.data[l+2]=p,s.data[l+3]=m}i.putImageData(s,0,0,0,0,s.width,s.height),e(t.toDataURL())}})},e.wh=function(e){const t=new Image;var n={};return new Promise((i,r)=>{t.onload=function(){n.w=this.width,n.h=this.height,i(n)},t.onerror=function(e){r(e)},t.src=e})},e};t["a"]=o},"507f":function(e,t,n){},"508c":function(e,t,n){"use strict";n("b5b6")},"52ce":function(e,t,n){"use strict";n("6358")},"53a0":function(e,t,n){},5588:function(e,t,n){"use strict";n("4f09")},"56a3":function(e,t,n){},"56d7":function(t,n,i){"use strict";i.r(n);var r=i("a026"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app",attrs:{id:"matrix-root",theme:e.theme}},[n("div",{staticClass:"rootcontent",class:{pip:e.pip,bin:e.pocketnet,fix:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,active:e.active,mobile:e.mobile,unselect:e.unselect}},[n("div",{staticClass:"chatwrapper",on:{click:e.iteraction}},[n("div",[e.closebybg?n("div",{staticClass:"backface",on:{click:e.hide}}):e._e(),n("MainWrapper"),e.globalpreloader?n("preloader"):e._e(),n("transition",{attrs:{name:"fade"}},[e.unauthorized?n("div",{staticClass:"fixedallwrapper likeoffline"},[n("userUnauthorized")],1):e._e()])],1)])]),n("div",{attrs:{hidden:"",id:"sprite-plyr"}},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[n("symbol",{attrs:{id:"plyr-airplay"}},[n("path",{attrs:{d:"M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"}}),n("path",{attrs:{d:"M4 17h10l-5-6z"}})]),n("symbol",{attrs:{id:"plyr-captions-off"}},[n("path",{attrs:{d:"M1 1c-.6 0-1 .4-1 1v11c0 .6.4 1 1 1h4.6l2.7 2.7c.2.2.4.3.7.3.3 0 .5-.1.7-.3l2.7-2.7H17c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1H1zm4.52 10.15c1.99 0 3.01-1.32 3.28-2.41l-1.29-.39c-.19.66-.78 1.45-1.99 1.45-1.14 0-2.2-.83-2.2-2.34 0-1.61 1.12-2.37 2.18-2.37 1.23 0 1.78.75 1.95 1.43l1.3-.41C8.47 4.96 7.46 3.76 5.5 3.76c-1.9 0-3.61 1.44-3.61 3.7 0 2.26 1.65 3.69 3.63 3.69zm7.57 0c1.99 0 3.01-1.32 3.28-2.41l-1.29-.39c-.19.66-.78 1.45-1.99 1.45-1.14 0-2.2-.83-2.2-2.34 0-1.61 1.12-2.37 2.18-2.37 1.23 0 1.78.75 1.95 1.43l1.3-.41c-.28-1.15-1.29-2.35-3.25-2.35-1.9 0-3.61 1.44-3.61 3.7 0 2.26 1.65 3.69 3.63 3.69z","fill-rule":"evenodd","fill-opacity":".5"}})]),n("symbol",{attrs:{id:"plyr-captions-on"}},[n("path",{attrs:{d:"M1 1c-.6 0-1 .4-1 1v11c0 .6.4 1 1 1h4.6l2.7 2.7c.2.2.4.3.7.3.3 0 .5-.1.7-.3l2.7-2.7H17c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1H1zm4.52 10.15c1.99 0 3.01-1.32 3.28-2.41l-1.29-.39c-.19.66-.78 1.45-1.99 1.45-1.14 0-2.2-.83-2.2-2.34 0-1.61 1.12-2.37 2.18-2.37 1.23 0 1.78.75 1.95 1.43l1.3-.41C8.47 4.96 7.46 3.76 5.5 3.76c-1.9 0-3.61 1.44-3.61 3.7 0 2.26 1.65 3.69 3.63 3.69zm7.57 0c1.99 0 3.01-1.32 3.28-2.41l-1.29-.39c-.19.66-.78 1.45-1.99 1.45-1.14 0-2.2-.83-2.2-2.34 0-1.61 1.12-2.37 2.18-2.37 1.23 0 1.78.75 1.95 1.43l1.3-.41c-.28-1.15-1.29-2.35-3.25-2.35-1.9 0-3.61 1.44-3.61 3.7 0 2.26 1.65 3.69 3.63 3.69z","fill-rule":"evenodd"}})]),n("symbol",{attrs:{id:"plyr-download"}},[n("path",{attrs:{d:"M9 13c.3 0 .5-.1.7-.3L15.4 7 14 5.6l-4 4V1H8v8.6l-4-4L2.6 7l5.7 5.7c.2.2.4.3.7.3zm-7 2h14v2H2z"}})]),n("symbol",{attrs:{id:"plyr-enter-fullscreen"}},[n("path",{attrs:{d:"M10 3h3.6l-4 4L11 8.4l4-4V8h2V1h-7zM7 9.6l-4 4V10H1v7h7v-2H4.4l4-4z"}})]),n("symbol",{attrs:{id:"plyr-exit-fullscreen"}},[n("path",{attrs:{d:"M1 12h3.6l-4 4L2 17.4l4-4V17h2v-7H1zM16 .6l-4 4V1h-2v7h7V6h-3.6l4-4z"}})]),n("symbol",{attrs:{id:"plyr-fast-forward"}},[n("path",{attrs:{d:"M7.875 7.171L0 1v16l7.875-6.171V17L18 9 7.875 1z"}})]),n("symbol",{attrs:{id:"plyr-logo-vimeo"}},[n("path",{attrs:{d:"M17 5.3c-.1 1.6-1.2 3.7-3.3 6.4-2.2 2.8-4 4.2-5.5 4.2-.9 0-1.7-.9-2.4-2.6C5 10.9 4.4 6 3 6c-.1 0-.5.3-1.2.8l-.8-1c.8-.7 3.5-3.4 4.7-3.5 1.2-.1 2 .7 2.3 2.5.3 2 .8 6.1 1.8 6.1.9 0 2.5-3.4 2.6-4 .1-.9-.3-1.9-2.3-1.1.8-2.6 2.3-3.8 4.5-3.8 1.7.1 2.5 1.2 2.4 3.3z"}})]),n("symbol",{attrs:{id:"plyr-logo-youtube"}},[n("path",{attrs:{d:"M16.8 5.8c-.2-1.3-.8-2.2-2.2-2.4C12.4 3 9 3 9 3s-3.4 0-5.6.4C2 3.6 1.3 4.5 1.2 5.8 1 7.1 1 9 1 9s0 1.9.2 3.2c.2 1.3.8 2.2 2.2 2.4C5.6 15 9 15 9 15s3.4 0 5.6-.4c1.4-.3 2-1.1 2.2-2.4.2-1.3.2-3.2.2-3.2s0-1.9-.2-3.2zM7 12V6l5 3-5 3z"}})]),n("symbol",{attrs:{id:"plyr-muted"}},[n("path",{attrs:{d:"M12.4 12.5l2.1-2.1 2.1 2.1 1.4-1.4L15.9 9 18 6.9l-1.4-1.4-2.1 2.1-2.1-2.1L11 6.9 13.1 9 11 11.1zM3.786 6.008H.714C.286 6.008 0 6.31 0 6.76v4.512c0 .452.286.752.714.752h3.072l4.071 3.858c.5.3 1.143 0 1.143-.602V2.752c0-.601-.643-.977-1.143-.601L3.786 6.008z"}})]),n("symbol",{attrs:{id:"plyr-pause"}},[n("path",{attrs:{d:"M6 1H3c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1zm6 0c-.6 0-1 .4-1 1v14c0 .6.4 1 1 1h3c.6 0 1-.4 1-1V2c0-.6-.4-1-1-1h-3z"}})]),n("symbol",{attrs:{id:"plyr-pip"}},[n("path",{attrs:{d:"M13.293 3.293L7.022 9.564l1.414 1.414 6.271-6.271L17 7V1h-6z"}}),n("path",{attrs:{d:"M13 15H3V5h5V3H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-6h-2v5z"}})]),n("symbol",{attrs:{id:"plyr-play"}},[n("path",{attrs:{d:"M15.562 8.1L3.87.225c-.818-.562-1.87 0-1.87.9v15.75c0 .9 1.052 1.462 1.87.9L15.563 9.9c.584-.45.584-1.35 0-1.8z"}})]),n("symbol",{attrs:{id:"plyr-restart"}},[n("path",{attrs:{d:"M9.7 1.2l.7 6.4 2.1-2.1c1.9 1.9 1.9 5.1 0 7-.9 1-2.2 1.5-3.5 1.5-1.3 0-2.6-.5-3.5-1.5-1.9-1.9-1.9-5.1 0-7 .6-.6 1.4-1.1 2.3-1.3l-.6-1.9C6 2.6 4.9 3.2 4 4.1 1.3 6.8 1.3 11.2 4 14c1.3 1.3 3.1 2 4.9 2 1.9 0 3.6-.7 4.9-2 2.7-2.7 2.7-7.1 0-9.9L16 1.9l-6.3-.7z"}})]),n("symbol",{attrs:{id:"plyr-rewind"}},[n("path",{attrs:{d:"M10.125 1L0 9l10.125 8v-6.171L18 17V1l-7.875 6.171z"}})]),n("symbol",{attrs:{id:"plyr-settings"}},[n("path",{attrs:{d:"M16.135 7.784a2 2 0 0 1-1.23-2.969c.322-.536.225-.998-.094-1.316l-.31-.31c-.318-.318-.78-.415-1.316-.094a2 2 0 0 1-2.969-1.23C10.065 1.258 9.669 1 9.219 1h-.438c-.45 0-.845.258-.997.865a2 2 0 0 1-2.969 1.23c-.536-.322-.999-.225-1.317.093l-.31.31c-.318.318-.415.781-.093 1.317a2 2 0 0 1-1.23 2.969C1.26 7.935 1 8.33 1 8.781v.438c0 .45.258.845.865.997a2 2 0 0 1 1.23 2.969c-.322.536-.225.998.094 1.316l.31.31c.319.319.782.415 1.316.094a2 2 0 0 1 2.969 1.23c.151.607.547.865.997.865h.438c.45 0 .845-.258.997-.865a2 2 0 0 1 2.969-1.23c.535.321.997.225 1.316-.094l.31-.31c.318-.318.415-.781.094-1.316a2 2 0 0 1 1.23-2.969c.607-.151.865-.547.865-.997v-.438c0-.451-.26-.846-.865-.997zM9 12a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"}})]),n("symbol",{attrs:{id:"plyr-volume"}},[n("path",{attrs:{d:"M15.6 3.3c-.4-.4-1-.4-1.4 0-.4.4-.4 1 0 1.4C15.4 5.9 16 7.4 16 9c0 1.6-.6 3.1-1.8 4.3-.4.4-.4 1 0 1.4.2.2.5.3.7.3.3 0 .5-.1.7-.3C17.1 13.2 18 11.2 18 9s-.9-4.2-2.4-5.7z"}}),n("path",{attrs:{d:"M11.282 5.282a.909.909 0 0 0 0 1.316c.735.735.995 1.458.995 2.402 0 .936-.425 1.917-.995 2.487a.909.909 0 0 0 0 1.316c.145.145.636.262 1.018.156a.725.725 0 0 0 .298-.156C13.773 11.733 14.13 10.16 14.13 9c0-.17-.002-.34-.011-.51-.053-.992-.319-2.005-1.522-3.208a.909.909 0 0 0-1.316 0zm-7.496.726H.714C.286 6.008 0 6.31 0 6.76v4.512c0 .452.286.752.714.752h3.072l4.071 3.858c.5.3 1.143 0 1.143-.602V2.752c0-.601-.643-.977-1.143-.601L3.786 6.008z"}})])])])])},s=[],a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main-wrapper",class:{minimized:e.minimized,active:e.active}},[e.showChats?n("div",{staticClass:"chat-container"},["contacts"===e.page?n("ContactsContainer"):e._e(),"chats"===e.page?n("ChatsContainer",{on:{sendMassMessage:e.sendMassMessage}}):e._e(),"settings"===e.page?n("SettingsContainer"):e._e(),n("FooterChat")],1):e._e(),e.showPage?n("div",{staticClass:"chat-container-pages",class:{minimized:e.minimized}},[e.mobile?n("router-view"):n("vue-page-transition",{attrs:{name:"fade-in-right"}},[n("router-view")],1),e.gallery?n("gallery",{attrs:{images:e.gallery.images,index:e.gallery.index},on:{close:e.closeGallery}}):e._e()],1):e._e(),e.showPage||e.pocketnet?e._e():n("div",{staticClass:"chat-container-pages-empty"},[n("i",{staticClass:"fas fa-comments"})]),e.gallery?n("gallery",{attrs:{images:e.gallery.images,index:e.gallery.index},on:{close:e.closeGallery}}):e._e()],1)},c=[],l=i("1da1"),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"footer-chat",class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active}},[n("div",{staticClass:"work"},[n("div",{staticClass:"menuItems"},[n("div",{staticClass:"menuItem bottom-nav__icon",class:{active:e.activecontacts},on:{click:function(t){return e.gotona("contacts")}}},[e._m(0),n("div",{staticClass:"label"},[e._v(" "+e._s(e.$t("caption.contacts"))+" ")])]),n("div",{staticClass:"menuItem bottom-nav__icon",class:{active:e.activechats},on:{click:function(t){return e.gotona("chats")}}},[e._m(1),n("div",{staticClass:"label"},[e._v(" "+e._s(e.$t("caption.chats"))+" ")]),e.notificationCount?n("div",{staticClass:"unseen chatMessages"},[e._v(" "+e._s(e.notificationCount>99?"99":e.notificationCount)+" ")]):e._e()]),e.pocketnet?e._e():n("div",{staticClass:"menuItem bottom-nav__icon",class:{active:e.activesettings},on:{click:function(t){return e.gotona("settings")}}},[e._m(2),n("div",{staticClass:"label"},[e._v(" "+e._s(e.$t("caption.settings"))+" ")])])])])])},d=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"icon"},[n("i",{staticClass:"fas fa-user-friends"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"icon"},[n("i",{staticClass:"fas fa-comments"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"icon"},[n("i",{staticClass:"fas fa-cog"})])}],h=i("2f62"),m={name:"footerChat",data:function(){return{loading:!1}},created:()=>{},watch:{},computed:Object(h["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active,auth:e=>e.auth,notificationCount:e=>e.allnotifications,current:function(){return this.$route.name},query:function(){return this.$route.query},activesettings:function(){return"settings"==this.query.page},activecontacts:function(){return"contacts"==this.query.page},activechats:function(){return void 0===this.query.page||"chats"==this.query.page},mobile:function(){return this.$store.state.mobile}}),methods:{gotona(e){this.$router.push({path:this.$router.path,query:{...this.$route.query,page:e}}),this.$store.commit("active",!0),this.$store.commit("setiteraction",!0)},movefromchat:function(){this.core.backtoapp&&this.core.backtoapp()}}},p=m,f=(i("6b1d"),i("508c"),i("2877")),g=Object(f["a"])(p,u,d,!1,null,"787c318d",null),v=g.exports,y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.images&&e.images.length?n("v-photoswipe",{attrs:{isOpen:e.isOpen,items:e.images,options:e.options},on:{close:e.close,sharecordova:e.sharecordova}}):e._e()},b=[],E={props:{images:Array,index:Number},components:{vPhotoswipe:()=>i.e("chunk-383dfa01").then(i.bind(null,"29a3")).then(e=>e.PhotoSwipe)},data:()=>({isOpen:!1}),mounted(){this.init()},computed:{options:function(){var e={index:0,arrowEl:!0,fullscreenEl:!1,shareEl:!1,history:!1};return e}},methods:{close(){this.isOpen=!1,this.$emit("close")},init(){this.isOpen=!0,this.$set(this.options,"index",this.index)},sharecordova:function(e){window.plugins&&window.plugins.socialsharing&&window.plugins.socialsharing.shareWithOptions({files:[e]})}}},S=E,w=Object(f["a"])(S,y,b,!1,null,null,null),C=w.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page chats",class:{pocketnet:e.pocketnet,mobile:e.mobile,minimized:e.minimized,active:e.active,newChat:e.newChat}},[n("topheader",{staticClass:"topheader",attrs:{share:e.share},on:{newchat:e.newchat,sendMassMessage:e.sendMassMessage}}),n("maincontent",{ref:"maincontent",attrs:{rbackexp:!0},scopedSlots:e._u([{key:"content",fn:function(){return[n("list",{attrs:{share:e.share},on:{scrolltop:e.scrolltop}}),e.newChat&&!e.hiddenInParent?n("modal",{on:{close:e.closeNewChat},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(e._s(e.$t("caption.newChat")))]},proxy:!0},{key:"body",fn:function(){return[n("chatcreate",{on:{completed:e.chatcreated,sendMassMessage:e.sendMassMessage}})]},proxy:!0},{key:"footer",fn:function(){},proxy:!0}],null,!1,524910330)}):e._e()]},proxy:!0}])})],1)},T=[],I=i("4fd2"),R=i("d136"),P=i("71da"),O=i("78a2"),x={name:"pagechats2",components:{list:I["a"],topheader:R["a"],contacts:P["a"],chatcreate:O["a"]},props:{share:Object},data:function(){return{newChat:!1}},computed:Object(h["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active,mobile:e=>e.mobile,hiddenInParent:e=>e.hiddenInParent}),methods:{sendMassMessage:function(e){console.log("sendmessage",e),this.$emit("sendMassMessage",e),this.closeNewChat()},newchat:function(){this.newChat=!0},closeNewChat:function(){this.newChat=!1},chatcreated:function(e){this.$router.push({path:"chat",query:{id:e.room_id}})},scrolltop:function(){this.$refs["maincontent"].scroll(0)}},mounted(){}},M=x,A=(i("9fdb"),Object(f["a"])(M,k,T,!1,null,"289a6a4a",null)),N=A.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page contacts"},[n("topheader",{staticClass:"topheader",attrs:{title:e.title}}),n("maincontent",{scopedSlots:e._u([{key:"content",fn:function(){return[n("contacts",{attrs:{mode:e.mode}})]},proxy:!0}])})],1)},j=[],U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chatsTopheader"}},[n("topheader",{attrs:{sideSlotsWidth:100},scopedSlots:e._u([{key:"left",fn:function(){return[e.minimized&&!e.active||!e.pocketnet?e._e():n("div",{staticClass:"iconbutton",on:{click:e.minimizeall}},[n("i",{staticClass:"fas fa-times"})])]},proxy:!0},{key:"info",fn:function(){return[n("span",[e._v(e._s(e.title))])]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])})],1)},L=[],$={name:"contactsTopheader",props:{title:{type:String,default:"Contacts"}},data:function(){return{loading:!1}},watch:{},computed:Object(h["c"])({auth:e=>e.auth,minimized:e=>e.minimized,pocketnet:e=>e.pocketnet,active:e=>e.active}),methods:{minimizeall:function(){this.$store.commit("minimize",!0),this.$router.push("/chats").catch(e=>{})}}},B=$,F=(i("7905"),Object(f["a"])(B,U,L,!1,null,"a06dc160",null)),K=F.exports,q={name:"pagecontacts",data:function(){return{page:"Contacts",showInviteButton:!1}},components:{contacts:P["a"],topheader:K},computed:Object(h["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,title:function(){return this.$route.query.startnew?this.$i18n.t("caption.startNewChat"):this.$i18n.t("caption.contacts")},mode:function(){return this.$route.query.startnew?"GroupsCreate":this.page}}),methods:{},mounted(){this.$store.commit("SET_LAST_ROOM",null)}},G=q,z=(i("0745"),Object(f["a"])(G,D,j,!1,null,"650f3273",null)),V=z.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page settings"},[n("topheader",{staticClass:"topheader"}),n("maincontent",{scopedSlots:e._u([{key:"content",fn:function(){return[n("settings")]},proxy:!0}])})],1)},W=[],J=i("7334"),Y=i("ce3e"),Q={name:"pagesettings",components:{settings:J["a"],topheader:Y["a"]},computed:Object(h["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized}),methods:{},mounted(){}},X=Q,Z=(i("6e67"),Object(f["a"])(X,H,W,!1,null,"64f4fef6",null)),ee=Z.exports,te={name:"mainWrapper",components:{FooterChat:v,gallery:C,ChatsContainer:N,ContactsContainer:V,SettingsContainer:ee},data:function(){return{prevRoute:null,loading:!1,page:this.$route.query.page?this.$route.query.page:"chats",showPage:"/chat"===this.$route.path||"/contact"===this.$route.path||"/publicPreview"===this.$route.path||"/chatSettings"===this.$route.path||"/chatInfo"===this.$route.path||"/teamRoom"===this.$route.path||"/invite"===this.$route.path,minimized:this.$store.state.mobile}},created:()=>{},watch:{"$route.query.page":{handler:function(e){this.page=e||"chats"},deep:!0,immediate:!0},"$route.path":{handler:function(e){this.showPage="/chat"===e||"/contact"===e||"/publicPreview"===e||"/chatSettings"===e||"/chatInfo"===e||"/teamRoom"===e||"/invite"===e},deep:!0,immediate:!0}},mounted(){this.page=this.$route.query.page?this.$route.query.page:"chats",this.showPage="/chat"===this.$route.path||"/contact"===this.$route.path||"/publicPreview"===this.$route.path||"/chatSettings"===this.$route.path||"/chatInfo"===this.$route.path||"/teamRoom"===this.$route.path||"/invite"===this.$route.path},beforeRouteEnter(e,t,n){n(e=>{e.prevRoute=t})},beforeRouteLeave(e,t,n){this.$store.commit("setmodal",null),n()},computed:Object(h["c"])({auth:e=>e.auth,pocketnet:e=>e.pocketnet,...Object(h["c"])(["currentUserChat","minimized","gallery","active","mobile","recipientsTotal","recipients"]),showFooter:function(){return"chat"!=this.$route.name||this.minimized},showChats(){return!this.pocketnet||"chats"===this.$route.name}}),methods:{closeGallery:function(){this.$store.commit("GALLERY",null)},sendMassMessage(e){var t=this;const{message:n,recipients:i,total:r}=e;this.$store.commit("PROCESS_MASS_MAILING",!0),this.$store.commit("SET_RECIPIENTS_TOTAL",r),this.core.user.usersInfo(i,!0).then(function(){var r=Object(l["a"])((function*(r){const o=function(){var e=Object(l["a"])((function*(){return new Promise(e=>{setTimeout(()=>(e("slept"),!0),200)})}));return function(){return e.apply(this,arguments)}}(),s=()=>{i.shift(),t.$store.commit("SET_RECIPIENTS",i),localStorage.setItem("chat_mass_message",JSON.stringify(e))};for(const e of r){const i=t.core.mtrx.kit.tetatetid(e,t.core.user.userinfo),r=t.core.user.matrixId(e.id);var a=[{type:"m.set.encrypted",state_key:"",content:{encrypted:!0}}];const c=t.$store.state.chatsMap[i];if(c){console.log("room",c),yield o(),s();const e=yield t.core.mtrx.testmessage({room:c.roomId,message:n});console.log("result message",e)}else s(),t.core.mtrx.client.createRoom({room_alias_name:i,visibility:"private",invite:[r],name:"#"+i,initial_state:a}).then(function(){var e=Object(l["a"])((function*(e){const i=yield t.core.mtrx.testmessage({room:e.room_id,message:n});console.log("result message 2",i)}));return function(t){return e.apply(this,arguments)}}()).catch(e=>{console.log("room create mailing err",e)})}}));return function(e){return r.apply(this,arguments)}}())}},mounted(){var e;const t=JSON.parse(localStorage.getItem("chat_mass_message")||"{}");null!==(e=t.recipients)&&void 0!==e&&e.length&&t.message&&(this.$store.commit("SET_RECIPIENTS",t.recipients),this.$store.commit("SET_RECIPIENTS_TOTAL",t.total))}},ne=te,ie=(i("e281"),i("4bf6"),Object(f["a"])(ne,a,c,!1,null,"2966e3dc",null)),re=ie.exports,oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{bin:e.pocketnet,fix:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,active:e.active},attrs:{id:"userUnauthorized"}},[n("div",{staticClass:"table"},[n("div",{staticClass:"cell"},[n("div",{staticClass:"wrapper"},[e.loading?n("div",[n("i",{staticClass:"fas fa-spinner fa-spin"})]):n("div",["unauthorized"==e.unauthorized?n("div",[e._m(0),n("div",{staticClass:"label"},[e._v(" User unauthorized ")])]):e._e(),"deleted"==e.unauthorized?n("div",[e._m(1),n("div",{staticClass:"label"},[e._v(" User deleted ")])]):e._e(),"unknown"==e.unauthorized?n("div",[e._m(2),n("div",{staticClass:"label"},[e._v(" "+e._s(e.$t("caption.accNotFound"))+" ")]),e.connect&&e.usersinfo[e.connect]?n("div",{staticClass:"connect"},[e._m(3),n("preview",{attrs:{contact:e.usersinfo[e.connect],mode:"mini"}})],1):e._e(),e.joinroom&&!e.connect?n("div",{staticClass:"connect joinroom"},[e._m(4)]):e._e()]):e._e(),n("div",{staticClass:"actions"},[n("button",{staticClass:"button small",on:{click:e.refresh}},[e._v(" Refresh "),n("i",{staticClass:"fas fa-sync"})]),e.mobile?n("button",{staticClass:"button small ghost",on:{click:e.movefromchat}},[n("i",{staticClass:"fas fa-arrow-right"})]):e._e()])])])])])])},se=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"icon"},[n("i",{staticClass:"fas fa-user-slash"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"icon"},[n("i",{staticClass:"fas fa-user-slash"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"icon"},[n("i",{staticClass:"fas fa-spinner fa-spin"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"connectCaption"},[n("span",[e._v(" When registration is complete, you will be connected to ")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"connectCaption"},[n("span",[e._v(" When registration is complete, you will be redirect to public room ")])])}],ae=i("92a6"),ce={name:"userUnauthorized",props:{data:Object},data:function(){return{loading:!1,intrv:null}},components:{preview:ae["a"]},computed:Object(h["c"])({pocketnet:e=>e.pocketnet,minimized:function(){return!this.mobile&&this.$store.state.minimized},active:function(){return!this.mobile&&this.$store.state.active},auth:e=>e.auth,connect:e=>e.connect,joinroom:e=>e.joinroom,unauthorized:function(){return this.$store.state.unauthorized},mobile:function(){return this.$store.state.mobile},usersinfo:function(){return this.$store.state.users}}),beforeDestroy:function(){this.intrv&&(clearInterval(this.intrv),this.intrv=null)},methods:{refresh:function(e){e||(this.loading=!0),this.core.initWithUser().then(e=>{setTimeout(()=>{this.loading=!1},350)})},movefromchat:function(){this.core.backtoapp&&this.core.backtoapp()}},mounted:function(){this.connect&&this.core.user.usersInfo([this.connect]),"unknown"==this.unauthorized&&(this.intrv=setInterval(()=>{this.refresh(!0)},2e4))}},le=ce,ue=(i("e619"),Object(f["a"])(le,oe,se,!1,null,"673d255b",null)),de=ue.exports,he=i("3139");r["default"].use(h["a"]);var me={white:"White",black:"Dark",classic:"Classic"},pe={theme:function(e,t){me[t]&&(e.theme=t)}},fe=null,ge=new h["a"].Store({state:{contacts:{},contactsFromMatrix:{},contactsMap:{},chats:[],prechats:[],chatsMap:{},events:{},users:{},typing:{},icon:null,loading:!1,online:!0,unauthorized:!1,theme:"white",themes:me,signedUpUsers:[],pocketnet:"",mobile:"",voiceMessagesEnabled:"",currentPlayingVoiceMessage:null,current_user:{},minimized:!1,active:!1,activeBlock:{},globalpreloader:!1,allnotifications:0,pocketteammessages:[],readedteammessages:{},chatsready:!1,autohide:!1,iteraction:!1,roomMembes:[],gallery:null,share:null,contact:null,connect:null,joinroom:null,chatusers:{},force:{},wasunhidden:!1,hiddenInParent:!1,hideOptimization:!1,modalShowed:null,menu:null,pinchat:!1,lastroom:null,dontreadreceipts:!1,voicerecording:!1,deletedrooms:{},pkoindisabled:!1,recipientsTotal:0,recipients:[],processMassMailing:!1,address:"",isLocalStorageChatAuth:!1},getters:{getUser:e=>e.user,getConnection:e=>e.localMatrixStore,getSignedUpUsers:e=>e.signedUpUsers},mutations:{SET_ADDRESS(e,t){e.address=t},PROCESS_MASS_MAILING(e,t){e.processMassMailing=t},SET_CURRENT_PLAYING_VOICE_MESSAGE(e,t){e.currentPlayingVoiceMessage=t},setUser(e,t){e.current_user=t||{}},clearall(e){if(e.contacts={},e.contactsFromMatrix={},e.contactsMap={},e.chats=[],e.prechats=[],e.chatsMap={},e.events={},e.users={},e.typing={},e.icon=null,e.loading=!1,e.online=!0,e.unauthorized=!1,e.signedUpUsers=[],e.current_user={},e.minimized=!1,e.active=!1,e.activeBlock={},e.globalpreloader=!1,e.allnotifications=0,e.pocketteammessages=[],e.readedteammessages={},e.chatsready=!1,e.autohide=!1,e.gallery=null,e.modalShowed=null,e.menu=null,e.pinchat=!1,e.dontreadreceipts=!1,e.lastroom=null,e.voicerecording=!1,e.mobile)return e.active=!1,e.iteraction=!1,void(e.minimized=!1);e.minimized=!1,fe&&(clearTimeout(fe),fe=null)},blockactive(e,t){t.value?r["default"].set(e.activeBlock,t.item,t.value):r["default"].delete(e.activeBlock,t.item,t.value)},globalpreloader:function(e,t){e.globalpreloader=t},icon(e,t){e.icon=t;var n=he["a"].deep(window,"window.POCKETNETINSTANCE.mobile.vibration");n&&n.small()},pkoindisabled(e,t){e.pkoindisabled=!(!t||"true"!=t)},wasunhidden(e,t){e.wasunhidden=!0},hiddenInParent(e,t){e.hiddenInParent=t},hideOptimization(e,t){e.hideOptimization=t},pinchat(e,t){e.pinchat=t,localStorage["pinchat"]=!!t||""},dontreadreceipts(e,t){e.dontreadreceipts=t,localStorage["dontreadreceipts"]=!!t||""},SET_LAST_ROOM(e,t){e.lastroom=t?{id:t,time:new Date}:null},active(e,t){if(e.mobile)return e.active=!1,void(e.iteraction=!1);var n=50;t||(n=1e3),fe=he["a"].slowMade(()=>{if(!t){if(!_.isEmpty(e.activeBlock))return;e.iteraction=!1}e.active=t,e.active||(e.share=null,delete e.activeBlock.share)},fe,n)},setiteraction(e,t){e.iteraction=t},maximize(e,t){e.minimized=!1},minimize(e,t){e.mobile?e.minimized=!1:(e.minimized&&(e.activeBlock={},e.active=!1),e.minimized=!0)},setmodal(e,t){e.modalShowed=t},setPocketnet(e,t){e.pocketnet=t},setMobile(e,t){e.mobile=t},setIsLocalStorageChatAuth(e,t){e.isLocalStorageChatAuth=t},setVoiceMessagesEnabled(e,t){e.voiceMessagesEnabled=t},ls(e){"undefined"!=typeof localStorage.getItem("pinchat")&&(e.pinchat=!!localStorage.getItem("pinchat")),"undefined"!=typeof localStorage.getItem("dontreadreceipts")&&(e.dontreadreceipts=!!localStorage.getItem("dontreadreceipts"))},init(e){pe.theme(e,localStorage.getItem("theme")||"white")},ALL_NOTIFICATIONS_COUNT(e,t){var n=new Date,i=_.filter(t,e=>{if("invite"===e._selfMembership){var t=ge._vm.core.mtrx.anotherChatUsers(e);if(1==t.length&&ge._vm.core.mtrx.blockeduser(t[0].userId))return!1;if(he["a"].date.addseconds(new Date(e.summary.lastModified),86400)>n)return!0}});if(e.allnotifications=_.reduce(t,(e,t)=>e+(t.getUnreadNotificationCount()||0),0)+i.length,e.chats.length<=3){var r=_.filter(e.pocketteammessages,(function(t){return!e.readedteammessages[t.id]})).length;e.allnotifications+=r}var o=he["a"].deep(ge,"_vm.core.external.clbks.ALL_NOTIFICATIONS_COUNT")||{};return _.each(o,(function(t){t(e.allnotifications)})),e.allnotifications},SET_CHATS_READY(e,t){e.chatsready=t},SET_PRECHATS_TO_STORE(e,t){e.prechats=t},SET_CHAT_TO_FORCE(e,t){r["default"].set(e.force,t,!0)},SET_CHATS_TO_STORE(e,t){e.chats=t;var n={};_.each(t,t=>{var i=t.info.title.replace("#","");e.chatsMap[t.roomId]&&!e.force[t.roomId]||r["default"].set(e.chatsMap,t.roomId,t),e.chatsMap[i]&&!e.force[t.roomId]||r["default"].set(e.chatsMap,i,t),n[t.roomId]=t,n[t.info.title.replace("#","")]=t,r["default"].delete(e.force,t.roomId)}),_.each(e.chatsMap,(function(t,i){n[i]||r["default"].delete(e.chatsMap,i)}))},SET_EVENTS_TO_STORE(e,t){_.each(t,(function(t,n){var i=[];_.each(t.timeline,(function(e){var t=e.event,n={event:{content:_.clone(t.content),event_id:t.event_id,origin_server_ts:t.origin_server_ts,room_id:t.room_id,sender:t.sender,state_key:t.state_key,type:t.type},get:()=>e};i.push(n)})),r["default"].set(e.events,n,{timeline:i})}))},SET_TYPING_TO_STORE(e,t){function n(e){for(var t in e)if(!e[t])return!1;return!0}e.typing[t.room]||(e.typing[t.room]={}),e.typing[t.room][t.name]=t.typing,n(t.typing)},DELETE_ROOM(e,t){r["default"].set(e.deletedrooms,t,!0)},SET_CONTACTS(e,t){var n={};_.each(t,(function(e){n[e.id]=e})),e.contacts=n,ge.commit("SET_CONTACTS_MAP")},SET_CHATS_USERS(e,t){_.each(t||{},(function(t,n){e.chatusers[n]&&_.isEqual(e.chatusers[n],t)||r["default"].set(e.chatusers,n,t)}))},SET_CONTACTS_FROM_MATRIX(e,t){var n={};_.each(t,(function(e){he["a"].getmatrixid(e.id)!=(ge._vm.core.user.userinfo&&ge._vm.core.user.userinfo.id)&&(n[e.id]=e)})),e.contactsFromMatrix=n,ge.commit("SET_CONTACTS_MAP")},SET_CONTACTS_MAP(e){var t={};_.each(e.contacts,(function(e){t[e.id]=e})),_.each(e.contactsFromMatrix,(function(e){t[e.id]=e})),e.contactsMap=t},SET_UNAUTHORIZED(e,t){e.unauthorized=t},SET_USERINFO(e,t){t.info&&(!t.reload&&e.users[t.info.id]||r["default"].set(e.users,t.info.id,t.info))},SET_CURRENT_ROOM(e,t){e.currentRoom=t},CLEAR_USERSINFO(e,t){e.users={}},SET_RECIPIENTS(e,t){e.recipients=t},SET_RECIPIENTS_TOTAL(e,t){e.recipientsTotal=t},GALLERY(e,t){e.gallery=t||null;var n=null;n=t?he["a"].deep(window,"window.POCKETNETINSTANCE.mobile.statusbar.gallerybackground"):he["a"].deep(window,"window.POCKETNETINSTANCE.mobile.statusbar.background"),n&&n()},SHARE(e,t){e.share=t||null,e.mobile||(e.activeBlock.share=!0,e.active=!0)},CONNECT(e,t){e.connect=t},JOINROOM(e,t){e.joinroom=t},CONTACT(e,t){e.contact=t||null},theme(e,t){pe.theme(e,t)},SET_POCKETTEAMMESSAGES(t,n){t.pocketteammessages=n;var i=localStorage.getItem("readedpocketteammessages");if(i)try{var r=JSON.parse(i);t.readedteammessages=r}catch(e){localStorage.removeItem("readedpocketteammessages"),t.readedteammessages={}}},SET_READEDTEAMMESSAGES(e,t){if(t&&t.length>0){var n={};_.each(t,(function(e){n[e.id]=!0})),e.readedteammessages=n,localStorage.setItem("readedpocketteammessages",JSON.stringify(n))}},SET_MENU(e,t){e.menu=t},SET_VOICERECORDING(e,t){e.voicerecording=t}},actions:{SET_CHAT_MEMBERS(e,t){let{commit:n}=e},TYPING_EVENT(e,t){let{commit:n}=e,i=t.roomId,r=t.name,o={room:i,name:r,typing:t.typing};n("SET_TYPING_TO_STORE",o)},CHAT_MEMBERS(e){let{commit:t}=e},SHOW_GALLERY_FROMEVENTS(e,t){let{commit:n,dispatch:i}=e,{events:r,event:o}=t;var s=[],a=0,c=function(e){return!!he["a"].deep(e,"event.content.info.secrets")};_.each(r,e=>{if("m.image"===e.event.content.msgtype){var t=e.event.content.url;c(e)&&(t=e.event.decryptedImage),s.push({src:t,w:e.event.content.info.w||500,h:e.event.content.info.h||500,eventId:e.event.event_id})}}),s=_.filter(s,(function(e){return e.src})),a=s.map((function(e){return e.eventId})).indexOf(o.event.event_id),i("SHOW_GALLERY",{images:s,index:a})},SHOW_GALLERY(e,t){let{commit:n}=e,{images:i,index:r}=t;r||(r=0),i||(i=[]),i.length?n("GALLERY",{images:i,index:r}):n("GALLERY",null)},RELOAD_CHAT_USERS(e,t){let{commit:n}=e;return ge._vm.core.mtrx.kit.usersInfoForChats(t,!0).then(e=>(n("SET_CHATS_USERS",ge._vm.core.mtrx.kit.usersFromChats(t)),Promise.resolve())).catch(e=>Promise.resolve())},FETCH_CHATS(e){let{commit:t}=e;var n=he["a"].deep(ge._vm,"core.mtrx.store.rooms")||{},i=ge._vm.core.user.myMatrixId(),r=_.map(n,(function(e){return-9007199254740991===e.getLastActiveTimestamp()?e.getMember(i)&&(e.summary.lastModified=e.getMember(i).events.member.event.origin_server_ts):e.summary.lastModified=e.getLastActiveTimestamp(),e.summary}));return t("SET_PRECHATS_TO_STORE",r),ge._vm.core.mtrx.kit.allchatmembers(n).then(e=>(t("SET_CHATS_TO_STORE",r),t("SET_CHATS_USERS",ge._vm.core.mtrx.kit.usersFromChats(n)),ge._vm.core.mtrx.kit.fillContacts(n)))},DELETE_ROOM(e,t){r["default"].set(e.deletedrooms,t,!0)},SET_CONTACTS(e,t){var n={};_.each(t,(function(e){n[e.id]=e})),e.contacts=n,ge.commit("SET_CONTACTS_MAP")},SET_CHATS_USERS(e,t){_.each(t||{},(function(t,n){e.chatusers[n]&&_.isEqual(e.chatusers[n],t)||r["default"].set(e.chatusers,n,t)}))},SET_CONTACTS_FROM_MATRIX(e,t){var n={};_.each(t,(function(e){he["a"].getmatrixid(e.id)!=(ge._vm.core.user.userinfo&&ge._vm.core.user.userinfo.id)&&(n[e.id]=e)})),e.contactsFromMatrix=n,ge.commit("SET_CONTACTS_MAP")},SET_CONTACTS_MAP(e){var t={};_.each(e.contacts,(function(e){t[e.id]=e})),_.each(e.contactsFromMatrix,(function(e){t[e.id]=e})),e.contactsMap=t},SET_UNAUTHORIZED(e,t){e.unauthorized=t},SET_USERINFO(e,t){t.info&&(!t.reload&&e.users[t.info.id]||r["default"].set(e.users,t.info.id,t.info))},SET_CURRENT_ROOM(e,t){e.currentRoom=t},CLEAR_USERSINFO(e,t){e.users={}},GALLERY(e,t){e.gallery=t||null;var n=he["a"].deep(window,"window.POCKETNETINSTANCE.mobile.fullscreenmode");n&&n(t)},SHARE(e,t){e.share=t||null,e.mobile||(e.activeBlock.share=!0,e.active=!0)},CONNECT(e,t){e.connect=t},JOINROOM(e,t){e.joinroom=t},CONTACT(e,t){e.contact=t||null},theme(e,t){pe.theme(e,t)},SET_POCKETTEAMMESSAGES(t,n){t.pocketteammessages=n;var i=localStorage.getItem("readedpocketteammessages");if(i)try{var r=JSON.parse(i);t.readedteammessages=r}catch(e){localStorage.removeItem("readedpocketteammessages"),t.readedteammessages={}}},SET_READEDTEAMMESSAGES(e,t){if(t&&t.length>0){var n={};_.each(t,(function(e){n[e.id]=!0})),e.readedteammessages=n,localStorage.setItem("readedpocketteammessages",JSON.stringify(n))}},SET_MENU(e,t){e.menu=t}},actions:{SET_CHAT_MEMBERS(e,t){let{commit:n}=e},TYPING_EVENT(e,t){let{commit:n}=e,i=t.roomId,r=t.name,o={room:i,name:r,typing:t.typing};n("SET_TYPING_TO_STORE",o)},CHAT_MEMBERS(e){let{commit:t}=e},SHOW_GALLERY_FROMEVENTS(e,t){let{commit:n,dispatch:i}=e,{events:r,event:o}=t;var s=[],a=0,c=function(e){return!!he["a"].deep(e,"event.content.info.secrets")};_.each(r,e=>{if("m.image"===e.event.content.msgtype){var t=e.event.content.url;c(e)&&(t=e.event.decryptedImage),s.push({src:t,w:e.event.content.info.w||500,h:e.event.content.info.h||500,eventId:e.event.event_id})}}),s=_.filter(s,(function(e){return e.src})),a=s.map((function(e){return e.eventId})).indexOf(o.event.event_id),i("SHOW_GALLERY",{images:s,index:a})},SHOW_GALLERY(e,t){let{commit:n}=e,{images:i,index:r}=t;r||(r=0),i||(i=[]),i.length?n("GALLERY",{images:i,index:r}):n("GALLERY",null)},RELOAD_CHAT_USERS(e,t){let{commit:n}=e;return ge._vm.core.mtrx.kit.usersInfoForChats(t,!0).then(e=>(n("SET_CHATS_USERS",ge._vm.core.mtrx.kit.usersFromChats(t)),Promise.resolve())).catch(e=>Promise.resolve())},FETCH_CHATS(e){let{commit:t}=e;var n=he["a"].deep(ge._vm,"core.mtrx.store.rooms")||{},i=ge._vm.core.user.myMatrixId(),r=_.map(n,(function(e){return-9007199254740991===e.getLastActiveTimestamp()?e.getMember(i)&&(e.summary.lastModified=e.getMember(i).events.member.event.origin_server_ts):e.summary.lastModified=e.getLastActiveTimestamp(),e.summary}));return t("SET_PRECHATS_TO_STORE",r),ge._vm.core.mtrx.kit.allchatmembers(n).then(e=>(t("SET_CHATS_TO_STORE",r),t("SET_CHATS_USERS",ge._vm.core.mtrx.kit.usersFromChats(n)),ge._vm.core.mtrx.kit.fillContacts(n)))},FETCH_EVENTS(e){let{commit:t}=e;var n=he["a"].deep(ge._vm,"core.mtrx.store.rooms")||{},i={};_.each(n,(function(e){i[e.roomId]={};var t=[].concat(e.timeline,e.currentState.getStateEvents("m.room.member"));i[e.roomId].timeline=t})),_.each(i,(function(e){e.timeline=_.sortBy(e.timeline,(function(e){return e.getDate()}))})),t("SET_EVENTS_TO_STORE",i)}}}),ve=ge,ye=i("8c4f");function _e(){return!1}r["default"].use(ye["a"]);const be=new ye["a"]({base:_e()?"/messenger":"/",routes:[{path:"/contacts",name:"contacts",component:()=>i.e("chunk-2d21b867").then(i.bind(null,"bfc0"))},{path:"/contact",name:"contact",component:()=>i.e("chunk-5f9613c9").then(i.bind(null,"4fe8"))},{path:"/chats",name:"chats",component:()=>Promise.resolve().then(i.bind(null,"9a41"))},{path:"/chat",name:"chat",component:()=>Promise.all([i.e("chunk-0019dc28"),i.e("chunk-32cdda30")]).then(i.bind(null,"ee79"))},{path:"/publicPreview",name:"publicPreview",component:()=>i.e("chunk-1d706d8a").then(i.bind(null,"5500"))},{path:"/chatSettings",name:"chatSettings",component:()=>i.e("chunk-6ec41fe0").then(i.bind(null,"9394"))},{path:"/chatInfo",name:"chatInfo",component:()=>Promise.all([i.e("chunk-0019dc28"),i.e("chunk-ca9e2052")]).then(i.bind(null,"266d"))},{path:"/teamRoom",name:"teamRoom",component:()=>i.e("chunk-6f87535e").then(i.bind(null,"4779"))},{path:"/settings",name:"settings",component:()=>i.e("chunk-e832edc6").then(i.bind(null,"8a21"))},{path:"/invite",name:"invite",component:()=>i.e("chunk-37dd8fd7").then(i.bind(null,"bd26"))}],mode:document.getElementById("automomous")?"history":"abstract"});var Ee=be,Se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"fade"}},[n("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:!e.minimized,active:e.active,mobile:e.mobile},attrs:{id:"modal"}},[n("div",{staticClass:"modal-backdrop",on:{click:e.close}}),n("div",{staticClass:"modal-wrapper"},[n("div",{staticClass:"modal",attrs:{role:"dialog","aria-labelledby":"modalTitle","aria-describedby":"modalDescription"}},[n("div",{staticClass:"modal-header"},[e._t("header",(function(){return[e._v(" "+e._s(e.$t("caption.header"))+" ")]}))],2),n("div",{staticClass:"modal-body",attrs:{id:"modalDescription"}},[e._t("body")],2),e.displayFooter?n("div",{staticClass:"modal-footer"}):e._e(),n("div",{staticClass:"modal-close",on:{click:e.close}},[n("i",{staticClass:"fas fa-times"})])])])])])},we=[],Ce={name:"modal",props:{displayFooter:{default:!0,type:Boolean},cantclose:Boolean},data:function(){return{loading:!1}},mounted(){this.$store.commit("active",!0),this.$store.commit("blockactive",{value:!0,item:"modal"})},destroyed(){this.$store.commit("blockactive",{value:!1,item:"modal"})},watch:{},computed:Object(h["c"])({auth:e=>e.auth,pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active,mobile:e=>e.mobile}),methods:{close:function(){this.$emit("close")}}},ke=Ce,Te=(i("edeb"),Object(f["a"])(ke,Se,we,!1,null,null,null)),Ie=Te.exports,Re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"pmenu",class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,active:e.active,mobile:e.mobile}},[e.menu?n("div",{staticClass:"menubgwrapper"},[n("div",{staticClass:"backgr",on:{click:function(t){return e.hidePopup()}}}),n("div",{staticClass:"menuwrapper"},[n("simpleMenu",{attrs:{items:e.menu.items},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("default",(function(){return[n("div",{staticClass:"menu-item",on:{click:function(n){return e.menuItemClick(t.item)}}},[n("div",{staticClass:"iconWrapper"},[t.item.icon?n("i",{class:t.item.icon}):e._e()]),n("div",{staticClass:"title"},[e._v(" "+e._s(t.item.title)+" ")])])]}),{item:t.item})]}}],null,!0)}),n("div",{staticClass:"cancelWrapper"},[n("div",{staticClass:"menu-item",on:{click:function(t){return e.hidePopup()}}},[n("div",{staticClass:"iconWrapper"}),n("div",{staticClass:"title"},[e._v(e._s(e.$t("cancel")))])])])],1)]):e._e()])},Pe=[],Oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"items"},[n("transition-group",{attrs:{name:"menulis2t",tag:"div"}},e._l(e.filteredItems,(function(t){return n("div",{key:t.click,staticClass:"item"},[e._t("default",(function(){return[n("router-link",{attrs:{to:"/"+t.route}},[n("div",{staticClass:"iwr"},[t.icon?n("i",{class:t.icon}):e._e(),n("span",[e._v(e._s(t.name&&"string"===typeof t.name?t.name:"undefined"))])])])]}),{item:t})],2)})),0)],1)])},xe=[],Me={name:"simpleMenu",props:{items:{type:Array,required:!0}},computed:{filteredItems:function(){return this.items.filter(e=>!e.hidden)}}},Ae=Me,Ne=(i("62d6"),Object(f["a"])(Ae,Oe,xe,!1,null,"79bb4e47",null)),De=Ne.exports,je={name:"pmenu",props:{},components:{simpleMenu:De},data:function(){return{last:null}},watch:{},computed:{...Object(h["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,mobile:e=>e.mobile,active:e=>e.active,hiddenInParent:e=>e.hiddenInParent,menu:e=>e.menu})},methods:{menuItemClick(e){this.menu&&(this.last=this.menu,this.menu.handler(e,this.menu.item,{hidePopup:this.hidePopup,showPopup:this.showPopup}))},showPopup:function(){this.last&&(this.$store.commit("SET_MENU",this.last),this.last=null)},hidePopup(){this.$store.commit("SET_MENU",null)}}},Ue=je,Le=(i("994e"),Object(f["a"])(Ue,Re,Pe,!1,null,"6078dda8",null)),$e=Le.exports,Be=i("7a1f"),Fe=i("3f9d"),Ke=i("a925"),qe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"m-message-fade",mode:"in-out"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"m-message-wrapper",class:e.wrapperClassName,style:{width:e.width}},[n("mmessage",{class:[e.type&&"m-message--"+e.type,e.className],attrs:{event:e.event,chat:e.chat,closable:e.showClose,"is-collapsed":e.isCollapsed,"close-handler":e.close,"click-handler":e.click,title:e.title,supportHTML:e.supportHTML},nativeOn:{mouseenter:function(t){return e.clearTimer.apply(null,arguments)},mouseleave:function(t){return e.startTimer.apply(null,arguments)}}},[n("template",{slot:"icon"},[e.iconImg?n("img",{staticClass:"m-message--icon",attrs:{src:e.iconImg}}):e.type?n("icon",{staticClass:"m-message--icon",attrs:{name:e.type}}):e._e()],1)],2)],1)])},Ge=[],ze=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"m-message"},[e.iconImg||e.$slots.icon?n("div",{staticClass:"m-message-icons",on:{click:e.handleClick}},[e.iconImg?n("img",{staticClass:"m-message--icon",attrs:{src:e.iconImg,alt:"Img"}}):e._t("icon")],2):e._e(),n("div",{staticClass:"m-message-content",on:{click:e.handleClick}},[e.title||e.$slots.title?n("div",{staticClass:"m-message--title"},[e._t("title",(function(){return[e._v(" "+e._s(e.title)+" ")]}))],2):e._e(),e.event&&e.chat?n("event",{attrs:{event:e.event,chat:e.chat,preview:!0}}):n("div",{staticClass:"m-message--body"},[e._t("message")],2)],1)])},Ve=[],He={name:"m-mmessage",props:{event:event,iconImg:String,closable:Boolean,closeHandler:Function,clickHandler:Function,chat:{},title:String,supportHTML:Boolean,isCollapsed:{type:Boolean,default:!0}},data(){return{visible:!0,collapsed:this.isCollapsed}},components:{event:()=>Promise.resolve().then(i.bind(null,"6167"))},methods:{triggerCollapse(){this.collapsed=!this.collapsed},handleClick:function(){"function"===typeof this.clickHandler&&this.clickHandler(this.close)},close(){this.visible=!1},handleClose(){"function"===typeof this.closeHandler?this.closeHandler(this.close):this.close()}},mounted(){}},We=He,Je=Object(f["a"])(We,ze,Ve,!1,null,null,null),Ye=Je.exports;const Qe={},Xe=function(e,t){Qe[e]=t},Ze={name:"Icon",props:{name:String,color:String},computed:{svg(){return Qe[this.name]}},render(e){const t=this.svg;if(!t)return console.warn(`The name of '${this.name}' could not be found.`),'<span class="m-svg-icon"></span>';this.color?this.color:t.fill&&t.fill;return'<span class={[\'m-svg-icon\', \'m-svg-icon--\' + this.name]}>\n        <svg\n          version="1.1"\n          xmlns="http://www.w3.org/2000/svg"\n          viewBox={svg.viewBox}\n          style={style}\n          class={svg.class}>\n          { svg.defs && <defs domPropsInnerHTML={svg.defs}></defs> }\n          { svg.path && <path fill="currentColor" d={svg.path} /> }\n          { svg.html && <g domPropsInnerHTML={svg.html}></g> }\n          {this.$slots.default}\n        </svg>\n      </span>'}};Ze.add=Xe;var et=Ze,tt={name:"info",fill:"#1CADF2",viewBox:"0 0 1024 1024",path:"M512,72C269,72,72,269,72,512s197,440,440,440s440-197,440-440S755,72,512,72z M581,673.9 c-33.2,49.9-67,88.3-123.8,88.3c-38.8-6.3-54.7-34.1-46.3-62.4L484,457.6c1.8-5.9-1.2-12.3-6.6-14.2c-5.4-1.9-15.9,5.1-25.1,15.1 l-44.2,53.2c-1.2-8.9-0.1-23.7-0.1-29.6c33.2-49.9,87.8-89.2,124.8-89.2c35.2,3.6,51.8,31.7,45.7,62.6l-73.6,243.3 c-1,5.5,1.9,11.1,6.9,12.8c5.4,1.9,16.8-5.1,26-15.1l44.2-53.1C583,652.3,581,667.9,581,673.9z M571.2,357.6 c-28,0-50.6-20.4-50.6-50.4c0-30,22.7-50.3,50.6-50.3c28,0,50.6,20.4,50.6,50.3C621.8,337.3,599.1,357.6,571.2,357.6z"},nt={name:"success",fill:"#17B77E",viewBox:"0 0 1024 1024",path:"M512,72C269,72,72,269,72,512s197,440,440,440s440-197,440-440S755,72,512,72L512,72z M758.9,374 c-48.5,48.6-81.2,76.9-172.3,186.8c-52.6,63.4-102.3,131.5-102.7,132L462.1,720c-4.6,6.1-13.5,6.8-19.1,1.6L267.9,558.9 c-17.8-16.5-18.8-44.4-2.3-62.2s44.4-18.8,62.2-2.3l104.9,97.5c5.5,5.1,14.1,4.5,18.9-1.3c16.2-20.1,38.4-44.5,62.4-68.6 c90.2-90.9,145.6-139.7,175.2-161.3c36-26.2,77.3-48.6,87.3-36.2C792,343.9,782.5,350.3,758.9,374L758.9,374z"},it={name:"error",fill:"#F56C6C",viewBox:"0 0 1024 1024",path:"M512,952C269,952,72,755,72,512S269,72,512,72s440,197,440,440S755,952,512,952z M579.7,512l101.6-101.6 c18.7-18.7,18.7-49,0-67.7c-18.7-18.7-49-18.7-67.7,0l0,0L512,444.3L410.4,342.7c-18.7-18.7-49-18.7-67.7,0s-18.7,49,0,67.7 L444.3,512L342.7,613.6c-18.7,18.7-18.7,49,0,67.7c18.7,18.7,49,18.7,67.7,0L512,579.7l101.6,101.6c18.7,18.7,49,18.7,67.7,0 c18.7-18.7,18.7-49,0-67.7L579.7,512z"},rt={name:"warning",fill:"#FFC603",viewBox:"0 0 1024 1024",path:"M512,952C269,952,72,755,72,512S269,72,512,72s440,197,440,440S755,952,512,952z M510,770.8 c30.4,0,55-24.6,55-55s-24.6-55-55-55s-55,24.6-55,55S479.6,770.8,510,770.8z M509.8,255.3c-39.3,0-71.2,31.9-71.2,71.2 c0,3.1,0.2,6.2,0.6,9.3L472.4,588c2.5,19.3,18.9,33.7,38.4,33.7c19.4,0,35.8-14.4,38.2-33.7l31.8-252.2c5-39.2-22.8-75-62-79.9 C515.9,255.5,512.8,255.3,509.8,255.3z"},ot={name:"loading",viewBox:"0 0 50 50",class:"m-loading-icon m-loading-wipe",defs:"<style>\n    .m-loading-icon {\n      stroke: #343640;\n      stroke-width: 3.5;\n      stroke-linecap: round;\n      background: none;\n      vertical-align: middle;\n    }\n    .m-loading-icon .m-loading-icon-bg-path{\n      fill: none;\n      stroke: #F2F2F2;\n    }\n    .m-loading-icon .m-loading-icon-active-path{\n      fill: none;\n      stroke: #20a0ff;\n      transform-origin: 50% 50%;\n    }\n    .m-loading-wipe .m-loading-icon-active-path{\n      stroke-dasharray: 90, 150;\n      stroke-dashoffset: 0;\n      animation: loading-wipe 1.5s ease-in-out infinite, loading-rotate 2s linear infinite;\n    }\n    .m-loading-default .m-loading-icon-active-path{\n      stroke-dasharray: 60, 150;\n      animation: loading-rotate 0.8s linear infinite;\n    }\n\n    @keyframes loading-rotate{\n      to{transform:rotate(1turn)}\n    }\n    @keyframes loading-wipe{\n      0%{\n        stroke-dasharray:1,200;\n        stroke-dashoffset:0;\n      }\n      50%{\n        stroke-dasharray:90,150;\n        stroke-dashoffset:-40px;\n      }\n      to{\n        stroke-dasharray:90,150;\n        stroke-dashoffset:-120px;\n      }\n    }\n  </style>",html:'<circle cx="25" cy="25" r="20" class="m-loading-icon-bg-path"></circle><circle cx="25" cy="25" r="20" class="m-loading-icon-active-path"></circle>'};et.add(tt.name,tt),et.add(nt.name,nt),et.add(it.name,it),et.add(rt.name,rt),et.add(ot.name,ot);var st=et,at={components:{Icon:st,mmessage:Ye},data(){return{show:!1,type:"info",iconImg:"",title:"",message:{},roomId:"",event:null,chat:null,duration:3e3,showClose:!1,isCollapsed:!1,width:"",className:"",wrapperClassName:"",supportHTML:!1,onClose:null,onClick:null,timer:null,closed:!1}},watch:{closed(e){e&&(this.show=!1,this.$el.addEventListener("animationend",this.destroyElement))}},methods:{close(){this.closed=!0,"function"===typeof this.onClose&&this.onClose(this)},click(){"function"===typeof this.onClick&&this.onClick(this)},clearTimer(){clearTimeout(this.timer)},startTimer(){this.duration>0&&"loading"!==this.type&&(this.timer=setTimeout(()=>{this.closed||this.close()},this.duration))},destroyElement(){this.$el.removeEventListener("transitionend",this.destroyElement),this.$destroy(!0),this.$el.parentNode.removeChild(this.$el)}},mounted(){"loading"!==this.type&&(this.startTimer(),this.duration<=0&&(this.showClose=!0))}},ct=at,lt=Object(f["a"])(ct,qe,Ge,!1,null,null,null),ut=lt.exports;const dt=r["default"].extend(ut),ht=[];let mt=1;const pt={},ft=function(e){let t=e.onClose,n=e.onClick;const i=e.position||"top-center",r=e.hasMask||!1,o=i+(r?"-mask":"");let s=pt[o];s||(s=pt[o]=document.createElement("div"),s.className=["m-message-container","is-"+i,r?"has-mask":""].filter((function(e){return!!e})).join(" "),document.body.appendChild(s)),e.zIndex&&(s.style.zIndex=e.zIndex);const a=mt++;e.onClose=function(){ft.close(a,t)},e.onClick=function(){ft.click(a,n,t)};const c=new dt({el:document.createElement("div"),data:e});return c.id=a,c.containerKey=o,0===i.indexOf("bottom")&&s.firstChild?s.insertBefore(c.$el,s.firstChild):s.appendChild(c.$el),c.show=!0,ht.push(c),c};ft.click=function(e,t,n){for(let i=0,r=ht.length;i<r;i++)if(e===ht[i].id){const{containerKey:e,hasMask:n}=ht[i];"function"===typeof t&&t(ht[i])}ft.close(e,n)},ft.close=function(e,t){for(let n=0,i=ht.length;n<i;n++)if(e===ht[n].id){const{containerKey:e,hasMask:i}=ht[n];"function"===typeof t&&t(ht[n]),ht[n]=null,ht.splice(n,1);const r=ht.findIndex((function(t){return t.containerKey===e}));i&&-1===r&&setTimeout((function(){pt[e].remove(),pt[e]=null}),300);break}setTimeout((function(){if(0===ht.length)for(let e in pt)pt[e]&&(pt[e].remove(),pt[e]=null)}),300)},ft.closeAll=function(){for(let e=ht.length-1;e>=0;e--)ht[e].close()};const gt=["info","success","error","warning","loading"];gt.forEach(e=>{ft[e]=function(t){return t="string"===typeof t?{message:t}:t,ft({...t,type:e})}});var vt=ft;i("a45a");vt.install=function(e,t){t&&t.name?e.prototype["$"+t.name]=vt:e.prototype.$message=vt};var yt=vt,_t=(i("2e4b"),i("0086")),bt=i.n(_t),Et=i("03a5"),St=i.n(Et),wt=i("f206"),Ct=i.n(wt),kt=i("6167"),Tt=(i("c5c5"),i("ade3")),It=(i("907a"),i("3c5d"),{});class Rt{constructor(e,t){t||(t={}),this.core=e}tetatetchat(e){if(!e)return!1;if("undefined"!=typeof e.tetatet)return e.tetatet;var t=this.core.mtrx.chatUsersInfo(e.roomId),n=!1;return 2==t.length&&(n=e.name=="#"+this.tetatetid(t[0],t[1])),t.length>1&&(e.tetatet=n),n}tetatetid(e,t){var n=2;if(e.id==t.id)return null;var i=parseInt(e.id,16)*parseInt(t.id,16)*n;if(It[i])return It[i];var r=he["a"].sha224(i.toString()).toString("hex");return It[i]=r,r}unknowngroupusers(e){return e&&"invite"===e._selfMembership&&!e.summary.members&&!this.tetatetchat(this.m_chat)}usersFromChats(e){var t={};return _.each(e,e=>{t[e.roomId]=_.map(_.uniq([].concat(_.toArray(e.currentState.members),e.summary.members||[]),e=>e.userId),(function(e){return{userId:he["a"].getmatrixid(e.userId),membership:e.membership,powerLevel:e.powerLevel}}))}),t}prepareChat(e){return this.usersInfoForChatsStore([e]).then(()=>this.core.pcrypto.addroom(e))}fillContacts(e){return e=_.filter(e,e=>"join"==e._selfMembership&&57==e.name.length),this.usersInfoForChatsStore(e).then(e=>{this.core.store.commit("SET_CONTACTS_FROM_MATRIX",_.filter(e,e=>!this.core.user.userinfo||e.id!==this.core.user.userinfo.id))})}usersInfoForChatsStore(e,t){return this.usersInfoForChats(e,t).then(t=>(this.core.store.commit("SET_CHATS_USERS",this.usersFromChats(e)),Promise.resolve(t))).catch(e=>Promise.resolve())}allchatmembers(e,t,n){var i=[],r=[];if(n)r=_.map(e,e=>"invite"!==e._selfMembership||e.summary.members&&!t||e.summary.membersloading?Promise.resolve():(e.summary.membersloading=!0,e._loadMembersFromServer().then(t=>(e.summary.membersloading=!1,e.summary.members=_.map(t,e=>({name:he["a"].getmatrixid(e.state_key),membership:e.content.membership,user:e,userId:e.state_key,powerLevel:e.content.powerLevel||0})),"invite"===e._selfMembership&&this.core.user.userinfo&&(_.find(e.summary.members,e=>e.userId==this.core.user.matrixId(this.core.user.userinfo.id))||e.summary.members.push({name:this.core.user.userinfo.id,membership:"invite",user:this.core.user.userinfo,userId:this.core.user.matrixId(this.core.user.userinfo.id),powerLevel:0})),Promise.resolve())).catch(t=>(e.summary.membersloading=!1,Promise.resolve()))));return Promise.all(r).then(t=>(_.each(e,e=>{i=i.concat(_.toArray(e.currentState.members),e.summary.members||[])}),i=_.uniq(i,(function(e){return e.userId})),Promise.resolve(i)))}usersInfoForChats(e,t){return this.allchatmembers(e,t).then(e=>this.usersInfo(e,t))}usersInfoById(e){var t=[he["a"].getmatrixid(e)];return this.core.user.usersInfo(t,!1).then(e=>Promise.resolve(e[0]))}usersInfo(e,t){var n=_.map(e,(function(e){return he["a"].getmatrixid(e.userId)}));return n=_.uniq(n),this.core.user.usersInfo(n,!1,t)}groupId(e){let t=[],n=[];e.forEach(e=>{n.push(this.core.user.matrixId(e.id))}),e.forEach((function(e){let n=parseInt(e.id,16);t.push(n)}));const i=t.reduce((e,t)=>e*t,1),r=he["a"].makeid(i);let o=he["a"].sha224(r.toString()).toString("hex");return{hash:o,idForInviting:n}}groupIdLight(e){let t=[],n=[];var i=[null];window.chatinvitedomains&&(i=[].concat(i,window.chatinvitedomains)),_.each(i,t=>{_.each(e,e=>{n.push(this.core.user.matrixId(e,t))})}),_.each(e,e=>{let n=parseInt(e,16);t.push(n)});const r=t.reduce((e,t)=>e*t,1),o=he["a"].makeid(r);let s=he["a"].sha224(o.toString()).toString("hex");return{hash:s,idForInviting:n}}chatIsPublic(e){var t=e.currentState.getStateEvents("m.room.join_rules");return!!_.find(t,e=>"public"==he["a"].deep(e,"event.content.join_rule"))}}var Pt=Rt,Ot=i("5059"),xt=i("a5bb"),Mt=i("4328"),At=i.n(Mt),Nt=i("21a6"),Dt=i.n(Nt),jt=i("6129");const Ut=i("0a00");var Lt=i("bc3a");class $t{constructor(e,t){Object(Tt["a"])(this,"fastsync",(function(){var e=this.client.getSyncState();if("PREPARED"!==e&&"SYNCING"!==e)return this.client.retryImmediately().catch(e=>{console.log("fastsyncerror",e)})})),t||(t={}),this.core=e,this.baseUrl=t.baseUrl,this.ready=!1,this.error=!1,this.kit=new Pt(this.core,t),this.sdk=Ut,this.sync="",this.nd=!1,this.version=4,this.dversion="2",this.backup={},this.db=null,this.customrequest=!0,this.devicekey="m8_device"}setCredentials(){var e=this;return Object(l["a"])((function*(){return e.core.user.matrixCredentials().then(t=>(e.credentials=t,Promise.resolve(t)))}))()}getDevices(){var t=localStorage[this.devicekey]||"";if(t)try{var n=JSON.parse(t);return n}catch(e){}return{}}setDevice(e,t){var n=this.getDevices();n[t]=e,localStorage[this.devicekey]=JSON.stringify(n),localStorage.device_=JSON.stringify(e)}getDevice(e){}request(t,n){var i=null,r=null;const o=Lt.CancelToken.source();var s={url:t.uri,params:t.qs,data:JSON.parse(t.body||"{}"),timeout:t.timeout,headers:t.headers,json:t.json,method:t.method,withCredentials:t.withCredentials,_matrix_opts:t,cancelToken:o.token,paramsSerializer:function(e){return At.a.stringify(e,t.qsStringifyOptions)}},a=Lt(s).then(e=>Promise.resolve(e)).catch(e=>(r=e,i=e.response,Promise.resolve(i))).then(t=>{var i=r;if(r)try{i=JSON.parse(he["a"].deep(t,"request.responseText")),r=new Ut.MatrixError(i)}catch(e){}n(r,t,he["a"].deep(t,"request.responseText")||"")});return a.abort=function(){o.cancel()},a}getFingerprint(){var e=this;return Object(l["a"])((function*(){var t=yield xt["a"].load(),n=yield t.get();return n.visitorId+e.dversion}))()}createMtrxClient(e){var t=Ut.createClient(e);return t.getProfileInfo=function(){return Promise.resolve({avatar_url:"",displayname:"test"})},t}getClient(){var t=this;return Object(l["a"])((function*(){yield t.setCredentials();var n={baseUrl:t.baseUrl},i={baseUrl:t.baseUrl};t.customrequest&&(i.request=t.request);var r=t.createMtrxClient(i);try{var o=yield r.login("m.login.password",{user:t.credentials.username,password:t.credentials.password})}catch(e){if(e&&e.indexOf&&e.indexOf("M_USER_DEACTIVATED")>-1)return t.error="M_USER_DEACTIVATED",null;if(!(yield r.isUsernameAvailable(t.credentials.username)))throw"Signup error, username is not available: "+e;o=yield r.register(t.credentials.username,t.credentials.password,null,{type:"m.login.dummy"})}localStorage.accessToken=o.access_token;var s=new Ut.IndexedDBStore({indexedDB:window.indexedDB,dbName:"matrix-js-sdk:"+t.credentials.username});yield s.startup(),Object.assign(n,{userId:o.user_id,accessToken:o.access_token,unstableClientRelationAggregation:!0,timelineSupport:!0,store:s}),t.customrequest&&(n.request=t.request);var a=t.createMtrxClient(n);return window.client=a,window.core=t.core,yield a.startClient({pollTimeout:6e4,resolveInvitesToProfiles:!0}),t.access=n,t.client=a,a}))()}clearstorage(e){var t=Object.keys(localStorage),n=t.length;while(n--)t[n]&&0==t[n].indexOf(e)&&localStorage.removeItem(t[n])}clearstore(){var e=Number(localStorage.matrixversion||"0");if(e<this.version){this.clearstorage("crypto."),this.clearstorage("session.");var t=["","2","3","4","5","6","8"];_.each(t,(function(e){delete localStorage["m"+e+"_device"]}))}localStorage.matrixversion=this.version}createClient(){var t=this;return Object(l["a"])((function*(){try{t.client=yield t.getClient(),t.store=t.client.store,t.ready=!0}catch(e){t.error=e}return!0}))()}wait(){return he["a"].pretry(()=>this.ready).then(()=>this.error?Promise.reject(this.error):Promise.resolve())}waitchats(){return he["a"].pretry(()=>this.chatsready).then(()=>this.error?Promise.reject(this.error):Promise.resolve())}me(e){var t;return he["a"].getmatrixid(e)==(null===(t=this.core.user.userinfo)||void 0===t?void 0:t.id)}reciepts(e){var t=null;return he["a"].pretry(()=>{var n=this.core.mtrx.store.rooms;return t=n[e.getRoomId()],t}).then(()=>t.getReceiptsForEvent(e))}storeFileLocal(e,t){return t.arrayBuffer().then(n=>{const i=new Blob([new Uint8Array(n)],{type:t.type});return window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.storage&&window.cordova?window.POCKETNETINSTANCE.storage.saveFile(e,i):this.db?this.db.set(e,i):void 0})}download(e){var t=()=>he["a"].fetchLocal(e).then(t=>(window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.storage&&window.cordova?window.POCKETNETINSTANCE.storage.saveFile(e,t.data):this.db&&this.db.set(e,t.data),Promise.resolve(t.data)));return window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.storage&&window.cordova?window.POCKETNETINSTANCE.storage.loadFile(e).then(e=>Promise.resolve(e),e=>t()):this.db?this.db.get(e).then(e=>Promise.resolve(e)).catch(()=>t()):t()}customRoomType(e){var t,n=this.core.mtrx.client.getRoom(e);if(!n)return null;var i=n.currentState.getStateEvents("m.room.custom","")||{};return null===(t=i.event)||void 0===t?void 0:t.content.type}isReaded(e,t){return this.reciepts(e).then(e=>Promise.resolve(_.find(e,e=>{var n=this.me(e.userId);return"m.read"==e.type&&(t&&n||!n&&!t)})))}initEvents(){let e=this.core.mtrx.client.credentials.userId;this.client.on("RoomMember.membership",(t,n)=>{this.chatsready&&("invite"!==n.membership&&"join"!==n.membership||t.getSender()===e||this.core.notifier.event(t))}),this.client.on("Room.timeline",(t,n)=>{if(this.chatsready&&t.event.content&&("m.file"===t.event.content.msgtype&&(t.event.content.pbody=JSON.parse(t.event.content.body)),t.getSender()!==e)){var i=this.core.mtrx.client.getRoom(t.event.room_id);if(t.event.content["m.relates_to"]&&"m.replace"==t.event.content["m.relates_to"]["rel_type"])return!1;i&&this.core.pcrypto.rooms[t.event.room_id]&&this.core.notifier.event(t,i)}}),this.client.on("RoomMember.typing",(e,t)=>{this.core.store.dispatch("TYPING_EVENT",t)}),this.client.on("sync",(e,t,n)=>{"PREPARED"===e&&this.setready(),this.core.store.dispatch("FETCH_CHATS").then(e=>{this.core.store.dispatch("FETCH_EVENTS"),this.core.store.commit("ALL_NOTIFICATIONS_COUNT",this.client.getRooms())})})}setready(){this.chatsready||(this.chatsready=!0,this.core.store.commit("SET_CHATS_READY",!0))}initdb(){return Object(jt["a"])("files",1).then(e=>(this.db=e,Promise.resolve())).catch(()=>Promise.resolve())}init(){return this.createClient().then(()=>this.error?Promise.reject(this.error):this.initdb()).then(()=>(this.initEvents(),Promise.resolve()))}deactivateAccount(){return this.client?this.client.deactivateAccount(this.credentials,!0):Promise.reject("noclient")}destroy(){this.client&&(window.cordova&&this.deletePusher(),this.client.stopClient()),this.chatsready=!1,this.ready=!1,this.error=!1}deletePusher(){var e;if(window.cordova&&(localStorage&&(e=localStorage.getItem("fcmtoken5")),e&&this.client.setPusher)){var t="pocketnet",n={app_display_name:t,app_id:t+window.cordova.platformId,data:{url:this.core.mtrx.baseUrl+"/_matrix/push/v1/notify",default_payload:{aps:{sound:"default","content-available":1}}},device_display_name:window.device.manufacturer+" "+window.device.model,kind:null,lang:localStorage.getItem("loc")||"en",pushkey:e};this.core.mtrx.client.setPusher(n).then(()=>{localStorage.removeItem("fcmtoken5")},e=>{console.log(e)})}}uploadContent(e,t){return this.client.uploadContent(e).then(e=>Promise.resolve(this.core.mtrx.client.mxcUrlToHttp(e))).then(n=>t?this.storeFileLocal(n,e).then(()=>Promise.resolve(n)).catch(e=>Promise.resolve(n)):Promise.resolve())}originalEvent(t,n){var i=n._timelineSet.getRelationsForEvent(e.event.event_id,"m.reference","m.room.message");if(i){var r=i.getRelations();return r[0]}}clearEventId(e){var t=null;return e.event.content["m.relates_to"]&&"m.replace"==e.event.content["m.relates_to"]["rel_type"]&&(t=e.event.content["m.relates_to"]["event_id"]),t||e.getId()}textEvent(e,t){return e.pcrypto.canBeEncrypt()?e.pcrypto.encryptEvent(t):Promise.resolve(this.sdk.ContentHelpers.makeTextMessage(t))}testmessage(e){return this.client.sendMessage(e.room,{block:1,body:e.message,msgtype:"m.text"})}sendtext(e,t,n){let{relation:i,from:r}=n;return this.textEvent(e,t).then(t=>(i&&(t["m.relates_to"]={rel_type:i.type,event_id:this.clearEventId(i.event)}),r&&(t["from"]=r),e.pcrypto.canBeEncrypt()?this.client.sendEvent(e.roomId,"m.room.message",t):this.client.sendMessage(e.roomId,t)))}sendFile(e,t,n,i,r){let{relation:o,from:s}=i;n||(n={});var a={};a.name=t.name,a.size=t.size;var c=(()=>Promise.resolve(t))(),l=null;return e.pcrypto.canBeEncrypt()&&!r&&(c=e.pcrypto.encryptFile(t).then(e=>(a.secrets=e.secrets,Promise.resolve(e.file)))),c.then(e=>(l=this.client.uploadContent(e),l.abort&&(n.abort=l.abort),l)).then(e=>n.aborted?Promise.reject("aborted"):Promise.resolve(this.client.mxcUrlToHttp(e))).then(t=>{a.url=t;let n=JSON.stringify(a);var i={body:n,msgtype:"m.file"};return o&&(i["m.relates_to"]={rel_type:o.type,event_id:this.clearEventId(o.event)}),s&&(i["from"]=s),this.client.sendMessage(e.roomId,i)})}sendImageBase64(e,t,n,i){var r="toFileFetch";return t.indexOf("data:")>-1&&(r="toFile"),he["a"].Base64[r](t).then(r=>this.sendImage(e,t,r,n,i))}sendAudioBase64(e,t,n,i){var r="toFileFetch";return t.indexOf("data:")>-1&&(r="toFile"),he["a"].Base64[r](t).then(r=>this.sendAudio(e,t,r,n,i))}sendImage(e,t,n,i){let{relation:r,from:o}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!n)return this.sendImageBase64(e,t,i);var s=new Ot["a"],a={};return i||(i={}),s.wh(t).then(t=>(a=t,o&&(a.from=o),e.pcrypto.canBeEncrypt()?e.pcrypto.encryptFile(n).then(e=>(a.secrets=e.secrets,Promise.resolve(e.file))):Promise.resolve(n))).then(e=>{let t=this.core.mtrx.uploadContent(e);return t.abort&&(i.abort=t.abort),Promise.resolve(e)}).then(e=>{var t=this.core.mtrx.uploadContent(e,!0);return t.abort&&(i.abort=t.abort),t}).then(t=>i.aborted?Promise.reject("aborted"):(i.event&&i.event.event&&(a["m.relates_to"]={rel_type:i.event.type,event_id:this.clearEventId(i.event.event)}),this.client.sendImageMessage(e.roomId,t,a,"Image")))}sendAudio(e,t,n,i){let{relation:r,from:o}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!n)return this.sendAudioBase64(e,t,i);let s={};return s.from=o,i.event&&i.event.event&&(s["m.relates_to"]={rel_type:i.event.type,event_id:this.clearEventId(i.event.event)}),new Promise(t=>{if(e.pcrypto.canBeEncrypt())return e.pcrypto.encryptFile(n).then(e=>(s.secrets=e.secrets,t(e.file)));t(n)}).then(e=>{let t=this.core.mtrx.uploadContent(e,!0);return t.abort&&(i.abort=t.abort),t}).then(t=>i.aborted?Promise.reject("aborted"):this.client.sendAudioMessage(e.roomId,t,s,"Audio")).then(e=>{let t=this.core.mtrx.uploadContent(e);return t.abort&&(i.abort=t.abort),t}).then(t=>i.aborted?Promise.reject("aborted"):(console.log("info",s),this.client.sendAudioMessage(e.roomId,t,s,"Audio")))}getFile(t,n){var i=this;return Object(l["a"])((function*(){try{var r=yield t.pcrypto.decryptKey(n.event);n.event.decryptKey=r}catch(e){return Promise.reject(e)}return i.download(n.event.content.pbody.url).then(e=>t.pcrypto.decryptFile(e,r)).then(e=>Promise.resolve({file:e,name:n.event.content.pbody.name})).catch(e=>Promise.reject(e))}))()}downloadFile(e,t){var n=this;return Object(l["a"])((function*(){return n.getFile(e,t).then(e=>window.cordova&&he["a"].saveFileCordova?new Promise((t,n)=>{he["a"].saveFileCordova(e.file,e.name,(function(e,i){i&&console.error(i),i?n("unable"):t()}))}):Dt.a.saveAs(e.file,e.name)).catch(e=>(console.error(e),Promise.reject(e)))}))()}getAudioUnencrypt(e,t){var n=this;return Object(l["a"])((function*(){return t.event.content.audioData?Promise.resolve(t.event.content.audioData):n.download(t.event.content.url,!0).then(e=>he["a"].readFile(e)).then(e=>(t.event.content.audioData=e,Promise.resolve(e)))}))()}getAudio(t,n){var i=this;return Object(l["a"])((function*(){if(n.event.decryptedAudio)return Promise.resolve(n.event.decryptedAudio);try{var r=yield t.pcrypto.decryptKey(n.event);return n.event.decryptKey=r,i.download(n.event.content.url,!0).then(e=>t.pcrypto.decryptFile(e,r)).then(e=>he["a"].readFile(e)).then(e=>(n.event.decryptedAudio=e,Promise.resolve(n.event.decryptedAudio))).catch(e=>Promise.reject(e))}catch(e){return Promise.reject(e)}}))()}getImage(t,n){var i=this;return Object(l["a"])((function*(){if(n.event.decryptedImage)return Promise.resolve(n.event.decryptedImage);try{var r=yield t.pcrypto.decryptKey(n.event);return n.event.decryptKey=r,i.download(n.event.content.url,!0).then(e=>t.pcrypto.decryptFile(e,r)).then(e=>he["a"].Base64.fromFile(e)).then(e=>(n.event.decryptedImage=e.replace("data:file;","data:image/jpeg;"),Promise.resolve(n.event.decryptedImage))).catch(e=>Promise.reject(e))}catch(e){return Promise.reject(e)}}))()}shareInChat(e,t){var n=this.client.getRoom(e);return this.core.mtrx.kit.prepareChat(n).then(e=>{var i=[];return _.each(t.images,e=>{var r=this.sendImageBase64(n,e,{},{from:t.from});i.push(r)}),_.each(t.files,e=>{i.push(this.sendFile(n,e,{},{from:t.from}))}),_.each(t.urls,e=>{i.push(this.sendtext(n,e,{from:t.from}))}),_.each(t.messages,e=>{i.push(this.sendtext(n,e,{from:t.from}))}),_.each(t.audio,e=>{var r="data:audio/mpeg;base64,"+he["a"]._arrayBufferToBase64(e);i.push(this.sendAudioBase64(n,r,{},{from:t.from}))}),Promise.all(i)})}opencontact(e){this.core.store.commit("setmodal",{caption:e.name,type:"contact",data:{contact:e}})}complain(e,t){this.core.store.commit("setmodal",{caption:e,type:"complain",data:t})}blockeduser(e){if(this.core.mtrx.client)return this.core.mtrx.client.isUserIgnored(this.core.user.matrixId(e))}blockUser(e){if(e=this.core.user.matrixId(e),this.client.isUserIgnored(e))return Promise.resolve();var t=this.client.getIgnoredUsers();return t.push(e),this.client.setIgnoredUsers(t).then(e=>Promise.resolve(e))}unblockUser(e){if(e=this.core.user.matrixId(e),!this.client.isUserIgnored(e))return Promise.resolve();var t=this.client.getIgnoredUsers();return t=_.filter(t,(function(t){return e!=t})),this.client.setIgnoredUsers(t).then(e=>Promise.resolve(e))}chatUsersInfo(e,t){t||(t="chatUsers");var n=this.core.store.state.users;return _.filter(_.map(this[t](e),e=>n[e.userId]),(function(e){return e}))}chatUsers(e){return this.core.store.state.chatusers[e]||[]}anotherChatUsers(e){return _.filter(this.chatUsers(e),e=>e.userId!=this.core.user.userinfo.id)}}var Bt=$t;class Ft{constructor(e,t){Object(Tt["a"])(this,"key","showednotifications"),Object(Tt["a"])(this,"showed",{}),Object(Tt["a"])(this,"show",(function(e,t){if("function"!=typeof t){var n=t;t=()=>{this.core.vm.$router.push(n).catch(e=>{}),this.core.apptochat&&this.core.apptochat()}}var i="bottom-right";this.core.vm.$store.state.mobile&&(i="top-left"),this.core.vm.$message({event:e.event,title:e.title,message:e.message,roomId:e.roomId,iconImg:e.icon||null,onClick:t,zIndex:999,supportHTML:!0,wrapperClassName:"notificationWrapper",position:i,type:"info",chat:e.chat,duration:5e3})})),t||(t={}),this.core=e,this.showed=JSON.parse(localStorage[this.key]||"{}"),this.ion=null,"undefined"!=typeof ion&&(this.ion=ion)}addshowed(e){this.showed=JSON.parse(localStorage[this.key]||"{}"),this.showed[e]=!0,localStorage[this.key]=JSON.stringify(this.showed)}clearshowed(){this.showed={},localStorage[this.key]=JSON.stringify(this.showed)}playsound(){window.Media&&window.cordova&&window.cordova.file&&window.cordova.file.applicationDirectory||window.ion&&ion.sound.play("glass")}notifySoundOrAction(){var e=localStorage["lastsounddate"]||null;e&&(e=new Date(e),he["a"].date.addseconds(e,10)>new Date)||(localStorage["lastsounddate"]=new Date,window.cordova&&window.POCKETNETINSTANCE?window.POCKETNETINSTANCE.mobile.vibration.small():this.playsound())}decrypt(e,t){return this.core.mtrx.kit.prepareChat(t).then(n=>e.event.decrypted?Promise.resolve():t.pcrypto.decryptEvent(e.event)).catch(e=>Promise.resolve())}message(e,t,n){var i=this.core.vm.$store.state;if(!this.showed[e.event.event_id]){this.addshowed(e.event.event_id);var r=he["a"].deep(this,"core.external.clbks.NOTIFICATION")||{},o="",s=he["a"].deep(e,"event.type");["m.room.member"].indexOf(s)>-1&&(o="invite"),["m.room.message"].indexOf(s)>-1&&(o="message"),["m.room.name"].indexOf(s)>-1&&(o=""),["m.room.power_levels"].indexOf(s)>-1&&(o="moder"),["m.room.redaction"].indexOf(s)>-1&&(o="redaction"),"m.encrypted"==he["a"].deep(e,"event.content.msgtype")&&(o="encrypted");var a=()=>{var s={title:t.name,event:e,message:"m.encrypted"==e.event.content.type?"***":e.event.content.body,roomId:e.event.room_id,icon:t.image,chat:n,ctype:o};_.each(r,(function(e){e(s)})),(i.currentRoom!==e.event.room_id||this.core.hiddenInParent)&&(this.notifySoundOrAction(),this.show(s,"/chat?id="+e.event.room_id))};"encrypted"==o?this.decrypt(e,n).then(a):a()}}event(e,t){let n=this.core.mtrx.client.getPushActionsForEvent(e);if(n.notify){var i=moment(moment.utc(e.event.origin_server_ts).toDate()).local().toDate(),r=he["a"].date.addseconds(i,10)>moment().toDate();r&&this.core.mtrx.isReaded(e,!0).then(n=>{n||!this.core.mtrx.me(e.getSender())&&e.getSender()&&e.getSender()!==this.core.mtrx.client.credentials.userId&&this.core.user.usersInfo([he["a"].getmatrixid(e.getSender())]).then(n=>{n&&n[0]&&this.message(e,n[0],t)})})}}}var Kt=Ft,qt=i("e7f6"),Gt=i("6967"),zt=i.n(Gt),Vt=i("bc3a"),{error:Ht,byError:Wt}=i("d854"),Jt=(Vt=function(){var t=["data.result"],n=["data.error"];function i(e){return r.apply(this,arguments)}function r(){return r=Object(l["a"])((function*(i){let{to:r,data:o}=i;o||(o={}),_.each(o,(e,t)=>{(_.isArray(e)||_.isObject(e))&&(o[t]=JSON.stringify(e))});var s=null;try{s=yield zt()({method:"post",headers:{"content-type":"application/x-www-form-urlencoded"},url:r,data:At.a.stringify(o),timeout:35e3})}catch(e){s=e.response}if(!s)return Promise.reject("noresponse");var a=_.find(n,(function(e){return he["a"].deep(s.data,e)}));if(a)return Promise.reject(Wt(he["a"].deep(s.data,a)));var c=_.find(t,(function(e){return he["a"].deep(s.data,e)}));return c?Promise.resolve(he["a"].deep(s.data,c)):Promise.reject("error")})),r.apply(this,arguments)}return{axios:i}},Vt),{error:Yt}=i("d854"),Qt=function(e){var t=this,n=new Jt,i={},r={},o={},s={pocketnet:null},a=function(){return Promise.resolve()},c=function(e){return o[e.storage]?Promise.resolve(o[e.storage]):Object(jt["a"])(e.storage,e.version||1,e.time).then(t=>(o[e.storage]=t,Promise.resolve(t)))},l=function(e,t,n,o,s){_.isArray(e)||(e=[e]);var l={};return n||(n=t),i[t]||(i[t]={}),r[t]||(r[t]={}),(s?c(s):a()).then(r=>r?Promise.all(_.map(e,e=>i[t][e]?Promise.resolve():r.get(e).then(e=>(i[t][e[n]]=e,Promise.resolve())).catch(e=>Promise.resolve()))):Promise.resolve()).then(u=>{var d=_.uniq(_.filter(e,(function(e){return o||!i[t][e]||i[t][e].nocache}))),h=_.filter(d,(function(e){if(!r[t][e])return r[t][e]=!0,!0;l[e]=!0})),m=function(o,u){return(s?c(s):a()).then(e=>e?Promise.all(_.map(o,t=>t[n]?e.set(t[n],t):Promise.resolve())):Promise.resolve()).then(()=>{_.each(o,(function(e){e[n]&&(i[t][e[n]]=e)})),_.each(u,(function(e){delete r[t][e],delete l[e],i[t][e]||(i[t][e]="error")}));var s={};return he["a"].pretry(()=>(_.each(e,(function(e){i[t][e]&&("error"!=i[t][e]&&(s[e]=i[t][e]),delete r[t][e],delete l[e])})),0==_.toArray(l).length)).then(()=>Promise.resolve(s))})};return Promise.resolve({id:h,handle:m})})},u=function(){return e&&e.waitonline?e.waitonline():Promise.resolve()},d=function(e,t,n,i,r){return l(e,t,n,i,r).then(e=>e.id.length?Promise.reject(e):e.handle([]))},h=function(e,t){return u().then(()=>(e||(e={}),n.axios({to:t,data:e}).then(e=>Promise.resolve(e)).catch(n=>"noresponse"==n?new Promise((n,i)=>{setTimeout((function(){h(e,t).then(e=>n(e)).catch(e=>i(e))}),3e3)}):Promise.reject(n))))};return t.clearCache=function(e){e?delete i[e]:i={}},t.pocketnet={common:(t,n)=>(t||(t={}),s.pocketnet||(s.pocketnet=he["a"].deep(window,"POCKETNETINSTANCE.api")),s.pocketnet||"undefined"==typeof Api||(s.pocketnet=new Api(e)),s.pocketnet?s.pocketnet.initIf().then(()=>s.pocketnet.wait.ready("use",3e3)).then(e=>s.pocketnet.rpc(n,t.parameters)).catch(e=>({error:e})):(t.method=n,t.node="185.148.147.15",t.parameters=he["a"].hexEncode(JSON.stringify(t.parameters||"")),h(t,servers.pocketnet+"/rpc-"+(n||"common")))),userState:e=>{_.isArray(e)||(e=[e]);var n=[e.join(",")];return t.pocketnet.common({parameters:n},"getuserstate")},userStateMe:e=>{var n=he["a"].deep(window,"POCKETNETINSTANCE.platform.sdk.ustate.storage."+e);return n?Promise.resolve(n):t.pocketnet.userState(e)},userInfoCached:(e,n,i)=>{var r=[];return n||(r=_.filter(_.map(e,e=>he["a"].deep(window,"POCKETNETINSTANCE.platform.sdk.userscl.storage."+e)||null),e=>e),e=_.filter(e,e=>!_.find(r,t=>t.address==e))),t.pocketnet.userInfo(e,n,i).then(e=>(e=_.toArray(e),_.each(r,t=>{e.push(t)}),Promise.resolve(e)))},search:e=>{var n=[e,"users"];return t.pocketnet.common({parameters:n},"searchusers").then(e=>Promise.resolve(e||[]))},fullUserInfo:e=>{var n=[e];return t.pocketnet.common({parameters:n},"getuserprofile")},userInfo:(e,n,i)=>e.length?i?t.pocketnet.fullUserInfo(e):d(e,"pocketnet_userInfo","address",n,{storage:"userInfo",time:86400}).catch(e=>{if(!e||!e.id)return Promise.reject(e);var n=[e.id,"1"];return t.pocketnet.common({parameters:n},"getuserprofile").then(t=>e.handle(t,e.id))}):Promise.resolve([]),postInfo:e=>{var n=[[e.parameters]];return t.pocketnet.common({parameters:n},"getrawtransactionwithmessagebyid").then(e=>Promise.resolve(e))},pocketNetProfileAddress:e=>{var n=[[e.parameters]];return t.pocketnet.common({parameters:n},"getuseraddress").then(e=>Promise.resolve(e))},pocketNetProfileInfo:e=>{var n=[[e.parameters]];return t.pocketnet.common({parameters:n},"getuserprofile").then(e=>Promise.resolve(e))}},t},Xt=Qt,Zt=i("9c21"),en=i("ebaa"),tn=function(){var e=this;e.gettingmedia=!1;var t={ios:{audio:function(){return new Promise((e,t)=>{window.audioinput.checkMicrophonePermission((function(n){n?e():window.audioinput.getMicrophonePermission((function(n,i){n?e():t("permissions")}))}))})},video:function(){return new Promise((e,t)=>{var n=!0,i=!0;cordova.plugins.iosrtc.requestPermission(n,i,(function(n){n?e():t("permissions")}))})}},audio:function(){var e=window.cordova.plugins.permissions;return new Promise((t,n)=>{if(e){var i=function(){e.requestPermission(e.RECORD_AUDIO,e=>{e.hasPermission?t():n("permissions")},e=>{console.error(e),n("permissions")})};e.checkPermission(e.RECORD_AUDIO,e=>{e.hasPermission?t():i()},e=>{console.error(e),i()})}else n("permissions")})},video:function(){var e=window.cordova.plugins.permissions;return new Promise((t,n)=>{e?e.hasPermission(e.CAMERA,i=>{i.hasPermission?t():e.requestPermission(e.CAMERA,()=>{t()},()=>{n("permissions")})}):n("permissions")})}},n=function(e){var n=function(e,t){return t?e():Promise.resolve()};if(window.cordova&&window.device){var i=he["a"].isios();return n(i?t.ios.audio:t.audio,e.audio).then(()=>n(i?t.ios.video:t.video,e.video)).catch(e=>(console.error("E",e),Promise.reject(e)))}return Promise.resolve()},i=function(e){return new Promise((t,i)=>{n(e).then(()=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e).then(t).catch(i):(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)(e,t,i)}).catch(i)})};e.get=function(e){return i(e)},e.permissions=n},nn=tn,rn=i("1eaa"),on=i("5165");rn["a"].encoder=on["a"],rn["a"].prototype.mimeType="audio/mpeg";class sn{constructor(e,t){Object(Tt["a"])(this,"hideOptimization",(function(e){this.store.commit("hideOptimization",e)})),Object(Tt["a"])(this,"hideInParent",(function(e){this.hiddenInParent=e,this.store.commit("hiddenInParent",e)})),Object(Tt["a"])(this,"canback",(function(){return!this.store.state.gallery})),Object(Tt["a"])(this,"update",(function(e){let{block:t}=e;this.pcrypto.set.block(t)})),Object(Tt["a"])(this,"logerror",(function(e,t){window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.Logger.error({err:e,payload:t,code:402})})),Object(Tt["a"])(this,"destroy",(function(){this.store.commit("clearall"),this.removeEvents(),"chats"!=!this.vm.$route.name&&this.vm.$router.push("/chats").catch(e=>{}),this.user.destroy(),this.mtrx.destroy(),this.pcrypto.destroy(),window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.platform.matrixchat.unlink(this),this.vm.$destroy()})),Object(Tt["a"])(this,"init",(function(){this.focusListener.init(),this.onlineListener.init(),this.initEvents(),window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.platform.matrixchat.link(this)})),Object(Tt["a"])(this,"setUnauthorized",(function(e){this.unauthorized=e,this.store.commit("SET_UNAUTHORIZED",e)})),Object(Tt["a"])(this,"initWithUserBase",(function(){return this.loading=!0,this.user.checkCredentials().then(e=>this.user.userInfo()).then(e=>e?e.deleted?Promise.reject("deleted"):this.pcrypto.prepare():Promise.reject("unknown")).then(e=>this.mtrx.init()).then(e=>(this.loading=!1,this.setUnauthorized(null),this.pcrypto.helpers.checkuser(),he["a"].deep(this.user,"userinfo.name")&&this.mtrx.client.setDisplayName(he["a"].deep(this.user,"userinfo.name")),Promise.resolve())).catch(e=>(console.log("E",e),this.loading=!1,"unauthorized"!=e&&"unknown"!=e&&"deleted"!=e||this.setUnauthorized(e),Promise.resolve()))})),Object(Tt["a"])(this,"initWithUser",(function(e){return this.user.setCredentials(e),this.initWithUserBase().then(()=>this.user.initKeysProcess()).catch(e=>Promise.resolve())})),Object(Tt["a"])(this,"waitonline",(function(){return this.online?Promise.resolve():new Promise((e,t)=>{he["a"].retry(()=>this.online,(function(){e()}),5)})})),Object(Tt["a"])(this,"removeEvents",(function(){delete this.focusListener.clbks.resume.core,delete this.focusListener.clbks.pause.core,delete this.onlineListener.clbks.online.core,delete this.onlineListener.clbks.offline.core})),Object(Tt["a"])(this,"initEvents",(function(){this.focusListener.clbks.resume.core=e=>{this.focus=this.focusListener.focus},this.focusListener.clbks.pause.core=()=>{this.focus=this.focusListener.focus},this.onlineListener.clbks.online.core=e=>{this.online=this.onlineListener.online},this.onlineListener.clbks.offline.core=()=>{this.online=this.onlineListener.online}})),Object(Tt["a"])(this,"externalLink",(function(e){this.external=e})),Object(Tt["a"])(this,"destroyExternalLink",(function(){this.external={}})),Object(Tt["a"])(this,"currentTime",(function(){var e=Math.floor((new Date).getTime()/1e3);return this.timeDifference&&(e+=this.timeDifference),e})),Object(Tt["a"])(this,"wait",(function(){return he["a"].pretry(()=>!this.loading).then(()=>Promise.resolve())})),t||(t={}),this.options={listofproxies:t.listofproxies},t.mtrx||(t.mtrx={}),t.mtrx.baseUrl="https://"+t.domain,"https://test.matrix.pocketnet.app"==t.mtrx.baseUrl?this.options.burn={v:"minutes",w:120,m:30,b:15}:this.options.burn={v:"days",w:7,m:2,b:1},this.apiHandlers={error:function(){},success:function(){}},this.domain=t.domain,this.vm=e,this.mtrx=new Bt(this,t.mtrx),this.user=new qt["a"](this,t.user||{}),this.notifier=new Kt(this,t.notifier||{}),this.pcrypto=new Zt["a"](this,t.pcrypto||{}),this.api=new Xt(this,t.servers),this.onlineListener=new en["a"].online(this),this.focusListener=new en["a"].focus(this),this.online=!0,this.focus=!0,this.store=e.$store,this.loading=!0,this.external={},this.hiddenInParent=!1,this.customRecorderConnected=!1,this.pcrypto.init(this.user),this.media=new nn,this.audioContext=null}joinRoom(e){return this.wait().then(()=>this.mtrx.wait()).then(()=>this.unauthorized?(this.store.commit("JOINROOM",e),Promise.reject(this.unauthorized)):Promise.resolve()).then(t=>(this.store.state.chatsMap[e]?this.vm.$router.push("/chat?id="+e).catch(e=>{}):(this.store.commit("JOINROOM",e),this.vm.$router.push("/publicPreview?id="+e).catch(e=>{})),Promise.resolve()))}connect(e){return this.wait().then(()=>this.mtrx.wait()).then(()=>this.unauthorized?(this.store.commit("CONNECT",he["a"].hexEncode(e)),Promise.reject(this.unauthorized)):this.user.usersInfo([e],!0)).then(t=>{var n=this.mtrx.kit.tetatetid(t[0],this.user.userinfo);return n?(this.store.state.chatsMap[n]?this.gotoRoute("/chat?id="+n):this.gotoRoute("/contact?id="+he["a"].hexEncode(e)),Promise.resolve()):Promise.reject("roomId")})}cancelshare(){return this.store.commit("SHARE",null),Promise.resolve()}share(e){return this.store.commit("SHARE",e),this.vm.$router.push("/chats").catch(e=>{}),Promise.resolve()}goto(e){this.cancelDefaultRoute=!0,this.mtrx.wait().then(()=>{this.vm.$router.push("/chat?id="+e).catch(e=>{})})}gotoRoute(e){this.cancelDefaultRoute=!0,this.mtrx.wait().then(()=>{this.vm.$router.push(e).catch(e=>{})})}updateUser(){return this.user.userInfo(!0).then(e=>{})}isactive(){return this.vm.$store.state.minimized&&this.vm.$store.state.active&&this.vm.$store.state.pocketnet}sitemessage(e){var t="bottom-right";this.vm.$store.state.mobile&&(t="top-left"),this.vm.$message({title:e,zIndex:999,supportHTML:!0,wrapperClassName:"notificationWrapper",position:t,type:"info",duration:2e3})}menu(e){this.store.commit("SET_MENU",e?{items:e.items,item:e.item,handler:e.handler}:null)}invitepnt(){var e=he["a"].deep(this,"user.userinfo.source");if(e)if(window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.platform)this.backtoapp&&this.backtoapp(),window.POCKETNETINSTANCE.platform.ui.socialshare("welcome?connect="+e.address,{sharing:{image:"",images:[e.i],title:this.vm.$i18n.t("caption.joinApp"),html:{body:this.vm.$i18n.t("caption.joinApp")+" "+this.vm.$i18n.t("caption.hasInvitedToJoin"),preview:this.vm.$i18n.t("caption.joinApp")+" "+this.vm.$i18n.t("caption.hasInvitedToJoin")},text:{body:this.vm.$i18n.t("caption.joinApp")+" "+this.vm.$i18n.t("caption.hasInvitedToJoin"),preview:this.vm.$i18n.t("caption.joinApp")+" "+this.vm.$i18n.t("caption.hasInvitedToJoin")}},embedding:{type:"connect",id:e.address}});else{var t="https://bastyon.com/welcome?connect="+e.address;he["a"].copytext(t),this.sitemessage("The link was copied successfully")}else this.sitemessage("The error was occuried")}convertAudioToBase64(e){return Object(l["a"])((function*(){const t=new FileReader;return t.readAsDataURL(e),new Promise(e=>{t.onloadend=()=>{e(t.result)}})}))()}initMediaRecorder(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.media.get({audio:!0}).then(e=>{let t=new rn["a"](e,{audioBitsPerSecond:32e3});return t}).catch((function(e){return Promise.reject(e)})):Promise.reject()}getAudioContext(){return this.audioContext&&"closed"!=this.audioContext.state?("suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioContext):(this.audioContext=new(window.AudioContext||window.webkitAudioContext)||null,he["a"].isios()&&window.unmute&&unmute(this.audioContext,!1,!1),this.audioContext)}}var an=sn,cn=i("e508"),ln=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active},attrs:{id:"preloader",platform:e.platform}},[e._m(0)])},un=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"variant "},[n("div",{staticClass:"iospreloadercenter"},[n("div",{staticClass:"spinner-eff spinner-eff-3"},[n("div",{staticClass:"circle circle-1"}),n("div",{staticClass:"circle circle-2"}),n("div",{staticClass:"circle circle-3"})])])])}],dn={name:"preloader",props:{},computed:Object(h["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active,platform:function(){return he["a"].deep(window,"device.platform")||"browser"}})},hn=dn,mn=(i("4578"),i("3f02"),Object(f["a"])(hn,ln,un,!1,null,"3e6353d6",null)),pn=mn.exports,fn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active},attrs:{id:"wai-fixedmessageicon"}},[n("div",{staticClass:"wrapper"},[n("div",{staticClass:"table"},[n("div",{staticClass:"cell"},[e.icon?n("div",{staticClass:"iconWrapper"},[n("sweetalert",{attrs:{icon:e.icon}})],1):e._e(),e.message?n("div",{staticClass:"message"},[n("div",[e._v(e._s(e.message))])]):e._e()])])])])},gn=[],vn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sa",style:e.cssVars},[e.isIcon("error")?n("div",{staticClass:"sa-error"},[e._m(0),n("div",{staticClass:"sa-error-placeholder"}),n("div",{staticClass:"sa-error-fix"})]):e.isIcon("warning")?n("div",{staticClass:"sa-warning"},[n("div",{staticClass:"sa-warning-body"}),n("div",{staticClass:"sa-warning-dot"})]):e.isIcon("info")?n("div",{staticClass:"sa-info"},[n("div",{staticClass:"sa-info-body"}),n("div",{staticClass:"sa-info-dot"})]):e.isIcon("loading")?n("div",{staticClass:"sa-loading"},[n("div",{staticClass:"sa-loading-body"})]):n("div",{staticClass:"sa-success"},[n("div",{staticClass:"sa-success-tip"}),n("div",{staticClass:"sa-success-long"}),n("div",{staticClass:"sa-success-placeholder"}),n("div",{staticClass:"sa-success-fix"})])])},yn=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sa-error-x"},[n("div",{staticClass:"sa-error-left"}),n("div",{staticClass:"sa-error-right"})])}],_n=i("5b1b"),bn=i.n(_n),En=i("6929"),Sn=i.n(En);const wn=["success","warning","error","info","loading"],Cn={success:"#007d09",warning:"#ff7800",error:"#ff007e",info:"#0600ff",loading:"#0600ff"};var kn={name:"sweetalert-icon",props:{icon:{type:String,default:"success",validator:e=>-1!==wn.indexOf(e)},color:{type:String,validator:bn.a}},computed:{cssVars(){const e=bn()(this.color)?this.color:Cn[this.icon];return{"--icon-color":e,"--icon-color-alpha":Sn()(e).alpha(.25)}}},methods:{isIcon(e){return e===this.icon}}},Tn=kn,In=(i("826f"),Object(f["a"])(Tn,vn,yn,!1,null,"0635047f",null)),Rn=In.exports,Pn={name:"fixedmessageicon",props:{},components:{sweetalert:Rn},data:function(){return{loading:!1}},created:()=>{},watch:{icon:{immediate:!0,handler(){this.init()}}},computed:Object(h["c"])({auth:e=>e.auth,icon:function(){return this.$store.state.icon?this.$store.state.icon.icon:null},message:function(){return this.$store.state.icon?this.$store.state.icon.message:null},pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active}),methods:{init:function(){var e,t=this;const n=null===(e=this.$store.state.icon)||void 0===e?void 0:e.timeout;this.$store.state.icon.manual||setTimeout((function(){t.$store.commit("icon",null)}),n||2e3)}}},On=Pn,xn=(i("17e1"),Object(f["a"])(On,fn,gn,!1,null,"1cf419f0",null)),Mn=xn.exports,An=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{attrs:{id:"wai-date"}},[e._v(e._s(e.label))])},Nn=[],Dn={name:"date",props:["date"],computed:Object(h["c"])({auth:e=>e.auth,label:function(){return moment.locale(this.$i18n.locale),moment(moment.utc(this.date).toDate()).local().fromNow()}})},jn=Dn,Un=(i("4382"),Object(f["a"])(jn,An,Nn,!1,null,"eb4df516",null)),Ln=Un.exports,$n=function(e,t){var n=t._c;return n("div",{staticClass:"userpic"},[n("div",{staticClass:"userpicSquareWrapper"},[n("div",{staticClass:"userpicSquareInnerWrapper"},[n("div",{staticClass:"userpicSquareInnerWrapper",class:t.props.status},[t.props.userinfo.image?n("bgimage",{attrs:{src:t.props.userinfo.image}}):t._e(),!t.props.userinfo.image&&t.props.userinfo.name&&"blocked"!=t.props.status&&"invite"!=t.props.status&&"ban"!=t.props.status?n("div",{staticClass:"charAvatar"},[n("span",[t._v(t._s(t.props.userinfo.name.charAt(0)))])]):t._e(),n("div",{staticClass:"statusIcon"},["blocked"==t.props.status||"ban"==t.props.status?n("i",{staticClass:"fas fa-ban"}):t._e(),"invite"==t.props.status?n("i",{staticClass:"fas fa-user-plus"}):t._e()])],1)])])])},Bn=[],Fn={name:"userpic",props:{userinfo:{type:Object,default:{}},status:""}},Kn=Fn,qn=(i("b93b"),Object(f["a"])(Kn,$n,Bn,!0,null,"5034d1e2",null)),Gn=qn.exports,zn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.users?n("div",{staticClass:"userspic",class:{oneuser:e.users&&1===e.users.length}},[0===e.users.length?n("userpic",{attrs:{userinfo:e.single,status:e.single.status}}):e._e(),1===e.users.length?n("userpic",{attrs:{status:e.status[e.users[0].id],userinfo:e.users[0],unseen:e.unseen}}):e._e(),e.users.length>1?n("many",{attrs:{slidesPerView:e.slidesPerView,status:e.status,userinfo:e.users,unseen:e.unseen}}):e._e(),e.unseen?n("div",{staticClass:"unseen"},[e._v(" "+e._s(e.unseen>99?"99":e.unseen)+" ")]):e._e()],1):e._e()},Vn=[],Hn=i("ecec"),Wn={name:"userspic",props:{users:Array,single:{},unseen:Number,slidesPerView:Number,status:{type:Object,default:{}}},data:function(){return{}},components:{many:Hn["a"]}},Jn=Wn,Yn=(i("4606"),Object(f["a"])(Jn,zn,Vn,!1,null,"792279b0",null)),Qn=Yn.exports,Xn=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bgimage",class:{loaded:e.loaded,hasimage:e.src},style:"background-image:url("+e.imageSrc+"); background-size: cover; background-position: center center; background-repeat: no-repeat"},[e._t("cnt")],2)},Zn=[],ei={name:"bgimage",directives:{},props:{src:String},watch:{src:{immediate:!0,handler:function(){this.load()}}},data:function(){return{loaded:!1,imageSrc:""}},methods:{load:function(){if(this.src){this.imageSrc=this.src.replace("bastyon.com:8092","pocketnet.app:8092").replace("test.pocketnet","pocketnet");var e=new Image;e.src=this.imageSrc,e.onload=()=>{this.loaded=!0}}else this.loaded=!0}}},ti=ei,ni=(i("9c10"),Object(f["a"])(ti,Xn,Zn,!1,null,"3fcf8be4",null)),ii=ni.exports,ri=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"wai-logotype"}},[n("div",{staticClass:"items"},[n("div",{staticClass:"item"},[n("div",{staticClass:"logo"},[n("img",{attrs:{src:"img/ldpiwide-"+e.themeL+".png"}})])])])])},oi=[],si={black:"black",white:"white",classic:"white"},ai={name:"wai-logotype",props:{},data:function(){return{loading:!1}},created:()=>{},watch:{},computed:Object(h["c"])({auth:e=>e.auth,themeL:function(e){return si[e.theme]||"white"}}),methods:{}},ci=ai,li=(i("d6cc"),Object(f["a"])(ci,ri,oi,!1,null,"e33cd7cc",null)),ui=li.exports,di=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"outer-div",class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,active:e.active,mobile:e.mobile},on:{click:function(e){e.stopPropagation()}}},[e.menuIsVisible&&!e.hiddenInParent?n("div",{staticClass:"dropdown",class:{visible:e.menuIsVisible}},[n("div",{staticClass:"backgr",on:{click:function(t){return e.hidePopup()}}}),n("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.hidePopup,expression:"hidePopup"}],staticClass:"menuwrapper"},[n("simpleMenu",{attrs:{items:e.menuItems},scopedSlots:e._u([{key:"default",fn:function(t){return[e._t("default",(function(){return[n("div",{staticClass:"menu-item",on:{click:function(n){return e.menuItemClick(t.item)}}},[n("div",{staticClass:"iconWrapper"},[t.item.icon?n("i",{class:t.item.icon}):e._e()]),n("div",{staticClass:"title"},[e._v(" "+e._s(t.item.title)+" ")])])]}),{item:t.item})]}}],null,!0)}),n("div",{staticClass:"cancelWrapper"},[n("div",{staticClass:"menu-item",on:{click:function(t){return e.hidePopup()}}},[n("div",{staticClass:"iconWrapper"}),n("div",{staticClass:"title"},[e._v(e._s(e.$t("cancel")))])])])],1)]):e._e(),n("div",{staticClass:"dropDownIcon",on:{click:e.onClickHandler}},[n("i",{class:"icon "+(e.icon||"fas fa-ellipsis-h")})])])},hi=[],mi={name:"dropdownMenu",props:{menuItems:{type:Array,required:!0},rowObject:{type:Object},icon:String},components:{simpleMenu:De},data:function(){return{loading:!1,menuIsVisible:!1}},watch:{menuIsVisible:function(e){this.$emit("menuIsVisible",e)}},computed:{dropdownWidthInner(){return this.dropdownWidth},...Object(h["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,mobile:e=>e.mobile,active:e=>e.active,hiddenInParent:e=>e.hiddenInParent})},methods:{menuItemClick(e){this.$emit("itemClicked",e,this.rowObject,{hidePopup:this.hidePopup,showPopup:this.showPopup})},onClickHandler(){this.menuIsVisible=!this.menuIsVisible},hidePopup(){this.menuIsVisible=!1},showPopup(){this.menuIsVisible=!0}}},pi=mi,fi=(i("5722"),Object(f["a"])(pi,di,hi,!1,null,"e4f39dca",null)),gi=fi.exports,vi=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"back",on:{click:e.click}},[n("div",{staticClass:"iconbutton"},[n("i",{class:e.icon||"fas fa-angle-left"})])])},yi=[],_i={name:"backButton",props:{icon:String,action:{type:String,default:"/"},caption:{type:String,default:""}},methods:{click:function(){"back"==this.action?this.$router.go(-1):this.$router.push(this.action).catch(e=>{})}}},bi=_i,Ei=(i("b215"),Object(f["a"])(bi,vi,yi,!1,null,"7e97eec1",null)),Si=Ei.exports,wi=i("08da"),Ci=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fixedOnPageTop",class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active,unauthorized:e.unauthorized,modalShowed:!!e.modalShowed,mobile:e.mobile},attrs:{id:"maincontent"},on:{mouseenter:e.mouseenter,mouseleave:e.mouseleave}},[n("div",{staticClass:"headerSpacerWrapper"},[n("div",{staticClass:"headerSpacerWrapperOvf"},[n("div",{ref:"scrollable",staticClass:"headerSpacer"},[e._t("content",(function(){return[e._v("   ")]}))],2)]),n("pmenu"),e.modalShowed&&e.modalShowed.data&&!e.hiddenInParent?n("modal",{on:{close:e.closeModal},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(e._s(e.modalShowed.caption))]},proxy:!0},{key:"body",fn:function(){return[n("div",{staticClass:"modalcommoncontent"},["complain"==e.modalShowed.type?n("complain",{attrs:{p:e.modalShowed.data}}):e._e(),"contact"==e.modalShowed.type?n("contact",{attrs:{contact:e.modalShowed.data.contact}}):e._e(),"showuserselect"==e.modalShowed.type?n("contacts",{attrs:{users:e.modalShowed.data.users,mode:"Select"},on:{close:e.closeModal,select:function(t){e.modalShowed.data.userselected(t),e.closeModal()}}}):e._e()],1)]},proxy:!0},{key:"footer",fn:function(){},proxy:!0}],null,!1,3972288297)}):e._e(),!e.unauthorized&&e.rbackexp?n("div",{staticClass:"expandp",on:{click:e.setactive,mousemove:e.effect}},[e._m(0)]):e._e()],1),e.iconshow?n("transition",{attrs:{name:"fade"}},[n("fixedmessageicon")],1):e._e()],1)},ki=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"etablew"},[n("div",{staticClass:"etable table"},[n("div",[n("i",{staticClass:"fas fa-expand-arrows-alt"})])])])}],Ti={name:"maincontent",props:{rbackexp:Boolean},components:{contact:()=>Promise.resolve().then(i.bind(null,"d3ff")),contacts:()=>Promise.resolve().then(i.bind(null,"f978")),complain:()=>i.e("chunk-5bf57b8c").then(i.bind(null,"c27d"))},data:function(){return{loading:!1}},created:()=>{},watch:{},computed:Object(h["c"])({auth:e=>e.auth,iconshow:function(){return!!this.$store.state.icon},pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active,modalShowed:e=>e.modalShowed,hiddenInParent:e=>e.hiddenInParent,mobile:e=>e.mobile,unauthorized:e=>e.unauthorized}),methods:{setactive:function(){this.$store.commit("active",!0),this.$store.commit("blockactive",{value:!0,item:"main"}),this.$store.commit("setiteraction",!0)},mouseenter:function(){},mouseleave:function(){this.$store.state.autohide&&this.$store.commit("active",!1),this.$store.commit("blockactive",{value:!1,item:"main"})},effect:function(e){},closeModal:function(){this.$store.commit("setmodal",null)},scroll:function(e){this.$refs["scrollable"].scrollTop=e||0}}},Ii=Ti,Ri=(i("52ce"),Object(f["a"])(Ii,Ci,ki,!1,null,"a8a70f9c",null)),Pi=Ri.exports,Oi=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active},attrs:{id:"search"}},[n("div",{staticClass:"searchWrapper"},[n("div",{staticClass:"inputWrapper"},[n("input",{ref:"input",attrs:{placeholder:e.placeholder||this.$i18n.t("caption.search"),type:"text"},domProps:{value:e.searchTxt},on:{keyup:e.change,input:e.change,focus:e.focused,blur:e.blured}})]),e.searchTxt?e._e():n("div",{staticClass:"iconWrapper"},[n("i",{staticClass:"fas fa-search"})]),e.searchTxt?n("div",{staticClass:"iconWrapper",on:{click:e.clear}},[n("i",{staticClass:"fas fa-times"})]):e._e()])])},xi=[],Mi={name:"search",props:{placeholder:String,minimize:{type:Boolean,default:!1}},data:function(){return{loading:!1,isTyping:!1,searchTxt:""}},created:()=>{},watch:{searchTxt:{handler:_.debounce((function(){var e=this.searchTxt.toLowerCase();this.$emit("search",e)}),500)}},computed:Object(h["c"])({auth:e=>e.auth,pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:function(e){return e.active||!this.minimize}}),methods:{change:function(e){this.searchTxt=e.target.value},clear:function(e){this.searchTxt=""},clickicon:function(){this.$refs["input"].focus()},blured:function(){this.$store.commit("blockactive",{value:!1,item:"input"})},focused:function(){this.$store.commit("blockactive",{value:!0,item:"input"})}}},Ai=Mi,Ni=(i("6bfd"),Object(f["a"])(Ai,Oi,xi,!1,null,"1774f2a8",null)),Di=Ni.exports,ji=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},Ui=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"linepreloader"}},[n("span"),n("span"),n("span")])}],Li={name:"linepreloader",props:{}},$i=Li,Bi=(i("0095"),Object(f["a"])($i,ji,Ui,!1,null,"bcf20e38",null)),Fi=Bi.exports,Ki=i("9a41");function qi(){const e=i("2db5"),t=e.keys().map(e=>({key:e,locale:e.match(/[a-z0-9-_]+/i)[0]})).reduce((t,n)=>{let{key:i,locale:r}=n;return{...t,[r]:e(i)}},{});return{context:e,messages:t}}r["default"].use(St.a),r["default"].component("eventsEvent",kt["default"]),r["default"].use(yt),r["default"].use(Fe["a"]),r["default"].use(Be["a"]),r["default"].use(Ke["a"]),r["default"].use(bt.a),r["default"].use(Ct.a),r["default"].config.productionTip=!1,r["default"].prototype.$f=he["a"],r["default"].component("pmenu",$e),r["default"].component("modal",Ie),r["default"].component("preloader",pn),r["default"].component("date",Ln),r["default"].component("userpic",Gn),r["default"].component("userspic",Qn),r["default"].component("fixedmessageicon",Mn),r["default"].component("bgimage",ii),r["default"].component("logotype",ui),r["default"].component("dropdownMenu",gi),r["default"].component("backButton",Si),r["default"].component("topheader",wi["a"]),r["default"].component("maincontent",Pi),r["default"].component("search",Di),r["default"].component("linepreloader",Fi),r["default"].use(cn["a"]),r["default"].directive("click-outside",{bind:function(e,t,n){e.clickOutsideEvent=function(i){e==i.target||e.contains(i.target)||n.context[t.expression](i)},document.body.addEventListener("click",e.clickOutsideEvent)},unbind:function(e){document.body.removeEventListener("click",e.clickOutsideEvent)}});const{context:Gi,messages:zi}=qi(),Vi=new Ke["a"]({locale:"en",messages:zi,silentTranslationWarn:!0});var Hi=null,Wi={install:function(e){Object.defineProperty(e.prototype,"core",{get(){return Hi}})}};r["default"].use(Wi);var Ji={de:!0,ru:!0,en:!0,fr:!0,cmn:!0,it:!0,es:!0,kr:!0},Yi={i18n:Vi,store:ve,router:Ee,name:"App",components:{MainWrapper:re,chats:Ki["default"],userUnauthorized:de},props:{address:{type:String,default:""},privatekey:{type:String,defautt:""},pocketnet:{type:String,default:""},mobile:{type:String,default:""},recording:{type:String,default:""},pkoindisabled:{type:String,default:""},ctheme:String,fcmtoken:String,localization:String,pip:{type:Boolean,default:!1}},watch:{fcmtoken:function(){this.setPusher(this.fcmtoken)},localization:{immediate:!0,handler:function(){Ji[this.localization]?Vi.locale=this.localization:Vi.locale="en",this.generateTeamroomMessages()}},mobile:function(){this.$store.commit("setMobile",this.mobile),this.$store.commit("minimize")},pocketnet:function(){this.$store.commit("setPocketnet",this.pocketnet),this.$store.commit("minimize")}},computed:{statetheme:function(){return this.$store.state.theme},theme:function(){return this.ctheme||this.statetheme},unauthorized:function(){return this.$store.state.unauthorized},online:function(){return this.$store.state.online},loading:function(){return this.$store.state.loading},minimized:function(){return!this.mobile&&this.$store.state.minimized},active:function(){return!0},globalpreloader:function(){return this.$store.state.globalpreloader},share:function(){if(!this.unauthorized)return this.$store.state.share},closebybg:function(){return this.$store.state.active},unselect:function(){return this.$store.state.voicerecording}},methods:{hide:function(){this.$store.commit("minimize",!0),setTimeout(()=>{"chats"!==this.$route.name&&"contact"!==this.$route.name&&"publicPreview"!==this.$route.name&&"chatSettings"!==this.$route.name&&!0!==Hi.cancelDefaultRoute&&this.$router.push("/chats").catch(e=>{})},500)},iteraction:function(){this.$store.commit("setiteraction",!0)},importInitialScripts(){},setPusher(e){var t;localStorage&&(t=localStorage.getItem("fcmtoken5")),t!=e&&this.core.mtrx.wait().then(t=>{this.core.mtrx.deletePusher();var n={url:this.core.mtrx.baseUrl+"/_matrix/push/v1/notify"},i="pocketnet",r={app_display_name:i,app_id:i+window.cordova.platformId,data:n,user_id:this.core.mtrx.client.credentials.userId,device_display_name:window.device.manufacturer+" "+window.device.model,kind:"http",lang:localStorage.getItem("loc")||"en",pushkey:e};this.core.mtrx.client.setPusher(r).then(()=>{localStorage.setItem("fcmtoken5",e)},e=>{console.log(e)})})},generateTeamroomMessages(){this.$store.commit("SET_POCKETTEAMMESSAGES",[{id:1,text:`\n\t\t\t\t\t\t\t<h4>${this.$i18n.t("teamMessages.1-title")}</h4>\n\t\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t\t<li>${this.$i18n.t("teamMessages.1-list1")}</li>\n\t\t\t\t\t\t\t\t<li class="mt">${this.$i18n.t("teamMessages.1-list2")}</li>\n\t\t\t\t\t\t\t\t<li class="mt">${this.$i18n.t("teamMessages.1-list3")}</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t`,previewText:this.$i18n.t("teamMessages.1-title")}])}},beforeCreate(){this.$store.commit("init")},created(){if(this.$store.commit("setIsLocalStorageChatAuth",_e()),this.$store.state.isLocalStorageChatAuth){const e=getDecryptedMnemonic();null===e.addressUser&&null===e.privateKey?window.open("https://bastyon.com/authorization","_blank"):(this.address=e.addressUser,this.privatekey=e.privateKey.toString("hex"),this.recording=!0)}this.$store.commit("setPocketnet",this.pocketnet),this.$store.commit("setMobile",this.mobile),this.$store.commit("setVoiceMessagesEnabled",this.recording),this.$store.commit("pkoindisabled",this.pkoindisabled),this.$store.commit("clearall"),this.$store.commit("ls"),this.importInitialScripts(),this.generateTeamroomMessages(),setTimeout(()=>{this.fcmtoken&&window.cordova&&this.setPusher(this.fcmtoken)},5e3);var e={matrixMan:{address:he["a"].hexEncode("PToMRMsMVh9dj4Cpa7yu1pB5iq65g4jrVC"),privateKey:"510aa931cdee36b9ac467ad04a2619f46be88815812b46e976e36bc8dbcdc41b"},ltme:{address:he["a"].hexEncode("PKszvjHwMWubQpeEKnQhRonGBVFWcJDbNJ"),privateKey:"513bc6a5014e7dd203537227fb0a78f7b974853478fcf95103125f6d793a5f8b"},travisnoscot1:{address:he["a"].hexEncode("PDjvHUQjcDX8Vq6rtpKveUDPtwPVUZEW7m"),privateKey:"63d91d001f7b5167a707dd4ee7e2638fc13e1fa3ff7171b040b432bcd1054e28"},mobRoocky:{address:he["a"].hexEncode("PCMnk8T3Edu81iGcTEpVCFq8FQd6UBXi2y"),privateKey:"0bbf6fb0dbf78a26f00345f6f96d4f76f52e0093417c51a1b7bccb7ca92e55df"},user1:{address:he["a"].hexEncode("PKxqtUuK3B6qwAxs6HLhvxrQVExuMwKWd5"),privateKey:"28f0fdc30094d517bc08abca3f219d77fc32230e313bbf0b699ecd42f80de82a0"},user2:{address:he["a"].hexEncode("PGe4xVAJRJtbD8swPipE2ug9Zk1rhSTa1y"),privateKey:"0b4562275da7e60a57e10432bdc7e3318dd9699b8b928224ba360b9fb951c77b"},FakeBadash:{address:he["a"].hexEncode("PDWPDFikMhLJHtiKLLXZGzfgphRcd19eHe"),privateKey:"99d8ce99383ccc5d6404535b98f2b43ce5ab939a28bfc52a442565b2351039fa"},Faketravis:{address:he["a"].hexEncode("PGURYzvoXuSvuwCuDty2wW37omjiKgzV5a"),privateKey:"93641f20095aa15b89b78d395ebe0a5a9b149ea2b54c57d896091c0ea9b86dfd"},fakeRocky:{address:he["a"].hexEncode("PRDKVP4yvF2wW8p5FUVkzrCvXYE8SMGkQK"),privateKey:"80d213d272405d4ff51752f91e79c639919f5f9f302583bdaa1c767b044ce2c0"},fakeFuture2:{address:"PBHvKTH5TGQYDbRHgQHTTvaBf7tuww6ho7",privateKey:"71cacb25f90b18e356e33bc12c428c2e8b6b7c6e2950ab6344412f226aab0b2c"},fakeFuture:{address:he["a"].hexEncode("PBHvKTH5TGQYDbRHgQHTTvaBf7tuww6ho7"),privateKey:"71cacb25f90b18e356e33bc12c428c2e8b6b7c6e2950ab6344412f226aab0b2c"},encMan:{address:he["a"].hexEncode("PEkKrb7WJgfU3rCkkU9JYT8jbGiQsw8Qy8"),privateKey:"616fd57f7610288978f4c01797a90d56b0c30392e598a2504b98c7a7246569a5"},harisCalvin:{address:he["a"].hexEncode("PXEWRce8siwbQWArQWyjnooogAEieHwhVd"),privateKey:"218bcb76df20438c1431c0394a42947f78f279bea987d7b238bfbd1cb1533b62"},oneSomeoneNigga:{address:he["a"].hexEncode("PGyjEoqmmK2tm6xmg69hGoSNM6hUrc4VfE"),privateKey:"254f5b9394f0490e78b41c6bf615bfd8e290fde3fb6d862f166b181b35764b06"},gomer:{address:he["a"].hexEncode("PVSdoFQqAg86p6tbAW8Y6CGGGjhiXkr4qh"),privateKey:"105de1935fa665bdc23b1b02bcdb3f62e01a3ad48823d5348edb5b94ec1b4526"},bart:{address:he["a"].hexEncode("PWioUw52q4iNpMQUauNYaWg9JpsPE1u9Ut"),privateKey:"a74bc4ee63290dd051d659fe46962176d2b9193e04104dea63116d25703bad72"},edSheeran:{address:he["a"].hexEncode("PVeqjqJk2GthxBK6QdhCCfQVEX1SAK92As"),privateKey:"d89952018721e6762de13fa2f1891b0dc2d1f1e75402ba483251086b2ba181ac"},duftPunkMan:{address:he["a"].hexEncode("PFnN8SExxLsUjMKzs2avdvBdcA3ZKXPPkF"),privateKey:"7d1a31cc49a05692cfd992359cd27e8b3783cd186d98053ea0b9307b00a19018"},jcole:{address:he["a"].hexEncode("P93cWU7X31wqn3R9GcUZ7c3fD11asXum5y"),privateKey:"900099127ad048d64523c4701d72d67b5b7f2afb18debbfdc53587f04a29c808"},flowMan:{address:he["a"].hexEncode("PM4gVCcWnTmysUXhMukoQA2mT7GpfWQvck"),privateKey:"12d28e4c950193665dcaaa32129c061b2213e736ffe20918f0f13b6a2857cc32"},JokeMan:{address:he["a"].hexEncode("PMSULgjrsCsEnWgNigCga5jSjhCvYBFSA8"),privateKey:"f7a2518393db3779a4394f4084473847bc4260a5aad20859eff9d32ab03c310e"},omgMan:{address:he["a"].hexEncode("P9R3aNvyjRbqTWfy5q1h5qvXFYaDtqaRi2"),privateKey:"80b4350df8c033a63fd7c6b71516ae05ab3a23a604a39afba5874b87b4effbf8"},nineBot:{address:he["a"].hexEncode("PNcvYsMXzf4RVmS9AjRYEqeeGjk1PiDjvF"),privateKey:"447554f94a3512a420ef6d089411dff3bc6d170f65e246cc52fc30aa9ed2216c"},tenBot:{address:he["a"].hexEncode("PS9F8hzGSxeL1Lc2VGvPoqXHotZvpoVkkX"),privateKey:"659bd118d33e541bb042015723cab1e6b644a9d330a988b10e6d593f9abe3542"},bikeBot:{address:he["a"].hexEncode("PBK1GDpiLNVFrKsPVAaNLU92byFY5P5KBr"),privateKey:"4c1ee4ae821a1ca885d77db84518b4dcbcd4efbed69603c8706b9557618529f9"},angryBot:{address:he["a"].hexEncode("PBMcLRBQNWtNQZYUbRZZAd5FuZ8yb7HMX2"),privateKey:"87bec25e930671a06e032dca484083d4b79e23aa985781995882d5d4594f8d8d"},test099090:{address:he["a"].hexEncode("PP582V47P8vCvXjdV3inwYNgxScZCuTWsq"),privateKey:"14ede296d13f8111c77a1da82519939329ee1b81ab23203da48df3f5e52fee3d"},tony:{address:he["a"].hexEncode("TLENU8HFyz8PqzpKBDWeN6Xix6rM8wjYKd"),privateKey:"8cf816c1c7a51cbc114db9aac8896b8654260f9b3a985232f27cf32823c7f45f"},invoker:{address:he["a"].hexEncode("TPjN8Dy4BpGDezMNw2ePuEdHiHetTvR3Mb"),privateKey:"a7ded16bd9d3350d6c3d233e6905b51e61bd879ba152ae24d0f8def76c4581c7"},drowRanger:{address:he["a"].hexEncode("TU8fAf96kSfQzmxmpjRDSSqvCiPWzWt67J"),privateKey:"38484a2047b5c8170847a97fc5cddf3d485c934c6532a51a73f64ec7e4659891"},nevermore:{address:he["a"].hexEncode("TKJ7xAC18XC4zQBvkNAWhkr3i7cARu11Uv"),privateKey:"8ec7f71d16b07d29bb49b3bc3054b5a4d2e65fb559e0ae695503568227584f53"},stormSpirit:{address:he["a"].hexEncode("TZBHmnZwLedPtHcJfJnFsbxobGuDKGf9uA"),privateKey:"642aaa706fe94ea77239468cb9aad6b463472793a2c4e1f60acf22078770c45f"},morph:{address:he["a"].hexEncode("TXyieuLsCntT1p4ougtiKURtYTxcdvWN1L"),privateKey:"8f59a6a6b7b8c1f63be47a6f571a11d726e9d7cde2baff52a51dc72326b6abb4"},alchemist:{address:he["a"].hexEncode("TT2CeQuHiM8E8hG4rkJcaMKQ8gWqhZmNUH"),privateKey:"957ad5e2a009e4c0f06f0ae2737ea4c36c48fa8312555fcd104ca9cff7db6848"},public_user_test:{address:he["a"].hexEncode("TLMXdC2UYSfMVbLzKtmJJTi4oK9LNHNVju"),privateKey:"509b219c5cead9545039ae38d428813af6671dbee3e37cadd2cd22f152013f2a"},cleanUser:{address:he["a"].hexEncode("THCRHFtVAoeDGLg548C4bQxXeDg9bwrs5K"),privateKey:"666919a742eb63bededea3fddc44b526148d8b0eb1126b0aaff480a2af888d92"},userwithoutavatar:{address:he["a"].hexEncode("TVcPMgVQ9TxgpzNrQyEAei5cnnR9jzXtzE"),privateKey:"2a3e96562c23a40e3d439b823453fb8fe6f8fb2c0267e8d2411734b3bdff90dd"},unnamed:{address:he["a"].hexEncode("THsA8rwdeAkq5bePA71Nw5CGtFg2duyDSq"),privateKey:"27b42dfba3d20ae7a945e09dd0688137fa7963fd48b94f7b4027dc4eed874a96"}},t={address:this.address?he["a"].hexEncode(this.address):"",privateKey:this.privatekey},n="nevermore",i=this.address&&this.privatekey?t:e[""+n];if(this.$store.commit("SET_ADDRESS",he["a"].hexDecode(i.address)),this.$store.state.isLocalStorageChatAuth)var r=[{host:"5.pocketnet.app",port:8899,wss:8099},{host:"1.pocketnet.app",port:8899,wss:8099},{host:"2.pocketnet.app",port:8899,wss:8099},{host:"3.pocketnet.app",port:8899,wss:8099},{host:"4.pocketnet.app",port:8899,wss:8099}];else r=he["a"].deep(window,"window.POCKETNETINSTANCE.options.listofproxies")||[{host:"test.pocketnet.app",port:8899,wss:8099}];if(this.$store.state.isLocalStorageChatAuth)var o="matrix.pocketnet.app";else o=he["a"].deep(window,"window.POCKETNETINSTANCE.options.matrix")||"test.matrix.pocketnet.app";Hi=new an(this,{domain:o,mtrx:{logger:function(){}},listofproxies:r,servers:{pocketnet:"https://pocketnet.app:8888"}}),Hi.init(),Hi.initWithUser(i).then(e=>Hi.mtrx.wait().then(()=>{Hi.user.getContacts(),setTimeout(()=>{"chats"!==this.$route.name&&"publicPreview"!==this.$route.name&&"chatSettings"!==this.$route.name&&"contact"!==this.$route.name&&!0!==Hi.cancelDefaultRoute&&this.$router.push("/chats").catch(e=>{})},100)})).catch(e=>{}),setInterval(()=>{!this.$store.state.autohide&&this.$store.state.iteraction||this.$store.commit("active",!1)},3e3),window.matrixchat=Hi},mounted(){this.$store.commit("minimize",!0)}};var Qi=Yi,Xi=(i("9322"),i("2db5b"),i("6964"),i("4b41"),Object(f["a"])(Qi,o,s,!1,null,null,null)),Zi=Xi.exports;i("db4d"),new r["default"]({render:e=>e(Zi)}).$mount("#matrix-root")},5722:function(e,t,n){"use strict";n("f860")},"590b":function(e,t,n){},"5b71":function(e,t,n){"use strict";n("b466")},"5bc6":function(e,t,n){},"5e66":function(e,t,n){"use strict";n("e296")},"5f05":function(e,t,n){"use strict";var i=n("c973").default;Object.defineProperty(t,"__esModule",{value:!0}),t.RoomList=void 0;var r=n("b503");class o{constructor(e){this._cryptoStore=e,this._roomEncryption={}}init(){var e=this;return i((function*(){yield e._cryptoStore.doTxn("readwrite",[r.IndexedDBCryptoStore.STORE_ROOMS],t=>{e._cryptoStore.getEndToEndRooms(t,t=>{e._roomEncryption=t})})}))()}getRoomEncryption(e){return this._roomEncryption[e]||null}isRoomEncrypted(e){return Boolean(this.getRoomEncryption(e))}setRoomEncryption(e,t){var n=this;return i((function*(){n._roomEncryption[e]=t,yield n._cryptoStore.doTxn("readwrite",[r.IndexedDBCryptoStore.STORE_ROOMS],i=>{n._cryptoStore.storeEndToEndRoom(e,t,i)})}))()}}t.RoomList=o},6:function(e,t){},"60b9":function(e,t,n){"use strict";n("3f60")},6129:function(e,t,n){"use strict";var i=n("1da1");n("d9e2");const r=function(e,t,n){const r=!1,o=!1;let s=()=>{};r&&(s=console.log);const a=3600,c=24*a,l=30*c;var u=n||l,d={};function h(){const e=Math.floor(Date.now()/1e3),t=e-e%a;return t}function m(){let n,i=indexedDB.open(e,t);function r(){const e=a("items"),t=e.objectStore("items"),n=t.getAll();return new Promise((e,t)=>{n.onsuccess=t=>{const n=t.target.result;n&&_.each(n,e=>{d[e.id]=e.message}),e()},n.onerror=t=>{s("PCryptoStorage CLEAR OUTDATED error",t),e()}})}function o(){const e=h()-u,t=n.transaction("items","readwrite"),i=t.objectStore("items"),r=i.openCursor();return new Promise((t,n)=>{r.onsuccess=n=>{const i=n.target.result;i&&(e>=i.value.cachedAt&&(s("PCryptoStorage CLEAR OUTDATED log",n),i.delete()),i.continue()),t()},r.onerror=e=>{s("PCryptoStorage CLEAR OUTDATED error",e),t()}})}function a(e){const t=n.transaction("items","readwrite");return t.onsuccess=function(e){s("PCryptoStorage TRANSACTION finished",e)},t.onabort=function(e){s("PCryptoStorage TRANSACTION abort",e.target.error)},t.onerror=function(e){s("PCryptoStorage TRANSACTION error",e.target.error)},t}i.onupgradeneeded=function(e){let t=i.result;const n=e.oldVersion!==e.newVersion,r=0===e.oldVersion;n&&!r&&(t.objectStoreNames.contains("items")||t.deleteObjectStore("items")),t.objectStoreNames.contains("items")||t.createObjectStore("items",{keyPath:"id"})};const c={clear:e=>{function t(t,n){const i=a("items",!0),r=i.objectStore("items"),o=r.delete(e);delete d[e],o.onsuccess=e=>{s("PCryptoStorage CLEAR log",e),t(!0)},o.onerror=e=>{s("PCryptoStorage CLEAR error",e.target.error),n(e.target.error)}}return s("PCryptoStorage clearing",e),new Promise(t)},set:(e,t)=>{function n(n,i){const r=a("items",!0),o=r.objectStore("items"),c=h(),l={id:e,message:t,cachedAt:c};d[e]=t;const u=o.put(l);u.onsuccess=function(e){s("PCryptoStorage SET log",e),n(!0)},u.onerror=function(e){s("PCryptoStorage SET error",e.target.error),i(e.target.error)}}return s("PCryptoStorage writing",e),new Promise(n)},get:e=>{function t(t,n){if(d[e])return t(d[e]);const i=a("items"),r=i.objectStore("items"),o=r.get(e);o.onsuccess=i=>{if(s("PCryptoStorage GET log",i,o.result),!o.result)return void n("Data does not exist");const r="message"in o.result;r?(d[e]=o.result.message,t(o.result.message)):n("Message property does not exist")},o.onerror=e=>{n(e.target.error)}}return s("PCryptoStorage reading",e),new Promise(t)}};function l(e,t){i.onerror=function(e){s("PCryptoStorage error occurred:",e),t("PCryptoStorage error initiating IndexedDB")},i.onsuccess=function(){n=i.result,o().then(e=>r()).then(t=>{e(c)})}}return new Promise(l)}function p(){function t(){const t=h()-7*c;let n=Object.keys(localStorage),i=n.filter(t=>t.includes(e));i.forEach(e=>{const n=JSON.parse(localStorage[e]);t>=n.cachedAt&&delete localStorage[e]})}const n={clear:function(){var t=Object(i["a"])((function*(t){s("PCryptoStorage clearing localstorage",t);const n=`${e}_${t}`,i=n in localStorage;if(!i)throw Error("Data does not exist");const r="message"in localStorage[n];if(!r)throw Error("Message property does not exist");return delete localStorage[n],new Promise(executor)}));return function(e){return t.apply(this,arguments)}}(),set:function(){var t=Object(i["a"])((function*(t,n){s("PCryptoStorage writing localstorage",t);const i=`${e}_${t}`,r=h(),o={message:n,cachedAt:r};localStorage[i]=JSON.stringify(o)}));return function(e,n){return t.apply(this,arguments)}}(),get:function(){var t=Object(i["a"])((function*(t){s("PCryptoStorage reading",t);const n=`${e}_${t}`,i=n in localStorage;if(!i)throw Error("Data does not exist");return localStorage[n]}));return function(e){return t.apply(this,arguments)}}()};return t(),n}return!window.indexedDB||o?(s("PCryptoStorage LOCALSTORAGE_FALLBACK"),p()):m()};t["a"]=r},6146:function(e,t,n){"use strict";function i(e,t){return new Promise((n,i)=>{let r=!0;const o=e.open(t);o.onupgradeneeded=()=>{r=!1},o.onblocked=()=>i(),o.onsuccess=()=>{const i=o.result;i.close(),r||e.deleteDatabase(t),n(r)},o.onerror=e=>i(e.target.error)})}Object.defineProperty(t,"__esModule",{value:!0}),t.exists=i},6167:function(t,n,i){"use strict";i.r(n);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.event.localRedactionEvent()||e.event.getRedactionEvent()||e.removed?n("div",{staticClass:"deletedMessage"},[n("i",{staticClass:"fas fa-eraser"}),e._v(" "+e._s(e.$t("caption.messageDeleted"))+" ")]):n("div",{ref:"msgElement",staticClass:"event",class:{readyToRender:e.readyToRender,my:e.my}},["member"!==e.type||e.preview?e._e():n("member",{attrs:{chat:e.chat,event:e.event,userinfo:e.userinfo,readed:e.readed,preview:e.preview||!1},on:{readyToRender:e.setReadyToRender}}),"message"===e.type||e.preview?n("message",{attrs:{chat:e.chat,event:e.event,prevevent:e.prevevent,origin:e.event,decryptEvent:e.decryptEvent,decryptedInfo:e.decryptedInfo,encryptedData:e.encryptedData,imgEvent:e.galleryData,userinfo:e.userinfo,readed:e.readed,preview:e.preview||!1,withImage:e.withImage||!1,clientWidth:e.clientWidth,encrypted:e.encrypted,subtype:e.subtype,error:e.error,reference:e.reference,downloaded:e.downloaded,last:e.last,showmyicontrue:e.showmyicontrue,fromreference:e.fromreference,multiSelect:e.multiSelect,selectedMessages:e.selectedMessages,audioBuffer:e.audioBuffer,isRemoveSelectedMessages:e.isRemoveSelectedMessages},on:{openGalleryImg:e.openImage,readyToRender:e.setReadyToRender,remove:e.removeEvent,download:e.downloadFile,decryptagain:e.decryptAgain,showMultiSelect:function(t){return e.$emit("showMultiSelect")},selectMessage:e.selectMessage,removeMessage:e.removeMessage,messagesIsDeleted:e.messagesIsDeleted,editing:e.editing,reply:e.reply,share:e.share,menuIsVisible:e.menuIsVisibleHandler}}):e._e(),"common"===e.type?n("common",{attrs:{event:e.event,userinfo:e.userinfo,readed:e.readed,preview:e.preview||!1}}):e._e(),e.downloading?n("div",{staticClass:"loading"},[n("linepreloader")],1):e._e()],1)},o=[],s=i("1da1"),a=i("a54c"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eventsCommon"})},l=[],u=i("2f62"),d={name:"eventsCommon",props:{event:Object,preview:Boolean,userinfo:Object},data:function(){return{loading:!1}},computed:Object(u["c"])({auth:e=>e.auth}),methods:{}},h=d,m=(i("78ad"),i("2877")),p=Object(m["a"])(h,c,l,!1,null,"52fddf5e",null),f=p.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eventMember"},[e.preview?e._e():n("div",{staticClass:"iconWrapper",on:{click:function(t){return e.core.mtrx.opencontact(e.userinfo)}}},[n("userpic",{attrs:{userinfo:e.userinfo}})],1),n("div",{staticClass:"labelwrapper"},[n("span",{staticClass:"label"},[n("b",[e._v(e._s(e.userinfo.name||"Somebody"))]),e._v(" "+e._s(e.keyword))])])])},v=[],y=i("3139"),b={name:"eventsMember",props:{event:Object,preview:Boolean,userinfo:Object},data:function(){return{loading:!1,pName:Object,membership:"",moder:!1}},mounted:function(){this.$emit("readyToRender")},computed:Object(u["c"])({auth:e=>e.auth,keyword:function(){var e,t=this.$store.state.users,n=null===(e=this.event.event)||void 0===e?void 0:e.content.membership,i=y["a"].getmatrixid(y["a"].deep(this.event,"event.state_key")||this.event.getSender()),r="";if("join"===n)return this.$i18n.t("caption.joinedInTheChat");if("invite"===n)return _.find(t,(e,t)=>{if(e.id===i)return r=e.name}),this.$i18n.t("caption.hasInvited")+""+r+this.$i18n.t("caption.inTheChat");if("ban"===n)return _.find(t,(e,t)=>{if(e.id===i)return r=e.name}),this.$i18n.t("caption.banned")+` ${r} `+this.$i18n.t("caption.andRoom");if("leave"===n){let e=this.$store.state.users[y["a"].getmatrixid(this.event.target.userId)];if(e)return e.name+" "+this.$i18n.t("caption.left")+this.$i18n.t("caption.theChat")}if("m.room.power_levels"===this.event.event.type&&this.event.event.unsigned.prev_content){let e=Object.keys(y["a"].ObjDiff(this.event.event.content.users,this.event.event.unsigned.prev_content.users)),t=this.$store.state.users[""+y["a"].getmatrixid(e[0])],n=this.event.event.content.users[""+e[0]];if(!_.isEmpty(t)&&e[0]){if(0===n)return this.$i18n.t("caption.unmarked")+` ${t.name} `+this.$i18n.t("caption.asModerator");if(50===n)return this.$i18n.t("caption.marked")+` ${t.name} `+this.$i18n.t("caption.asModerator")}}return this.event.event.type,"m.room.name"===this.event.event.type?this.$i18n.t("caption.editedChatNameTo")+`"${this.event.event.content.name}"`:void 0}}),methods:{}},E=b,S=(i("00e4"),Object(m["a"])(E,g,v,!1,null,"54a240c2",null)),w=S.exports,C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"eventsMessage"},[e.referenceshowed&&e.reference&&!e.preview&&!e.fromreference?n("div",{staticClass:"reference referenceTop",class:{my:e.my}},[n("eventsEvent",{attrs:{event:e.reference,chat:e.chat,preview:!1,fromreference:!0}})],1):e._e(),(e.content.from||e.imageFrom)&&(e.file||"m.image"===e.content.msgtype&&e.imageUrl||"m.audio"===e.content.msgtype&&e.audioUrl)?n("div",{staticClass:"fromimagesfiles"},[n("div",{staticClass:"fromCaption"},[n("i",{staticClass:"fas fa-share-alt"}),e._v(" "),n("span",[e._v(e._s(e.$t("caption.messagefrom"))+" "+e._s(e.userinfo.name))])])]):e._e(),e.preview||"m.notice"===e.content.msgtype?e._e():n("div",{directives:[{name:"touch",rawName:"v-touch:touchhold",value:e.dropDownMenuShow,expression:"dropDownMenuShow",arg:"touchhold"}],class:{referenceshowed:e.referenceshowed,showmeta:e.showmeta,my:e.my,messageRow:"messageRow",urlpreview:e.urlpreview,allscreen:e.urlpreview||"m.image"===e.content.msgtype||e.file,aligncenter:"m.audio"===e.content.msgtype},attrs:{my:e.my}},[e.urlpreview||e.imageUrl||"m.image"===e.content.msgtype||e.showmeta&&e.my||e.file?n("div",{staticClass:"timeWrapper"},[e.showburn?n("i",{class:"fas fa-fire burn "+e.showburn,on:{click:e.showwhenburn}}):e._e(),n("span",[e._v(" "+e._s(e.format_date(e.origin._localTimestamp)||"Now")+" ")])]):e._e(),n("div",{staticClass:"actionsWrapper"},[e.multiSelect?n("div",{staticClass:"multiSelect",on:{click:function(t){return e.eventMessage(e.selectedMessage)}}},[e.selectedMessage?n("i",{staticClass:"far fa-check-circle"}):n("i",{staticClass:"far fa-circle"})]):n("div",{staticClass:"mnwrapper"},[n("i",{staticClass:"fas fa-ellipsis-h",on:{click:e.setmenu}})])]),!e.my||e.showmyicon?n("div",{staticClass:"iconWrapper",on:{click:function(t){return e.core.mtrx.opencontact(e.userinfo)}}},[n("userpic",{attrs:{userinfo:e.userinfo}})],1):e._e(),"m.image"===e.content.msgtype?n("div",{staticClass:"messageImg",class:{referenceImg:e.reference}},[!e.reference||e.preview||e.fromreference?e._e():n("div",{staticClass:"reference showreference",on:{click:e.showreference}},[e.referenceshowed?e._e():n("eventsEvent",{attrs:{event:e.reference,chat:e.chat,preview:!0}}),n("div",{staticClass:"referenceCaption"},[e.referenceshowed?n("button",{staticClass:"button ghost small"},[e._v("Hide")]):n("span",[n("i",{staticClass:"fas fa-share"})])])],1),e.imageUrl?n("div",{},[e.encryptedData?n("div",{staticClass:"encryptedDataIcon"},[n("i",{staticClass:"fas fa-lock"})]):e._e(),n("div",{staticClass:"imgMsg"},[n("div",{staticClass:"showImage",style:e.imagePaddingStyle(e.content),on:{click:function(t){return e.openImageGallery(e.origin)}}},[n("div",{staticClass:"abswrapper"},[n("img",{directives:[{name:"images-loaded",rawName:"v-images-loaded:on.loaded",value:e.imagesLoaded,expression:"imagesLoaded",arg:"on",modifiers:{loaded:!0}}],attrs:{src:e.imageUrl,alt:""}})])])])]):n("div",{staticClass:"preloaderImage",style:e.imagePaddingStyle(e.content)},[n("div",{staticClass:"abswrapper"},[n("linepreloader")],1)])]):e._e(),"m.audio"===e.content.msgtype?n("div",{staticClass:"messageAudio"},[!e.reference||e.preview||e.fromreference?e._e():n("div",{staticClass:"reference showreference",on:{click:e.showreference}},[e.referenceshowed?e._e():n("eventsEvent",{attrs:{event:e.reference,chat:e.chat,preview:!0}}),n("div",{staticClass:"referenceCaption"},[e.referenceshowed?n("button",{staticClass:"button ghost small"},[e._v("Hide")]):n("span",[n("i",{staticClass:"fas fa-share"})])])],1),e.audioUrl?n("VoiceMessage",{attrs:{audioBuffer:e.audioUrl,decryptedInfo:e.decryptedInfo,id:e.event._localTimestamp||Date.now()}}):e._e()],1):e._e(),"m.encrypted"===e.content.msgtype&&!e.textWithoutLinks&&e.badenctypted?n("div",{staticClass:"maxcontent",class:{my:e.my}},[n("div",{staticClass:"badenctyptedText"},[n("span",[e._v(e._s(e.$t("caption.unabletoDecrypt")))]),e._v(" "),n("i",{staticClass:"fas fa-undo decryptagain",on:{click:e.decryptagain}})])]):e._e(),"m.text"!==e.content.msgtype&&"m.encrypted"!==e.content.msgtype||!e.textWithoutLinks?e._e():n("div",{staticClass:"maxcontent",class:{my:e.my}},[n("div",{staticClass:"messageText"},[e.edited?n("div",{staticClass:"edited"},[n("i",{staticClass:"fas fa-pen"}),e._v(" "+e._s(e.$t("caption.edited"))+" ")]):e._e(),n("div",{staticClass:"msgtext"},[n("IncomingMessage",{attrs:{message:e.textWithoutLinks}})],1),!e.content.from&&!e.my&&e.showmeta||e.showmyicon&&!e.my?n("div",{staticClass:"sendername"},[n("span",[n("b",[e._v(e._s(e.userinfo.name))])]),e._v(" · "),n("span",[e._v(" "+e._s(e.format_date(e.origin._localTimestamp)||"Now")+" ")])]):e._e(),!e.reference||e.preview||e.fromreference?e._e():n("div",{staticClass:"reference showreference",on:{click:e.showreference}},[e.referenceshowed?e._e():n("eventsEvent",{attrs:{event:e.reference,chat:e.chat,preview:!0}}),n("div",{staticClass:"referenceCaption"},[e.referenceshowed?n("button",{staticClass:"button ghost small"},[e._v("Hide")]):n("span",[n("i",{staticClass:"fas fa-share"})])])],1),e.content.from?n("div",{staticClass:"from"},[n("div",{staticClass:"fromCaption"},[n("i",{staticClass:"fas fa-share-alt"}),n("span",[e._v(e._s(e.$t("caption.messagefrom"))+" "+e._s(e.userinfo.name))])])]):e._e()])]),e.file?n("div",{staticClass:"filePreview",class:{reference:e.reference}},[!e.reference||e.preview||e.fromreference?e._e():n("div",{staticClass:"reference showreference",on:{click:e.showreference}},[e.referenceshowed?e._e():n("eventsEvent",{attrs:{event:e.reference,chat:e.chat,preview:!0}}),n("div",{staticClass:"referenceCaption"},[e.referenceshowed?n("button",{staticClass:"button ghost small"},[e._v("Hide")]):n("span",[n("i",{staticClass:"fas fa-share"})])])],1),n("fileMessage",{attrs:{encryptedData:e.encryptedData,file:e.file,downloaded:e.downloaded},on:{download:e.download}}),e.encryptedData?n("div",{staticClass:"encryptedDataIcon"},[n("i",{staticClass:"fas fa-lock"})]):e._e(),e.error?n("div",{staticClass:"badencrypted"},[n("span",[e._v(e._s(e.$t("caption.unabletoDecrypt")))])]):e._e()],1):e._e(),e.urlpreview?n("div",{staticClass:"linkPreview"},[e.sending?n("div",[n("linepreloader")],1):n("div",{staticClass:"pr"},[e.origin.localRedactionEvent()||e.origin.getRedactionEvent()?e._e():n("url",{attrs:{url:e.urlpreview,urllink:e.urlpreview,preview:!0},on:{updatedSize:e.updatedSize}})],1)]):e._e()]),e.preview?n("div",{staticClass:"messagePreview"},[n("listPreview",{attrs:{my:e.my,event:e.origin,decryptEvent:e.decryptEvent,userinfo:e.userinfo,chat:e.chat,readed:e.readed}})],1):e._e(),e.my&&e.readed&&!e.preview&&!e.fromreference?n("div",{staticClass:"statusWrapper"},[n("div",{staticClass:"my"},[n("i",{staticClass:"fas fa-check-double"}),e._v(" "),n("span",[e._v(e._s(e.$t("caption.messageRead")))])])]):e._e()])},k=[],T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"msgAction"},[n("div",{staticClass:"contentAction",style:{margin:e.position}},[n("ul",[n("li",[n("a",{attrs:{href:"google.com"}},[e._v(e._s(e.$t("button.reply"))+" "),n("i",{staticClass:"fas fa-reply"})])]),n("li",[e._v(e._s(e.$t("button.copy"))+" "),n("i",{staticClass:"far fa-copy"})]),n("li",[e._v(e._s(e.$t("button.select"))+" "),n("i",{staticClass:"far fa-check-circle"})]),n("li",[e._v(e._s(e.$t("button.forward"))+" "),n("i",{staticClass:"fas fa-share"})]),n("li",[e._v(e._s(e.$t("button.delete"))+" "),n("i",{staticClass:"far fa-trash-alt"})])])])])},I=[],R={name:"msgActions",props:{position:String},data:function(){return{loading:!1,actionMessage:!1}},computed:Object(u["c"])({auth:e=>e.auth}),methods:{}},P=R,O=(i("7acf"),Object(m["a"])(P,T,I,!1,null,"9d2b1700",null)),x=O.exports,M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("clip-loader",{staticClass:"clipLoader",attrs:{size:"25px",color:"#0035a8",loading:!0}}),n("p",[e._v(e._s(e.preview.name))]),n("p",[e._v(e._s(e.preview.size))])],1)},A=[],N=i("da7a"),D={props:{preview:Object},components:{clipLoader:N["a"]}},j=D,U=Object(m["a"])(j,M,A,!1,null,null,null),L=U.exports,$=i("696c2"),B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"listPreview"},[e.urlpreview&&e.metaPreviewLink?n("div",{staticClass:"previewMessage"},[e.senderName?n("span",{staticClass:"sname txt"},[e._v(e._s(e.senderName)+" ")]):e._e(),n("span",{staticClass:"linkTitle txt"},[e._v("sent link: "+e._s(e.meta["og:title"])+" ")]),"Pocketnet"===e.meta["og:site_name"]?n("span",{staticClass:"pocketnetLink"},[e._v(" "+e._s(e.meta["og:site_name"])+" ")]):n("span",[e._v(" "+e._s(e.meta["og:site_name"])+" ")])]):e._e(),"m.file"===e.content.msgtype?n("div",{staticClass:"previewMessage"},[e.senderName?n("span",{staticClass:"sname txt"},[e._v(e._s(e.senderName)+" ")]):e._e(),n("span",{staticClass:"txt"},[e._v(" sent file: "+e._s(JSON.parse(e.content.body).name)+" ")])]):e._e(),"m.bad.encrypted"===e.content.msgtype?n("div",{staticClass:"previewMessage"},[n("span",[e._v(" "+e._s(e.$t("caption.unabletoDecrypt"))+" ")])]):e._e(),"m.room.redaction"===e.event.event.type?n("div",{staticClass:"previewMessage"},[n("span",{staticClass:"txt"},[n("i",{staticClass:"fas fa-eraser"}),e._v(" "+e._s(e.$t("caption.messageDeleted"))+" ")])]):e._e(),"m.room.power_levels"===e.event.event.type?n("div",{staticClass:"previewMessage"},[e.senderName?n("span",{staticClass:"txt sname"},[e._v(e._s(e.senderName)+" ")]):e._e(),n("span",{staticClass:"txt"},[e._v(" "+e._s(e.powerLevels)+" ")])]):e._e(),"m.image"===e.content.msgtype?n("div",{staticClass:"previewMessage"},[e.senderName?n("span",{staticClass:"txt sname"},[e._v(e._s(e.senderName)+" ")]):e._e(),n("span",{staticClass:"txt"},[e._v(e._s(e.$t("caption.sentImage")))])]):e._e(),"m.audio"===e.content.msgtype?n("div",{staticClass:"previewMessage"},[e.senderName?n("span",{staticClass:"txt sname"},[e._v(e._s(e.senderName)+" ")]):e._e(),n("span",{staticClass:"txt"},[e._v(e._s(e.$t("caption.sentVoiceMessage")))])]):e._e(),"m.text"!==e.content.msgtype||e.urlpreview?e._e():n("div",{staticClass:"previewMessage"},[e.senderName&&"You"!=e.senderName?n("span",{staticClass:"txt sname"},[e._v(e._s(e.senderName)+": ")]):e._e(),n("span",{staticClass:"txt"},[n("IncomingMessage",{attrs:{message:e.content.body}})],1)]),"m.encrypted"!==e.content.msgtype||e.urlpreview?e._e():n("div",{staticClass:"previewMessage"},[e.senderName&&"You"!=e.senderName?n("span",{staticClass:"txt sname"},[e._v(e._s(e.senderName)+": ")]):e._e(),n("span",{staticClass:"txt"},[n("IncomingMessage",{attrs:{message:e.decryptEvent.body}})],1)]),"invite"===e.content.membership?n("div",{staticClass:"invitedEvent"},[e.tetatetchat?n("span",{staticClass:"txt"},[e._v(e._s(e.$t("caption.invitationToChat")))]):e._e(),e.tetatetchat?e._e():n("span",{staticClass:"txt"},[e._v(e._s(e.$t("caption.invitationToRoom")))])]):e._e(),"leave"===e.content.membership?n("div",{staticClass:"previewMessage"},[e.senderName?n("span",{staticClass:"txt sname"},[e._v(e._s(e.senderName)+": ")]):e._e(),n("span",{staticClass:"txt sname"},[e._v(" "+e._s(e.name)+" ")]),n("span",{staticClass:"txt"},[e._v(e._s(e.$t("caption.leftChat")))])]):e._e(),"ban"===e.content.membership?n("div",[e.senderName?n("span",{staticClass:"txt sname"},[e._v(e._s(e.senderName)+" ")]):e._e(),e._v(" "),n("span",{staticClass:"txt"},[e._v("banned "+e._s(e.content.displayname))])]):e._e(),"join"===e.content.membership&&e.event.getSender()!==e.userId?n("div",{staticClass:"invitedEvent"},[e.senderName?n("span",{staticClass:"txt sname"},[e._v(e._s(e.senderName)+" ")]):e._e(),n("span",{staticClass:"txt"},[e._v(e._s(e.$t("caption.joined")))])]):e._e(),e.content.name?n("div",[n("span",{staticClass:"txt"},[e._v(e._s(e.$t("caption.chatRenamed"))+" "),n("b",[e._v(e._s(e.content.name))])])]):e._e(),e.content.topic?n("div",[n("span",{staticClass:"txt"},[e._v(e._s(e.$t("caption.chatTopic"))+" "),n("b",[e._v(e._s(e.content.topic.replace(/_/g," ")))])])]):e._e(),e.readed?n("div",{staticClass:"statusWrapper"},[e.my?n("div",{staticClass:"my"},[n("i",{staticClass:"fas fa-check-double"})]):e._e()]):e._e()])},F=[],K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("label",e._l(e.chunks,(function(t,i){return n("label",{key:i,attrs:{chunks:e.chunks}},[t.id?n("label",{staticClass:"likelink",on:{click:function(n){return e.show(t)}}},[e._v("@"+e._s(t.name))]):n("label",[e._v(e._s(t))])])})),0)},q=[],G={name:"IncomingMessage",props:{message:{type:String,default:""}},data(){return{user_id:/\w{68}:/,userCalled:/@\w{68}:\w{1,50}/g}},computed:{chunks:function(){if(-1==this.message.indexOf("@"))return[this.message];var e=this.message.split(this.userCalled),t=Array.from(this.message.matchAll(this.userCalled),e=>e[0]),n=[];return _.each(e,(function(e,i){if(n.push(e),t[i]){var r=t[i].replace("@","").split(":");2==r.length?n.push({id:r[0],name:r[1]}):n.push(t[i])}})),n}},methods:{show:function(e){this.core.mtrx.kit.usersInfoById(e.id).then(e=>{core.mtrx.opencontact(e)})}}},z=G,V=(i("de56"),Object(m["a"])(z,K,q,!1,null,"6b3704ba",null)),H=V.exports,W={props:{event:{},chat:{},decryptEvent:{},notificationPreview:!1,userinfo:Object,readed:Object,my:Boolean},components:{IncomingMessage:H},data:function(){return{meta:{}}},computed:{userId:function(){var e;return null===(e=this.core.user.userinfo)||void 0===e?void 0:e.id},countMembers:function(){var e;return _.size(null===(e=this.chat)||void 0===e?void 0:e.currentState.members)},urlpreview:function(){if("m.file"!==this.content.msgtype)return""},tetatetchat:function(){return this.core.mtrx.kit.tetatetchat(this.chat)},unknowngroupusers:function(){return this.core.mtrx.kit.unknowngroupusers(this.m_chat)},senderName:function(){return this.userinfo.id==this.userId?"You":this.userinfo.name||""},metaPreviewLink:function(){return this.core.mtrx.client.getUrlPreview(this.urlpreview,0).then(e=>this.meta=e),this.meta},ev:function(){return this.event._clearEvent||this.event},content:function(){return this.event.event.content},name:function(){var e=this.$store.state.users[""+y["a"].getmatrixid(this.event.event.state_key)].name;return e==this.senderName?"":e},powerLevels:function(){if("m.room.power_levels"===this.event.event.type&&this.event.event.unsigned.prev_content){let e=Object.keys(y["a"].ObjDiff(this.event.event.content.users,this.event.event.unsigned.prev_content.users)),t=this.$store.state.users[""+y["a"].getmatrixid(e[0])],n=this.event.event.content.users[""+e[0]];if(!_.isEmpty(t)&&e[0]){if(0===n&&t.name)return"unmarked "+t.name+" as moderator";if(50===n&&t.name)return"marked "+t.name+" as moderator"}}}}},J=W,Y=(i("9801"),Object(m["a"])(J,B,F,!1,null,"ba5ac396",null)),Q=Y.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"urlMessage",attrs:{id:"url"}},["impty"==e.urltype||e.error?e._e():n("div",{staticClass:"urlwrapper"},[e.loading?n("div",[n("div",{staticClass:"preloaderWrapperLocal"},[n("linepreloader")],1)]):n("metaMessage",{ref:"metamessage",attrs:{type:e.urltype,name:e.meta["og:site_name"],title:e.meta["og:title"],description:e.meta["og:description"],image:e.previewImageUrl,url:e.url,h:e.meta["og:image:height"],w:e.meta["og:image:width"]},on:{updatedSize:e.updatedSize}})],1)])},Z=[],ee={name:"eventsurl",props:{url:String,preview:Boolean,data:Object},components:{metaMessage:()=>i.e("chunk-6f115af6").then(i.bind(null,"dacd"))},data:function(){return{meta:{},loading:!0,error:!1,groups:{p:["pocketnet.app","bastyon.com"],pt:["test.pocketnet.app","test.bastyon.com"]}}},computed:Object(u["c"])({auth:e=>e.auth,clearurl:function(){var e=this.url||"";return e=e.replace("http://","https://"),-1==e.indexOf("https://")&&(e="https://"+e),e},previewImageUrl(){if(this.meta["og:image"])return this.core.mtrx.client.mxcUrlToHttp(this.meta["og:image"])},urltype:function(){if(!this.url)return"empty";if(this.url.indexOf("embedVideo.php")>-1)return"video";var t={};try{t=new URL(this.url)}catch(e){this.error=e}if(!t.pathname||"/"==t.pathname)return"custom";var n=window.pocketnetdomain||"pocketnet.app";if(this.url.indexOf("publicroom=")>-1)return"matrix";if(this.url.indexOf("connect=")>-1)return"matrix";if(this.url.indexOf("bastyon://")>-1)return"pocketnet";if(this.url.indexOf("pocketnet://")>-1)return"pocketnet";var i=_.find(this.groups,(function(e){return _.indexOf(e,t.host)>-1&&_.indexOf(e,n)>-1}));return i&&-1==this.url.indexOf("embedVideo.php")?"pocketnet":"custom"}}),mounted:function(){"custom"==this.urltype?this.geturl():this.loading=!1},methods:{updatedSize:function(e){this.$emit("updatedSize",e)},geturl:function(){this.loading=!0,this.core.mtrx.client.getUrlPreview(this.clearurl,0).then(e=>{this.loading=!1,this.meta=e}).catch(e=>{this.meta={},this.loading=!1})}}},te=ee,ne=(i("fdca"),Object(m["a"])(te,X,Z,!1,null,"791cf1f7",null)),ie=ne.exports,re=i("8ff0"),oe=i.n(re),se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"voiceMessage",class:{playing:e.isPlaying}},[n("div",{staticClass:"voiceMessage_wrapper"},[n("button",{staticClass:"voiceMessage_toggle",class:{encrypted:e.encrypted},on:{touchend:e.audioToggle,click:e.audioToggleClick}},[n("i",{class:e.isPlaying?"fas fa-pause":"fas fa-play"})]),n("div",{staticClass:"voiceMessage_graph"},[n("canvas",{ref:"canvas",attrs:{width:"100",height:"50"},on:{mousedown:e.goTo}})]),n("div",{staticClass:"voiceMessage_options"},[e.error?e._e():n("span",[e._v(e._s(e.getDurationString))]),e.error?n("i",{staticClass:"fas fa-exclamation-circle"}):e._e()]),e.encrypted&&!e.error?n("div",{staticClass:"encsign"},[n("i",{staticClass:"fas fa-lock"})]):e._e()])])},ae=[],ce={name:"VoiceMessage",props:{decryptedInfo:[Object,ArrayBuffer],audioBuffer:{type:null|String,required:!0},id:{type:Number}},data(){return{voiceMessage:null,isPlaying:!1,interval:null,audioContext:null,audio:null,duration:null,currentTime:null,signal:null,audiobuffer:null,error:null}},inject:["addToQueue","playNext"],mounted(){this.initVoiceMessage()},beforeDestroy(){this.isPlaying&&this.pause(),this.interval&&(clearInterval(this.interval),this.interval=null)},watch:{isPlaying:function(e){this.isPlaying}},computed:{encrypted(){return!!this.decryptedInfo},...Object(u["c"])({mobile:e=>e.mobile}),getDurationString(){if(this.duration){let e,t;return this.currentTime?(e=Math.floor(this.currentTime),t=Math.floor(this.currentTime/60),`${t}:${e<10?"0"+e:e}`):(t=Math.floor(this.duration/60),e=Math.floor(this.duration-60*t),`${t}:${e<10?"0"+e:e}`)}return"0:00"},percentPlayed(){return this.currentTime/this.duration},localBuffer(){return y["a"].copyArrayBuffer(this.audioBuffer)}},methods:{goTo(e){if(this.$refs.canvas){var t=e.offsetX/this.$refs.canvas.width*this.duration;this.isPlaying?(this.pause(),setTimeout(()=>{this.setTime(t),this.play()},20)):(this.setTime(t),this.play())}},audioToggleClick(){this.mobile||this.audioToggle()},audioToggle(){this.isPlaying?this.pause():this.play()},pause(){this.audio&&(this.audio.stop(),this.audio.disconnect()),this.isPlaying=!1,this.draw();let e=this.$store.state.currentPlayingVoiceMessage;e&&e.id==this.id&&this.$store.commit("SET_CURRENT_PLAYING_VOICE_MESSAGE",null),this.interval&&(clearInterval(this.interval),this.interval=null)},play(){if(!this.audiobuffer)return;if(this.error)return void this.playNext(this.id);this.audioContext=this.core.getAudioContext(),this.isPlaying=!0,this.audio=this.initAudioNode(),this.currentTime>=this.duration&&this.setTime(0),this.audio.start?this.audio.start(0,this.currentTime):this.audio.play?this.audio.play(0,this.currentTime):this.audio.noteOn&&this.audio.noteOn(0,this.currentTime);let e=this.$store.state.currentPlayingVoiceMessage;e&&e.id!==this.id&&e.pause(),this.$store.commit("SET_CURRENT_PLAYING_VOICE_MESSAGE",this),this.interval&&clearInterval(this.interval);var t=50;this.interval=setInterval(()=>{var e=this.currentTime+t/1e3;this.duration-t/1e3<e&&(e=this.duration),this.currentTime>this.duration&&this.pause(),this.draw(),this.setTime(e)},t)},draw(){const e=this.$refs.canvas;if(!this.signal)return;if(!e)return;const t=this.signal;var n=e.width,i=e.height,r=t.length,o=this.percentPlayed;const s=e.getContext("2d");s.clearRect(0,0,n,i);var a=Math.floor(r/20);for(let c=0;c<r;c+=a){let e=Math.floor(c/r*n),a=Math.abs(t[c]*i)+1;s.fillStyle=c/r<=o?"#00a4ff":"#8bddfb",s.fillRect(e,i/2-a/2,2,a)}},initAudioNode(){let e=null;return e=this.audioContext.createBufferSource(),e.buffer=this.audiobuffer,e.connect(this.audioContext.destination),e.onended=()=>{this.audio=null,this.isPlaying&&setTimeout(()=>{this.playNext(this.id)},300),this.duration-100<this.currentTime&&this.setTime(0),this.pause()},e},setTime(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.currentTime=e},initVoiceMessage(){var t=this;return Object(s["a"])((function*(){try{t.audioContext=t.core.getAudioContext()}catch(e){t.error=e}if(!t.error){t.addToQueue(t,t.id),t.duration=0,t.setTime(0);try{yield t.audioContext.decodeAudioData(t.localBuffer,e=>{t.audiobuffer=e,t.duration=e.duration,t.setTime(0),t.signal=e.getChannelData(0),t.draw()})}catch(e){t.error=e}}}))()}}},le=ce,ue=(i("a421"),Object(m["a"])(le,se,ae,!1,null,"aae169ce",null)),de=ue.exports,he={name:"eventsMessage",props:{decryptEvent:{},origin:Object,prevevent:Object,event:Object,preview:Boolean,userinfo:Object,readed:Object,downloaded:Boolean,baseImg:{type:String,default:"empty"},filePreview:Object,imgEvent:{},add_image:Function,goToGallery:Function,chat:Object,encrypted:!1,encryptedData:Boolean,decryptedInfo:null,error:String,withImage:Boolean,reference:Object,last:Boolean,showmyicontrue:!1,fromreference:Boolean,multiSelect:{default:!1,type:Boolean},selectedMessages:{default:[],type:Array},isRemoveSelectedMessages:!1,audioBuffer:null},directives:{imagesLoaded:oe.a},data:function(){return{referenceshowed:!1}},components:{actions:x,filePreview:L,fileMessage:$["a"],listPreview:Q,url:ie,dummypreviews:a["a"],IncomingMessage:H,VoiceMessage:de},watch:{isRemoveSelectedMessages:{immediate:!0,handler:function(){if(this.isRemoveSelectedMessages){for(let e=0;e<this.selectedMessages.length;e++)if(this.selectedMessages[e].message_id===this.origin.event.event_id)return this.$emit("remove"),this.core.mtrx.client.redactEvent(this.chat.roomId,this.origin.event.event_id,null,{reason:"messagedeleting"});this.$emit("messagesIsDeleted",!0)}}},readyToRender:{immediate:!0,handler:function(){this.readyToRender&&this.$emit("readyToRender")}}},computed:{showburn:function(){return new Date<new Date(2021,11,28)?"":-moment().diff(this.willburn,this.core.options.burn.v)<this.core.options.burn.b?"big":-moment().diff(this.willburn,this.core.options.burn.v)<this.core.options.burn.m?"medium":""},willburn:function(){var e=moment(this.origin._localTimestamp).add(this.core.options.burn.w,this.core.options.burn.v);return e},readyToRender:function(){var e="m.encrypted"===this.content.msgtype&&!this.textWithoutLinks&&this.badenctypted||this.content.membership||("m.text"===this.content.msgtype||"m.encrypted"===this.content.msgtype)&&this.textWithoutLinks||this.file||this.error||"m.image"===this.content.msgtype&&this.imageUrl||"m.audio"===this.content.msgtype&&this.audioUrl||this.urlpreview||this.preview;return e},my:function(){var e;return this.userinfo.id===(null===(e=this.core.user.userinfo)||void 0===e?void 0:e.id)},stateChat:function(){var e=this.$route.query.id;return this.$store.state.chatsMap[e]},sending:function(){return"sending"==this.origin.status},showmeta:function(){if(!this.prevevent)return!0;var e=this.$f.getmatrixid(this.prevevent.getSender()),t=6e5;return 0!=moment().diff(this.origin._localTimestamp,"days")&&(t=864e5),e!=this.userinfo.id||this.prevevent._localTimestamp+t<this.origin._localTimestamp||void 0},imageFrom:function(){if(this.content&&this.content.info)return this.content.info.from},showmyicon:function(){return this.showmyicontrue||"m.image"===this.content.msgtype||"m.file"===this.content.msgtype||this.urlpreview||!this.$store.state.active&&this.$store.state.minimized},file:function(){if("m.file"===this.content.msgtype)return this.body},replacedmintionsbody:function(){return this.body.replace(/@\w{68}:(\w{1,50})/g,(function(e,t){return"@"+t}))},body:function(){var e=this.origin.event.content;return"m.encrypted"==this.origin.event.content.msgtype&&(e=this.decryptEvent),e.pbody||e.body||""},content:function(){return this.origin.event.content},badenctypted:function(){return"m.bad.encrypted"==this.decryptEvent.msgtype},textWithoutLinks:function(){var e=this.$f.trim(this.body);return!this.urlpreview||this.urlpreview.length<10||e.indexOf(this.urlpreview)>0&&e.indexOf(this.urlpreview)+this.urlpreview.length<e.length?e:this.$f.trim(e.replace(this.urlpreview,""))},imageUrl:function(){if("m.image"===this.content.msgtype)return this.encryptedData?this.decryptedInfo:this.content&&this.content.url},audioUrl:function(){if("m.audio"===this.content.msgtype)return this.encryptedData&&this.decryptedInfo?this.decryptedInfo:this.audioBuffer},canediting:function(){var e=y["a"].deep(this.origin,"event.type");if("m.room.message"==e&&("m.encrypted"==this.origin.event.content.msgtype||"m.text"==this.origin.event.content.msgtype))return!0},cancopy:function(){var e=y["a"].deep(this.origin,"event.type");if("m.room.message"==e&&("m.encrypted"==this.origin.event.content.msgtype||"m.text"==this.origin.event.content.msgtype))return!0},menuItems:function(){var e=[{click:"reply",title:this.$i18n.t("button.reply"),icon:"fas fa-reply"},{click:"showMultiSelect",title:this.$i18n.t("button.select"),icon:"fas fa-check-circle"},{click:"share",title:this.$i18n.t("button.share"),icon:"fas fa-share-alt"}];this.my&&e.push({click:"delete",title:this.$i18n.t("button.delete"),icon:"far fa-trash-alt"});var t=y["a"].deep(this.origin,"event.type");return"m.room.message"==t&&(e.unshift({click:"copy",title:this.$i18n.t("button.copy"),icon:"far fa-copy"}),this.my&&this.canediting&&e.unshift({click:"edit",title:this.$i18n.t("button.edit"),icon:"far fa-edit"})),e},urlpreview:function(){if(!this.preview&&"m.file"!==this.content.msgtype){var e=y["a"].getUrl(this.body);if(e){var t=new URL(e);return"/"==t.pathname&&y["a"].knsite(e)?"":e}return e||""}},edited:function(){return!!this.content.edited||(!(!this.origin.event.content["m.relates_to"]||"m.replace"!=this.origin.event.content["m.relates_to"]["rel_type"])||void 0)},selectedMessage:function(){var e;const t=this.selectedMessages.filter(e=>e.message_id===this.origin.event.event_id);return(null===(e=t[0])||void 0===e?void 0:e.message_id)===this.origin.event.event_id}},mounted(){},methods:{gotoreference:function(){var e=this.reference.getId();this.$emit("gotoreference",e)},showwhenburn:function(){var e="";e=this.willburn.toDate()<new Date?this.$i18n.t("messagewasburn"):this.$i18n.t("messagewillburn"),this.$store.commit("icon",{icon:"info",message:e})},imagesLoaded:function(){this.updatedSize()},updatedSize:function(e){this.$emit("updatedSize",e)},dropDownMenuShow:function(){setTimeout(()=>{this.setmenu()},200)},setmenu:function(){this.core.menu({items:this.menuItems,handler:this.menuItemClickHandler,item:{}})},menushare:function(){var e,t={};return"m.file"!==this.content.msgtype&&(e=this.$f.trim(this.body)),"m.file"!==this.content.msgtype&&"m.encrypted"!==this.content.msgtype||(t.files=[this.file]),"m.image"===this.content.msgtype&&this.imageUrl&&(t.images=[this.imageUrl]),"m.audio"===this.content.msgtype&&this.audioUrl&&(t.audio=[this.audioUrl]),"m.text"!==this.content.msgtype&&"m.encrypted"!==this.content.msgtype||!e||(t.messages=[e]),t.from=this.userinfo.id,this.$emit("share",t),Promise.resolve()},menuedit:function(){return this.$emit("editing",this.body),Promise.resolve()},menushowMultiSelect:function(){return this.$emit("showMultiSelect"),this.selectMessage(),Promise.resolve()},menureply:function(){return this.$emit("reply"),Promise.resolve()},menucopy:function(){return this.$f.copytext(this.replacedmintionsbody),Promise.resolve()},menudelete:function(){return this.$dialog.confirm("Do you really want to delete message?",{okText:this.$i18n.t("yes"),cancelText:this.$i18n.t("cancel")}).then(e=>(this.$emit("remove"),this.core.mtrx.client.redactEvent(this.chat.roomId,this.origin.event.event_id,null,{reason:"messagedeleting"}))).catch(e=>Promise.resolve())},menuItemClickHandler:function(e,t,n){n.hidePopup(),this["menu"+e.click]().then(e=>{}).catch(e=>{n.showPopup()})},imagePaddingStyle:function(e){if(e.info&&e.info.h&&e.info.w){var t=e.info.h/e.info.w;t>1.7&&(t=1.7);var n="padding-bottom:"+100*t+"%";return n}return""},parser(e){return JSON.parse(e)["og:title"]},openImage(e){this.$emit("openImg",e)},format_date(e){if(e)return 0===moment().diff(e,"days")?new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):moment().year()===moment(e).year()?moment(e).locale(this.$i18n.locale).format("D MMMM"):moment(e).locale(this.$i18n.locale).format("D MMMM YYYY")},download:function(){this.$emit("download")},decryptagain:function(){this.$emit("decryptagain")},openImageGallery(e){this.$emit("openGalleryImg",e)},reshareKeys(){this.chat.roomId},textDonation:function(){var e=this.$i18n.t("caption.somebody"),t="";try{e=this.$f.deep(this,"$store.state.users."+this.content.from).name}catch(i){}var n=this.$i18n.t("caption.somebody");try{n=this.$f.deep(this,"$store.state.users."+this.content.to).name}catch(i){}return t+=e+this.$i18n.t("caption.sent")+this.content.amount+this.$i18n.t("caption.sent")+n,t},menuIsVisibleHandler(e){this.$emit("menuIsVisible",e)},showreference:function(){this.referenceshowed=!this.referenceshowed},selectMessage:function(){var e,t={};"m.file"!==this.content.msgtype&&(e=this.$f.trim(this.body)),"m.file"!==this.content.msgtype&&"m.encrypted"!==this.content.msgtype||(t.files=[this.file]),"m.image"===this.content.msgtype&&this.imageUrl&&(t.images=[this.imageUrl]),"m.audio"===this.content.msgtype&&this.decryptedInfo&&(t.audio=[this.decryptedInfo]),"m.text"!==this.content.msgtype&&"m.encrypted"!==this.content.msgtype||!e||(t.messages=[e]),t.from=this.userinfo.id,this.$emit("selectMessage",{message_id:this.origin.event.event_id,...t})},removeMessage:function(){this.$emit("removeMessage",{message_id:this.origin.event.event_id})},eventMessage:function(e){e?this.removeMessage():this.selectMessage()}}},me=he,pe=(i("9389"),Object(m["a"])(me,C,k,!1,null,"3f11cd6c",null)),fe=pe.exports,ge={name:"eventsEvent",components:{common:f,member:w,message:fe,dummypreviews:a["a"]},data:function(){return{readed:null,decryptEvent:{},decryptedInfo:null,decryptReady:"",readyEvent:!1,downloading:!1,error:null,reference:null,removed:!1,downloaded:!1,readedInterval:null,audioBuffer:null,readyToRender:!1}},props:{event:Object,prevevent:Object,preview:Boolean,withImage:Boolean,timeline:Object,last:Boolean,chat:Object,showmyicontrue:Boolean,metaUrl:String,galleryData:{},goToGallery:Function,clientWidth:Number,fromreference:Boolean,multiSelect:{default:!1,type:Boolean},selectedMessages:{type:Array,default:()=>[]},isRemoveSelectedMessages:!1},computed:{type:function(){var e=y["a"].deep(this,"event.event.type");return["m.room.member"].indexOf(e)>-1?"member":["m.room.message"].indexOf(e)>-1?"message":["m.room.name"].indexOf(e)>-1||["m.room.power_levels"].indexOf(e)>-1?"member":["m.room.redaction"].indexOf(e)>-1?"message":["m.room.topic"].indexOf(e)>-1?"member":""},subtype:function(){return y["a"].deep(this,"event.event.content.msgtype")},encryptedData:function(){return!(!y["a"].deep(this,"event.event.content.info.secrets")&&!y["a"].deep(this,"event.event.content.pbody.secrets"))},userinfo:function(){return this.$f.deep(this,"$store.state.users."+this.$f.getmatrixid(this.event.getSender()))||{}},encrypted:function(){return!(!this.chat||!this.chat.roomId)&&this.core.mtrx.client.isRoomEncrypted(this.chat.roomId)},my:function(){var e;return this.userinfo.id===(null===(e=this.core.user.userinfo)||void 0===e?void 0:e.id)}},beforeDestroy:function(){this.readedInterval&&(clearInterval(this.readedInterval),this.readedInterval=null)},mounted:function(){this.$emit("mounted")},watch:{readed:{immediate:!0,handler:function(){this.manageReadedInterval()}},last:{handler:function(){this.manageReadedInterval()}},event:{immediate:!0,handler:function(){this.decryptEvent={},this.checkReaded(),this.relations(),this.encryptedData||"m.encrypted"==this.subtype?y["a"].pretry(()=>this.chat.pcrypto,20,1e4).then(()=>{this.encryptedData&&"m.image"==this.subtype&&this.decryptImage(),this.encryptedData&&"m.audio"==this.subtype&&this.decryptAudio(),"m.encrypted"==this.subtype&&this.decrypt()}):"m.audio"==this.subtype&&this.getAudioUnencrypt()}}},methods:{setReadyToRender(){setTimeout(()=>{this.readyToRender=!0},20)},manageReadedInterval(){!this.preview&&this.my&&(this.last||this.readed?this.readedInterval||(this.readedInterval=setInterval(()=>{this.checkReaded()},500)):this.readedInterval&&(clearInterval(this.readedInterval),this.readedInterval=null))},relations(){if(this.timeline){var e=this.timeline._timelineSet,t=this.event;if(!this.reference&&t.event.content["m.relates_to"]&&t.event.content["m.relates_to"]&&"m.reference"==t.event.content["m.relates_to"]["rel_type"]){var n=t.event.content["m.relates_to"]["event_id"];n&&this.core.mtrx.client.getEventTimeline(e,n).then(i=>{var r=_.find(i.getEvents(),e=>{if(e.getId()==n)return!0});if(r){this.reference=t.event.content.reference=r;var o=e.getRelationsForEvent(this.core.mtrx.clearEventId(r),"m.replace","m.room.message");if(o){var s=o.getLastReplacement();s&&(r.event.content.body=s.event.content.body,r.event.content.edited=s.event.event_id)}}})}}},editing(e){this.$emit("editing",e)},reply(){this.$emit("reply")},share(e){var t=Promise.resolve();return e.download&&(t=this.core.mtrx.getFile(this.chat,this.event).then(e=>y["a"].Base64.fromFile(e.file)).then(t=>(e.files=[t],Promise.resolve()))),t.then(()=>this.core.share(e))},downloadFile(){this.downloading=!0,this.core.mtrx.downloadFile(this.chat,this.event).catch(e=>(this.error=e.toString(),Promise.resolve(e))).then(e=>{this.downloading=!1,this.downloaded=!0,this.$store.commit("icon",{icon:"success",message:"Downloaded"})}).catch(e=>{this.$store.commit("icon",{icon:"error",message:"Downloading Failed"})})},getAudioUnencrypt(){this.core.mtrx.getAudioUnencrypt(this.chat,this.event).then(e=>{this.audioBuffer=e}).catch(e=>{})},decryptAudio(){var e=this;return Object(s["a"])((function*(){e.core.mtrx.getAudio(e.chat,e.event).then(t=>{e.decryptedInfo=t}).catch(t=>{e.event.event.decryptKey=e.decryptKey={msgtype:"m.bad.encrypted"}})}))()},decryptImage(){var e=this;return Object(s["a"])((function*(){e.core.mtrx.getImage(e.chat,e.event).then(t=>{e.decryptedInfo=t}).catch(t=>{e.event.event.decryptKey=e.decryptKey={msgtype:"m.bad.encrypted"}})}))()},decryptAgain(){var e=this;return Object(s["a"])((function*(){return e.event.event.decrypted=null,e.decrypt()}))()},decrypt(){var t=this;return Object(s["a"])((function*(){if(t.event.event.decrypted)return t.decryptEvent=t.event.event.decrypted,Promise.resolve();try{var n=yield t.chat.pcrypto.decryptEvent(t.event.event);t.decryptEvent=n,t.event.event.decrypted=t.decryptEvent}catch(e){console.error(e),t.event.event.decrypted=t.decryptEvent={msgtype:"m.bad.encrypted"}}}))()},checkReaded:function(){this.event&&this.core.mtrx.isReaded(this.event).then(e=>{this.readed=e||null})},openImage:function(){this.$emit("openImageEvent",this.event)},removeEvent:function(e){this.$emit("removeEvent",e),this.removed=!0},menuIsVisibleHandler:function(e){this.$emit("menuIsVisible",e)},selectMessage:function(e){this.$emit("selectMessage",e)},removeMessage:function(e){this.$emit("removeMessage",e)},shareManyMessages:function(e){this.$emit("shareManyMessages",e)},messagesIsDeleted:function(e){this.$emit("messagesIsDeleted",e)}}},ve=ge,ye=(i("60b9"),Object(m["a"])(ve,r,o,!1,null,"72e46191",null));n["default"]=ye.exports},"62d6":function(e,t,n){"use strict";n("c776")},6358:function(e,t,n){},6386:function(e,t,n){"use strict";n("d9e2");var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimelineSet=h;var r=n("faa1"),o=n("e685"),s=n("a120"),a=i(n("3987")),c=n("63c7"),l=n("3ed0");const u=!0;let d;function h(e,t){this.room=e,this._timelineSupport=Boolean(t.timelineSupport),this._liveTimeline=new o.EventTimeline(this),this._unstableClientRelationAggregation=!!t.unstableClientRelationAggregation,this._timelines=[this._liveTimeline],this._eventIdToTimeline={},this._filter=t.filter||null,this._unstableClientRelationAggregation&&(this._relations={})}d=u?c.logger.log.bind(c.logger):function(){},a.inherits(h,r.EventEmitter),h.prototype.getTimelines=function(){return this._timelines},h.prototype.getFilter=function(){return this._filter},h.prototype.setFilter=function(e){this._filter=e},h.prototype.getPendingEvents=function(){return this.room?this._filter?this._filter.filterRoomTimeline(this.room.getPendingEvents()):this.room.getPendingEvents():[]},h.prototype.getLiveTimeline=function(){return this._liveTimeline},h.prototype.eventIdToTimeline=function(e){return this._eventIdToTimeline[e]},h.prototype.replaceEventId=function(e,t){const n=this._eventIdToTimeline[e];n&&(delete this._eventIdToTimeline[e],this._eventIdToTimeline[t]=n)},h.prototype.resetLiveTimeline=function(e,t){const n=!this._timelineSupport||!t,i=this._liveTimeline,r=n?i.forkLive(o.EventTimeline.FORWARDS):i.fork(o.EventTimeline.FORWARDS);n?(this._timelines=[r],this._eventIdToTimeline={}):this._timelines.push(r),t&&i.setPaginationToken(t,o.EventTimeline.FORWARDS),r.setPaginationToken(e,o.EventTimeline.BACKWARDS),this._liveTimeline=r,this.emit("Room.timelineReset",this.room,this,n)},h.prototype.getTimelineForEvent=function(e){const t=this._eventIdToTimeline[e];return void 0===t?null:t},h.prototype.findEventById=function(e){const t=this.getTimelineForEvent(e);if(t)return a.findElement(t.getEvents(),(function(t){return t.getId()==e}))},h.prototype.addTimeline=function(){if(!this._timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");const e=new o.EventTimeline(this);return this._timelines.push(e),e},h.prototype.addEventsToTimeline=function(e,t,n,i){if(!n)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!t&&n==this._liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(this._filter&&(e=this._filter.filterRoomTimeline(e),!e.length))return;const r=t?o.EventTimeline.BACKWARDS:o.EventTimeline.FORWARDS,s=t?o.EventTimeline.FORWARDS:o.EventTimeline.BACKWARDS;let a=!1,l=!1;for(let u=0;u<e.length;u++){const i=e[u],h=i.getId(),m=this._eventIdToTimeline[h];if(!m){this.addEventToTimeline(i,n,t),l=!0,a=!0;continue}if(l=!1,m==n){d("Event "+h+" already in timeline "+n);continue}const p=n.getNeighbouringTimeline(r);if(p){d(m==p?"Event "+h+" in neighbouring timeline - switching to "+m:"Event "+h+" already in a different timeline "+m),n=m;continue}c.logger.info("Already have timeline for "+h+" - joining timeline "+n+" to "+m);const f=m===this._liveTimeline,g=n===this._liveTimeline,v=r===o.EventTimeline.BACKWARDS&&f,y=r===o.EventTimeline.FORWARDS&&g;v||y?(v&&c.logger.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+m+")"),y&&c.logger.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+n+")")):(n.setNeighbouringTimeline(m,r),m.setNeighbouringTimeline(n,s),n=m,a=!0)}if(l||!a){if(r===o.EventTimeline.FORWARDS&&n===this._liveTimeline)return c.logger.warn({lastEventWasNew:l,didUpdate:a}),void c.logger.warn(`Refusing to set forwards pagination token of live timeline ${n} to ${i}`);n.setPaginationToken(i,r)}},h.prototype.addLiveEvent=function(e,t,n){if(this._filter){const t=this._filter.filterRoomTimeline([e]);if(!t.length)return}const i=this._eventIdToTimeline[e.getId()];if(i)if("replace"===t){d("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());const t=i.getEvents();for(let n=0;n<t.length;n++)if(t[n].getId()===e.getId()){o.EventTimeline.setEventMetadata(e,i.getState(o.EventTimeline.FORWARDS),!1),t[n].encryptedType||(t[n]=e);break}}else d("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());else this.addEventToTimeline(e,this._liveTimeline,!1,n)},h.prototype.addEventToTimeline=function(e,t,n,i){const r=e.getId();t.addEvent(e,n),this._eventIdToTimeline[r]=t,this.setRelationsTarget(e),this.aggregateRelations(e);const o={timeline:t,liveEvent:!n&&t==this._liveTimeline&&!i};this.emit("Room.timeline",e,this.room,Boolean(n),!1,o)},h.prototype.handleRemoteEcho=function(e,t,n){const i=this._eventIdToTimeline[t];i?(delete this._eventIdToTimeline[t],this._eventIdToTimeline[n]=i):this._filter?this._filter.filterRoomTimeline([e]).length&&this.addEventToTimeline(e,this._liveTimeline,!1):this.addEventToTimeline(e,this._liveTimeline,!1)},h.prototype.removeEvent=function(e){const t=this._eventIdToTimeline[e];if(!t)return null;const n=t.removeEvent(e);if(n){delete this._eventIdToTimeline[e];const i={timeline:t};this.emit("Room.timeline",n,this.room,void 0,!0,i)}return n},h.prototype.compareEventOrdering=function(e,t){if(e==t)return 0;const n=this._eventIdToTimeline[e],i=this._eventIdToTimeline[t];if(void 0===n)return null;if(void 0===i)return null;if(n===i){let i,r;const o=n.getEvents();for(let n=0;n<o.length&&(void 0===i||void 0===r);n++){const s=o[n].getId();s==e&&(i=n),s==t&&(r=n)}return i-r}let r=n;while(r){if(r===i)return-1;r=r.getNeighbouringTimeline(o.EventTimeline.FORWARDS)}r=n;while(r){if(r===i)return 1;r=r.getNeighbouringTimeline(o.EventTimeline.BACKWARDS)}return null},h.prototype.getRelationsForEvent=function(e,t,n){if(!this._unstableClientRelationAggregation)throw new Error("Client-side relation aggregation is disabled");if(!e||!t||!n)throw new Error("Invalid arguments for `getRelationsForEvent`");const i=this._relations[e]||{},r=i[t]||{};return r[n]},h.prototype.setRelationsTarget=function(e){if(!this._unstableClientRelationAggregation)return;const t=this._relations[e.getId()];if(!t)return;const n=t["m.replace"];if(!n)return;const i=n["m.room.message"];i&&i.setTargetEvent(e)},h.prototype.aggregateRelations=function(e){if(!this._unstableClientRelationAggregation)return;if(e.isRedacted()||e.status===s.EventStatus.CANCELLED)return;if(e.isBeingDecrypted())return void e.once("Event.decrypted",()=>{this.aggregateRelations(e)});const t=e.getRelation();if(!t)return;const n=t.event_id,i=t.rel_type,r=e.getType();let o=this._relations[n];o||(o=this._relations[n]={});let a=o[i];a||(a=o[i]={});let c,u=a[r],d=!1;u||(u=a[r]=new l.Relations(i,r,this.room),d=!0,c=this.findEventById(n)||this.room.getPendingEvent(n),c&&u.setTargetEvent(c)),u.addEvent(e),d&&c&&c.emit("Event.relationsCreated",i,r)}},"63c7":function(e,t,n){"use strict";var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var r=i(n("5c7d"));const o="matrix";r.default.methodFactory=function(e,t,n){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.prefix&&t.unshift(this.prefix)}};const s=r.default.getLogger(o);function a(e){e.withPrefix=function(e){const t=this.prefix||"";return c(t+e)}}function c(e){const t=r.default.getLogger(`${o}-${e}`);return t.prefix!==e&&(a(t),t.prefix=e,t.setLevel(r.default.levels.DEBUG)),t}t.logger=s,s.setLevel(r.default.levels.DEBUG),a(s)},"646c":function(t,n,i){"use strict";(function(t){var r=i("c973").default,o=i("dbce");Object.defineProperty(n,"__esModule",{value:!0}),n.SyncApi=b;var s=i("87d6"),a=i("0594"),c=i("d15f"),l=o(i("3987")),u=i("c976"),d=i("e685"),h=i("ef06"),m=i("63c7"),p=i("0023");const f=!0,g=8e4,v=3;function y(e,t){return"FILTER_SYNC_"+e+(t?"_"+t:"")}function _(){f&&m.logger.log(...arguments)}function b(e,t){this.client=e,t=t||{},t.initialSyncLimit=void 0===t.initialSyncLimit?8:t.initialSyncLimit,t.resolveInvitesToProfiles=t.resolveInvitesToProfiles||!1,t.pollTimeout=t.pollTimeout||3e4,t.pendingEventOrdering=t.pendingEventOrdering||"chronological",t.canResetEntireTimeline||(t.canResetEntireTimeline=function(e){return!1}),this.opts=t,this._peekRoom=null,this._currentSyncRequest=null,this._syncState=null,this._syncStateData=null,this._catchingUp=!1,this._running=!1,this._keepAliveTimer=null,this._connectionReturnedDefer=null,this._notifEvents=[],this._failedSyncCount=0,this._storeIsInvalid=!1,e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),["Room.timeline","Room.timelineReset"])}function E(e,t){const n=new s.User(t);return e.reEmitter.reEmit(n,["User.avatarUrl","User.displayName","User.presence","User.currentlyActive","User.lastPresenceTs"]),n}b.prototype.createRoom=function(e){const t=this.client,{timelineSupport:n,unstableClientRelationAggregation:i}=t,r=new a.Room(e,t,t.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n,unstableClientRelationAggregation:i});return t.reEmitter.reEmit(r,["Room.name","Room.avatar","Room.timeline","Room.redaction","Room.redactionCancelled","Room.receipt","Room.tags","Room.timelineReset","Room.localEchoUpdated","Room.accountData","Room.myMembership","Room.replaceEvent"]),this._registerStateListeners(r),r},b.prototype.createGroup=function(e){const t=this.client,n=new c.Group(e);return t.reEmitter.reEmit(n,["Group.profile","Group.myMembership"]),t.store.storeGroup(n),n},b.prototype._registerStateListeners=function(e){const t=this.client;t.reEmitter.reEmit(e.currentState,["RoomState.events","RoomState.members","RoomState.newMember"]),e.currentState.on("RoomState.newMember",(function(e,n,i){i.user=t.getUser(i.userId),t.reEmitter.reEmit(i,["RoomMember.name","RoomMember.typing","RoomMember.powerLevel","RoomMember.membership"])}))},b.prototype._deregisterStateListeners=function(e){e.currentState.removeAllListeners("RoomState.events"),e.currentState.removeAllListeners("RoomState.members"),e.currentState.removeAllListeners("RoomState.newMember")},b.prototype.syncLeftRooms=function(){const e=this.client,t=this,n=new u.Filter(this.client.credentials.userId);n.setTimelineLimit(1),n.setIncludeLeaveRooms(!0);const i=this.opts.pollTimeout+g,r={timeout:0};return e.getOrCreateFilter(y(e.credentials.userId,"LEFT_ROOMS"),n).then((function(t){return r.filter=t,e._http.authedRequest(void 0,"GET","/sync",r,void 0,i)})).then((function(n){let i=[];n.rooms&&n.rooms.leave&&(i=t._mapSyncResponseToRoomArray(n.rooms.leave));const r=[];return i.forEach((function(n){const i=n.room;if(r.push(i),!n.isBrandNewRoom)return;n.timeline=n.timeline||{};const o=t._mapSyncEventsFormat(n.timeline,i),s=t._mapSyncEventsFormat(n.state,i);i.getLiveTimeline().setPaginationToken(n.timeline.prev_batch,d.EventTimeline.BACKWARDS),t._processRoomEvents(i,s,o),i.recalculate(),e.store.storeRoom(i),e.emit("Room",i),t._processEventsForNotifs(i,o)})),r}))},b.prototype.peek=function(e){if(this._peekRoom&&this._peekRoom.roomId===e)return Promise.resolve(this._peekRoom);const t=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,20).then(e=>{e.messages=e.messages||{},e.messages.chunk=e.messages.chunk||[],e.state=e.state||[];const n=l.map(l.deepCopy(e.state),t.getEventMapper()),i=l.map(e.state,t.getEventMapper()),r=l.map(e.messages.chunk,t.getEventMapper());return e.presence&&l.isArray(e.presence)&&e.presence.map(t.getEventMapper()).forEach((function(e){let n=t.store.getUser(e.getContent().user_id);n?n.setPresenceEvent(e):(n=E(t,e.getContent().user_id),n.setPresenceEvent(e),t.store.storeUser(n)),t.emit("event",e)})),e.messages.start&&(this._peekRoom.oldState.paginationToken=e.messages.start),this._peekRoom.oldState.setStateEvents(n),this._peekRoom.currentState.setStateEvents(i),this._resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(r.reverse(),!0,this._peekRoom.getLiveTimeline(),e.messages.start),t.store.storeRoom(this._peekRoom),t.emit("Room",this._peekRoom),this._peekPoll(this._peekRoom),this._peekRoom})},b.prototype.stopPeeking=function(){this._peekRoom=null},b.prototype._peekPoll=function(e,t){if(this._peekRoom!==e)return void _("Stopped peeking in room %s",e.roomId);const n=this;this.client._http.authedRequest(void 0,"GET","/events",{room_id:e.roomId,timeout:3e4,from:t},void 0,5e4).then((function(t){if(n._peekRoom!==e)return void _("Stopped peeking in room %s",e.roomId);t.chunk.filter((function(e){return"m.presence"===e.type})).map(n.client.getEventMapper()).forEach((function(e){let t=n.client.store.getUser(e.getContent().user_id);t?t.setPresenceEvent(e):(t=E(n.client,e.getContent().user_id),t.setPresenceEvent(e),n.client.store.storeUser(t)),n.client.emit("event",e)}));const i=t.chunk.filter((function(t){return t.room_id===e.roomId&&t.event_id})).map(n.client.getEventMapper());e.addLiveEvents(i),n._peekPoll(e,t.end)}),(function(i){m.logger.error("[%s] Peek poll failed: %s",e.roomId,i),setTimeout((function(){n._peekPoll(e,t)}),3e4)}))},b.prototype.getSyncState=function(){return this._syncState},b.prototype.getSyncStateData=function(){return this._syncStateData},b.prototype.recoverFromSyncStartupError=function(){var e=r((function*(e,t){yield e;const n=this._startKeepAlives();this._updateSyncState("ERROR",{error:t}),yield n}));return function(t,n){return e.apply(this,arguments)}}(),b.prototype._wasLazyLoadingToggled=function(){var e=r((function*(e){e=!!e;let t=!1;const n=yield this.client.store.isNewlyCreated();if(!n){const n=yield this.client.store.getClientOptions();return n&&(t=!!n.lazyLoadMembers),t!==e}return!1}));return function(t){return e.apply(this,arguments)}}(),b.prototype._shouldAbortSync=function(e){return"M_UNKNOWN_TOKEN"===e.errcode&&(m.logger.warn("Token no longer valid - assuming logout"),this.stop(),!0)},b.prototype.sync=function(){var e=this;const n=this.client,i=this;this._running=!0,t.window&&t.window.addEventListener&&(this._onOnlineBound=this._onOnline.bind(this),t.window.addEventListener("online",this._onOnlineBound,!1));let o=Promise.resolve(),s=null;function a(){return c.apply(this,arguments)}function c(){return c=r((function*(){try{_("Getting push rules...");const e=yield n.getPushRules();_("Got push rules"),n.pushRules=e}catch(e){if(m.logger.error("Getting push rules failed",e),i._shouldAbortSync(e))return;return _("Waiting for saved sync before retrying push rules..."),yield i.recoverFromSyncStartupError(o,e),void a()}d()})),c.apply(this,arguments)}function l(){const e=new u.Filter(n.credentials.userId);return e.setTimelineLimit(i.opts.initialSyncLimit),e}const d=function(){var t=r((function*(){if(_("Checking lazy load status..."),e.opts.lazyLoadMembers&&n.isGuest()&&(e.opts.lazyLoadMembers=!1),e.opts.lazyLoadMembers){_("Checking server lazy load support...");const t=yield n.doesServerSupportLazyLoading();t?(_("Enabling lazy load on sync filter..."),e.opts.filter||(e.opts.filter=l()),e.opts.filter.setLazyLoadMembers(!0)):(_("LL: lazy loading requested but not supported by server, so disabling"),e.opts.lazyLoadMembers=!1)}_("Checking whether lazy loading has changed in store...");const t=yield e._wasLazyLoadingToggled(e.opts.lazyLoadMembers);if(t){e._storeIsInvalid=!0;const t=p.InvalidStoreError.TOGGLED_LAZY_LOADING,n=new p.InvalidStoreError(t,!!e.opts.lazyLoadMembers);return e._updateSyncState("ERROR",{error:n}),void m.logger.warn("InvalidStoreError: store is not usable: stopping sync.")}e.opts.lazyLoadMembers&&e.opts.crypto&&e.opts.crypto.enableLazyLoading();try{_("Storing client options..."),yield e.client._storeClientOptions(),_("Stored client options")}catch(i){throw m.logger.error("Storing client options failed",i),i}h()}));return function(){return t.apply(this,arguments)}}();function h(){return f.apply(this,arguments)}function f(){return f=r((function*(){let e,t;_("Getting filter..."),e=i.opts.filter?i.opts.filter:l();try{t=yield n.getOrCreateFilter(y(n.credentials.userId),e)}catch(r){if(m.logger.error("Getting filter failed",r),i._shouldAbortSync(r))return;return _("Waiting for saved sync before retrying filter..."),yield i.recoverFromSyncStartupError(o,r),void h()}n.resetNotifTimelineSet(),null===i._currentSyncRequest&&(_("Sending first sync request..."),i._currentSyncRequest=i._doSyncRequest({filterId:t},s)),_("Waiting for saved sync before starting sync processing..."),yield o,i._sync({filterId:t})})),f.apply(this,arguments)}n.isGuest()?i._sync({}):(_("Getting saved sync token..."),o=n.store.getSavedSyncToken().then(e=>(_("Got saved sync token"),s=e,_("Getting saved sync..."),n.store.getSavedSync())).then(e=>{if(_("Got reply from saved sync, exists? "+!!e),e)return i._syncFromCache(e)}).catch(e=>{m.logger.error("Getting saved sync failed",e)}),a())},b.prototype.stop=function(){_("SyncApi.stop"),t.window&&(t.window.removeEventListener("online",this._onOnlineBound,!1),this._onOnlineBound=void 0),this._running=!1,this._currentSyncRequest&&this._currentSyncRequest.abort(),this._keepAliveTimer&&(clearTimeout(this._keepAliveTimer),this._keepAliveTimer=null)},b.prototype.retryImmediately=function(){return!!this._connectionReturnedDefer&&(this._startKeepAlives(0),!0)},b.prototype._syncFromCache=function(){var t=r((function*(t){_("sync(): not doing HTTP hit, instead returning stored /sync data");const n=t.nextBatch;this.client.store.setSyncToken(n);const i={oldSyncToken:null,nextSyncToken:n,catchingUp:!1,fromCache:!0},r={next_batch:n,rooms:t.roomsData,groups:t.groupsData,account_data:{events:t.accountData}};try{yield this._processSyncResponse(i,r)}catch(e){m.logger.error("Error processing cached sync",e.stack||e)}this._storeIsInvalid||this._updateSyncState("PREPARED",i)}));return function(e){return t.apply(this,arguments)}}(),b.prototype._sync=function(){var t=r((function*(t){const n=this.client;if(!this._running)return _("Sync no longer running: exiting."),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");const i=n.store.getSyncToken();let r;try{null===this._currentSyncRequest&&(this._currentSyncRequest=this._doSyncRequest(t,i)),r=yield this._currentSyncRequest}catch(e){return void this._onSyncError(e,t)}finally{this._currentSyncRequest=null}n.store.setSyncToken(r.next_batch),this._failedSyncCount=0,yield n.store.setSyncData(r);const o={oldSyncToken:i,nextSyncToken:r.next_batch,catchingUp:this._catchingUp};this.opts.crypto&&(yield this.opts.crypto.onSyncWillProcess(o));try{yield this._processSyncResponse(o,r)}catch(e){m.logger.error("Caught /sync error",e.stack||e),this.client.emit("sync.unexpectedError",e)}o.catchingUp=this._catchingUp,t.hasSyncedBefore||(this._updateSyncState("PREPARED",o),t.hasSyncedBefore=!0),this.opts.crypto&&(yield this.opts.crypto.onSyncCompleted(o)),this._updateSyncState("SYNCING",o),n.store.wantsSave()&&(this.opts.crypto&&(yield this.opts.crypto.saveDeviceList(0)),n.store.save()),this._sync(t)}));return function(e){return t.apply(this,arguments)}}(),b.prototype._doSyncRequest=function(e,t){const n=this._getSyncParams(e,t);return this.client._http.authedRequest(void 0,"GET","/sync",n,void 0,n.timeout+g)},b.prototype._getSyncParams=function(e,t){let n=this.opts.pollTimeout;("SYNCING"!==this.getSyncState()||this._catchingUp)&&(this._catchingUp=!0,n=0);let i=e.filterId;this.client.isGuest()&&!i&&(i=this._getGuestFilter());const r={filter:i,timeout:n};return this.opts.disablePresence&&(r.set_presence="offline"),t?r.since=t:r._cacheBuster=Date.now(),"ERROR"!=this.getSyncState()&&"RECONNECTING"!=this.getSyncState()||(r.timeout=0),r},b.prototype._onSyncError=function(e,t){if(!this._running)return _("Sync no longer running: exiting"),this._connectionReturnedDefer&&(this._connectionReturnedDefer.reject(),this._connectionReturnedDefer=null),void this._updateSyncState("STOPPED");m.logger.error("/sync error %s",e),m.logger.error(e),this._shouldAbortSync(e)||(this._failedSyncCount++,m.logger.log("Number of consecutive failed sync requests:",this._failedSyncCount),_("Starting keep-alive"),this._startKeepAlives().then(e=>{e&&"ERROR"===this.getSyncState()&&this._updateSyncState("CATCHUP",{oldSyncToken:null,nextSyncToken:null,catchingUp:!0}),this._sync(t)}),this._currentSyncRequest=null,this._updateSyncState(this._failedSyncCount>=v?"ERROR":"RECONNECTING",{error:e}))},b.prototype._processSyncResponse=function(){var e=r((function*(e,t){const n=this.client,i=this;if(t.presence&&l.isArray(t.presence.events)&&t.presence.events.map(n.getEventMapper()).forEach((function(e){let t=n.store.getUser(e.getSender());t?t.setPresenceEvent(e):(t=E(n,e.getSender()),t.setPresenceEvent(e),n.store.storeUser(t)),n.emit("event",e)})),t.account_data&&l.isArray(t.account_data.events)){const e=t.account_data.events.map(n.getEventMapper()),i=e.reduce((e,t)=>(e[t.getId()]=n.store.getAccountData(t.getType()),e),{});n.store.storeAccountDataEvents(e),e.forEach((function(e){if("m.push_rules"===e.getType()){const t=e.getContent();n.pushRules=h.PushProcessor.rewriteDefaultRules(t)}const t=i[e.getId()];return n.emit("accountData",e,t),e}))}if(t.to_device&&l.isArray(t.to_device.events)&&t.to_device.events.length>0){const e=[];t.to_device.events.map(n.getEventMapper()).map(t=>{if("m.key.verification.cancel"===t.getType()){const n=t.getContent()["transaction_id"];n&&e.push(n)}return t}).forEach((function(t){const i=t.getContent();if("m.room.message"!=t.getType()||"m.bad.encrypted"!=i.msgtype){if("m.key.verification.start"===t.getType()||"m.key.verification.request"===t.getType()){const n=i["transaction_id"];e.includes(n)&&t.flagCancelled()}n.emit("toDeviceEvent",t)}else m.logger.log("Ignoring undecryptable to-device event from "+t.getSender())}))}else this._catchingUp=!1;t.groups&&(t.groups.invite&&this._processGroupSyncEntry(t.groups.invite,"invite"),t.groups.join&&this._processGroupSyncEntry(t.groups.join,"join"),t.groups.leave&&this._processGroupSyncEntry(t.groups.leave,"leave"));let o=[],s=[],a=[];if(t.rooms&&(t.rooms.invite&&(o=this._mapSyncResponseToRoomArray(t.rooms.invite)),t.rooms.join&&(s=this._mapSyncResponseToRoomArray(t.rooms.join)),t.rooms.leave&&(a=this._mapSyncResponseToRoomArray(t.rooms.leave))),this._notifEvents=[],o.forEach((function(e){const t=e.room,r=i._mapSyncEventsFormat(e.invite_state,t);i._processRoomEvents(t,r),e.isBrandNewRoom&&(t.recalculate(),n.store.storeRoom(t),n.emit("Room",t)),r.forEach((function(e){n.emit("event",e)})),t.updateMyMembership("invite")})),yield l.promiseMapSeries(s,function(){var t=r((function*(t){const o=t.room,s=i._mapSyncEventsFormat(t.state,o),a=i._mapSyncEventsFormat(t.timeline,o),c=i._mapSyncEventsFormat(t.ephemeral),u=i._mapSyncEventsFormat(t.account_data);if(t.unread_notifications){o.setUnreadNotificationCount("total",t.unread_notifications.notification_count);const e=n.isRoomEncrypted(o.roomId);(!e||e&&o.getUnreadNotificationCount("highlight")<=0)&&o.setUnreadNotificationCount("highlight",t.unread_notifications.highlight_count)}if(t.timeline=t.timeline||{},t.isBrandNewRoom)o.getLiveTimeline().setPaginationToken(t.timeline.prev_batch,d.EventTimeline.BACKWARDS);else if(t.timeline.limited){let r=!0;for(let e=a.length-1;e>=0;e--){const t=a[e].getId();if(o.getTimelineForEvent(t)){_("Already have event "+t+" in limited sync - not resetting"),r=!1,a.splice(0,e);break}}r&&(i._deregisterStateListeners(o),o.resetLiveTimeline(t.timeline.prev_batch,i.opts.canResetEntireTimeline(o.roomId)?null:e.oldSyncToken),n.resetNotifTimelineSet(),i._registerStateListeners(o))}function h(e){return m.apply(this,arguments)}function m(){return m=r((function*(e){if(n.emit("event",e),e.isState()&&"m.room.encryption"==e.getType()&&i.opts.crypto&&(yield i.opts.crypto.onCryptoEvent(e)),e.isState()&&"im.vector.user_status"===e.getType()){let t=n.store.getUser(e.getStateKey());t?t._unstable_updateStatusMessage(e):(t=E(n,e.getStateKey()),t._unstable_updateStatusMessage(e),n.store.storeUser(t))}})),m.apply(this,arguments)}i._processRoomEvents(o,s,a,e.fromCache),t.summary&&o.setSummary(t.summary),o.addEphemeralEvents(c),o.addAccountData(u),o.recalculate(),t.isBrandNewRoom&&(n.store.storeRoom(o),n.emit("Room",o)),i._processEventsForNotifs(o,a),yield l.promiseMapSeries(s,h),yield l.promiseMapSeries(a,h),c.forEach((function(e){n.emit("event",e)})),u.forEach((function(e){n.emit("event",e)})),o.updateMyMembership("join")}));return function(e){return t.apply(this,arguments)}}()),a.forEach((function(e){const t=e.room,r=i._mapSyncEventsFormat(e.state,t),o=i._mapSyncEventsFormat(e.timeline,t),s=i._mapSyncEventsFormat(e.account_data);i._processRoomEvents(t,r,o),t.addAccountData(s),t.recalculate(),e.isBrandNewRoom&&(n.store.storeRoom(t),n.emit("Room",t)),i._processEventsForNotifs(t,o),r.forEach((function(e){n.emit("event",e)})),o.forEach((function(e){n.emit("event",e)})),s.forEach((function(e){n.emit("event",e)})),t.updateMyMembership("leave")})),e.oldSyncToken&&this._notifEvents.length&&(this._notifEvents.sort((function(e,t){return e.getTs()-t.getTs()})),this._notifEvents.forEach((function(e){n.getNotifTimelineSet().addLiveEvent(e)}))),t.device_lists&&this.opts.crypto&&(yield this.opts.crypto.handleDeviceListChanges(e,t.device_lists)),this.opts.crypto&&t.device_one_time_keys_count){const e=t.device_one_time_keys_count.signed_curve25519||0;this.opts.crypto.updateOneTimeKeyCount(e)}if(this.opts.crypto&&t["org.matrix.msc2732.device_unused_fallback_key_types"]){const e=t["org.matrix.msc2732.device_unused_fallback_key_types"];this.opts.crypto.setNeedsNewFallback(e instanceof Array&&!e.includes("signed_curve25519"))}}));return function(t,n){return e.apply(this,arguments)}}(),b.prototype._startKeepAlives=function(e){void 0===e&&(e=2e3+Math.floor(5e3*Math.random())),null!==this._keepAliveTimer&&clearTimeout(this._keepAliveTimer);const t=this;return e>0?t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t),e):t._pokeKeepAlive(),this._connectionReturnedDefer||(this._connectionReturnedDefer=l.defer()),this._connectionReturnedDefer.promise},b.prototype._pokeKeepAlive=function(e){void 0===e&&(e=!1);const t=this;function n(){clearTimeout(t._keepAliveTimer),t._connectionReturnedDefer&&(t._connectionReturnedDefer.resolve(e),t._connectionReturnedDefer=null)}this.client._http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15e3}).then((function(){n()}),(function(i){400==i.httpStatus||404==i.httpStatus?t._keepAliveTimer=setTimeout(n,2e3):(e=!0,t._keepAliveTimer=setTimeout(t._pokeKeepAlive.bind(t,e),5e3+Math.floor(5e3*Math.random())),t._updateSyncState("ERROR",{error:i}))}))},b.prototype._processGroupSyncEntry=function(e,t){for(const n of Object.keys(e)){const i=e[n];let r=this.client.store.getGroup(n);const o=null===r;null===r&&(r=this.createGroup(n)),i.profile&&r.setProfile(i.profile.name,i.profile.avatar_url),i.inviter&&r.setInviter({userId:i.inviter}),r.setMyMembership(t),o&&this.client.emit("Group",r)}},b.prototype._mapSyncResponseToRoomArray=function(e){const t=this.client,n=this;return l.keys(e).map((function(i){const r=e[i];let o=t.store.getRoom(i),s=!1;return o||(o=n.createRoom(i),s=!0),r.room=o,r.isBrandNewRoom=s,r}))},b.prototype._mapSyncEventsFormat=function(e,t){if(!e||!l.isArray(e.events))return[];const n=this.client.getEventMapper();return e.events.map((function(e){return t&&(e.room_id=t.roomId),n(e)}))},b.prototype._resolveInvites=function(e){if(!e||!this.opts.resolveInvitesToProfiles)return;const t=this.client;e.getMembersWithMembership("invite").forEach((function(n){if(n._requestedProfileInfo)return;n._requestedProfileInfo=!0;const i=t.getUser(n.userId);let r;r=i?Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):t.getProfileInfo(n.userId),r.then((function(t){const i=n.events.member;"invite"===i.getContent().membership&&(i.getContent().avatar_url=t.avatar_url,i.getContent().displayname=t.displayname,n.setMembershipEvent(i,e.currentState))}),(function(e){}))}))},b.prototype._processRoomEvents=function(e,t,n,i){const r=e.getLiveTimeline(),o=0==r.getEvents().length;if(o){for(const e of t)this.client.getPushActionsForEvent(e);r.initialiseState(t)}this._resolveInvites(e),e.recalculate(),o||(e.oldState.setStateEvents(t||[]),e.currentState.setStateEvents(t||[])),e.addLiveEvents(n||[],null,i)},b.prototype._processEventsForNotifs=function(e,t){if(this.client.getNotifTimelineSet())for(let n=0;n<t.length;n++){const e=this.client.getPushActionsForEvent(t[n]);e&&e.notify&&e.tweaks&&e.tweaks.highlight&&this._notifEvents.push(t[n])}},b.prototype._getGuestFilter=function(){const e=this.client._guestRooms;return e?JSON.stringify({room:{timeline:{limit:20}}}):"{}"},b.prototype._updateSyncState=function(e,t){const n=this._syncState;this._syncState=e,this._syncStateData=t,this.client.emit("sync",this._syncState,n,t)},b.prototype._onOnline=function(){_("Browser thinks we are back online"),this._startKeepAlives(0)}}).call(this,i("c8ba"))},"672d":function(e,t,n){},6933:function(e,t,n){},6964:function(e,t,n){"use strict";n("7dff")},"696c":function(t,n,i){"use strict";var r=i("dbce");Object.defineProperty(n,"__esModule",{value:!0}),n.MemoryStore=c;var o=i("87d6"),s=r(i("3987"));function a(e){const t="string"===typeof e&&!!e&&"undefined"!==e&&"null"!==e;return t||"number"===typeof e}function c(e){e=e||{},this.rooms={},this.groups={},this.users={},this.syncToken=null,this.filters={},this.accountData={},this.localStorage=e.localStorage,this._oobMembers={},this._clientOptions={}}c.prototype={getSyncToken:function(){return this.syncToken},isNewlyCreated:function(){return Promise.resolve(!0)},setSyncToken:function(e){this.syncToken=e},storeGroup:function(e){this.groups[e.groupId]=e},getGroup:function(e){return this.groups[e]||null},getGroups:function(){return s.values(this.groups)},storeRoom:function(e){this.rooms[e.roomId]=e,e.currentState.on("RoomState.members",this._onRoomMember.bind(this));const t=this;e.currentState.getMembers().forEach((function(n){t._onRoomMember(null,e.currentState,n)}))},_onRoomMember:function(e,t,n){if("invite"===n.membership)return;const i=this.users[n.userId]||new o.User(n.userId);n.name&&(i.setDisplayName(n.name),n.events.member&&i.setRawDisplayName(n.events.member.getDirectionalContent().displayname)),n.events.member&&n.events.member.getContent().avatar_url&&i.setAvatarUrl(n.events.member.getContent().avatar_url),this.users[i.userId]=i},getRoom:function(e){return this.rooms[e]||null},getRooms:function(){return s.values(this.rooms)},removeRoom:function(e){this.rooms[e]&&this.rooms[e].removeListener("RoomState.members",this._onRoomMember),delete this.rooms[e]},getRoomSummaries:function(){return s.map(s.values(this.rooms),(function(e){return e.summary}))},storeUser:function(e){this.users[e.userId]=e},getUser:function(e){return this.users[e]||null},getUsers:function(){return s.values(this.users)},scrollback:function(e,t){return[]},storeEvents:function(e,t,n,i){},storeFilter:function(e){e&&(this.filters[e.userId]||(this.filters[e.userId]={}),this.filters[e.userId][e.filterId]=e)},getFilter:function(e,t){return this.filters[e]&&this.filters[e][t]?this.filters[e][t]:null},getFilterIdByName:function(t){if(!this.localStorage)return null;const n="mxjssdk_memory_filter_"+t;try{const e=this.localStorage.getItem(n);if(a(e))return e}catch(e){}return null},setFilterIdByName:function(t,n){if(!this.localStorage)return;const i="mxjssdk_memory_filter_"+t;try{a(n)?this.localStorage.setItem(i,n):this.localStorage.removeItem(i)}catch(e){}},storeAccountDataEvents:function(e){const t=this;e.forEach((function(e){t.accountData[e.getType()]=e}))},getAccountData:function(e){return this.accountData[e]},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(e){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return this.rooms={},this.users={},this.syncToken=null,this.filters={},this.accountData={},Promise.resolve()},getOutOfBandMembers:function(e){return Promise.resolve(this._oobMembers[e]||null)},setOutOfBandMembers:function(e,t){return this._oobMembers[e]=t,Promise.resolve()},clearOutOfBandMembers:function(){return this._oobMembers={},Promise.resolve()},getClientOptions:function(){return Promise.resolve(this._clientOptions)},storeClientOptions:function(e){return this._clientOptions=Object.assign({},e),Promise.resolve()}}},"696c2":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"wrapper table"},[n("div",{staticClass:"filecontent"},[n("div",{staticClass:"name"},[n("span",[e._v(e._s(e.file.name))])]),n("div",{staticClass:"size"},[n("span",[e._v(e._s(e.humanReadableSize(e.file.size)))])]),e.encryptedData?n("div",{staticClass:"download"},[n("button",{staticClass:"button small rounded",on:{click:e.download}},[e.downloaded?n("span",[e._v(e._s(e.$t("button.downloaded")))]):n("span",[e._v(e._s(e.$t("button.download")))])])]):n("div",{staticClass:"download"},[n("a",{staticClass:"fileMessage",attrs:{href:e.file.url,download:e.download,target:"_external"}},[n("button",{staticClass:"button small rounded"},[e.downloaded?n("span",[e._v(e._s(e.$t("button.downloaded")))]):n("span",[e._v(e._s(e.$t("button.download")))])])])])]),n("div",{staticClass:"icon"},[n("a",{staticClass:"fileMessage",attrs:{href:e.file.url,download:e.download,target:"_external"}},[n("i",{staticClass:"fas fa-file-download"})])])])},r=[],o=n("3139"),s={props:{preview:Object,file:Object,encryptedData:Boolean,downloaded:Boolean},computed:{getExtension:function(e){var t=e.name.split("."),n=t[t.length-1].toLowerCase();return n}},methods:{humanReadableSize(e){return o["a"].formatBytes(e)},download(){this.$emit("download")}}},a=s,c=(n("8cd8"),n("2877")),l=Object(c["a"])(a,i,r,!1,null,"0f8b05de",null);t["a"]=l.exports},"6b1d":function(e,t,n){"use strict";n("3bbf")},"6bfd":function(e,t,n){"use strict";n("71ff")},"6ce2":function(e){e.exports=JSON.parse('{"caption":{"create":"Create","addPublicChatName":"Add Public Chat Name","addGroupNamePlaceHolder":"Add Group Name","createPublicChat":"Create public chat","chatTopic":"Topic renamed","asModerator":"as moderator","marked":"marked","unmarked":"unmarked","removeBan":"Remove Ban","cancelModeration":"Remove moderation","uploadFiles":"Herunterladen von Dateien","header":"Header","dragAndDropAFile":"Drag & Drop-Datei","chatInvite":"Sie wurden eingeladen mit Benutzer zu chatten:","cantJoion":"Sie können den Chat mit dem Benutzer nicht beitreten:","chatInviteDecline":"Sie können im Chat teilnehmen oder Einladung ablehnen","creatorLeft":"Weil der Schöpfer den Raum verlassen hat","encrypted":"Verschlüssel","noImages":"Es gibt noch keine Bilder in diesem Chat","noFiles":"There are no files in this chat yet","inviteUser":"Benutzer einladen","invite":"Einladen","add":"Hinzufügen","mute":"Stumm","unmute":"Ton aktivieren","leave":"Verlassen","Info":"Info","new":"Neue","typing":"Tippt","accNotFound":"Ihr Konto wurde nicht in der Blockchain gefunden. Vielleicht müssen Sie warten","emptyList":"liste ist leer ( gefiltert oder nur leer )","welcome":"Willkommen bei Pocketnet Chat","startNewChat":"Fangen Sie einen neuen chat an","chats":"Chats","shareWith":"Teilen mit","newChat":"Neuer Chat","moveToChat":"Zum Chat wechseln","queryNoResults":"Abfrage meldet keine Ergebnisse","needMoreCharacters":"Benötigen Sie mehr Zeichen für das Ergebnis","createGroup":"Gruppe erstellen","unabletoDecrypt":"* Kann nicht entschlüsselnt","messageDeleted":"Nachricht gelöscht","sentImage":"gesendetes Bild","sentVoiceMessage":"eine Sprachnachricht gesendet","invitationToChat":"Einladung zum Chat","invitationToRoom":"Invitation to room","leftChat":"Hat den chat verlasst","joined":"beitretet","chatRenamed":"Chat umbenannt in","recentComment":"Letzter Kommentar:","share":"AKTIE","followers":"Anhänger:","reputation":"Reputation:","following":"Folgen:","theme":"Thema:","contacts":"Kontakte","phoneContacts":"Telefonische Kontakte","chooseInviteMedia":"Bitte wählen Sie, wie Sie einladen möchten","admin":"Admin","moderator":"Moderator","videocall":"Videoanrufe","call":"Anruf","leaveAndDelete":"Verlassen und Löschen","donate":"Donate","makeModerator":"Als Moderator ernennen","ban":"Ban","kick":"Kick","members":"Mitglieds","media":"Media","files":"Datei","contactsList":"Kontaktliste","send":"Senden","pageCaption":"Seite Beschriftung","caption":"Beschriftung","text":"Text","placeholder":"Platzhalter","sendTransactionTo":"Transaktion senden an","toBePaidByReceiver":"Zahlung durch den Empfänger","toBePaidBySender":"Zahlung durch Absender","source":"Quelle","amount":"Anzahl","receiver":"Empfänger","message":"Nachricht","includeFeesInAmount":"Gebühren in den Betrag einbeziehen","transactionFees":"Gebühren pro Transaktion","totalAmount":"Insgesamt","balanceTooLow":"Bilanz zu niedrig","transactionError":"Fehler: Transaktion kann nicht ausgeführt werden","calculateFees":"Gebühren berechnen","startChatWith":"Chat anfangen mit","searchResult":"Ergebnis der Suche","joinedInTheChat":"in den Chat eingeloggt","invited":"eingeladet ","hasInvited":"eingeladen ","inTheChat":" in den chat","banned":"banned","andRoom":"und Zimmer","left":"verließt","theChat":" Chat ","made":"Gemacht ","aModerator":" Moderator","editedChatNameTo ":"änderte den Chat-Namen in ","somebody":"Jemand","sent":"gesendet","PKOINto":" PKOIN für ","response":"Antwort","edited":"Bearbeitet","settings":"Einstellungen","unauthorized":"Nicht autorisiert","search":"Suche","replyOnMessage":"Antwort auf Nachricht","editMessage":"Nachricht bearbeiten","inviteFriend":"Пригласите друзей","emptyContactList":"Список контактов пуст","joinApp":"Pocketnet beitreten","hasInvitedToJoin":"hat Sie eingeladen, Pocketnet beizutreten","messagefrom":"Forwarded message from","usernotgen":"User did not generate their encryption keys yet. You will be able to chat them when their keys are generated.","younotgen":"Please wait a minute, Your encryption keys are being generated...","chatsearchingempty":"No chats found for the specified filter","sendmessage":"Send message","clearHistory":"Clear history"},"input":{"patientEmailPlaceholder":"Email","refillNamePlaceholder":"Den Namen Nachfüllen"},"message":{},"button":{"starChatButton":"Chat anfangen","decline":"Ablehnen","join":"Beitreten","ok":"Ok","copy":"Kopieren","forward":"Weiterleiten","delete":"Löschen","save":"Speichern","reply":"Antworten","share":"Share","download":"Herunterladen","downloaded":"Herunterladen","goToPocketnetProfile":"Zum Pocketnet Profil","sendFile":"Datai senden","takePhotoOrVideo":"Foto machen","sendCoins":"Münzen senden","edit":"Bearbeiten","select":"Auswählen","block":"Sperren","unblock":"Entsperren","blockUser":"Benutzer sperren"},"yes":"Ja","cancel":"Abbrechen","teamMessages":{"1-title":"Willkommen beim privaten Bastyon-Chat!","1-list1":"Privater Messenger, der NICHT mit Ihrer Telefonnummer verbunden ist.","1-list2":"Standardmäßig Ende-zu-Ende-Verschlüsselung jedes 1-zu-1-Gesprächs","1-list3":"Alle per Chat gesendeten oder empfangenen Bilder werden verschlüsselt gespeichert","1-list4":"Der Nachrichtenverlauf wird nur 7 Tage lang gespeichert","2-title":"Eine riesige Ankündigung! Die Pocketnet-Anwendung heißt jetzt Bastyon!","2-message1":"Die Domain wird auf Bastyon.com verschoben. Wir haben kürzlich die folgenden wichtigen Updates veröffentlicht:","2-list1":"Privater verschlüsselter Messenger, der nicht mit Ihrer Telefonnummer verbunden ist","2-list2":"Möglichkeit, PKOIN an Blogger zu spenden","2-list3":"Video- und Live-Streaming","2-message2":"Laden Sie jetzt Ihre Freunde ein und werden Sie Teil der großen Zukunft des dezentralen Internets!","2-button":"Freunde einladen"},"sendingerror":"An error occurred while sending the message","details":"Details","settings_pin":"Pin chat window","checked":"Yes","unchecked":"No","settings_read":"Send read receipts","messagewasburn":"This message remains only in the memory of your device","messagewillburn":"The message will be deleted soon","micaccessbrowser":"Access to the microphone is restricted, please check your browser settings.","micaccesscommonproblem":"Sorry, for some reason it is not possible to record voice messages on the device","micaccesscordova":"Access to the microphone is restricted, please check your device settings.","micdevicenotfound":"Audio recording device not found"}')},"6e67":function(e,t,n){"use strict";n("d936")},"6e9e":function(e,t,n){"use strict";n("d74d")},"706e":function(e,t,n){"use strict";n("ac94")},"71da":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active},attrs:{id:"contacts"}},[e.unauthorized?n("div",{staticClass:"dmdv"}):n("div",["Contacts"===e.mode&&e.window.cordova?n("div",{staticClass:"work"},[n("div",{staticClass:"inviteUserDiv"},[n("router-link",{staticClass:"inviteButton",class:{colored:!0},attrs:{to:"/invite",tag:"button"}},[n("span",[e._v(e._s(e.$i18n.t("caption.inviteFriend")))]),e._v(" "),n("i",{staticClass:"fas fa-address-card"})])],1)]):e._e(),"Contacts"!==e.mode||e.window.cordova?e._e():n("div",{staticClass:"work"},[n("div",{staticClass:"inviteUserDiv"},[n("button",{staticClass:"inviteButton",class:{colored:!0},on:{click:e.invitepnt}},[n("span",[e._v(e._s(e.$i18n.t("caption.inviteFriend")))]),e._v(" "),n("i",{staticClass:"fas fa-address-card"})])])]),n("div",{staticClass:"namebuttoncreate"},["Selectmany"===e.mode&&e.selectedlength?n("div",{},[n("div",{staticClass:"work"},[n("div",{staticClass:"groupList"},[n("div",{staticClass:"groupCaption"},[n("span",{staticClass:"label"},[e._v(" "+e._s("massmailing"===e.type?"Total recipients (subscribers): ":"Selected ")+" "+e._s(e.selectedlength))])])]),n("div",{staticClass:"participants"},e._l(e.selected,(function(t){return n("div",{key:t.id||t,staticClass:"groupListName"},[n("preview",{attrs:{contact:e.usersinfo[t.id||t],mode:"mini"}}),t.id?e._e():n("i",{staticClass:"far fa-times-circle",on:{click:function(n){return e.toggleUser(t)}}})],1)})),0)])]):e._e()]),n("div",{staticClass:"work searchWrapperEA"},[n("search",{attrs:{minimize:e.minimized},on:{search:e.search}})],1),n("div",{staticClass:"work"},[0!==e.users.contacts.length?n("div",{staticClass:"titleContacts"},[n("span",[e._v(e._s(e.$t("massmailing"===e.type?"caption.contactsForMailing":"caption.contacts")))])]):e._e(),n("list",{attrs:{mode:e.mode,selected:e.selected,users:e.users.contacts,title:"Contacts"},on:{toggleUser:e.toggleUser,select:e.select}})],1),n("div",{staticClass:"work"},[0!==e.users.contacts.length||e.searching||e.loading||e.inputText?e._e():n("div",{staticClass:"titleContacts empty"},[n("span",[e._v(e._s(e.$t("caption.contactsempty")))])])]),e.inputText.length&&(e.searching||0===e.users.contacts.length||e.users.search.length)?n("div",{staticClass:"searchResult"},[n("div",{staticClass:"work"},[0!==e.users.search.length?n("div",{staticClass:"titleSearchResult"},[n("span",[e._v(e._s(e.$t("caption.searchResult")))])]):e._e(),e.users.search.length?n("list",{attrs:{mode:e.mode,selected:e.selected,users:e.users.search,title:"Search results"},on:{toggleUser:e.toggleUser,select:e.select}}):e._e()],1),e.inputText.length>=3&&!e.users.search.length&&!e.loading&&!e.searching?n("div",{staticClass:"noSearchResult"},[n("span",[e._v(e._s(e.$t("caption.queryNoResults")))]),n("i",{staticClass:"fas fa-search"})]):e._e(),e.searching?n("div",{staticClass:"searching"},[n("div",{staticClass:"linepreloaderWrapper"},[n("linepreloader")],1)]):e._e()]):e._e()])])},r=[],o=n("2f62"),s=n("f978"),a=n("92a6"),c=n("d3ff"),l={name:"contacts",props:{type:{type:String,default:function(){return""}},mode:{type:String,default:function(){return""}},chatRoomId:String},components:{list:s["default"],contact:c["default"],preview:a["a"]},data:function(){return{loading:!1,searching:!1,fromSearch:[],inputText:"",groupContacts:[],groupName:"",contact:{},selected:{}}},mounted:function(){this.mode&&this.mode},created:function(){},watch:{},computed:Object(o["c"])({auth:e=>e.auth,window:function(){return window},users:function(){var e={contacts:[],search:[]};return e.contacts=_.filter(this.contactsMap,e=>{if(!this.inputText||e.name.toLowerCase().match(this.inputText.toLowerCase()))return!0}),e.search=_.filter(this.fromSearch,(e,t)=>!this.contactsMap[e.id]),e},...Object(o["c"])(["contactsMap","pocketnet","minimized","active","unauthorized"]),usersinfo:function(){return this.$store.state.users},selectedInfo:function(){return this.selected?this.usersinfo[Object.values(this.selected)[0]]:{}},u:function(){return this.$route.query.u},selectedlength:function(){var e,t,n;return"massmailing"===this.type?null!==(e=this.selectedInfo)&&void 0!==e&&e.source&&(null===(t=this.selectedInfo)||void 0===t||null===(n=t.source)||void 0===n?void 0:n.subscribers_count)||0:_.toArray(this.selected).length},contactsListFiltered(){var e=[],t=this.contactsMap,n=this.inputText;return _.each(t,(function(t,n){t.selected=!1,e.push(t)})),e.filter((function(e){return e.name.match(n)}))},gName:function(){var e=this.groupName;return e.replace(/ /g,"_")}}),methods:{select:function(e){this.$emit("select",e)},toggleUser:function(e){if(this.selected[e])this.$delete(this.selected,e);else{if(this.selectedlength>=11)return void this.$store.commit("icon",{icon:"warning",message:"At the moment, you can add no more than 12 users to the chat"});"massmailing"===this.type?this.selected={[e]:e}:this.$set(this.selected,e,e)}this.$emit("selectedUsers",this.selected)},search(e){this.inputText=e,this.searching=!0,this.inputText?this.core.user.searchContacts(this.inputText).then(e=>{this.fromSearch=_.filter(e||[],e=>e.id!=this.core.user.userinfo.id)}).finally(()=>{this.searching=!1}):this.fromSearch=[]},invitepnt(){this.core.invitepnt()},inviteUserAction(e){var t=this.core.mtrx.client,n=this.chatRoomId,i=this;_.each(e,e=>{var r="@"+e+":"+i.core.domain;t.invite(n,r).then(e=>{})}),this.$emit("closeModal",!1)}}},u=l,d=(n("0adc"),n("2877")),h=Object(d["a"])(u,i,r,!1,null,"7bbdc64d",null);t["a"]=h.exports},"71ff":function(e,t,n){},7284:function(e,t,n){},"72f3":function(e){e.exports=JSON.parse('["PQ8AiCHJaTZAThr2TnpkQYDyVd1Hidq4PM","TQEGz5cQQtRad8wo2c1KapvFek9rnuprkD","PU7D6X5bNUdEiuUGWGLp8C6TjSsB2hzHxL","PP6bNhVaXy7YK19UbLHXbQPKa7oV4yx1rr","PKU652wwKYC52WGBJ8EHkA1Mtud8iHWChC","PToMRMsMVh9dj4Cpa7yu1pB5iq65g4jrVC","PKszvjHwMWubQpeEKnQhRonGBVFWcJDbNJ","PDjvHUQjcDX8Vq6rtpKveUDPtwPVUZEW7m","PCMnk8T3Edu81iGcTEpVCFq8FQd6UBXi2y","PKxqtUuK3B6qwAxs6HLhvxrQVExuMwKWd5","PGe4xVAJRJtbD8swPipE2ug9Zk1rhSTa1y","PDWPDFikMhLJHtiKLLXZGzfgphRcd19eHe","PGURYzvoXuSvuwCuDty2wW37omjiKgzV5a","PRDKVP4yvF2wW8p5FUVkzrCvXYE8SMGkQK","PBHvKTH5TGQYDbRHgQHTTvaBf7tuww6ho7","PBHvKTH5TGQYDbRHgQHTTvaBf7tuww6ho7","PEkKrb7WJgfU3rCkkU9JYT8jbGiQsw8Qy8","PXEWRce8siwbQWArQWyjnooogAEieHwhVd","PGyjEoqmmK2tm6xmg69hGoSNM6hUrc4VfE","PVSdoFQqAg86p6tbAW8Y6CGGGjhiXkr4qh","PWioUw52q4iNpMQUauNYaWg9JpsPE1u9Ut","PVeqjqJk2GthxBK6QdhCCfQVEX1SAK92As","PFnN8SExxLsUjMKzs2avdvBdcA3ZKXPPkF","P93cWU7X31wqn3R9GcUZ7c3fD11asXum5y","PM4gVCcWnTmysUXhMukoQA2mT7GpfWQvck","PMSULgjrsCsEnWgNigCga5jSjhCvYBFSA8","P9R3aNvyjRbqTWfy5q1h5qvXFYaDtqaRi2","PNcvYsMXzf4RVmS9AjRYEqeeGjk1PiDjvF","PS9F8hzGSxeL1Lc2VGvPoqXHotZvpoVkkX","PBK1GDpiLNVFrKsPVAaNLU92byFY5P5KBr","PBMcLRBQNWtNQZYUbRZZAd5FuZ8yb7HMX2","PP582V47P8vCvXjdV3inwYNgxScZCuTWsq","TLENU8HFyz8PqzpKBDWeN6Xix6rM8wjYKd","TPjN8Dy4BpGDezMNw2ePuEdHiHetTvR3Mb","TU8fAf96kSfQzmxmpjRDSSqvCiPWzWt67J","TKJ7xAC18XC4zQBvkNAWhkr3i7cARu11Uv","TZBHmnZwLedPtHcJfJnFsbxobGuDKGf9uA","TXyieuLsCntT1p4ougtiKURtYTxcdvWN1L","TT2CeQuHiM8E8hG4rkJcaMKQ8gWqhZmNUH","TLMXdC2UYSfMVbLzKtmJJTi4oK9LNHNVju","THCRHFtVAoeDGLg548C4bQxXeDg9bwrs5K","TVcPMgVQ9TxgpzNrQyEAei5cnnR9jzXtzE","THsA8rwdeAkq5bePA71Nw5CGtFg2duyDSq","TKJ7xAC18XC4zQBvkNAWhkr3i7cARu11Uv","PEj7QNjKdDPqE9kMDRboKoCtp8V6vZeZPd","PLJvEixJkj85C4jHM3mt5u1ATwZE9zgFaA","PRTugzBefzB1AA2Rw8VTBKf3BBPDjQND8y","PCVt7H4vgjBDxifLz3uokbc1tD3MZwWwQh","PJ3nv2jGyW2onqZVDKJf9TmfuLGpmkSK2X","PLH8biT5rMdvE1zXFhsvNkzphVRK6cNM7p","P92gc46iqLhCswPsbLxH7wjTfh9rhhNSux","PXUYsENSv6QkQZEdiJTsfJmu3XxZvVmVfQ","PXXaSczoZcuJEwxYKhaC9pV1JBvwi6UjSw","PFV4UT9fhHsqkmCGsWsSCr55Pr1SMX6NL2","PTcArXMkhsKMUrzQKn2SXmaVZv4Q7sEpBt","PL9U1q1JmJezPh8GQb5dj5h5GavuCGcjYk","PS4pYW4tpu6fwviz63CHLMxPA37fJ3GLvn","PHmvLy9b5m2b7fvU7MSTw4mAkdshhdY4Nt","PVpSK2qQXmG1SjAMJVMAMRLUkrzMjsJouL","P8boyun9yF6QYn1fjGC1WABt4BQUL4STeh","PA6biduJbWcQ97n5jz2jUqWHtenLpWTH7s","P9EkPPJPPRYxmK541WJkmH8yBM4GuWDn2m","PUYo1a6LxjnnBVi6uBjHUsZQS4FnbUwdAN","PLFtS8H7ATooK53xRTw7YHsuK7jsn5tHgi","PVJDtKPnxcaRDoQhqQj7FMNu46ZwB4nXVa","PVjvMwapTA29biRTsksXUBuVVf2HVwY7ps","PKSV2KXCdEtTtYb8rF3xMMgiiKe1oDstXR","PUqq6vksrmoMPRrRjZxCVQefqGLpuaqWii","PMtmtctmBD9nHJFzmfXJR1G2busp8CjASs","PNUMTC5CTH3F5LfQpkmj3MXcDnGNKTU4ov","PSWR1jHNocGVVVFE3aoxFh8G85SQK3G9Ta","PJuW8LKT7LZY88fP7WM35NJURh3rAaeU3o","PGCTymXHcEydV8SSmoABTB8YEchJbDoRJn","PDXGoy43t5RSqJY1UJBgswBu6phtW8Knwa","PHqNLuNEwrw8nzj71ELVGp7w1eEp8p2pKA","PR3BcnBziYoDgckdyaARgFayiZUiA7agSx","PEbSS6Fu9fCSEzFcrW5a3ztjx5ekoYvpjx","PKZNLmxpsiW9H77beXt7pNWK7rTbG6Qu5h","PNoR5LNLAZP3VGiNcK2wn4xxAFT6yQAMqj","PL1wziiaQj7FLnoktuQQ1MKweYYbdcekRB","PMVvs8kvbskq6eVV8Q3oyjotbox9tBfvnp","PQ3hdiozrxtTf1UhuVfhUb9bcvrUzbzwRJ","PCSxAFQCRZphi9W6nrV4tSQXKFfsxdxERA","PGFKA1DieVsg9pQK4aBaEp5wpvaXpWtuVJ","PFbq1BkrrVsmEAevMqQ2PV6aFf7QWQP9sB","PXgYFdVs5W831WpksVLA5hNtXa7XSqUzLB","PSBePd5Tx5KG9vxwAzbaDTfjzDbq1GUTYw","PDgbAvsrS4VGKkW5rivcJaiCp7fnBoZRgM","PQt1eggTZKCCbjVsHx6rcMcBMU2p2PNQmt","PPY1UbumjHJaoxsfL7DVTPNLM4g697zdDe","P9nFzh2sSyeTFd1F7fFGByhB6cD886jJi5","PMf2RiHZiZTtQZftkxhRYbN5CgBH6dNh5A","PDz71dsW1cPwNewGHVUteFgQx3ZmBf4gaf","PFjWEfsm3jX81MctFU2VSJ17LGVKDc99oH","PBo7zu6xguzzftFE8c3Urgz4D6YVnj8oux","P9KXb7sS2JDjV5jnXu4t2WwwbvzYeu6yds","PUYEkLb6szwxjw3cq6FvLxDPmedbyd3foq","PU6LDxDqNBDipG4usCqhebgJWeA4fQR5R4","P8rnj1gSaAQJ1YkAAthSgmLKiDfspb98GP","PUXG7rfX19Xoco1FXjXBW8qt6NEZpp8maL","PSanUFKb1vd5ua4U3BXMmsSZ2zm3sN2nyj","PERF5kDM32ebkq8SeSj8ZaLqfCoqz8FRgh","PApFYMrbm3kXMV7kjrEG1v6ULv6ZFDHb9j","PUBRMTAUhy51gkbuP1tRJLMMAzEDt9C2X6","P9i55BxFWpjMyqgHyCKtazDN1HDiZxTSzJ","PLLDTFuBhb4FRPt811bTPjgaYgqoj16hVV","PXmw1tQnengAAy9ML8Depr2kANupmadZ7j","PCkbxDvFQbFvEzPWnnrraey1QCUro2kMLU","PBKPEWcsZZHH7LQ7GQCNSMSSEteiJMfoFx","PEWQWe1DQM3uh19vRqtFDkUrPreyM5uJnS","PQ2wxGv2YNbie2BP66aac72Y3UU1uSzxCX","PE6VLUqsPYLJnX2W7qhHX6yb2zLN3H2x25","PEiNYu3dNM4oZDRYvSrsfy51xz7CokPYNV","PQk66yNJS3agLJ2k6A1AN5FmM2TNUwEgbP","PFpBmqET9NyQA2EHp8BPEjjKZobXUBBjjn","PB1EShZbvkTSQgU8NLxEH8MN5UiKw1CBHb","PCeyj5aXETKtCYbXJxmDv3bXGawda1KEHQ","PWAAzRuHNi5iNxQDaJ8ZVpqEJSoPWFFiRN","P9XuLKA5iCiZT6epTuVWzLU23c2gedSDkc","PTNtirNwbe5GfgNod7rwMWLLGhYWhGyLJx","PUaDSBBveSUG9yieuDSYCpgsyE2djYU9N5","P9eLPo3gXUqBr7wgxDSSLNfyNMyeDua7cn","PF57cm7HGsc5djwK556uZ7AZbqk59wXxF2","PQ2W4ispScj349r3Gsqr1PchSVDvU59Ssf","PUBkQATBYhGiCvvdtHCX7GM7fdx23wdaJb","PJzhMENFrkp6Bopfzsf4VR46E3Znd2aoGj","PKp1bjJByqY76XNZNzDFkTAhyfPq4bah5V","PPEWFN5ETvdjc7TKqjxDPEWmZRUyPUYr8z","PH1yzW1qvyeq3thaFhUwv3pTA2VazhtZDT","PCjhy4t6B2b5xeqVoJcN51XkhUqAXBuaq4","PJTNch4or4Zr8cDnF3KA4eAXTqWCxYLSzu","PKS5Hy6FV3ytgUDmcAVa8y8qxPYKg3CdMH","PVyHHKFuZrH2mh8Y5ZokvZnDfG1iTURpM7","PTPVArrxr4wZuget8phZ1eSNFsGmdSXXck","PQUj7dS2QpamP9vapARCYaJaSqjXpcZk8p","PP7Sz6pjbgv4XdnnCRnRm4avfxD2TEoMoC","PN9is9RTq2MW6yHw7ggz77vyeKX1a4XJQt","PLAj8RmQg2ehTVEx8pSWnd2QeFvjHnYtRZ","PXupozgNg1Ee6Nrbapj8DEfMGCVgWi4GB1","PD4pWxVke4Yz2y5UnNWnSsVHd45Vy6izCr","PW3tfEkGLKv4LFREpJYYpWxenKHSizB8rQ","PSm8oVmMYCKnn35i4BABE6kw59WvTckagc","PEWcDgFAD6t7SmCmsnixbmhTFkZr6hYVUb","PQi77s3JtrUkavxN9t6Hy5sT3CNnHokNrK","PTBHcYYBL5NU1okBYXYUTcFY6PE9p2o7gz","PFrbFN4W2kwHj9jbHwLjt3vAkTM7ThgGBk","PGCqT8bhkWHLEyQG1xgVhrzojCN1VjDLaP","PWeAQ1Mb3Xb7anjikyNogR3UqiZgnNbRiZ","PCkkR6TPP273vv5AQgJTWhBHawjzakkU1A","PT2kwKs93LYgRFhohRAkLuU9oynRDrfXto","PGNUAB5kNKVGTQ9CbE198sesKKYXnmX8HU","PBGqJGSrdsBrEsLmiAaeH22bxGg8irX3gC","PQ2hAPwkey8aACP548DtgLscQTk9PkAKnP","PFGMWt1cQFm6QEbcqH6YJxfabj4L5rHfLM","PUq5SNWQCdU1dwuQUNRCKaxgzw52rD6Uez","PTft97ycE3N6ZKgvixdpbYj8qPxzCe2CxG","P9W6f4HJoimwsjJwmnAWKG6HQKcUHz1vaP","PAVjp9nsNtgzUNF1VkUd74YzLaQHpv4g7v","PKB7GXh1qcY7Q7gs3hafgpzndHLKTx4isM","PQ8PDzWy7hDV8gfgSgoP2BCU2CXngMPCvt","PHMjVgWj6HMiLeAhiR8eDLzVrXp8nyF2ji","PR54hSnPDbhPePLNQZCP4CU77TRFoMxYqg","PARV591XENALBB5ApkR7WcQPhEZtLHfi2A","PVgktx9ZmPnSXW83HmSF6MX76SV4u5a2hJ","PSbwbtsVfALgykAUsCYofkPFTu9Chd6RUo","PP3QYWu7ZRRm7NTAkXD7u3NbCKNGJhbEeL","PP8AJb4X4uHxJw89UEGcNEom5RZy2RRxBY","PRhLYR1TJegWzuzFa7FwT1iCCpNSeJrpjn","PXb9rpCDax5NpU6m4tt2gdXyTp4urbTdS8","PRDXZpyF7rm9cJw3y6DX2nFvK1AYgjpXdF","P9D3ntMdwy4HGjBhg1uQDuQD99MXYZTqg3","PWGhooqyrq1qL7NPgg2an8M69sHfJrDM8Y","PUuNT7icKad8fm7ATPRn1s8gd19HXYKDqS","PWkQMUTG6pKVA9bAbjLmLewB5eVgEnVk6f","PUAQeTYUB9H5qjeSSXzeeAd6NKXAz8fzpP","PQ4X2NQJD1ZA5Hy58ZU9eHcjpRco7ZMgTz","PTMFZXMXYFjiN1UuSV4ZckepyEFVWMm6Zy","PKwa3jVZXHpaVgG89WvnM8vBfpp745GGNN","PHsHq6i4RKm9gCqFGhAr3yvF34yDocc5S7","PNsx3cC4wDyfowrhvBgjf7VfeXHeFdRgX1","PHEDVg12YtcHjHYNsmxzV8iexWyw81cQge","PRKdjSJkqk15YFncjq1FUUXpHo1XWPbB9x","PBw3aSQe6HCzX75xDy5X2SXx9y9JaUP9ke","PCxXVA4quzXVjUM356t3FE2nvWmDVY47J7","PVATJhZqKdYXLp1nmPdrssRhygJApmAALR","PJtnXwKNPDdEpJhaKH2fbPEyLrcS77oj46","PSoCtc8FbPaagG6spsqbS2HJjRM8oPG16b","PPxDNqCB2oWp3JffCiRXwJTzxRQuRjb5Bc","PVRWuvwCNfZWUUD5gQzDsqabnTcMXoqgbV","P8sSu2qFnVPGEtnSTKYRMUzuG3xBHsj3ms","PUF8bsAYyHZQCtaMbrTwyRDcC3wMLKhFFX","PSFpsP19aHs7ZfGPnnt19yQC258y1HFYKD","PGecwCERTkoFd82E3e471SvxSxnJpC4cWk","PRZEXQXTmz1jW6YmH1e83nkRRiDUqkE6fw","PCM3fmcUikLbSNCeqtQ7MEk4yQbn6qQRJt","PKXSw8Q4Kdy244Gb1R7GYPvTwiM22JssTf","P8gfyLfXyeHzyAvq4Yqw6EW39ifCyVJ9f6","PSKLx4k7ehAtvipwpo2ohBeCYzpf4SiKHj","PK8dRanrBFxfSo3qw1P4gm6veaQQssZXxB","PAqPD7P3iFtz7e2epSP4V8FMPXrJKASeqD","PUopiRZvD6BAjF9CcWtMfpeJtxp411dxKM","PQkNpRfXbCGXJ2o1mRfsJMvMtsvq3uvZU9","PSBhEi8AUasemizUHyJ64t6xXonsxwp73y","PKYwaiikhUoPWmpWmYec4Xf3TPWwJQCqUt","PST4P2KEweDQJ2RAtG3scUmXAgPJJ5JJRL","PCfvhqHEYG3zdWXvLJrjPPDVK2H8qwwXn5","PLZsQmsRUDMJGc61pGMLdDQ58UuqQ8kU5Z","PMC3pwutfiYpGWUMHhiB1NRjiHL7iWHiyi","PMTrhcppMJpaRz4Xnv7CogJPHPMKtcg6bA","PCYeapWncohMda9vfrFe26EDEiFa89kDZ1","PQEYtpgvtfETFVfhk467SyuGRhwtMcvKUd","PGnshbCvNGRiBYGxUpVNqLkaM8Ku1xvbaw","PF3oocNVVz5gfdFJGQF4J4xf2bCaxRxYTh","PSGSnF7Diww2yJdQefuy3ZvuZEoBw8TGTV","PUhvX53ueD2Sxa3q7av83vNcEHuS8M7kRS","PGegspsgRqvMiZCP8PGufKMYBk3yekDaEE","PB8wu7hQwo5xMsVG4F4HshrW39t2Y4eN37","PT4fvQ7jMicg6McC52BmFFkL2M6AEWc7vo","PCkX8n2e6aD6Ji37hSpHCJpqvaaJjVWt1m","PGD5jUBQ7qNnHDuW85RRBxY1msywEdCm7r","PPdfqTLnz2S6F1ng5N7rzMUh19H4e3pfZe","PVjhQyjrLur2ZGD5CspSu18ee7R2qsCjo6","PNQ8drkeMEtZ44g7VyhxPPwPYubBsT6ekt","PCx1LKWdV1pc6TmKwYU8vqEn3CpAeTexDr","PLZATQyqYzM6NLbH8M3LPicSU3cTAqW3SA","PKWM3oo6YTFFn5U2HLaBueqA3fcLd7BP8m","PHnvqSQzg5D3yKo5KgCiXqtFP84bsYyF7G","PPw4k3Zra7tYRM643QVm3V4UFrcZZb9H6H","PUFZvqrgdnaGXxaFmwPuUPf5NhGg7tpBe9","PDhQL18skFG4g7bEJoYhgvjqo6JNpkN533","PP1bBz11vicydAcw7QKJezYQdQMpYGEMiV","PSFPrHstL1wawZ2eXLdLEpFEjhG8a27EYb","PWKzt9TG45VUmAjuoFQQ4bGfZpjaUhxnhH","PJ5HX1eCHedY2Zjt4JTUanL1ZLi3NQdy3Q","PXkJiHrAwPNk2uKNrN1odK4SDeEdHNGw9j","PXpnB4BNmynDf6AuCU8eyB9patuQTbHAgS","PGjGt6AGH4UQyVQ62rsyovEFUW2H9nRU4w","PLb2C3Gs7r3YqCMamVeaztqnm6mfM2HDjR","P95itUBNbBsH28SVYsyk5qUhXWdSb23dbx","PUZZnLHg9qPoF1NrwFPvGse96DiNQ1uF5g","PJ13w4ap16wZ9xmnLViEt4csZRSDrbCsmF","PDkzixpA4TmkTqEKBJrmX6xFDu15qJ39ut","PGPqNyxuSSsAkt3m6eb5hyckoDhyy19dW9","PRUJpbgfqrDayD5eRi1DmDw7S8857Jhw4e","PWbYmgG6PzqhrNDtuFmWrSaLHTDMwZWc26","PLbv7r1CkNmPMetvpkTssS14WYuuMXNhDF"]')},7334:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{mobile:!e.pocketnet},attrs:{id:"settings"}},[n("div",{staticClass:"infoPart"},e._l(e.settings,(function(t,i){return n("div",{key:i,class:"inputWrapper "+t.id},[n("div",{staticClass:"forInput"},[n("toggle-button",{attrs:{value:e.get_settings(t.id)},on:{change:function(n){return e.set_settings(t.id,n)}}})],1),n("div",{staticClass:"label"},[n("label",{attrs:{for:"settings_"+t.id}},[e._v(e._s(e.$t(t.label)))])])])})),0)])},r=[],o=n("2f62"),s={name:"settings",props:{},data:function(){return{loading:!1,settings:[{id:"pin",checked:"yes",unchecked:"no",label:"settings_pin"},{id:"read",checked:"yes",unchecked:"no",label:"settings_read"}]}},created:()=>{},watch:{},computed:Object(o["c"])({auth:e=>e.auth,themes:e=>e.themes,theme:e=>e.theme,settings_pin:e=>e.pinchat,settings_read:e=>!e.dontreadreceipts,pocketnet:e=>e.pocketnet}),methods:{setTheme:function(e){var t=e.target.value;this.$store.commit("theme",{value:t,root:this.$root.$el})},set_settings_pin:function(e){this.$store.commit("pinchat",e)},set_settings_read:function(e){this.$store.commit("dontreadreceipts",!e)},set_settings:function(e,t){return this["set_settings_"+e](t.value)},get_settings:function(e){return this["settings_"+e]}}},a=s,c=(n("4784"),n("2877")),l=Object(c["a"])(a,i,r,!1,null,"216856d2",null);t["a"]=l.exports},7704:function(e){e.exports=JSON.parse('{"caption":{"create":"Создать","addPublicChatName":"Имя Публичной комнаты","addGroupNamePlaceHolder":"Имя Чата","createPublicChat":"Создать публичный чат","chatTopic":"Топик изменён","publicRoomTitle":"Публичная комната","asModerator":"права модерации","marked":"Передал","unmarked":"Снял","removeBan":"Снять Бан","cancelModeration":"Снять модерцию","uploadFiles":"Загрузить файлы","header":"Заголовок","dragAndDropAFile":"Перетятите файл в эту область","chatInvite":"Вы приглашены в чат с","cantJoion":"Вы не можете присоединиться к чату с","chatInviteDecline":"Вы можете присоединиться к чату или отклонить приглашение","creatorLeft":"Так как создатель чата покинул его","encrypted":"Зашифровано ","noImages":"В чате пока нет изображений","noFiles":"В чате пока нет файлов","inviteUser":"Пригласить пользователя","invite":"Пригласить","add":"Добавить","mute":"Отключить звук","unmute":"Включить звук","leave":"Покинуть","Info":"Информация","new":"Новый","typing":"печатает","accNotFound":"Ваш аккаунт находится в процессе регистрации, пожалуйста, подождите...","emptyList":"Список пуст","welcome":"Добро пожаловать в чат!","startNewChat":"Начать новый чат","chats":"Чаты","shareWith":"Поделиться с","newChat":"Новый чат","moveToChat":"Перейти в чат","queryNoResults":"Нет результатов по запросу","needMoreCharacters":"Введите больше символов для поиска","createGroup":"Создать группу","unabletoDecrypt":"* Невозможно расшифровать","messageDeleted":"Сообщение удалено","sentImage":"отправлено изображение","sentVoiceMessage":"отправлено голосовое сообщение","invitationToChat":"Приглашение в чат","invitationToRoom":"Приглашение в комнату","leftChat":"покинул чат","joined":"присоединился","chatRenamed":"Чат переименован в ","recentComment":"Последний комментарий:","share":"Поделиться","followers":"Подписались","reputation":"Репутация","unsubscribe":"Отписаться","following":"Подписан","theme":"Тема:","contacts":"Контакты","phoneContacts":"Телефонные контакты","chooseInviteMedia":"Пожалуйста, выберите, способ приглашения","admin":"Админ","moderator":"Модератор","videocall":"Видеозвонок","call":"Звонок","leaveAndDelete":"Покинуть и удалить чат","donate":"Донат","makeModerator":"Сделать модератором","ban":"Бан","kick":"Исключить","members":"Участники","media":"Медиа","files":"Файлы","contactsList":"Список контактов","send":"Отправить","pageCaption":"Заголовок страницы","caption":"Заголовок","text":"текст","placeholder":"плейсхолдер","sendTransactionTo":"Послать транзакрию","toBePaidByReceiver":"Оплата получателем","toBePaidBySender":"Оплата отправителем","source":"Источник","amount":"Количество","receiver":"Получатель","message":"Сообщение","includeFeesInAmount":"Включить комиссию в сумму","transactionFees":"Комиссия за транзакцию","totalAmount":"Итого","balanceTooLow":"Баланс слишком низкий","transactionError":"Ошибка: нельзя совершить транзакцию","calculateFees":"Подсчитать комиссию","startChatWith":"Начать чат с","searchResult":"Результат поиска","joinedInTheChat":"вошел в чат","invited":"пригласил ","hasInvited":"пригласил ","inTheChat":" в чат","banned":"забанен","andRoom":"и комната","inRoom":"в комнате","left":"покинул","theChat":" чат ","made":"сделал ","aModerator":" модератором","editedChatNameTo ":"изменил имя чата на ","somebody":"Кто-то","sent":"отправлено","PKOINto":" PKOIN для ","response":"Ответ","edited":"Отредактировано","settings":"Настройки","unauthorized":"Неавторизован","search":"Поиск","replyOnMessage":"Ответить на сообщение","editMessage":"Редактировать сообщение","inviteFriend":"Пригласить друзей","emptyContactList":"Ваша книга контактов пуста","joinApp":"Присоединяйтесь ко мне в защищенном чате.","hasInvitedToJoin":"Это зашифрованный чат, который не привязывается к номеру телефона.","messagefrom":"Пересланное сообщение от","usernotgen":"User did not generate their encryption keys yet. You will be able to chat them when their keys are generated.","younotgen":"Please wait a minute, Your encryption keys are being generated...","messageRead":"Сообщение прочитано","open":"Открыть","You":"Вы","chatsearchingempty":"Чатов по данному фильтру не найдено","sendmessage":"Отправить сообщение","clearHistory":"Очистить чат"},"input":{"patientEmailPlaceholder":"Электронная почта","refillNamePlaceholder":"Заполнить имя еще раз"},"message":{},"button":{"starChatButton":"Начать чат","decline":"Отклонить","join":"Присоединиться","ok":"Ок","copy":"Скопировать","forward":"Переслать","delete":"Удалить","save":"Сохранить","reply":"Ответить","share":"Переслать","download":"Загрузить","downloaded":"Загружено","goToPocketnetProfile":"Перейти в профиль","sendFile":"Отправить файл","takePhotoOrVideo":"Отправить фотографию","sendCoins":"Отправить коины","edit":"Редактировать","select":"Выбрать","block":"Заблокировать","unblock":"Разблокировать","blockUser":"Заблокировать пользователя","Complain":"Пожаловаться"},"type":{"publicgroup":"Создать публичную группу","privategroup":"Создать приватную группу","one":"Чат один на один"},"typelabel":{"publicgroup":"Создание публичной группы","privategroup":"Создание приватной группы","one":"Создание чата один на один"},"yes":"Да","cancel":"Отменить","teamMessages":{"1-title":"Добро пожаловать в приватный чат Bastyon!","1-list1":"Личный мессенджер, который НЕ связан с вашим номером телефона","1-list2":"Конечное шифрование каждого разговора 1 на 1 по умолчанию","1-list3":"Все изображения, отправленные или полученные через чат, хранятся в зашифрованном виде","1-list4":"История сообщений сохраняется только в течение 7 дней","2-title":"Огромное объявление! Приложение Pocketnet теперь называется Bastyon!","2-message1":"Домен будет перенесен на Bastyon.com. Недавно мы выпустили следующие крупные обновления:","2-list1":"Частный зашифрованный мессенджер, не связанный с вашим номером телефона","2-list2":"Возможность пожертвовать PKOIN блогерам","2-list3":"Видео и прямая трансляция","2-message2":"Пригласите своих друзей сейчас и станьте частью большого будущего децентрализованного интернета!","2-button":"Пригласите друзей"},"sendingerror":"Возникла ошибка при отправке сообщения","details":"Подробнее","settings_pin":"Закрепить окно чата","checked":"Да","unchecked":"Нет","settings_read":"Отправлять отчёты о прочтении","messagewasburn":"Данное сообщение осталось только лишь в памяти вашего устройства","messagewillburn":"Сообщение скоро будет удалено","micaccessbrowser":"Доступ к микрофону запрещен настройками браузера, пожалуйста проверьте настройки.","micaccesscommonproblem":"Извините, по какой-то причине запись голосовых сообщений невозможна на устройстве.","micaccesscordova":"Доступ к микрофону запрещен настройками устройства, пожалуйста разрешите доступ к микрофону в настройках устройства.","micdevicenotfound":"Устройство для записи звука не найдено"}')},"788e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVICE_TYPES=void 0;const i=Object.freeze({IS:"SERVICE_TYPE_IS",IM:"SERVICE_TYPE_IM"});t.SERVICE_TYPES=i},"78a2":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chatcreate"}},[n("div",{staticClass:"selecttype"},[n("div",{staticClass:"work"},[e.type?e._e():n("div",{staticClass:"types"},e._l(e.viewTypes,(function(t){return n("div",{key:t.id,staticClass:"type",on:{click:function(n){return e.selecttype(t.id)}}},[n("div",{staticClass:"icon"},[n("i",{class:t.icon})]),n("div",[n("span",[e._v(e._s(e.$t("type."+t.id)))])])])})),0),e.type?n("div",{staticClass:"selectedtype"},[n("div",{staticClass:"icon",on:{click:e.unselecttype}},[n("i",{staticClass:"fas fa-arrow-left"})]),n("div",{staticClass:"label"},[e._v(" "+e._s(e.$t("typelabel."+e.type.id))+" ")]),n("div",{staticClass:"completewrapper"},[n("button",{staticClass:"button small rounded",class:{orange:e.cancomplete,ghost:!e.cancomplete},on:{click:function(t){return e.complete()}}},[e._v(" "+e._s(e.$t("caption.create"))+" "),n("i",{class:e.type.icon}),e._v(" "),e.selectedLength?n("span",[e._v(e._s(e.selectedLength))]):e._e()])])]):e._e()]),n("div",{staticClass:"creationbody"},[e.type?n("div",{staticClass:"groupsettigns"},["massmailing"===e.type.id?n("div",[n("div",{staticClass:"inputWrapper"},[n("div",{staticClass:"center"},[n("InputField",{attrs:{type:e.type.id,placeholder:this.$i18n.t("caption.addMassMessageHolder")},on:{input:e.typeMassMessage}})],1)])]):n("div",{staticClass:"namebuttoncreate"},[n("div",{staticClass:"groupNameInput"},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.groupName,expression:"groupName"}],attrs:{type:"text",placeholder:"privategroup"===e.type.id?this.$i18n.t("caption.addGroupNamePlaceHolder"):this.$i18n.t("caption.addPublicChatName")},domProps:{value:e.groupName},on:{input:function(t){t.target.composing||(e.groupName=t.target.value)}}})])])])]):e._e(),e.type?e._e():n("div",{staticClass:"contactswrapper oneonone"},[n("contacts",{attrs:{mode:"Select"},on:{select:e.selectoneuser}})],1),e.type?n("div",{staticClass:"contactswrapper"},[n("contacts",{attrs:{mode:"Selectmany",type:e.type.id},on:{selectedUsers:e.selectedUsers}})],1):e._e()])])])},r=[],o=n("2f62"),s=n("71da"),a=n("ed32"),c=n("72f3"),l={name:"chatcreate",props:{},components:{contacts:s["a"],InputField:a["a"]},data:function(){return{loading:!1,types:{privategroup:{id:"privategroup",icon:"fas fa-user-friends",value:"private"},publicgroup:{id:"publicgroup",icon:"fas fa-users",value:"public"},massmailing:{id:"massmailing",icon:"fas fa-envelope",value:"mass"}},type:null,groupName:"",massMessage:"",selected:{}}},created:()=>{},watch:{},computed:{...Object(o["c"])({auth:e=>e.auth,cancomplete:function(){return!!this.type&&("privategroup"==this.type.id?this.selectedLength>1:"publicgroup"==this.type.id?!!this.groupName:"massmailing"==this.type.id||void 0)},selectedLength:function(){return _.toArray(this.selected).length},pro:e=>c.indexOf(e.address)>-1}),viewTypes(){const{massmailing:e,...t}=this.types;return this.pro?this.types:t}},methods:{typeMassMessage(e){this.massMessage=e},createChats(){Object.values(this.selected).length&&this.massMessage?this.core.user.usersInfo(Object.values(this.selected),null,null,!0).then((e,t)=>{if(console.log("user",e),e&&e.length){const t=e[0].source.subscribers||[],n={message:this.massMessage,recipients:t,total:t.length};localStorage.setItem("chat_mass_message",JSON.stringify(n)),this.$emit("sendMassMessage",n)}}):this.$store.commit("icon",{icon:"error",message:"Please enter a message and choose recipients (subscribers)"})},unselecttype:function(){this.type=null,this.selected={}},selecttype:function(e){this.type=this.types[e],this.selected={}},selectedUsers:function(e){this.selected=e},selectoneuser:function(e){var t=this.core.mtrx.kit.tetatetid(e,this.core.user.userinfo);this.$router.push("chat?id="+t+"&u="+e.id).catch(e=>{})},complete(){if("massmailing"===this.type.id)return this.createChats();this.createGroupAction(this.selected).then(e=>{this.$emit("completed",e),this.$store.commit("icon",{icon:"success",message:""})}).catch(e=>{var t="An unexpected error occurred";"cantcomplete"==e&&(t="Please enter a group name and add chat members"),this.$store.commit("icon",{icon:"error",message:t})})},createGroupAction(e){if(!this.cancomplete)return Promise.reject("cantcomplete");if(!this.type)return Promise.reject("type");if(_.isEmpty(e))return Promise.reject("users");const t=this.core.mtrx.kit.groupIdLight(e);return this.$store.state.globalpreloader=!0,this.core.mtrx.client.createRoom({visibility:this.type.value,invite:t.idForInviting,name:"@"+(this.groupName?this.groupName:"New Room"),initial_state:[{type:"m.room.guest_access",state_key:"",content:{guest_access:"can_join"}}]}).then(e=>(this.$store.state.globalpreloader=!1,e)).catch(e=>(this.$store.state.globalpreloader=!1,Promise.reject(e)))}},mounted(){var e;this.type=(null===(e=this.$route.query)||void 0===e?void 0:e.type)||""}},u=l,d=(n("4871"),n("2877")),h=Object(d["a"])(u,i,r,!1,null,"32ebf78b",null);t["a"]=h.exports},"78ad":function(e,t,n){"use strict";n("672d")},7905:function(e,t,n){"use strict";n("1426")},"79f0":function(e,t,n){"use strict";var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixScheduler=a;var r=i(n("3987")),o=n("63c7");const s=!1;function a(e,t){this.retryAlgorithm=e||a.RETRY_BACKOFF_RATELIMIT,this.queueAlgorithm=t||a.QUEUE_MESSAGES,this._queues={},this._activeQueues=[],this._procFn=null}function c(e){e._procFn&&r.forEach(r.filter(r.keys(e._queues),(function(t){return-1===e._activeQueues.indexOf(t)&&e._queues[t].length>0})),(function(t){e._activeQueues.push(t),h("Spinning up queue: '%s'",t),l(e,t)}))}function l(e,t){const n=u(e,t);if(!n){const n=e._activeQueues.indexOf(t);return n>=0&&e._activeQueues.splice(n,1),void h("Stopping queue '%s' as it is now empty",t)}h("Queue '%s' has %s pending events",t,e._queues[t].length),Promise.resolve().then(()=>e._procFn(n.event)).then((function(i){d(e,t),h("Queue '%s' sent event %s",t,n.event.getId()),n.defer.resolve(i),l(e,t)}),(function(i){n.attempts+=1;const r=e.retryAlgorithm(n.event,n.attempts,i);h("retry(%s) err=%s event_id=%s waitTime=%s",n.attempts,i,n.event.getId(),r),-1===r?(h("Queue '%s' giving up on event %s",t,n.event.getId()),d(e,t),n.defer.reject(i),l(e,t)):setTimeout((function(){l(e,t)}),r)}))}function u(e,t){const n=e._queues[t];return r.isArray(n)?n[0]:null}function d(e,t){const n=e._queues[t];return r.isArray(n)?n.shift():null}function h(){s&&o.logger.log(...arguments)}a.prototype.getQueueForEvent=function(e){const t=this.queueAlgorithm(e);return t&&this._queues[t]?r.map(this._queues[t],(function(e){return e.event})):null},a.prototype.removeEventFromQueue=function(e){const t=this.queueAlgorithm(e);if(!t||!this._queues[t])return!1;let n=!1;return r.removeElement(this._queues[t],(function(t){if(t.event.getId()===e.getId())return n=!0,!0})),n},a.prototype.setProcessFunction=function(e){this._procFn=e,c(this)},a.prototype.queueEvent=function(e){const t=this.queueAlgorithm(e);if(!t)return null;this._queues[t]||(this._queues[t]=[]);const n=r.defer();return this._queues[t].push({event:e,defer:n,attempts:0}),h("Queue algorithm dumped event %s into queue '%s'",e.getId(),t),c(this),n.promise},a.RETRY_BACKOFF_RATELIMIT=function(e,t,n){if(400===n.httpStatus||403===n.httpStatus||401===n.httpStatus)return-1;if("rejected"===n.cors)return-1;if("M_TOO_LARGE"===n.name)return-1;if("M_LIMIT_EXCEEDED"===n.name){const e=n.data.retry_after_ms;if(e>0)return e}return t>4?-1:1e3*Math.pow(2,t)},a.QUEUE_MESSAGES=function(e){return"m.room.message"===e.getType()||e.hasAssocation()?"message":null}},"7a1f":function(e,t,n){"use strict";(function(e){var i=n("4a1e");function r(e){e.component("vue-page-transition",i["a"])}const o={version:1,install:r};t["a"]=o;let s=null;"undefined"!==typeof window?s=window.Vue:"undefined"!==typeof e&&(s=e.Vue),s&&s.use(o)}).call(this,n("c8ba"))},"7acf":function(e,t,n){"use strict";n("6933")},"7dff":function(e,t,n){},"81bf":function(e,t,n){"use strict";n("4061")},"826f":function(e,t,n){"use strict";n("bec2")},"84de":function(e,t,n){"use strict";n("507f")},"87d6":function(e,t,n){"use strict";var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.User=s;var r=i(n("3987")),o=n("faa1");function s(e){this.userId=e,this.presence="offline",this.presenceStatusMsg=null,this._unstable_statusMessage="",this.displayName=e,this.rawDisplayName=e,this.avatarUrl=null,this.lastActiveAgo=0,this.lastPresenceTs=0,this.currentlyActive=!1,this.events={presence:null,profile:null},this._updateModifiedTime()}r.inherits(s,o.EventEmitter),s.prototype.setPresenceEvent=function(e){if("m.presence"!==e.getType())return;const t=null===this.events.presence;this.events.presence=e;const n=[];(e.getContent().presence!==this.presence||t)&&n.push("User.presence"),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&n.push("User.avatarUrl"),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&n.push("User.displayName"),void 0!==e.getContent().currently_active&&e.getContent().currently_active!==this.currentlyActive&&n.push("User.currentlyActive"),this.presence=e.getContent().presence,n.push("User.lastPresenceTs"),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this._updateModifiedTime();for(let i=0;i<n.length;i++)this.emit(n[i],e,this)},s.prototype.setDisplayName=function(e){const t=this.displayName;this.displayName="string"===typeof e?e:void 0,e!==t&&this._updateModifiedTime()},s.prototype.setRawDisplayName=function(e){this.rawDisplayName="string"===typeof e?e:void 0},s.prototype.setAvatarUrl=function(e){const t=this.avatarUrl;this.avatarUrl=e,e!==t&&this._updateModifiedTime()},s.prototype._updateModifiedTime=function(){this._modified=Date.now()},s.prototype.getLastModifiedTime=function(){return this._modified},s.prototype.getLastActiveTs=function(){return this.lastPresenceTs-this.lastActiveAgo},s.prototype._unstable_updateStatusMessage=function(e){e.getContent()?this._unstable_statusMessage=e.getContent()["status"]:this._unstable_statusMessage="",this._updateModifiedTime(),this.emit("User._unstable_statusMessage",this)}},"880e":function(e,t,n){},8975:function(e,t,n){},"8cd8":function(e,t,n){"use strict";n("f703")},9205:function(e,t,n){"use strict";n("c49a")},"92a6":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"contacts-preview"},[n("div",{staticClass:"previewWrapper",style:e.isUser},[n("div",{staticClass:"iconWrapper"},[n("userpic",{attrs:{userinfo:e.contact,mode:"Contacts"}})],1),n("div",{staticClass:"infoWrapper"},[n("div",{staticClass:"summaryLine"},[n("div",{staticClass:"caption"},[n("span",[e._v(e._s(e.contact.name))])])])])])])},r=[],o=n("2f62"),s={name:"contactsPreview",props:{contact:{},mode:{default:"",type:String},user:null},components:{},data:function(){return{loading:!1,isUser:"",asd:{}}},computed:Object(o["c"])({auth:e=>e.auth}),methods:{},mounted(){}},a=s,c=(n("4001"),n("2877")),l=Object(c["a"])(a,i,r,!1,null,"951b8314",null);t["a"]=l.exports},9322:function(e,t,n){"use strict";n("c4a5")},9389:function(e,t,n){"use strict";n("f41f")},9589:function(e,t,n){"use strict";var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResult=s;var r=i(n("3987")),o=n("bb76");function s(e,t){this.rank=e,this.context=t}s.fromJson=function(e,t){const n=e.context||{},i=n.events_before||[],a=n.events_after||[],c=new o.EventContext(t(e.result));return c.setPaginateToken(n.start,!0),c.addEvents(r.map(i,t),!0),c.addEvents(r.map(a,t),!1),c.setPaginateToken(n.end,!1),new s(e.rank,c)}},"95f7":function(e,t,n){},"96ee":function(e){e.exports=JSON.parse('{"caption":{"create":"Create","addPublicChatName":"Add Public Chat Name","addGroupNamePlaceHolder":"Add Group Name","createPublicChat":"Create public chat","chatTopic":"Topic renamed","publicRoomTitle":"Public Room Preview","asModerator":"as moderator","marked":"marked","unmarked":"unmarked","removeBan":"Remove Ban","cancelModeration":"Remove moderation","uploadFiles":"上传文件","header":"头","dragAndDropAFile":"拖放文件","chatInvite":"你被邀请与之聊天：","cantJoin":"您不能加入与以下人员的聊天：","chatInviteDecline":"你可以加入聊天或拒绝邀请","creatorLeft":"因为创建者离开了房间","encrypted":"加密的","noImages":"此聊天中还没有图片","noFiles":"There are no files in this chat yet","inviteUser":"邀请用户","invite":"邀请","add":"添加","mute":"静音","unmute":"取消静音","leave":"离开","Info":"信息","new":"新","tying":"打字","accNotFound":"您的注册正在进行中，请等待...","emptyList":"列表为空（已过滤或只是空）","welcome":"欢迎来到Pocketnet聊天","startNewChat":"开始一个新的聊天","chats":"Chats","shareWith":"与人分享","newChat":"新聊天","moveToChat":"移动到聊天","queryNoResults":"查询报告没有结果","needMoreCharacters":"需要更多的字符来获得结果","createGroup":"创建群组","unabletoDecrypt":"* 无法解密","messageDeleted":"信息已删除","sentImage":"已发送的图片","sentVoiceMessage":"发了一条语音信息","invitationToChat":"邀请聊天","invitationToRoom":"Invitation to room","leftChat":"离开聊天","joined":"加入","chatRenamed":"聊天记录重命名为","recentComment":"最近的评论：","share":"SHARE","followers":"Followers:","reputation":"声誉:","following":"关注：","theme":"主题:","contacts":"联系人","phoneContacts":"电话联系人","chooseInviteMedia":"请选择你的邀请方式：","admin":"管理员","moderator":"版主","videocall":"视频通话","call":"呼叫","leaveAndDelete":"离开和删除","donate":"捐献","makeModerator":"做版主","ban":"禁止","kick":"踢","members":"会员","media":"媒体","files":"文件","contactsList":"联系人列表","send":"发送","pageCaption":"页面标题","caption":"标题","text":"文本","placeholder":"占位符","sendTransactionTo":"发送交易到","toBePaidByReceiver":"由收件人支付","toBePaidBySender":"将由发送方支付","source":"来源","amount":"金额","receiver":"收件人","message":"消息","includeFeesInAmount":"在金额中包括费用","transactionFees":"交易费用","totalAmount":"总金额","balanceTooLow":"余额太低","transactionError":"Error, can\'t make the transaction","calculateFees":"计算费用","startChatWith":"开始与之聊天","searchResult":"搜索结果","joinInTheChat":"加入到聊天中","invested":"被邀请","inTheChat":"在聊天中","banned":"被禁止的","andRoom":"和室","left":"左边","theChat":" 聊天","made":"制造","aModerator":"一个版主","editedChatNameTo":"将聊天名称编辑为","somebody":"某人","sent":"已发送","PKOINto":" PKOIN to ","response":"回应","messagefrom":"轉發的消息來自","edited":"已编辑","settings":"设置","unauthorized":"未经授权","search":"搜索","replyOnMessage":"在信息中回复","editMessage":"编辑信息","inviteFriend":"邀请朋友","emptyContactList":"联系人列表是空的","joinApp":"加入口袋网","hasInvitedToJoin":"已邀请您加入口袋网","contactsempty":"您还没有联系人，请在搜索中找到他们","sendmessage":"Send message","clearHistory":"Clear history"},"input":{"patientEmailPlaceholder":"电子邮件","refillNamePlaceholder":"补货名称"},"message":{},"button":{"starChatButton":"开始聊天","decline":"拒绝","declineandignore":"忽略用户","join":"加入","ok":"好的","copy":"复制","forward":"转发","delete":"删除","reply":"回复","save":"Save","share":"分享","download":"下载","downloaded":"已下载","goToPocketnetProfile":"转到Pocketnet配置文件","sendFile":"发送文件","takePhotoOrVideo":"发送图像","sendCoins":"发送硬币","edit":"编辑","select":"選擇","block":"阻止","unblock":"解除封锁","blockUser":"阻止用户"},"yes":"是的","cancel":"取消","teamMessages":{"1-title":"欢迎来到巴斯蒂昂私人聊天室!","1-list1":"与你的手机号码无关的私人信使","1-list2":"默认对每一次1对1对话进行端对端加密","1-list3":"通过聊天发送或接收的所有图像都是加密存储的","1-list4":"信息的历史记录只保存7天","2-title":"一个巨大的公告! 口袋网的应用程序现在被称为Bastyon!","2-message1":"该域名将被转移到Bastyon.com。我们最近发布了以下重大更新","2-list1":"不与你的电话号码相连的私人加密信使","2-list2":"能够将PKOIN捐赠给博主","2-list3":"视频和实时流媒体","2-message2":"现在就邀请你的朋友，成为去中心化的互联网大未来的一部分吧","2-button":"邀请朋友"},"settings_pin":"Pin chat window","checked":"Yes","unchecked":"No","settings_read":"Send read receipts","messagewasburn":"This message remains only in the memory of your device","messagewillburn":"The message will be deleted soon","micaccessbrowser":"Access to the microphone is restricted, please check your browser settings.","micaccesscommonproblem":"Sorry, for some reason it is not possible to record voice messages on the device","micaccesscordova":"Access to the microphone is restricted, please check your device settings.","micdevicenotfound":"Audio recording device not found"}')},9730:function(e,t,n){"use strict";function i(e,t){return{msgtype:"m.text",format:"org.matrix.custom.html",body:e,formatted_body:t}}function r(e,t){return{msgtype:"m.notice",format:"org.matrix.custom.html",body:e,formatted_body:t}}function o(e,t){return{msgtype:"m.emote",format:"org.matrix.custom.html",body:e,formatted_body:t}}function s(e){return{msgtype:"m.text",body:e}}function a(e){return{msgtype:"m.notice",body:e}}function c(e){return{msgtype:"m.emote",body:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.makeHtmlMessage=i,t.makeHtmlNotice=r,t.makeHtmlEmote=o,t.makeTextMessage=s,t.makeNotice=a,t.makeEmoteMessage=c},9801:function(e,t,n){"use strict";n("edd7")},"980b":function(t,n,i){"use strict";(function(t){var r=i("c973").default;i("d9e2"),i("907a"),i("3c5d");var o=i("dbce"),s=i("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.MatrixClient=N,n.CRYPTO_ENABLED=void 0;var a=s(i("0b16")),c=i("faa1"),l=i("d0f2"),u=i("c976"),d=i("646c"),h=i("a120"),m=i("e685"),p=i("9589"),f=i("a376"),g=i("3134"),v=i("16e5"),y=o(i("3987")),_=i("1c8f"),b=i("07df"),E=o(i("9730")),S=i("3da4"),w=(i("5f05"),i("63c7")),C=i("f408"),k=i("ef06"),T=i("87d6"),I=i("3700");const R=3e3,P=!1;n.CRYPTO_ENABLED=P;const O=216e5,x=6e5;function M(t,n,i){const r=[];for(const[o,s]of Object.entries(t))try{const e=A(s,n);e.session_id=o,e.room_id=i,r.push(e)}catch(e){w.logger.log("Failed to decrypt megolm session from backup",e)}return r}function A(e,t){return JSON.parse(t.decrypt(e.session_data.ephemeral,e.session_data.mac,e.session_data.ciphertext))}function N(e){e.baseUrl=y.ensureNoTrailingSlash(e.baseUrl),e.idBaseUrl=y.ensureNoTrailingSlash(e.idBaseUrl),l.MatrixBaseApis.call(this,e),this.olmVersion=null,this.reEmitter=new S.ReEmitter(this),this.usingExternalCrypto=e.usingExternalCrypto,this.store=e.store||new f.StubStore,this.deviceId=e.deviceId||null;const t=e.userId||null;if(this.credentials={userId:t},e.deviceToImport?this.deviceId?w.logger.warn("not importing device because device ID is provided to constructor independently of exported data"):this.credentials.userId?w.logger.warn("not importing device because user ID is provided to constructor independently of exported data"):e.deviceToImport.deviceId?(this.deviceId=e.deviceToImport.deviceId,this.credentials.userId=e.deviceToImport.userId,this._exportedOlmDeviceToImport=e.deviceToImport.olmDevice):w.logger.warn("not importing device because no device ID in exported data"):e.pickleKey&&(this.pickleKey=e.pickleKey),this.scheduler=e.scheduler,this.scheduler){const e=this;this.scheduler.setProcessFunction(function(){var t=r((function*(t){const n=e.getRoom(t.getRoomId());t.status!==h.EventStatus.SENDING&&F(n,t,h.EventStatus.SENDING);const i=yield K(e,t);return n&&n.updatePendingEvent(t,h.EventStatus.SENT,i.event_id),i}));return function(e){return t.apply(this,arguments)}}())}this.clientRunning=!1;const n=(0,g.createNewMatrixCall)(this);this._supportsVoip=!1,n?(this._callEventHandler=new v.CallEventHandler(this),this._supportsVoip=!0):this._callEventHandler=null,this._syncingRetry=null,this._syncApi=null,this._peekSync=null,this._isGuest=!1,this._ongoingScrollbacks={},this.timelineSupport=Boolean(e.timelineSupport),this.urlPreviewCache={},this._notifTimelineSet=null,this.unstableClientRelationAggregation=!!e.unstableClientRelationAggregation,this._crypto=null,this._cryptoStore=e.cryptoStore,this._sessionStore=e.sessionStore,this._verificationMethods=e.verificationMethods,this._cryptoCallbacks=e.cryptoCallbacks||{},this._forceTURN=e.forceTURN||!1,this._iceCandidatePoolSize=void 0===e.iceCandidatePoolSize?0:e.iceCandidatePoolSize,this._supportsCallTransfer=e.supportsCallTransfer||!1,this._fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this._pushProcessor=new k.PushProcessor(this),this._serverVersionsPromise=null,this._cachedCapabilities=null,this._clientWellKnown=void 0,this._clientWellKnownPromise=void 0,this._turnServers=[],this._turnServersExpiry=0,this._checkTurnServersIntervalID=null,this.on("Event.decrypted",e=>{const t=e.getPushActions(),n=this._pushProcessor.actionsForEvent(e);e.setPushActions(n);const i=this.getRoom(e.getRoomId());if(!i)return;const r=i.getUnreadNotificationCount("highlight"),o=!(!t||!t.tweaks)&&!!t.tweaks.highlight,s=!(!n||!n.tweaks)&&!!n.tweaks.highlight;if((o!==s||r>0)&&!i.hasUserReadEvent(this.getUserId(),e.getId())){let e=r;s&&!o&&e++,!s&&o&&e--,i.setUnreadNotificationCount("highlight",e);const t=i.getUnreadNotificationCount("total");t<e&&i.setUnreadNotificationCount("total",e)}}),this.on("Room.receipt",(e,t)=>{if(t&&this.isRoomEncrypted(t.roomId)){const n=e.getContent(),i=Object.keys(n).filter(e=>Object.keys(n[e]["m.read"]).includes(this.getUserId())).length>0;if(!i)return;const r=20,o=t.getLiveTimeline().getEvents();let s=0;for(let e=o.length-1;e>=0;e--){if(e===o.length-r)return;const n=o[e];if(t.hasUserReadEvent(this.getUserId(),n.getId()))break;const i=this.getPushActionsForEvent(n);s+=i.tweaks&&i.tweaks.highlight?1:0}t.setUnreadNotificationCount("highlight",s)}})}function D(e,t,n,i,r,o){return j.apply(this,arguments)}function j(){return j=r((function*(e,t,n,i,r,o){if(!e._crypto)throw new Error("End-to-End encryption disabled");yield e._crypto.setDeviceVerification(t,n,i,r,o)})),j.apply(this,arguments)}function U(e,t){for(const n of t)e.prototype[n]=function(){if(!this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto[n](...arguments)}}function L(e,t,n,i){return Promise.resolve().then((function(){const i=$(e,n,t);return i?(F(t,n,h.EventStatus.ENCRYPTING),i.then(()=>{F(t,n,h.EventStatus.SENDING)})):null})).then((function(){let i;return e.scheduler&&(i=e.scheduler.queueEvent(n),i&&e.scheduler.getQueueForEvent(n).length>1&&F(t,n,h.EventStatus.QUEUED)),i||(i=K(e,n),t&&(i=i.then(e=>(t.updatePendingEvent(n,h.EventStatus.SENT,e.event_id),e)))),i})).then((function(e){return i&&i(null,e),e}),(function(e){w.logger.error("Error sending event",e.stack||e);try{n.error=e,F(t,n,h.EventStatus.NOT_SENT),e.event=n,i&&i(e)}catch(r){w.logger.error("Exception in error handler!",r.stack||e)}throw e}))}function $(e,t,n){if(t.isEncrypted())return null;if(!e.isRoomEncrypted(t.getRoomId()))return null;if(!e._crypto&&e.usingExternalCrypto)return null;if("m.reaction"===t.getType())return null;if(!e._crypto)throw new Error("This room is configured to use encryption, but your client does not support encryption.");return e._crypto.encryptEvent(t,n)}function B(e,t,n){if("m.reaction"===n)return n;const i=e.isRoomEncrypted(t);return i?"m.room.encrypted":n}function F(e,t,n){e?e.updatePendingEvent(t,n):t.setStatus(n)}function K(e,t){let n=t.getTxnId();n||(n=e.makeTxnId(),t.setTxnId(n));const i={$roomId:t.getRoomId(),$eventType:t.getWireType(),$stateKey:t.getStateKey(),$txnId:n};let r;if(t.isState()){let e="/rooms/$roomId/state/$eventType";t.getStateKey()&&t.getStateKey().length>0&&(e="/rooms/$roomId/state/$eventType/$stateKey"),r=y.encodeUri(e,i)}else if(t.isRedaction()){const e="/rooms/$roomId/redact/$redactsEventId/$txnId";r=y.encodeUri(e,Object.assign({$redactsEventId:t.event.redacts},i))}else r=y.encodeUri("/rooms/$roomId/send/$eventType/$txnId",i);return e._http.authedRequest(void 0,"PUT",r,void 0,t.getWireContent()).then(e=>(w.logger.log(`Event sent to ${t.getRoomId()} with event id ${e.event_id}`),e))}function q(e,t,n,i,r,o){y.isFunction(r)&&(o=r,r=void 0);const s=y.encodeUri("/rooms/$roomId/state/m.room.member/$userId",{$roomId:t,$userId:n});return e._http.authedRequest(o,"PUT",s,void 0,{membership:i,reason:r})}function G(e,t,n,i,r,o){y.isFunction(r)&&(o=r,r=void 0);const s=y.encodeUri("/rooms/$room_id/$membership",{$room_id:t,$membership:i});return e._http.authedRequest(o,"POST",s,void 0,{user_id:n,reason:r})}function z(e,t,n){e&&e(n),t(n)}function V(e,t,n){e&&e(null,n),t(n)}function H(e,t){const n=Boolean(t&&t.preventReEmit);function i(t){const i=new h.MatrixEvent(t);return i.isEncrypted()&&(n||e.reEmitter.reEmit(i,["Event.decrypted"]),i.attemptDecryption(e._crypto)),n||e.reEmitter.reEmit(i,["Event.replaced"]),i}return i}y.inherits(N,c.EventEmitter),y.extend(N.prototype,l.MatrixBaseApis.prototype),N.prototype.rehydrateDevice=r((function*(){if(this._crypto)throw new Error("Cannot rehydrate device after crypto is initialized");if(!this._cryptoCallbacks.getDehydrationKey)return;const n=yield this.getDehydratedDevice();if(!n)return;if(!n.device_data||!n.device_id)return void w.logger.info("no dehydrated device found");const i=new t.Olm.Account;try{const e=n.device_data;if(e.algorithm!==_dehydration.DEHYDRATION_ALGORITHM)return void w.logger.warn("Wrong algorithm for dehydrated device");w.logger.log("unpickling dehydrated device");const t=yield this._cryptoCallbacks.getDehydrationKey(e,t=>{i.unpickle(new Uint8Array(t),e.account)});i.unpickle(t,e.account),w.logger.log("unpickled device");const r=yield this._http.authedRequest(void 0,"POST","/dehydrated_device/claim",void 0,{device_id:n.device_id},{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"});if(!0===r.success){this.deviceId=n.device_id,w.logger.info("using dehydrated device");const e=this.pickleKey||"DEFAULT_KEY";return this._exportedOlmDeviceToImport={pickledAccount:i.pickle(e),sessions:[],pickleKey:e},i.free(),this.deviceId}return i.free(),void w.logger.info("not using dehydrated device")}catch(e){i.free(),w.logger.warn("could not unpickle",e)}})),N.prototype.getDehydratedDevice=r((function*(){try{return yield this._http.authedRequest(void 0,"GET","/dehydrated_device",void 0,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2697.v2"})}catch(e){return void w.logger.info("could not get dehydrated device",e.toString())}})),N.prototype.setDehydrationKey=function(){var e=r((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(this._crypto)return yield this._crypto._dehydrationManager.setKeyAndQueueDehydration(e,t,n);w.logger.warn("not dehydrating device if crypto is not enabled")}));return function(t){return e.apply(this,arguments)}}(),N.prototype.createDehydratedDevice=function(){var e=r((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(this._crypto)return yield this._crypto._dehydrationManager.setKey(e,t,n),yield this._crypto._dehydrationManager.dehydrateDevice();w.logger.warn("not dehydrating device if crypto is not enabled")}));return function(t){return e.apply(this,arguments)}}(),N.prototype.exportDevice=r((function*(){if(this._crypto)return{userId:this.credentials.userId,deviceId:this.deviceId,olmDevice:yield this._crypto._olmDevice.export()};w.logger.warn("not exporting device if crypto is not enabled")})),N.prototype.clearStores=function(){if(this._clientRunning)throw new Error("Cannot clear stores while client is running");const e=[];return e.push(this.store.deleteAllData()),this._cryptoStore&&e.push(this._cryptoStore.deleteAllData()),Promise.all(e)},N.prototype.getUserId=function(){return this.credentials&&this.credentials.userId?this.credentials.userId:null},N.prototype.getDomain=function(){return this.credentials&&this.credentials.userId?this.credentials.userId.replace(/^.*?:/,""):null},N.prototype.getUserIdLocalpart=function(){return this.credentials&&this.credentials.userId?this.credentials.userId.split(":")[0].substring(1):null},N.prototype.getDeviceId=function(){return this.deviceId},N.prototype.supportsVoip=function(){return this._supportsVoip},N.prototype.setForceTURN=function(e){this._forceTURN=e},N.prototype.setSupportsCallTransfer=function(e){this._supportsCallTransfer=e},N.prototype.getSyncState=function(){return this._syncApi?this._syncApi.getSyncState():null},N.prototype.getSyncStateData=function(){return this._syncApi?this._syncApi.getSyncStateData():null},N.prototype.isInitialSyncComplete=function(){const e=this.getSyncState();return!!e&&("PREPARED"===e||"SYNCING"===e)},N.prototype.isGuest=function(){return this._isGuest},N.prototype.getScheduler=function(){return this.scheduler},N.prototype.setGuest=function(e){this._isGuest=e},N.prototype.retryImmediately=function(){return this._syncApi.retryImmediately()},N.prototype.getNotifTimelineSet=function(){return this._notifTimelineSet},N.prototype.setNotifTimelineSet=function(e){this._notifTimelineSet=e},N.prototype.getCapabilities=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=(new Date).getTime();return this._cachedCapabilities&&!e&&t<this._cachedCapabilities.expiration?(w.logger.log("Returning cached capabilities"),Promise.resolve(this._cachedCapabilities.capabilities)):this._http.authedRequest(void 0,"GET","/capabilities").catch(e=>(w.logger.error(e),null)).then(e=>{e||(e={});const n=e["capabilities"]||{},i=Object.keys(n).length?O:6e4+5e3*Math.random();return this._cachedCapabilities={capabilities:n,expiration:t+i},w.logger.log("Caching capabilities: ",n),n})},N.prototype.initCrypto=r((function*(){if(!(0,_crypto.isCryptoAvailable)())throw new Error("End-to-end encryption not supported in this js-sdk build: did you remember to load the olm library?");if(this._crypto)return void w.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");if(!this._sessionStore)throw new Error("Cannot enable encryption: no sessionStore provided");if(!this._cryptoStore)throw new Error("Cannot enable encryption: no cryptoStore provided");w.logger.log("Crypto: Starting up crypto store..."),yield this._cryptoStore.startup(),w.logger.log("Crypto: initialising roomlist..."),yield this._roomList.init();const e=this.getUserId();if(null===e)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");if(null===this.deviceId)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");const t=new _crypto.Crypto(this,this._sessionStore,e,this.deviceId,this.store,this._cryptoStore,this._roomList,this._verificationMethods);this.reEmitter.reEmit(t,["crypto.keyBackupFailed","crypto.keyBackupSessionsRemaining","crypto.roomKeyRequest","crypto.roomKeyRequestCancellation","crypto.warning","crypto.devicesUpdated","crypto.willUpdateDevices","deviceVerificationChanged","userTrustStatusChanged","crossSigning.keysChanged"]),w.logger.log("Crypto: initialising crypto object..."),yield t.init({exportedOlmDevice:this._exportedOlmDeviceToImport,pickleKey:this.pickleKey}),delete this._exportedOlmDeviceToImport,this.olmVersion=_crypto.Crypto.getOlmVersion(),t.registerEventHandlers(this),this._crypto=t})),N.prototype.isCryptoEnabled=function(){return null!==this._crypto},N.prototype.getDeviceEd25519Key=function(){return this._crypto?this._crypto.getDeviceEd25519Key():null},N.prototype.getDeviceCurve25519Key=function(){return this._crypto?this._crypto.getDeviceCurve25519Key():null},N.prototype.uploadKeys=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.uploadDeviceKeys()},N.prototype.downloadKeys=function(e,t){return null===this._crypto?Promise.reject(new Error("End-to-end encryption disabled")):this._crypto.downloadKeys(e,t)},N.prototype.getStoredDevicesForUser=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getStoredDevicesForUser(e)||[]},N.prototype.getStoredDevice=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getStoredDevice(e,t)||null},N.prototype.setDeviceVerified=function(e,t,n){void 0===n&&(n=!0);const i=D(this,e,t,n,null);return e==this.credentials.userId&&this._crypto.checkKeyBackup(),i},N.prototype.setDeviceBlocked=function(e,t,n){return void 0===n&&(n=!0),D(this,e,t,null,n)},N.prototype.setDeviceKnown=function(e,t,n){return void 0===n&&(n=!0),D(this,e,t,null,null,n)},N.prototype.requestVerificationDM=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.requestVerificationDM(e,t)},N.prototype.findVerificationRequestDMInProgress=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.findVerificationRequestDMInProgress(e)},N.prototype.getVerificationRequestsToDeviceInProgress=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getVerificationRequestsToDeviceInProgress(e)},N.prototype.requestVerification=function(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.requestVerification(e,t)},N.prototype.beginKeyVerification=function(e,t,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.beginKeyVerification(e,t,n)},N.prototype.setGlobalBlacklistUnverifiedDevices=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.setGlobalBlacklistUnverifiedDevices(e)},N.prototype.getGlobalBlacklistUnverifiedDevices=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getGlobalBlacklistUnverifiedDevices()},N.prototype.setGlobalErrorOnUnknownDevices=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.setGlobalErrorOnUnknownDevices(e)},N.prototype.getGlobalErrorOnUnknownDevices=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.getGlobalErrorOnUnknownDevices()},U(N,["getCrossSigningId","getStoredCrossSigningForUser","checkUserTrust","checkDeviceTrust","checkOwnCrossSigningTrust","checkCrossSigningPrivateKey","legacyDeviceVerification","prepareToEncrypt","isCrossSigningReady","bootstrapCrossSigning","getCryptoTrustCrossSignedDevices","setCryptoTrustCrossSignedDevices","countSessionsNeedingBackup"]),U(N,["getEventEncryptionInfo","createRecoveryKeyFromPassphrase","isSecretStorageReady","bootstrapSecretStorage","addSecretStorageKey","hasSecretStorageKey","storeSecret","getSecret","isSecretStored","requestSecret","getDefaultSecretStorageKeyId","setDefaultSecretStorageKeyId","checkSecretStorageKey","checkSecretStoragePrivateKey"]),N.prototype.getEventSenderDeviceInfo=function(){var e=r((function*(e){return this._crypto?this._crypto.getEventSenderDeviceInfo(e):null}));return function(t){return e.apply(this,arguments)}}(),N.prototype.isEventSenderVerified=function(){var e=r((function*(e){const t=yield this.getEventSenderDeviceInfo(e);return!!t&&t.isVerified()}));return function(t){return e.apply(this,arguments)}}(),N.prototype.cancelAndResendEventRoomKeyRequest=function(e){return e.cancelAndResendKeyRequest(this._crypto,this.getUserId())},N.prototype.setRoomEncryption=function(e,t){if(!this._crypto)throw new Error("End-to-End encryption disabled");return this._crypto.setRoomEncryption(e,t)},N.prototype.isRoomEncrypted=function(e){const t=this.getRoom(e);if(!t)return!1;const n=t.currentState.getStateEvents("m.room.encryption","");return!!n},N.prototype.forceDiscardSession=function(e){if(!this._crypto)throw new Error("End-to-End encryption disabled");this._crypto.forceDiscardSession(e)},N.prototype.exportRoomKeys=function(){return this._crypto?this._crypto.exportRoomKeys():Promise.reject(new Error("End-to-end encryption disabled"))},N.prototype.importRoomKeys=function(e,t){if(!this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.importRoomKeys(e,t)},N.prototype.checkKeyBackup=function(){return this._crypto.checkKeyBackup()},N.prototype.getKeyBackupVersion=function(){return this._http.authedRequest(void 0,"GET","/room_keys/version",void 0,void 0,{prefix:_.PREFIX_UNSTABLE}).then(e=>{if(e.algorithm!==olmlib.MEGOLM_BACKUP_ALGORITHM){const t="Unknown backup algorithm: "+e.algorithm;return Promise.reject(t)}if("object"===typeof e.auth_data&&e.auth_data.public_key)return e;{const e="Invalid backup data returned";return Promise.reject(e)}}).catch(e=>{if("M_NOT_FOUND"===e.errcode)return null;throw e})},N.prototype.isKeyBackupTrusted=function(e){return this._crypto.isKeyBackupTrusted(e)},N.prototype.getKeyBackupEnabled=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto._checkedForBackup?Boolean(this._crypto.backupKey):null},N.prototype.enableKeyBackup=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo=e,this._crypto.backupKey&&this._crypto.backupKey.free(),this._crypto.backupKey=new t.Olm.PkEncryption,this._crypto.backupKey.set_recipient_key(e.auth_data.public_key),this.emit("crypto.keyBackupStatus",!0),this._crypto.scheduleKeyBackupSend()},N.prototype.disableKeyBackup=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo=null,this._crypto.backupKey&&this._crypto.backupKey.free(),this._crypto.backupKey=null,this.emit("crypto.keyBackupStatus",!1)},N.prototype.prepareKeyBackupVersion=function(){var e=r((function*(e){let{secureSecretStorage:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===this._crypto)throw new Error("End-to-end encryption disabled");const{keyInfo:n,encodedPrivateKey:i,privateKey:r}=yield this.createRecoveryKeyFromPassphrase(e);t&&(yield this.storeSecret("m.megolm_backup.v1",(0,olmlib.encodeBase64)(r)),w.logger.info("Key backup private key stored in secret storage"));const o={public_key:n.pubkey};return n.passphrase&&(o.private_key_salt=n.passphrase.salt,o.private_key_iterations=n.passphrase.iterations),{algorithm:olmlib.MEGOLM_BACKUP_ALGORITHM,auth_data:o,recovery_key:i}}));return function(t){return e.apply(this,arguments)}}(),N.prototype.isKeyBackupKeyStored=r((function*(){return this.isSecretStored("m.megolm_backup.v1",!1)})),N.prototype.createKeyBackupVersion=function(){var e=r((function*(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const t={algorithm:e.algorithm,auth_data:e.auth_data};yield this._crypto._signObject(t.auth_data),this._cryptoCallbacks.getCrossSigningKey&&this._crypto._crossSigningInfo.getId()&&(yield this._crypto._crossSigningInfo.signObject(t.auth_data,"master"));const n=yield this._http.authedRequest(void 0,"POST","/room_keys/version",void 0,t,{prefix:_.PREFIX_UNSTABLE});return yield this.checkKeyBackup(),this.getKeyBackupEnabled()||w.logger.error("Key backup not usable even though we just created it"),n}));return function(t){return e.apply(this,arguments)}}(),N.prototype.deleteKeyBackupVersion=function(e){if(null===this._crypto)throw new Error("End-to-end encryption disabled");this._crypto.backupInfo&&this._crypto.backupInfo.version===e&&this.disableKeyBackup();const t=y.encodeUri("/room_keys/version/$version",{$version:e});return this._http.authedRequest(void 0,"DELETE",t,void 0,void 0,{prefix:_.PREFIX_UNSTABLE})},N.prototype._makeKeyBackupPath=function(e,t,n){let i;i=void 0!==t?y.encodeUri("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:t}):void 0!==e?y.encodeUri("/room_keys/keys/$roomId",{$roomId:e}):"/room_keys/keys";const r=void 0===n?void 0:{version:n};return{path:i,queryData:r}},N.prototype.sendKeyBackup=function(e,t,n,i){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const r=this._makeKeyBackupPath(e,t,n);return this._http.authedRequest(void 0,"PUT",r.path,r.queryData,i,{prefix:_.PREFIX_UNSTABLE})},N.prototype.scheduleAllGroupSessionsForBackup=r((function*(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");yield this._crypto.scheduleAllGroupSessionsForBackup()})),N.prototype.flagAllGroupSessionsForBackup=function(){if(null===this._crypto)throw new Error("End-to-end encryption disabled");return this._crypto.flagAllGroupSessionsForBackup()},N.prototype.isValidRecoveryKey=function(t){try{return(0,_recoverykey.decodeRecoveryKey)(t),!0}catch(e){return!1}},N.prototype.keyBackupKeyFromPassword=function(e,t){return(0,_key_passphrase.keyFromAuthData)(t.auth_data,e)},N.prototype.keyBackupKeyFromRecoveryKey=function(e){return(0,_recoverykey.decodeRecoveryKey)(e)},N.RESTORE_BACKUP_ERROR_BAD_KEY="RESTORE_BACKUP_ERROR_BAD_KEY",N.prototype.restoreKeyBackupWithPassword=function(){var e=r((function*(e,t,n,i,r){const o=yield(0,_key_passphrase.keyFromAuthData)(i.auth_data,e);return this._restoreKeyBackup(o,t,n,i,r)}));return function(t,n,i,r,o){return e.apply(this,arguments)}}(),N.prototype.restoreKeyBackupWithSecretStorage=function(){var e=r((function*(e,t,n,i){const r=yield this.getSecret("m.megolm_backup.v1"),o=(0,_crypto.fixBackupKey)(r);if(o){const[e]=yield this._crypto.getSecretStorageKey();yield this.storeSecret("m.megolm_backup.v1",o,[e])}const s=(0,olmlib.decodeBase64)(o||r);return this._restoreKeyBackup(s,t,n,e,i)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),N.prototype.restoreKeyBackupWithRecoveryKey=function(e,t,n,i,r){const o=(0,_recoverykey.decodeRecoveryKey)(e);return this._restoreKeyBackup(o,t,n,i,r)},N.prototype.restoreKeyBackupWithCache=function(){var e=r((function*(e,t,n,i){const r=yield this._crypto.getSessionBackupPrivateKey();if(!r)throw new Error("Couldn't get key");return this._restoreKeyBackup(r,e,t,n,i)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),N.prototype._restoreKeyBackup=function(n,i,r,o){let{cacheCompleteCallback:s,progressCallback:a}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(null===this._crypto)throw new Error("End-to-end encryption disabled");let c=0,l=[];const u=this._makeKeyBackupPath(i,r,o.version),d=new t.Olm.PkDecryption;let h;try{h=d.init_with_private_key(n)}catch(e){throw d.free(),e}return h!==o.auth_data.public_key?Promise.reject({errcode:N.RESTORE_BACKUP_ERROR_BAD_KEY}):(this._crypto.storeSessionBackupPrivateKey(n).catch(e=>{w.logger.warn("Error caching session backup key:",e)}).then(s),a&&a({stage:"fetch"}),this._http.authedRequest(void 0,"GET",u.path,u.queryData,void 0,{prefix:_.PREFIX_UNSTABLE}).then(t=>{if(t.rooms)for(const[e,n]of Object.entries(t.rooms)){if(!n.sessions)continue;c+=Object.keys(n.sessions).length;const t=M(n.sessions,d,e);for(const n of t)n.room_id=e,l.push(n)}else if(t.sessions)c=Object.keys(t.sessions).length,l=M(t.sessions,d,i,l);else{c=1;try{const e=A(t,d);e.room_id=i,e.session_id=r,l.push(e)}catch(e){w.logger.log("Failed to decrypt megolm session from backup",e)}}return this.importRoomKeys(l,{progressCallback:a,untrusted:!0,source:"backup"})}).then(()=>this._crypto.setTrustedBackupPubKey(h)).then(()=>({total:c,imported:l.length})).finally(()=>{d.free()}))},N.prototype.deleteKeysFromBackup=function(e,t,n){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const i=this._makeKeyBackupPath(e,t,n);return this._http.authedRequest(void 0,"DELETE",i.path,i.queryData,void 0,{prefix:_.PREFIX_UNSTABLE})},N.prototype.sendSharedHistoryKeys=function(){var e=r((function*(e,t){if(null===this._crypto)throw new Error("End-to-end encryption disabled");const n=this._roomList.getRoomEncryption(e);if(!n)return void w.logger.error("Unknown room.  Not sharing decryption keys");const i=yield this._crypto.downloadKeys(t),r={};for(const[s,a]of Object.entries(i))r[s]=Object.values(a);const o=this._crypto._getRoomDecryptor(e,n.algorithm);o.sendSharedHistoryInboundSessions?yield o.sendSharedHistoryInboundSessions(r):w.logger.warning("Algorithm does not support sharing previous keys",n.algorithm)}));return function(t,n){return e.apply(this,arguments)}}(),N.prototype.getGroup=function(e){return this.store.getGroup(e)},N.prototype.getGroups=function(){return this.store.getGroups()},N.prototype.getMediaConfig=function(e){return this._http.authedRequest(e,"GET","/config",void 0,void 0,{prefix:_.PREFIX_MEDIA_R0})},N.prototype.getRoom=function(e){return this.store.getRoom(e)},N.prototype.getRooms=function(){return this.store.getRooms()},N.prototype.getVisibleRooms=function(){const e=this.store.getRooms(),t=new Set;for(const n of e){const e=n.currentState.getStateEvents("m.room.create","");if(e){const n=e.getContent()["predecessor"];n&&n["room_id"]&&t.add(n["room_id"])}}return e.filter(e=>{const n=e.currentState.getStateEvents("m.room.tombstone","");return!n||!t.has(e.roomId)})},N.prototype.getUser=function(e){return this.store.getUser(e)},N.prototype.getUsers=function(){return this.store.getUsers()},N.prototype.setAccountData=function(e,t,n){const i=y.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e}),r=(0,_.retryNetworkOperation)(5,()=>this._http.authedRequest(void 0,"PUT",i,void 0,t));return n&&r.then(e=>n(null,e),n),r},N.prototype.getAccountData=function(e){return this.store.getAccountData(e)},N.prototype.getAccountDataFromServer=function(){var t=r((function*(t){if(this.isInitialSyncComplete()){const e=this.store.getAccountData(t);return e?e.getContent():null}const n=y.encodeUri("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:t});try{const e=yield this._http.authedRequest(void 0,"GET",n,void 0);return e}catch(e){if(e.data&&"M_NOT_FOUND"===e.data.errcode)return null;throw e}}));return function(e){return t.apply(this,arguments)}}(),N.prototype.getIgnoredUsers=function(){const e=this.getAccountData("m.ignored_user_list");return e&&e.getContent()&&e.getContent()["ignored_users"]?Object.keys(e.getContent()["ignored_users"]):[]},N.prototype.setIgnoredUsers=function(e,t){const n={ignored_users:{}};return e.map(e=>n.ignored_users[e]={}),this.setAccountData("m.ignored_user_list",n,t)},N.prototype.isUserIgnored=function(e){return-1!==this.getIgnoredUsers().indexOf(e)},N.prototype.joinRoom=function(e,t,n){if(y.isFunction(t))throw new Error("Expected 'opts' object, got function.");t=t||{},void 0===t.syncRoom&&(t.syncRoom=!0);const i=this.getRoom(e);if(i&&i.hasMembershipState(this.credentials.userId,"join"))return Promise.resolve(i);let r=Promise.resolve();t.inviteSignUrl&&(r=this._http.requestOtherUrl(void 0,"POST",t.inviteSignUrl,{mxid:this.credentials.userId}));const o={};t.viaServers&&(o["server_name"]=t.viaServers);const s={qsStringifyOptions:{arrayFormat:"repeat"}},a=this,c=new Promise((i,c)=>{r.then((function(t){const n={};t&&(n.third_party_signed=t);const i=y.encodeUri("/join/$roomid",{$roomid:e});return a._http.authedRequest(void 0,"POST",i,o,n,s)})).then((function(e){const n=e.room_id,i=new d.SyncApi(a,a._clientOpts),r=i.createRoom(n);return t.syncRoom,Promise.resolve(r)})).then((function(e){V(n,i,e)}),(function(e){z(n,c,e)}))});return c},N.prototype.resendEvent=function(e,t){return F(t,e,h.EventStatus.SENDING),L(this,t,e)},N.prototype.cancelPendingEvent=function(e){if([h.EventStatus.QUEUED,h.EventStatus.NOT_SENT].indexOf(e.status)<0)throw new Error("cannot cancel an event with status "+e.status);this.scheduler&&this.scheduler.removeEventFromQueue(e);const t=this.getRoom(e.getRoomId());F(t,e,h.EventStatus.CANCELLED)},N.prototype.setRoomName=function(e,t,n){return this.sendStateEvent(e,"m.room.name",{name:t},void 0,n)},N.prototype.setRoomAvatarUrl=function(e,t,n){return this.sendStateEvent(e,"m.room.avatar",{avatarUrl:t},void 0,n)},N.prototype.setRoomTopic=function(e,t,n){return this.sendStateEvent(e,"m.room.topic",{topic:t},void 0,n)},N.prototype.getRoomTags=function(e,t){const n=y.encodeUri("/user/$userId/rooms/$roomId/tags/",{$userId:this.credentials.userId,$roomId:e});return this._http.authedRequest(t,"GET",n,void 0)},N.prototype.setRoomTag=function(e,t,n,i){const r=y.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this._http.authedRequest(i,"PUT",r,void 0,n)},N.prototype.deleteRoomTag=function(e,t,n){const i=y.encodeUri("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:t});return this._http.authedRequest(n,"DELETE",i,void 0,void 0)},N.prototype.setRoomAccountData=function(e,t,n,i){const r=y.encodeUri("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:t});return this._http.authedRequest(i,"PUT",r,void 0,n)},N.prototype.setPowerLevel=function(e,t,n,i,r){let o={users:{}};i&&"m.room.power_levels"===i.getType()&&(o=y.deepCopy(i.getContent())),o.users[t]=n;const s=y.encodeUri("/rooms/$roomId/state/m.room.power_levels",{$roomId:e});return this._http.authedRequest(r,"PUT",s,void 0,o)},N.prototype.sendEvent=function(e,t,n,i,r){return this._sendCompleteEvent(e,{type:t,content:n},i,r)},N.prototype._sendCompleteEvent=function(e,t,n,i){y.isFunction(n)&&(i=n,n=void 0),n||(n=this.makeTxnId());const r=new h.MatrixEvent(Object.assign(t,{event_id:"~"+e+":"+n,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:e,origin_server_ts:(new Date).getTime()})),o=this.getRoom(e),s=r.getAssociatedId();if(s&&s.startsWith("~")){const e=o.getPendingEvents().find(e=>e.getId()===s);e.once("Event.localEventIdReplaced",()=>{r.updateAssociatedId(e.getId())})}const a=r.getType();return w.logger.log(`sendEvent of type ${a} in ${e} with txnId ${n}`),r.setTxnId(n),r.setStatus(h.EventStatus.SENDING),o&&o.addPendingEvent(r,n),r.status===h.EventStatus.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):L(this,o,r,i)},N.prototype.redactEvent=function(e,t,n,i){const r="object"===typeof i?i:{},o=r.reason,s="function"===typeof i?i:void 0;return this._sendCompleteEvent(e,{type:"m.room.redaction",content:{reason:o},redacts:t},n,s)},N.prototype.sendMessage=function(e,t,n,i){return y.isFunction(n)&&(i=n,n=void 0),this.sendEvent(e,"m.room.message",t,n,i)},N.prototype.sendTextMessage=function(e,t,n,i){const r=E.makeTextMessage(t);return this.sendMessage(e,r,n,i)},N.prototype.sendNotice=function(e,t,n,i){const r=E.makeNotice(t);return this.sendMessage(e,r,n,i)},N.prototype.sendEmoteMessage=function(e,t,n,i){const r=E.makeEmoteMessage(t);return this.sendMessage(e,r,n,i)},N.prototype.sendImageMessage=function(e,t,n,i,r,o){y.isFunction(i)&&(r=i,i=void 0),i||(i="Image");const s={msgtype:"m.image",url:t,info:n,body:i,"m.relates_to":n["m.relates_to"]};return this.sendMessage(e,s,r)},N.prototype.sendAudioMessage=function(e,t,n,i,r){y.isFunction(i)&&(r=i,i=void 0),i||(i="Audio");const o={msgtype:"m.audio",url:t,info:n,body:i,"m.relates_to":n["m.relates_to"]};return this.sendMessage(e,o,r)},N.prototype.sendStickerMessage=function(e,t,n,i,r){y.isFunction(i)&&(r=i,i=void 0),i||(i="Sticker");const o={url:t,info:n,body:i};return this.sendEvent(e,"m.sticker",o,r,void 0)},N.prototype.sendHtmlMessage=function(e,t,n,i){const r=E.makeHtmlMessage(t,n);return this.sendMessage(e,r,i)},N.prototype.sendHtmlNotice=function(e,t,n,i){const r=E.makeHtmlNotice(t,n);return this.sendMessage(e,r,i)},N.prototype.sendHtmlEmote=function(e,t,n,i){const r=E.makeHtmlEmote(t,n);return this.sendMessage(e,r,i)},N.prototype.sendReceipt=function(e,t,n,i){if("function"===typeof n&&(i=n,n={}),this.isGuest())return Promise.resolve({});const r=y.encodeUri("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:t,$eventId:e.getId()}),o=this._http.authedRequest(i,"POST",r,void 0,n||{}),s=this.getRoom(e.getRoomId());return s&&s._addLocalEchoReceipt(this.credentials.userId,e,t),o},N.prototype.sendReadReceipt=function(){var e=r((function*(e,t,n){"function"===typeof t&&(n=t,t={}),t||(t={});const i=e.getId(),r=this.getRoom(e.getRoomId());if(r&&r.hasPendingEvent(i))throw new Error(`Cannot set read receipt to a pending event (${i})`);const o={"m.hidden":Boolean(t.hidden)};return this.sendReceipt(e,"m.read",o,n)}));return function(t,n,i){return e.apply(this,arguments)}}(),N.prototype.setRoomReadMarkers=function(){var e=r((function*(e,t,n,i){const r=this.getRoom(e);if(r&&r.hasPendingEvent(t))throw new Error(`Cannot set read marker to a pending event (${t})`);let o;if(n){if(o=n.getId(),r&&r.hasPendingEvent(o))throw new Error(`Cannot set read receipt to a pending event (${o})`);r&&r._addLocalEchoReceipt(this.credentials.userId,n,"m.read")}return this.setRoomReadMarkersHttpRequest(e,t,o,i)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),N.prototype.getUrlPreview=function(e,t,n){t=6e4*Math.floor(t/6e4);const i=t+"_"+e,r=this.urlPreviewCache[i];if(r)return n&&r.then(n).catch(n),r;const o=this._http.authedRequest(n,"GET","/preview_url",{url:e,ts:t},void 0,{prefix:_.PREFIX_MEDIA_R0});return this.urlPreviewCache[i]=o,o},N.prototype.sendTyping=function(e,t,n,i){if(this.isGuest())return Promise.resolve({});const r=y.encodeUri("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.credentials.userId}),o={typing:t};return t&&(o.timeout=n||2e4),this._http.authedRequest(i,"PUT",r,void 0,o)},N.prototype.getRoomUpgradeHistory=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.getRoom(e);if(!n)return[];const i=[n];let r=n.currentState.getStateEvents("m.room.create","");while(r){w.logger.log("Looking at "+r.getId());const e=r.getContent()["predecessor"];if(!e||!e["room_id"])break;{w.logger.log("Looking at predecessor "+e["room_id"]);const n=this.getRoom(e["room_id"]);if(!n)break;if(t){const e=n.currentState.getStateEvents("m.room.tombstone","");if(!e||e.getContent()["replacement_room"]!==n.roomId)break}i.splice(0,0,n),r=n.currentState.getStateEvents("m.room.create","")}}let o=n.currentState.getStateEvents("m.room.tombstone","");while(o){const e=this.getRoom(o.getContent()["replacement_room"]);if(!e)break;if(e.roomId===n.roomId)break;if(t){if(r=e.currentState.getStateEvents("m.room.create",""),!r||!r.getContent()["predecessor"])break;const t=r.getContent()["predecessor"];if(t["room_id"]!==n.roomId)break}i.push(e);const s=new Set(i.map(e=>e.roomId));if(s.size<i.length)return i.slice(0,i.length-1);n=e,o=n.currentState.getStateEvents("m.room.tombstone","")}return i},N.prototype.invite=function(e,t,n,i){return G(this,e,t,"invite",i,n)},N.prototype.inviteByEmail=function(e,t,n){return this.inviteByThreePid(e,"email",t,n)},N.prototype.inviteByThreePid=function(){var e=r((function*(e,t,n,i){const r=y.encodeUri("/rooms/$roomId/invite",{$roomId:e}),o=this.getIdentityServerUrl(!0);if(!o)return Promise.reject(new _.MatrixError({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));const s={id_server:o,medium:t,address:n};if(this.identityServer&&this.identityServer.getAccessToken&&(yield this.doesServerAcceptIdentityAccessToken())){const e=yield this.identityServer.getAccessToken();e&&(s.id_access_token=e)}return this._http.authedRequest(i,"POST",r,void 0,s)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),N.prototype.leave=function(e,t){return G(this,e,void 0,"leave",void 0,t)},N.prototype.leaveRoomChain=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.getRoomUpgradeHistory(e);let i=n;if(!t){i=[];for(const t of n)if(i.push(t),t.roomId===e)break}const r={},o=[],s=e=>this.leave(e).then(()=>{r[e]=null}).catch(t=>(r[e]=t,null));for(const a of i)o.push(s(a.roomId));return Promise.all(o).then(()=>r)},N.prototype.ban=function(e,t,n,i){return G(this,e,t,"ban",n,i)},N.prototype.forget=function(e,t,n){void 0===t&&(t=!0);const i=G(this,e,void 0,"forget",void 0,n);if(!t)return i;const r=this;return i.then((function(t){return r.store.removeRoom(e),r.emit("deleteRoom",e),t}))},N.prototype.unban=function(e,t,n){const i=y.encodeUri("/rooms/$roomId/unban",{$roomId:e}),r={user_id:t};return this._http.authedRequest(n,"POST",i,void 0,r)},N.prototype.kick=function(e,t,n,i){return q(this,e,t,"leave",n,i)},N.prototype.getPushActionsForEvent=function(e){return e.getPushActions()||e.setPushActions(this._pushProcessor.actionsForEvent(e)),e.getPushActions()},N.prototype.setProfileInfo=function(e,t,n){const i=y.encodeUri("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this._http.authedRequest(n,"PUT",i,void 0,t)},N.prototype.setDisplayName=function(){var e=r((function*(e,t){const n=yield this.setProfileInfo("displayname",{displayname:e},t),i=this.getUser(this.getUserId());return i&&(i.displayName=e,i.emit("User.displayName",i.events.presence,i)),n}));return function(t,n){return e.apply(this,arguments)}}(),N.prototype.setAvatarUrl=function(){var e=r((function*(e,t){const n=yield this.setProfileInfo("avatar_url",{avatar_url:e},t),i=this.getUser(this.getUserId());return i&&(i.avatarUrl=e,i.emit("User.avatarUrl",i.events.presence,i)),n}));return function(t,n){return e.apply(this,arguments)}}(),N.prototype.mxcUrlToHttp=function(e,t,n,i,r){return(0,b.getHttpUriForMxc)(this.baseUrl,e,t,n,i,r)},N.prototype._unstable_setStatusMessage=function(e){const t="im.vector.user_status";return Promise.all(this.getRooms().map(n=>{const i="join"===n.getMyMembership(),r=2===n.getInvitedAndJoinedMemberCount();if(!i||!r)return Promise.resolve();const o=n.currentState.mayClientSendStateEvent(t,this);return o?this.sendStateEvent(n.roomId,t,{status:e},this.getUserId()):Promise.resolve()}))},N.prototype.setPresence=function(e,t){const n=y.encodeUri("/presence/$userId/status",{$userId:this.credentials.userId});"string"===typeof e&&(e={presence:e});const i=["offline","online","unavailable"];if(-1==i.indexOf(e.presence))throw new Error("Bad presence value: "+e.presence);return this._http.authedRequest(t,"PUT",n,void 0,e)},N.prototype.getPresence=function(e,t){const n=y.encodeUri("/presence/$userId/status",{$userId:e});return this._http.authedRequest(t,"GET",n,void 0,void 0)},N.prototype.scrollback=function(e,t,n){y.isFunction(t)&&(n=t,t=void 0),t=t||30;let i=0,r=this._ongoingScrollbacks[e.roomId]||{};if(r.promise)return r.promise;if(r.errorTs){const e=Date.now()-r.errorTs;i=Math.max(R-e,0)}if(null===e.oldState.paginationToken)return Promise.resolve(e);const o=this.store.scrollback(e,t).length;if(o===t)return Promise.resolve(e);t-=o;const s=this,a=new Promise((r,o)=>{(0,y.sleep)(i).then((function(){return s._createMessagesRequest(e.roomId,e.oldState.paginationToken,t,"b")})).then((function(t){const i=y.map(t.chunk,H(s));if(t.state){const n=y.map(t.state,H(s));e.currentState.setUnknownStateEvents(n)}e.addEventsToTimeline(i,!0,e.getLiveTimeline()),e.oldState.paginationToken=t.end,0===t.chunk.length&&(e.oldState.paginationToken=null),s.store.storeEvents(e,i,t.end,!0),s._ongoingScrollbacks[e.roomId]=null,V(n,r,e)}),(function(t){s._ongoingScrollbacks[e.roomId]={errorTs:Date.now()},z(n,o,t)}))});return r={promise:a,errorTs:null},this._ongoingScrollbacks[e.roomId]=r,a},N.prototype.getEventTimeline=function(e,t){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(e.getTimelineForEvent(t))return Promise.resolve(e.getTimelineForEvent(t));const n=y.encodeUri("/rooms/$roomId/context/$eventId",{$roomId:e.room.roomId,$eventId:t});let i=void 0;this._clientOpts.lazyLoadMembers&&(i={filter:JSON.stringify(u.Filter.LAZY_LOADING_MESSAGES_FILTER)});const r=this,o=r._http.authedRequest(void 0,"GET",n,i).then((function(n){if(!n.event)throw new Error("'event' not in '/context' result - homeserver too old?");if(e.getTimelineForEvent(t))return e.getTimelineForEvent(t);n.events_after.reverse();const i=n.events_after.concat([n.event]).concat(n.events_before),o=y.map(i,r.getEventMapper());let s=e.getTimelineForEvent(o[0].getId());if(s){const e=y.map(n.state,r.getEventMapper());s.getState(m.EventTimeline.BACKWARDS).setUnknownStateEvents(e)}else s=e.addTimeline(),s.initialiseState(y.map(n.state,r.getEventMapper())),s.getState(m.EventTimeline.FORWARDS).paginationToken=n.end;e.addEventsToTimeline(o,!0,s,n.start);const a=e.getTimelineForEvent(t)||s;return a}));return o},N.prototype._createMessagesRequest=function(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const o=y.encodeUri("/rooms/$roomId/messages",{$roomId:e});void 0===n&&(n=30);const s={from:t,limit:n,dir:i};let a=null;return this._clientOpts.lazyLoadMembers&&(a=Object.assign({},u.Filter.LAZY_LOADING_MESSAGES_FILTER)),r&&(a=a||{},Object.assign(a,r.getRoomTimelineFilterComponent())),a&&(s.filter=JSON.stringify(a)),this._http.authedRequest(void 0,"GET",o,s)},N.prototype.paginateEventTimeline=function(e,t){const n=e.getTimelineSet()===this._notifTimelineSet;t=t||{};const i=t.backwards||!1;if(n&&!i)throw new Error("paginateNotifTimeline can only paginate backwards");const r=i?m.EventTimeline.BACKWARDS:m.EventTimeline.FORWARDS,o=e.getPaginationToken(r);if(!o)return Promise.resolve(!1);const s=e._paginationRequests[r];if(s)return s;let a,c,l;const u=this;if(n)a="/notifications",c={limit:"limit"in t?t.limit:30,only:"highlight"},o&&"end"!==o&&(c.from=o),l=this._http.authedRequest(void 0,"GET",a,c,void 0).then((function(t){const n=t.next_token,o=[];for(let e=0;e<t.notifications.length;e++){const n=t.notifications[e],i=u.getEventMapper()(n.event);i.setPushActions(k.PushProcessor.actionListToActionsObject(n.actions)),i.event.room_id=n.room_id,o[e]=i}return e.getTimelineSet().addEventsToTimeline(o,i,e,n),i&&!t.next_token&&e.setPaginationToken(null,r),!!t.next_token})).finally((function(){e._paginationRequests[r]=null})),e._paginationRequests[r]=l;else{const n=this.getRoom(e.getRoomId());if(!n)throw new Error("Unknown room "+e.getRoomId());l=this._createMessagesRequest(e.getRoomId(),o,t.limit,r,e.getFilter()),l.then((function(t){if(t.state){const n=e.getState(r),i=y.map(t.state,u.getEventMapper());n.setUnknownStateEvents(i)}const n=t.end,o=y.map(t.chunk,u.getEventMapper());return e.getTimelineSet().addEventsToTimeline(o,i,e,n),i&&t.end==t.start&&e.setPaginationToken(null,r),t.end!=t.start})).finally((function(){e._paginationRequests[r]=null})),e._paginationRequests[r]=l}return l},N.prototype.resetNotifTimelineSet=function(){this._notifTimelineSet&&this._notifTimelineSet.resetLiveTimeline("end",null)},N.prototype.peekInRoom=function(e){return this._peekSync&&this._peekSync.stopPeeking(),this._peekSync=new d.SyncApi(this,this._clientOpts),this._peekSync.peek(e)},N.prototype.stopPeeking=function(){this._peekSync&&(this._peekSync.stopPeeking(),this._peekSync=null)},N.prototype.setGuestAccess=function(e,t){const n=this.sendStateEvent(e,"m.room.guest_access",{guest_access:t.allowJoin?"can_join":"forbidden"});let i=Promise.resolve();return t.allowRead&&(i=this.sendStateEvent(e,"m.room.history_visibility",{history_visibility:"world_readable"})),Promise.all([i,n])},N.prototype.requestRegisterEmailToken=function(e,t,n,i){return this._requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:i})},N.prototype.requestRegisterMsisdnToken=function(e,t,n,i,r){return this._requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:i,next_link:r})},N.prototype.requestAdd3pidEmailToken=function(e,t,n,i){return this._requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:i})},N.prototype.requestAdd3pidMsisdnToken=function(e,t,n,i,r){return this._requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:i,next_link:r})},N.prototype.requestPasswordEmailToken=function(e,t,n,i){return this._requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:t,send_attempt:n,next_link:i})},N.prototype.requestPasswordMsisdnToken=function(e,t,n,i,r){return this._requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:t,client_secret:n,send_attempt:i,next_link:r})},N.prototype._requestTokenFromEndpoint=function(){var e=r((function*(e,t){const n=Object.assign({},t);if(!(yield this.doesServerSupportSeparateAddAndBind())&&this.idBaseUrl){const e=a.default.parse(this.idBaseUrl);if(!e.host)throw new Error("Invalid ID server URL: "+this.idBaseUrl);if(n.id_server=e.host,this.identityServer&&this.identityServer.getAccessToken&&(yield this.doesServerAcceptIdentityAccessToken())){const e=yield this.identityServer.getAccessToken();e&&(n.id_access_token=e)}}return this._http.request(void 0,"POST",e,void 0,n)}));return function(t,n){return e.apply(this,arguments)}}(),N.prototype.getRoomPushRule=function(e,t){if(!this.pushRules)throw new Error("SyncApi.sync() must be done before accessing to push rules.");for(let n=0;n<this.pushRules[e].room.length;n++){const i=this.pushRules[e].room[n];if(i.rule_id===t)return i}},N.prototype.setRoomMutePushRule=function(e,t,n){const i=this;let r,o;const s=this.getRoomPushRule(e,t);if(s&&0<=s.actions.indexOf("dont_notify")&&(o=!0),n?s?o||(r=y.defer(),this.deletePushRule(e,"room",s.rule_id).then((function(){i.addPushRule(e,"room",t,{actions:["dont_notify"]}).then((function(){r.resolve()}),(function(e){r.reject(e)}))}),(function(e){r.reject(e)})),r=r.promise):r=this.addPushRule(e,"room",t,{actions:["dont_notify"]}):o&&(r=this.deletePushRule(e,"room",s.rule_id)),r)return new Promise((e,t)=>{r.then((function(){i.getPushRules().then((function(t){i.pushRules=t,e()}),(function(e){t(e)}))}),(function(e){i.getPushRules().then((function(n){i.pushRules=n,t(e)}),(function(n){t(e)}))}))})},N.prototype.searchMessageText=function(e,t){const n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}},t)},N.prototype.searchRoomEvents=function(e){const t={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:"recent",event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},n={_query:t,results:[],highlights:[]};return this.search({body:t}).then(this._processRoomEventsSearch.bind(this,n))},N.prototype.backPaginateRoomEventsSearch=function(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;const t={body:e._query,next_batch:e.next_batch},n=this.search(t).then(this._processRoomEventsSearch.bind(this,e)).finally((function(){e.pendingRequest=null}));return e.pendingRequest=n,n},N.prototype._processRoomEventsSearch=function(e,t){const n=t.search_categories.room_events;e.count=n.count,e.next_batch=n.next_batch;const i={};n.highlights.forEach((function(e){i[e]=1})),e.highlights.forEach((function(e){i[e]=1})),e.highlights=Object.keys(i);for(let r=0;r<n.results.length;r++){const t=p.SearchResult.fromJson(n.results[r],this.getEventMapper());e.results.push(t)}return e},N.prototype.syncLeftRooms=function(){if(this._syncedLeftRooms)return Promise.resolve([]);if(this._syncLeftRoomsPromise)return this._syncLeftRoomsPromise;const e=this,t=new d.SyncApi(this,this._clientOpts);return this._syncLeftRoomsPromise=t.syncLeftRooms(),this._syncLeftRoomsPromise.then((function(t){w.logger.log("Marking success of sync left room request"),e._syncedLeftRooms=!0})).finally((function(){e._syncLeftRoomsPromise=null})),this._syncLeftRoomsPromise},N.prototype.createFilter=function(e){const t=this,n=y.encodeUri("/user/$userId/filter",{$userId:this.credentials.userId});return this._http.authedRequest(void 0,"POST",n,void 0,e).then((function(n){const i=u.Filter.fromJson(t.credentials.userId,n.filter_id,e);return t.store.storeFilter(i),i}))},N.prototype.getFilter=function(e,t,n){if(n){const n=this.store.getFilter(e,t);if(n)return Promise.resolve(n)}const i=this,r=y.encodeUri("/user/$userId/filter/$filterId",{$userId:e,$filterId:t});return this._http.authedRequest(void 0,"GET",r,void 0,void 0).then((function(n){const r=u.Filter.fromJson(e,t,n);return i.store.storeFilter(r),r}))},N.prototype.getOrCreateFilter=function(){var e=r((function*(e,t){const n=this.store.getFilterIdByName(e);let i=void 0;if(n){try{const e=yield this.getFilter(this.credentials.userId,n,!0);if(e){const r=e.getDefinition(),o=t.getDefinition();y.deepCompare(r,o)&&(i=n)}}catch(o){if("M_UNKNOWN"!==o.errcode&&"M_NOT_FOUND"!==o.errcode)throw o}i||this.store.setFilterIdByName(e,void 0)}if(i)return i;const r=yield this.createFilter(t.getDefinition());return this.store.setFilterIdByName(e,r.filterId),r.filterId}));return function(t,n){return e.apply(this,arguments)}}(),N.prototype.getOpenIdToken=function(){const e=y.encodeUri("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this._http.authedRequest(void 0,"POST",e,void 0,{})},N.prototype.turnServer=function(e){return this._http.authedRequest(e,"GET","/voip/turnServer")},N.prototype.getTurnServers=function(){return this._turnServers||[]},N.prototype.getTurnServersExpiry=function(){return this._turnServersExpiry},N.prototype._checkTurnServers=r((function*(){if(!this._supportsVoip)return;let e=!1;const n=this._turnServersExpiry-Date.now();if(n>x)w.logger.debug("TURN creds are valid for another "+n+" ms: not fetching new ones."),e=!0;else{w.logger.debug("Fetching new TURN credentials");try{const t=yield this.turnServer();if(t.uris){w.logger.log("Got TURN URIs: "+t.uris+" refresh in "+t.ttl+" secs");const n={urls:t.uris,username:t.username,credential:t.password};this._turnServers=[n],this._turnServersExpiry=Date.now()+1e3*t.ttl,e=!0}}catch(i){w.logger.error("Failed to get TURN URIs",i),403===i.httpStatus&&(w.logger.info("TURN access unavailable for this account: stopping credentials checks"),null!==this._checkTurnServersIntervalID&&t.clearInterval(this._checkTurnServersIntervalID),this._checkTurnServersIntervalID=null)}}return e})),N.prototype.setFallbackICEServerAllowed=function(e){this._fallbackICEServerAllowed=e},N.prototype.isFallbackICEServerAllowed=function(){return this._fallbackICEServerAllowed},N.prototype.isSynapseAdministrator=function(){const e=y.encodeUri("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this._http.authedRequest(void 0,"GET",e,void 0,void 0,{prefix:""}).then(e=>e["admin"])},N.prototype.whoisSynapseUser=function(e){const t=y.encodeUri("/_synapse/admin/v1/whois/$userId",{$userId:e});return this._http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:""})},N.prototype.deactivateSynapseUser=function(e){const t=y.encodeUri("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this._http.authedRequest(void 0,"POST",t,void 0,void 0,{prefix:""})},N.prototype.startClient=function(){var e=r((function*(e){if(this.clientRunning)return;this.clientRunning=!0,"number"===typeof e&&(e={initialSyncLimit:e});const t=this.getUserId();t&&this.store.storeUser(new T.User(t)),this._crypto&&(this._crypto.uploadDeviceKeys(),this._crypto.start()),this._supportsVoip&&(this._checkTurnServersIntervalID=setInterval(()=>{this._checkTurnServers()},x),this._checkTurnServers()),this._syncApi&&(w.logger.error("Still have sync object whilst not running: stopping old one"),this._syncApi.stop()),e=Object.assign({},e),e.crypto=this._crypto,e.canResetEntireTimeline=e=>!!this._canResetTimelineCallback&&this._canResetTimelineCallback(e),this._clientOpts=e,this._syncApi=new d.SyncApi(this,e),this._syncApi.sync(),void 0!==e.clientWellKnownPollPeriod&&(this._clientWellKnownIntervalID=setInterval(()=>{this._fetchClientWellKnown()},1e3*e.clientWellKnownPollPeriod),this._fetchClientWellKnown())}));return function(t){return e.apply(this,arguments)}}(),N.prototype._fetchClientWellKnown=r((function*(){this._clientWellKnownPromise=I.AutoDiscovery.getRawClientConfig(this.getDomain()),this._clientWellKnown=yield this._clientWellKnownPromise,this.emit("WellKnown.client",this._clientWellKnown)})),N.prototype.getClientWellKnown=function(){return this._clientWellKnown},N.prototype.waitForClientWellKnown=function(){return this._clientWellKnownPromise},N.prototype._storeClientOptions=function(){const e=["boolean","string","number"],t=Object.entries(this._clientOpts).filter(t=>{let[n,i]=t;return e.includes(typeof i)}).reduce((e,t)=>{let[n,i]=t;return e[n]=i,e},{});return this.store.storeClientOptions(t)},N.prototype._unstable_getSharedRooms=function(){var e=r((function*(e){if(!(yield this.doesServerSupportUnstableFeature("uk.half-shot.msc2666")))throw Error("Server does not support shared_rooms API");const t=y.encodeUri("/uk.half-shot.msc2666/user/shared_rooms/$userId",{$userId:e}),n=yield this._http.authedRequest(void 0,"GET",t,void 0,void 0,{prefix:_.PREFIX_UNSTABLE});return n.joined}));return function(t){return e.apply(this,arguments)}}(),N.prototype.stopClient=function(){w.logger.log("stopping MatrixClient"),this.clientRunning=!1,this._syncApi&&(this._syncApi.stop(),this._syncApi=null),this._crypto&&this._crypto.stop(),this._peekSync&&this._peekSync.stopPeeking(),this._callEventHandler&&(this._callEventHandler.stop(),this._callEventHandler=null),t.clearInterval(this._checkTurnServersIntervalID),void 0!==this._clientWellKnownIntervalID&&t.clearInterval(this._clientWellKnownIntervalID)},N.prototype.getVersions=function(){return this._serverVersionsPromise||(this._serverVersionsPromise=this._http.request(void 0,"GET","/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(e=>{throw this._serverVersionsPromise=null,e})),this._serverVersionsPromise},N.prototype.isVersionSupported=function(){var e=r((function*(e){const{versions:t}=yield this.getVersions();return t&&t.includes(e)}));return function(t){return e.apply(this,arguments)}}(),N.prototype.doesServerSupportLazyLoading=r((function*(){const e=yield this.getVersions();if(!e)return!1;const t=e["versions"],n=e["unstable_features"];return t&&t.includes("r0.5.0")||n&&n["m.lazy_load_members"]})),N.prototype.doesServerRequireIdServerParam=r((function*(){const e=yield this.getVersions();if(!e)return!0;const t=e["versions"];if(t&&t.includes("r0.6.0"))return!1;const n=e["unstable_features"];return!n||(void 0===n["m.require_identity_server"]||n["m.require_identity_server"])})),N.prototype.doesServerAcceptIdentityAccessToken=r((function*(){const e=yield this.getVersions();if(!e)return!1;const t=e["versions"],n=e["unstable_features"];return t&&t.includes("r0.6.0")||n&&n["m.id_access_token"]})),N.prototype.doesServerSupportSeparateAddAndBind=r((function*(){const e=yield this.getVersions();if(!e)return!1;const t=e["versions"],n=e["unstable_features"];return t&&t.includes("r0.6.0")||n&&n["m.separate_add_and_bind"]})),N.prototype.doesServerSupportUnstableFeature=function(){var e=r((function*(e){const t=yield this.getVersions();if(!t)return!1;const n=t["unstable_features"];return n&&!!n[e]}));return function(t){return e.apply(this,arguments)}}(),N.prototype.doesServerForceEncryptionForPreset=function(){var e=r((function*(e){const t=yield this.getVersions();if(!t)return!1;const n=t["unstable_features"];return n&&!!n["io.element.e2ee_forced."+e]}));return function(t){return e.apply(this,arguments)}}(),N.prototype.hasLazyLoadMembersEnabled=function(){return!!this._clientOpts.lazyLoadMembers},N.prototype.setCanResetTimelineCallback=function(e){this._canResetTimelineCallback=e},N.prototype.getCanResetTimelineCallback=function(){return this._canResetTimelineCallback},N.prototype.relations=function(){var e=r((function*(e,t,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const o=B(this,e,i),s=yield this.fetchRelations(e,t,n,o,r),a=this.getEventMapper();let c;s.original_event&&(c=a(s.original_event));let l=s.chunk.map(a);if("m.room.encrypted"===o){const e=c?l.concat(c):l;yield Promise.all(e.map(e=>new Promise(t=>e.once("Event.decrypted",t)))),l=l.filter(e=>e.getType()===i)}return c&&"m.replace"===n&&(l=l.filter(e=>e.getSender()===c.getSender())),{originalEvent:c,events:l,nextBatch:s.next_batch}}));return function(t,n,i,r){return e.apply(this,arguments)}}(),N.prototype.getEventMapper=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return H(this,e)},N.prototype.getCrossSigningCacheCallbacks=function(){return this._crypto&&this._crypto._crossSigningInfo.getCacheCallbacks()},N.prototype.generateClientSecret=function(){return(0,C.randomString)(32)}}).call(this,i("c8ba"))},9916:function(e,t,n){},"994e":function(e,t,n){"use strict";n("e53f")},"9a41":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page chats",class:{pocketnet:e.pocketnet,mobile:e.mobile,minimized:e.minimized,active:e.active,newChat:e.newChat}},[n("topheader",{staticClass:"topheader",attrs:{share:e.share},on:{newchat:e.newchat,sendMassMessage:e.sendMassMessage}}),n("maincontent",{ref:"maincontent",attrs:{rbackexp:!0},scopedSlots:e._u([{key:"content",fn:function(){return[n("list",{attrs:{share:e.share},on:{scrolltop:e.scrolltop}}),e.newChat&&!e.hiddenInParent?n("modal",{on:{close:e.closeNewChat},scopedSlots:e._u([{key:"header",fn:function(){return[e._v(e._s(e.$t("caption.newChat")))]},proxy:!0},{key:"body",fn:function(){return[n("chatcreate",{on:{completed:e.chatcreated,sendMassMessage:e.sendMassMessage}})]},proxy:!0},{key:"footer",fn:function(){},proxy:!0}],null,!1,524910330)}):e._e()]},proxy:!0}])})],1)},r=[],o=n("1da1"),s=n("4fd2"),a=n("d136"),c=n("2f62"),l=n("71da"),u=n("78a2"),d={name:"pagechats",components:{list:s["a"],topheader:a["a"],contacts:l["a"],chatcreate:u["a"]},props:{share:Object},data:function(){return{newChat:!1}},computed:Object(c["c"])({pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active,mobile:e=>e.mobile,hiddenInParent:e=>e.hiddenInParent,joinroom:e=>e.joinroom}),methods:{sendMassMessage(e){var t=this;console.log("sendmassmessage!",e);const{message:n,recipients:i,total:r}=e;this.$store.commit("PROCESS_MASS_MAILING",!0),this.$store.commit("SET_RECIPIENTS_TOTAL",r),this.core.user.usersInfo(i,!0).then(function(){var r=Object(o["a"])((function*(r){const s=function(){var e=Object(o["a"])((function*(){return new Promise(e=>{setTimeout(()=>(e("slept"),!0),200)})}));return function(){return e.apply(this,arguments)}}(),a=()=>{i.shift(),t.$store.commit("SET_RECIPIENTS",i),localStorage.setItem("chat_mass_message",JSON.stringify(e))};for(const e of r){const i=t.core.mtrx.kit.tetatetid(e,t.core.user.userinfo),r=t.core.user.matrixId(e.id);var c=[{type:"m.set.encrypted",state_key:"",content:{encrypted:!0}}];const l=t.$store.state.chatsMap[i];if(l){console.log("room",l),yield s(),a();const e=yield t.core.mtrx.testmessage({room:l.roomId,message:n});console.log("result message",e)}else t.core.mtrx.client.createRoom({room_alias_name:i,visibility:"private",invite:[r],name:"#"+i,initial_state:c}).then(function(){var e=Object(o["a"])((function*(e){console.log("_chat",e),yield s(),a();const i=yield t.core.mtrx.testmessage({room:e.room_id,message:n});console.log("result message 2",i)}));return function(t){return e.apply(this,arguments)}}())}}));return function(e){return r.apply(this,arguments)}}()),this.closeNewChat()},newchat:function(){this.newChat=!0},closeNewChat:function(){this.newChat=!1},chatcreated:function(e){this.$router.push({path:"chat",query:{id:e.room_id}})},scrolltop:function(){this.$refs["maincontent"].scroll(0)}},mounted(){var e;this.newChat=Boolean(null===(e=this.$route.query)||void 0===e?void 0:e.type),this.joinroom&&(this.$router.push("/publicPreview?id="+this.joinroom),this.$store.commit("JOINROOM",null))}},h=d,m=(n("5e66"),n("2877")),p=Object(m["a"])(h,i,r,!1,null,"bae093a2",null);t["default"]=p.exports},"9c10":function(e,t,n){"use strict";n("590b")},"9c21":function(t,n,i){"use strict";(function(t){var r=i("1da1"),o=(i("907a"),i("3c5d"),i("d9e2"),i("3139")),s=i("6129"),a=i("3db6");const c=i("399f");var l=i("a099"),u="PR7srzZt4EfcNb3s27grgmiG8aB9vYNV82",d=null,h=function(){var n=Object(r["a"])((function*(n,i,s){let{ls:h,lse:p}=s;var f=this;this.configurable=!1;var g={},v=12,y={},b=new m;i.pcrypto=f,f.clear=function(){({}),y={},[],g={}};var E="pcrypto5_"+i.roomId+"_",S="e_pcrypto5_";f.preparedUsers=function(e){return _.filter(I(e),(function(e){return e.keys&&e.keys.length>=v}))},f.cantchat=function(){var e=f.preparedUsers();return!!(n.core.mtrx.kit.tetatetchat(i)&&e.length&&e.length<2)},f.canBeEncrypt=function(e){var t=_.toArray(y),r=n.core.mtrx.kit.chatIsPublic(i);return!!(!r&&n.user&&n.user.private&&12==n.user.private.length&&g[n.user.userinfo.id]&&t.length>1&&t.length<50&&f.preparedUsers(e).length/t.length>.6)},f.userschanded=function(){return f.cantchat()?(f.clear(),f.prepare()):Promise.resolve()};var w=function(){var e=_.map(g,(function(e){return e.id}));return n.core.user.usersInfo(e).then(e=>(y={},_.each(e,(function(e){y[e.id]=e})),Promise.resolve()))},C=function(){var e=n.core.mtrx.kit.tetatetchat(i),t=_.filter(_.map(i.currentState.getStateEvents("m.room.member"),(function(t){var n=t.event,i=n.content.membership;return"join"==i||"leave"==i&&!e||e&&"invite"==i?{time:n.origin_server_ts||1,membership:i,id:"invite"==i?o["a"].getmatrixid(n.state_key):o["a"].getmatrixid(n.sender)}:null})),(function(e){return e}));return t=_.sortBy(t,(function(e){return e.time})),t},k=function(e){for(var t=0,n=C(),i=n.length-1;i>=0;i--)n[i].time<e&&!t&&(t=i);return t},T=function(){var e=C(),t=n.core.mtrx.kit.tetatetchat(i);_.each(e,(function(e){g[e.id]||(g[e.id]={id:e.id,life:[]});var n=g[e.id].life;if(e.membership&&("join"==e.membership||"invite"==e.membership&&t))n.push({start:t?1:e.time});else if(n.length&&"leave"==e.membership&&!t){var i=n[n.length-1];i.end=e.time}}))},I=function(e){var t=R(e);return _.filter(_.map(t,(function(e){return y[e.id]})),(function(e){return e}))},R=function(e){return _.filter(g,(function(t){var n=_.find(t.life,(function(t){if(e){if(t.start<e&&(!t.end||t.end>e))return!0}else if(t.start&&!t.end)return!0}));if(n)return!0}))};f.getusersinfobytime=I,f.prepare=function(){return T(),w().then(e=>f)};var P={aeskeys:{inp:function(e){var t={};return _.each(e,(function(e,n){t[n]=o["a"]._arrayBufferToBase64(e)})),t},out:function(e){var t={};return _.each(e,(function(e,n){t[n]=new Uint8Array(o["a"]._base64ToArrayBuffer(e))})),t}}},O={aeskeysls:function(e,t){e||(e=0),t||(t=n.currentblock.height),n.core.mtrx.kit.tetatetchat(i)||(t=10);var o=k(e)+"-"+t;return h.get(`${E+n.user.userinfo.id}-${o}`).then(e=>{const t=P.aeskeys.out(e);return{keys:t,k:o}}).catch(function(){var i=Object(r["a"])((function*(i){const r=O.aeskeys(e,t);if(f.preparedUsers(e).length>1){const e=`${E+n.user.userinfo.id}-${o}`;yield h.set(e,P.aeskeys.inp(r)).catch(()=>{})}return{keys:r,k:o}}));return function(e){return i.apply(this,arguments)}}())},aeskeys:function(e,t){return e||(e=0),t||(t=n.currentblock.height),x.aeskeys(e,t)}},x={cuhash:function(e,t,i){return l.pbkdf2Sync(o["a"].sha224(_.map(e,(function(e){return e.keys[t]})).join("")+(i||n.currentblock.height)).toString("hex"),u,1,32,"sha256")},userspublics:function(e,i){var r=f.preparedUsers(e),o={};return _.each(r,(function(s){if(!(s.id==n.user.userinfo.id&&r.length>1)){var a=_.map(s.keys,(function(e){return t.from(e,"hex")}));o[s.id]=x.points(e,i,a)}})),o},current:function(e,i){var r=_.map(n.user.private,(function(e){return e.private})),o=t.allocUnsafe(32),s=x.scalars(e,i,r).toBuffer();return s.copy(o,32-s.length),o},scalars:function(e,t,n){for(var i=f.preparedUsers(e),r=null,o=0;o<v;o++){var s=new c(this.cuhash(i,o,t)),a=new c(n[o],16),l=a.mul(s).umod(d);r=o?r.add(l).umod(d):l}return r},points:function(e,t,n){for(var i=f.preparedUsers(e),r=null,o=0;o<v;o++){var s=this.cuhash(i,o,t),a=bitcoin.ecc.pointMultiply(n[o],s,void 0,!0);r=o?bitcoin.ecc.pointAdd(r,a,void 0,!0):a}return r},aeskeys:function(e,t){var i=x.userspublics(e,t),r=x.current(e,t),o={};return _.each(i,(function(e,t){t!=n.user.userinfo.id&&(o[t]=bitcoin.ecc.pointMultiply(e,r,void 0,!0),o[t]=l.pbkdf2Sync(o[t].toString("hex"),u,64,32,"sha512"))})),o}};f.decrypt=function(){var t=Object(r["a"])((function*(t,i,r,o){let{encrypted:s,nonce:a}=i,{keys:c,k:l}=yield O.aeskeysls(r,o);var u=null;if(c[t])try{return yield N(c[t],{encrypted:s,nonce:a})}catch(e){u=e}else u="emptykey";throw yield h.clear(`${E+n.user.userinfo.id}-${l}`).catch(e=>{console.error("Error clearing item on LS.CLEAR")}),new Error(u)}));return function(e,n,i,r){return t.apply(this,arguments)}}(),f.encrypt=function(){var e=Object(r["a"])((function*(e,t){let{keys:n}=yield O.aeskeysls();if(n[e])return yield D(t,n[e]);throw new Error("emptykey")}));return function(t,n){return e.apply(this,arguments)}}(),f.decryptEvent=function(){var t=Object(r["a"])((function*(t){if(t.content.hash)return f.decryptEventGroup(t);if(!n.user.userinfo)throw new Error("userinfo");if(t.decrypting)return t.decrypting;var i=`${S+n.user.userinfo.id}-${t.event_id}`,s=p.get(i).then(t=>{var n=null;try{n=JSON.parse(t)}catch(e){}return n?Promise.resolve(n):Promise.reject()}).catch(function(){var e=Object(r["a"])((function*(e){const r=o["a"].getmatrixid(t.sender),s=n.user.userinfo.id;let a,c;const l=JSON.parse(o["a"].Base64.decode(t.content.body)),u=t.origin_server_ts||1,d=t.content.block;if(r==s?_.find(l,(function(e,t){if(t!=s)return a=t,c=t,!0})):(c=s,a=r),!l[c])throw new Error("emptyforme");return f.decrypt(a,l[c],u,d).then(e=>{var t={body:e,msgtype:"m.text"};return p.set(i,JSON.stringify(t)),t})}));return function(t){return e.apply(this,arguments)}}()).finally(()=>{delete t.decrypting});return t.decrypting=s,s}));return function(e){return t.apply(this,arguments)}}(),f.encryptFile=function(){var e=Object(r["a"])((function*(e,t){var n=yield b.randomkey(),i=yield f.encryptKey(n),r={file:null,secrets:i};return b.encryptFile(e,n,t).then(e=>(r.file=e,Promise.resolve(r))).catch(e=>(console.error(e),Promise.reject(e)))}));return function(t,n){return e.apply(this,arguments)}}(),f.decryptFile=function(){var e=Object(r["a"])((function*(e,t,n){return b.decryptFile(e,t,n).then(e=>Promise.resolve(e))}));return function(t,n,i){return e.apply(this,arguments)}}(),f.encryptKey=function(){var e=Object(r["a"])((function*(e){var t=f.preparedUsers(),r=n.currentblock.height;n.core.mtrx.kit.tetatetchat(i)||(r=10);for(var s={block:r,keys:{}},a=0;a<t.length;a++){var c=t[a];(c.id!=n.user.userinfo.id||t.length<=1)&&(s.keys[c.id]=yield f.encrypt(c.id,e))}return s.keys=o["a"].Base64.encode(JSON.stringify(s.keys)),s}));return function(t){return e.apply(this,arguments)}}(),f.decryptKey=function(){var e=Object(r["a"])((function*(e){if(!n.user.userinfo)throw new Error("userinfo");var t="",i="";if("m.room.encryption"==e.type?(t=e.content.keys,i=e.content.block):(t=o["a"].deep(e,"content.info.secrets.keys")||o["a"].deep(e,"content.pbody.secrets.keys"),i=o["a"].deep(e,"content.info.secrets.block")||o["a"].deep(e,"content.pbody.secrets.block")),!t)throw new Error("secrets");if(!i)throw new Error("block");var r=o["a"].getmatrixid(e.sender),s=n.user.userinfo.id,a=null,c=null,l=JSON.parse(o["a"].Base64.decode(t)),u=e.origin_server_ts||1;if(r==s?_.find(l,(function(e,t){if(t!=s)return a=t,c=t,!0})):(c=s,a=r),!l[c])throw new Error("emptyforme");var d=yield f.decrypt(a,l[c],u,i);return d}));return function(t){return e.apply(this,arguments)}}(),f.encryptEvent=function(){var e=Object(r["a"])((function*(e){var t=f.preparedUsers();if(!n.core.mtrx.kit.tetatetchat(i))return f.encryptEventGroup(e);for(var r={block:n.currentblock.height,msgtype:"m.encrypted",body:{}},s=0;s<t.length;s++){var a=t[s];(a.id!=n.user.userinfo.id||t.length<=1)&&(r.body[a.id]=yield f.encrypt(a.id,e))}return r.body=o["a"].Base64.encode(JSON.stringify(r.body)),r}));return function(t){return e.apply(this,arguments)}}();var M=function(){var e=f.preparedUsers(),t=o["a"].md5(_.filter(_.map(e,e=>e.id),e=>e&&e!=n.user.userinfo.id).join("")+"_v4");return t};f.sendCommonKey=function(){return f.createMyCommonKey().then(e=>n.core.mtrx.client.sendStateEvent(i.roomId,"m.room.encryption",e.export,"pcrypto."+n.user.userinfo.id+"."+e.export.hash)).then(e=>f.getCommonKey()).catch(e=>(console.error(e),Promise.reject(e)))};var A=function(e,t){var r=t||M();e||(e=n.user.userinfo.id);var o="pcrypto."+e+"."+r,s=i.currentState.getStateEvents("m.room.encryption"),a=_.find(s,e=>e.event.state_key==o);if(a)return a};f.getCommonKey=function(e,t){return o["a"].pretry(()=>{var n=A(e,t);return n},50,5e3).then(()=>{var n=A(e,t);return n||Promise.reject("m.room.encryption event not found"),Promise.resolve(n.event)})},f.getOrCreateCommonKey=function(){var e=null,t=A(),n=null;return n=t?Promise.resolve(t.event):f.sendCommonKey(),n.then(t=>(e=t,f.decryptKey(t))).then(t=>({key:t,hash:e.content.hash,block:e.content.block}))},f.createMyCommonKey=function(){var e=M(),t={private:{},export:{}};return b.randomkey().then(e=>(t.private.secret=e,b.key(e))).then(n=>(t.private.key=n,t.private.hash=e,t.export.hash=e,f.encryptKey(t.private.secret))).then(e=>(t.export.keys=e.keys,t.export.block=e.block,t))},f.decryptEventGroup=function(e){if(!n.user.userinfo)throw new Error("userinfo");if(e.decrypting)return e.decrypting;var i=e.content.hash,r=o["a"].getmatrixid(e.sender),s=(e.content.block,f.getCommonKey(r,i).then(e=>f.decryptKey(e)).then(n=>b.decrypt(t.from(e.content.body,"hex"),n).then(e=>{var t=new TextDecoder,n={body:t.decode(new Uint8Array(e)),msgtype:"m.text"};return Promise.resolve(n)})).finally(()=>{delete e.decrypting}));return e.decrypting=s,s},f.encryptEventGroup=function(){var e=Object(r["a"])((function*(e){var n={msgtype:"m.encrypted",body:{}};return f.getOrCreateCommonKey().then(i=>{n.block=i.block,n.hash=i.hash;let r=new TextEncoder;return b.encrypt(r.encode(e),i.key).then(e=>(n.body=t.from(e).toString("hex"),Promise.resolve(n)))})}));return function(t){return e.apply(this,arguments)}}();var N=function(){var e=Object(r["a"])((function*(e,t){let{encrypted:n,nonce:i}=t;var r=yield a["SIV"].importKey(e,"AES-SIV"),s=new Uint8Array(o["a"]._base64ToArrayBuffer(n)),c=new Uint8Array(o["a"]._base64ToArrayBuffer(i)),l=yield r.open(s,c),u=yield(new TextDecoder).decode(l);return u}));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=Object(r["a"])((function*(e,t){let n=yield a["SIV"].importKey(t,"AES-SIV"),i=new Uint8Array((new TextEncoder).encode(e)),r=new Uint8Array(32);window.crypto.getRandomValues(r);let s=yield n.seal(i,r),c={encrypted:o["a"]._arrayBufferToBase64(s.buffer),nonce:o["a"]._arrayBufferToBase64(r.buffer)};return c}));return function(t,n){return e.apply(this,arguments)}}();return f}));return function(e,t,i){return n.apply(this,arguments)}}(),m=function(){var e=this,t=[19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34],n=function(e){let t=new FileReader;return window.cordova&&(t=t._realReader),t.readAsArrayBuffer(e),new Promise((e,n)=>{t.onloadend=function(n){e(t.result)},t.onerror=function(){n(t.error)}})},i=function(e,t){return new(window.wFile||window.File)([e],"encrypted",{type:"encrypted/"+t.type,name:t.name})},r=function(e,t){return new(window.wFile||window.File)([e],"decrypted",{type:(t.type||"").replace("encrypted/",""),name:"Unnamed"})};return e.randomkey=function(){return new Promise(e=>{var t=new Uint32Array(24),n=window.crypto.getRandomValues(t).toString("hex");e(n)})},e.key=function(e){let t=new TextEncoder;function n(){return window.crypto.subtle.importKey("raw",t.encode(e),"PBKDF2",!1,["deriveBits","deriveKey"])}return n().then(e=>window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t.encode("matrix.pocketnet"),iterations:1e4,hash:"SHA-256"},e,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]))},e.encryptFile=function(t,r,o){return n(t).then(t=>e.encrypt(t,r,o)).then(e=>Promise.resolve(i(e,t)))},e.decryptFile=function(t,i,o){return n(t).then(t=>e.decrypt(t,i,o)).then(e=>Promise.resolve(r(e,t)))},e.encrypt=function(n,i,r){return n&&i?(r||(r={}),r.charsetEnc=r.charsetEnc||"utf8",r.charsetDec=r.charsetDec||"hex",e.key(i).then(e=>crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(t)},e,n)).then((function(e){return e}))):Promise.reject("data")},e.decrypt=function(n,i,r){return n&&i?(r||(r={}),r.charsetEnc=r.charsetEnc||"utf8",r.charsetDec=r.charsetDec||"hex",e.key(i).then(e=>crypto.subtle?crypto.subtle.decrypt({name:"AES-CBC",iv:new Uint8Array(t)},e,n):Promise.reject("crypto.subtle")).then((function(e){return e})).catch(e=>(console.error(e),Promise.reject(e)))):Promise.reject("data")},e},p=function(e,t){d=new c("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",16);var n,i,o=this;return o.core=e,o.clearStorage=function(){o.core.mtrx.clearstorage("pcrypto")},o.currentblock={height:1},o.blocks={},o.user=null,o.rooms={},o.init=function(e){o.user=e},o.destroy=function(){_.each(o.rooms,(function(e){e.clear()})),o.rooms={}},o.addroom=function(t){return pretry(()=>e.user.private&&12==e.user.private.length).then(function(){var e=Object(r["a"])((function*(e){if(o.rooms[t.roomId])return o.rooms[t.roomId].prepare();var r=yield new h(o,t,{ls:n,lse:i});return o.rooms[t.roomId]=r,r.prepare()}));return function(t){return e.apply(this,arguments)}}())},o.set={block:function(e){e&&e.height>o.currentblock.height&&(o.currentblock=e),e.height&&(o.blocks[e.height]=e)}},o.helpers={checkuser:function(){if(e.user&&e.user.private&&12==e.user.private.length&&e.user.userinfo&&e.user.userinfo.keys&&e.user.userinfo.keys.length){var t=e.user.userinfo.keys.join(","),n=_.map(e.user.private,(function(e){return e.public})).join(",");return t==n}return!1}},o.prepare=function(){return Promise.all([Object(s["a"])("messages",1),Object(s["a"])("events",1)]).then(e=>(n=e[0],i=e[1],Promise.resolve()))},o};n["a"]=p}).call(this,i("b639").Buffer)},"9d78":function(e,t,n){},"9e54":function(e,t,n){"use strict";var i=n("c973").default;n("d9e2");var r=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.LocalIndexedDBStoreBackend=y;var o=n("2d78"),s=r(n("3987")),a=r(n("6146")),c=n("63c7");const l=3;function u(e){e.createObjectStore("users",{keyPath:["userId"]}),e.createObjectStore("accountData",{keyPath:["type"]}),e.createObjectStore("sync",{keyPath:["clobber"]})}function d(e){const t=e.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]});t.createIndex("room","room_id")}function h(e){e.createObjectStore("client_options",{keyPath:["clobber"]})}function m(e,t,n){const i=e.openCursor(t);return new Promise((e,t)=>{const r=[];i.onerror=e=>{t(new Error("Query failed: "+e.target.errorCode))},i.onsuccess=t=>{const i=t.target.result;i?(r.push(n(i)),i.continue()):e(r)}})}function p(e){return new Promise((t,n)=>{e.oncomplete=function(e){t(e)},e.onerror=function(e){n(e.target.error)}})}function f(e){return new Promise((t,n)=>{e.onsuccess=function(e){t(e)},e.onerror=function(e){n(e.target.error)}})}function g(e){return new Promise((t,n)=>{e.onsuccess=()=>t(e),e.onerror=e=>n(e)})}function v(e){return f(e).then(e=>e.target.result)}function y(e,t){this.indexedDB=e,this._dbName="matrix-js-sdk:"+(t||"default"),this.db=null,this._disconnected=!0,this._syncAccumulator=new o.SyncAccumulator,this._isNewlyCreated=!1}y.exists=function(e,t){return t="matrix-js-sdk:"+(t||"default"),a.exists(e,t)},y.prototype={connect:function(){if(!this._disconnected)return c.logger.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this._disconnected=!1,c.logger.log("LocalIndexedDBStoreBackend.connect: connecting...");const e=this.indexedDB.open(this._dbName,l);return e.onupgradeneeded=e=>{const t=e.target.result,n=e.oldVersion;c.logger.log("LocalIndexedDBStoreBackend.connect: upgrading from "+n),n<1&&(this._isNewlyCreated=!0,u(t)),n<2&&d(t),n<3&&h(t)},e.onblocked=()=>{c.logger.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},c.logger.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),f(e).then(e=>(c.logger.log("LocalIndexedDBStoreBackend.connect: connected"),this.db=e.target.result,this.db.onversionchange=()=>{this.db.close()},this._init()))},isNewlyCreated:function(){return Promise.resolve(this._isNewlyCreated)},_init:function(){return Promise.all([this._loadAccountData(),this._loadSyncData()]).then(e=>{let[t,n]=e;c.logger.log("LocalIndexedDBStoreBackend: loaded initial data"),this._syncAccumulator.accumulate({next_batch:n.nextBatch,rooms:n.roomsData,groups:n.groupsData,account_data:{events:t}},!0)})},getOutOfBandMembers:function(e){return new Promise((t,n)=>{const i=this.db.transaction(["oob_membership_events"],"readonly"),r=i.objectStore("oob_membership_events"),o=r.index("room"),s=IDBKeyRange.only(e),a=o.openCursor(s),c=[];let l=!1;a.onsuccess=e=>{const n=e.target.result;if(!n)return c.length||l?t(c):t(null);const i=n.value;i.oob_written?l=!0:c.push(i),n.continue()},a.onerror=e=>{n(e)}}).then(t=>(c.logger.log("LL: got "+(t&&t.length)+` membershipEvents from storage for room ${e} ...`),t))},setOutOfBandMembers:function(){var e=i((function*(e,t){c.logger.log("LL: backend about to store "+t.length+" members for "+e);const n=this.db.transaction(["oob_membership_events"],"readwrite"),i=n.objectStore("oob_membership_events");t.forEach(e=>{i.put(e)});const r={room_id:e,oob_written:!0,state_key:0};i.put(r),yield p(n),c.logger.log(`LL: backend done storing for ${e}!`)}));return function(t,n){return e.apply(this,arguments)}}(),clearOutOfBandMembers:function(){var e=i((function*(e){const t=this.db.transaction(["oob_membership_events"],"readonly"),n=t.objectStore("oob_membership_events"),i=n.index("room"),r=IDBKeyRange.only(e),o=v(i.openKeyCursor(r,"next")).then(e=>e&&e.primaryKey[1]),s=v(i.openKeyCursor(r,"prev")).then(e=>e&&e.primaryKey[1]),[a,l]=yield Promise.all([o,s]),u=this.db.transaction(["oob_membership_events"],"readwrite"),d=u.objectStore("oob_membership_events"),h=IDBKeyRange.bound([e,a],[e,l]);c.logger.log(`LL: Deleting all users + marker in storage for room ${e}, with key range:`,[e,a],[e,l]),yield g(d.delete(h))}));return function(t){return e.apply(this,arguments)}}(),clearDatabase:function(){return new Promise((e,t)=>{c.logger.log("Removing indexeddb instance: "+this._dbName);const n=this.indexedDB.deleteDatabase(this._dbName);n.onblocked=()=>{c.logger.log("can't yet delete indexeddb "+this._dbName+" because it is open elsewhere")},n.onerror=t=>{c.logger.warn("unable to delete js-sdk store indexeddb: "+t.target.error),e()},n.onsuccess=()=>{c.logger.log("Removed indexeddb instance: "+this._dbName),e()}})},getSavedSync:function(e){void 0===e&&(e=!0);const t=this._syncAccumulator.getJSON();return t.nextBatch?e?Promise.resolve(s.deepCopy(t)):Promise.resolve(t):Promise.resolve(null)},getNextBatchToken:function(){return Promise.resolve(this._syncAccumulator.getNextBatchToken())},setSyncData:function(e){return Promise.resolve().then(()=>{this._syncAccumulator.accumulate(e)})},syncToDatabase:function(e){const t=this._syncAccumulator.getJSON(!0);return Promise.all([this._persistUserPresenceEvents(e),this._persistAccountData(t.accountData),this._persistSyncData(t.nextBatch,t.roomsData,t.groupsData)])},_persistSyncData:function(e,t,n){return c.logger.log("Persisting sync data up to",e),s.promiseTry(()=>{const i=this.db.transaction(["sync"],"readwrite"),r=i.objectStore("sync");return r.put({clobber:"-",nextBatch:e,roomsData:t,groupsData:n}),p(i)})},_persistAccountData:function(e){return s.promiseTry(()=>{const t=this.db.transaction(["accountData"],"readwrite"),n=t.objectStore("accountData");for(let i=0;i<e.length;i++)n.put(e[i]);return p(t)})},_persistUserPresenceEvents:function(e){return s.promiseTry(()=>{const t=this.db.transaction(["users"],"readwrite"),n=t.objectStore("users");for(const i of e)n.put({userId:i[0],event:i[1]});return p(t)})},getUserPresenceEvents:function(){return s.promiseTry(()=>{const e=this.db.transaction(["users"],"readonly"),t=e.objectStore("users");return m(t,void 0,e=>[e.value.userId,e.value.event])})},_loadAccountData:function(){return c.logger.log("LocalIndexedDBStoreBackend: loading account data..."),s.promiseTry(()=>{const e=this.db.transaction(["accountData"],"readonly"),t=e.objectStore("accountData");return m(t,void 0,e=>e.value).then(e=>(c.logger.log("LocalIndexedDBStoreBackend: loaded account data"),e))})},_loadSyncData:function(){return c.logger.log("LocalIndexedDBStoreBackend: loading sync data..."),s.promiseTry(()=>{const e=this.db.transaction(["sync"],"readonly"),t=e.objectStore("sync");return m(t,void 0,e=>e.value).then(e=>(c.logger.log("LocalIndexedDBStoreBackend: loaded sync data"),e.length>1&&c.logger.warn("loadSyncData: More than 1 sync row found."),e.length>0?e[0]:{}))})},getClientOptions:function(){return Promise.resolve().then(()=>{const e=this.db.transaction(["client_options"],"readonly"),t=e.objectStore("client_options");return m(t,void 0,e=>{if(e.value&&e.value&&e.value.options)return e.value.options}).then(e=>e[0])})},storeClientOptions:function(){var e=i((function*(e){const t=this.db.transaction(["client_options"],"readwrite"),n=t.objectStore("client_options");n.put({clobber:"-",options:e}),yield p(t)}));return function(t){return e.apply(this,arguments)}}()}},"9f70":function(e,t,n){},"9fdb":function(e,t,n){"use strict";n("e072")},a0261:function(e,t,n){},a071:function(e,t,n){"use strict";n("df31")},a0b4:function(e,t,n){},a0e8:function(e,t,n){},a120:function(t,n,i){"use strict";var r=i("c973").default;i("d9e2");var o=i("dbce");Object.defineProperty(n,"__esModule",{value:!0}),n.MatrixEvent=n.EventStatus=void 0;var s=i("faa1"),a=o(i("3987")),c=i("63c7");const l={NOT_SENT:"not_sent",ENCRYPTING:"encrypting",SENDING:"sending",QUEUED:"queued",SENT:"sent",CANCELLED:"cancelled"};n.EventStatus=l;const u={};function d(e){return u[e]||(u[e]=e),u[e]}const h=function(e){["state_key","type","sender","room_id","membership"].forEach(t=>{e[t]&&(e[t]=d(e[t]))}),["membership","avatar_url","displayname"].forEach(t=>{e.content&&e.content[t]&&(e.content[t]=d(e.content[t]))}),["rel_type"].forEach(t=>{e.content&&e.content["m.relates_to"]&&e.content["m.relates_to"][t]&&(e.content["m.relates_to"][t]=d(e.content["m.relates_to"][t]))}),this.event=e||{},this.sender=null,this.target=null,this.status=null,this.error=null,this.forwardLooking=!0,this._pushActions=null,this._replacingEvent=null,this._localRedactionEvent=null,this._isCancelled=!1,this._clearEvent={},this._senderCurve25519Key=null,this._claimedEd25519Key=null,this._forwardingCurve25519KeyChain=[],this._untrusted=null,this._decryptionPromise=null,this._retryDecryption=!1,this.verificationRequest=null,this._txnId=e.txn_id||null,this._localTimestamp=Date.now()-this.getAge()};n.MatrixEvent=h,a.inherits(h,s.EventEmitter),a.extend(h.prototype,{getId:function(){return this.event.event_id},getSender:function(){return this.event.sender||this.event.user_id},getType:function(){return this._clearEvent.type||this.event.type},getWireType:function(){return this.event.type},getRoomId:function(){return this.event.room_id},getTs:function(){return this.event.origin_server_ts},getDate:function(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null},getOriginalContent:function(){return this._localRedactionEvent?{}:this._clearEvent.content||this.event.content||{}},getContent:function(){return this._localRedactionEvent?{}:this._replacingEvent?this._replacingEvent.getContent()["m.new_content"]||{}:this.getOriginalContent()},getWireContent:function(){return this.event.content||{}},getPrevContent:function(){return this.getUnsigned().prev_content||this.event.prev_content||{}},getDirectionalContent:function(){return this.forwardLooking?this.getContent():this.getPrevContent()},getAge:function(){return this.getUnsigned().age||this.event.age},getLocalAge:function(){return Date.now()-this._localTimestamp},getStateKey:function(){return this.event.state_key},isState:function(){return void 0!==this.event.state_key},makeEncrypted:function(e,t,n,i){this._clearEvent={type:this.event.type,content:this.event.content},this.event.type=e,this.event.content=t,this._senderCurve25519Key=n,this._claimedEd25519Key=i},isBeingDecrypted:function(){return null!=this._decryptionPromise},isDecryptionFailure:function(){return this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"===this._clearEvent.content.msgtype},attemptDecryption:function(){var e=r((function*(e,t){if(!this.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");if(this._clearEvent&&this._clearEvent.content&&"m.bad.encrypted"!==this._clearEvent.content.msgtype)throw new Error("Attempt to decrypt event which has already been decrypted");return this._decryptionPromise?(c.logger.log(`Event ${this.getId()} already being decrypted; queueing a retry`),this._retryDecryption=!0,this._decryptionPromise):(this._decryptionPromise=this._decryptionLoop(e,t),this._decryptionPromise)}));return function(t,n){return e.apply(this,arguments)}}(),cancelAndResendKeyRequest:function(e,t){const n=this.getWireContent();return e.requestRoomKey({algorithm:n.algorithm,room_id:this.getRoomId(),session_id:n.session_id,sender_key:n.sender_key},this.getKeyRequestRecipients(t),!0)},getKeyRequestRecipients:function(e){const t=this.getWireContent(),n=[{userId:e,deviceId:"*"}],i=this.getSender();return i!==e&&n.push({userId:i,deviceId:t.device_id}),n},_decryptionLoop:function(){var t=r((function*(t,n){yield Promise.resolve();while(1){let i,r;this._retryDecryption=!1;try{t?(i=yield t.decryptEvent(this),n&&c.logger.info(`Decrypted event on retry (id=${this.getId()})`)):i=this._badEncryptedMessage("Encryption not enabled")}catch(e){if("DecryptionError"!==e.name){const i=n?"re":"";return c.logger.error(`Error ${i}decrypting event (id=${this.getId()}): ${e.stack||e}`),this._decryptionPromise=null,void(this._retryDecryption=!1)}if(r=e,this._retryDecryption){c.logger.log(`Got error decrypting event (id=${this.getId()}: `+e+"), but retrying");continue}c.logger.warn(`Error decrypting event (id=${this.getId()}): ${e.detailedString}`),i=this._badEncryptedMessage(e.message)}return this._decryptionPromise=null,this._retryDecryption=!1,this._setClearData(i),this.setPushActions(null),void this.emit("Event.decrypted",this,r)}}));return function(e,n){return t.apply(this,arguments)}}(),_badEncryptedMessage:function(e){return{clearEvent:{type:"m.room.message",content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: "+e+" **"}}}},_setClearData:function(e){this._clearEvent=e.clearEvent,this._senderCurve25519Key=e.senderCurve25519Key||null,this._claimedEd25519Key=e.claimedEd25519Key||null,this._forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain||[],this._untrusted=e.untrusted||!1},getClearContent:function(){const e=this._clearEvent;return e&&e.content?e.content:null},isEncrypted:function(){return!this.isState()&&"m.room.encrypted"===this.event.type},getSenderKey:function(){return this._senderCurve25519Key},getKeysClaimed:function(){return{ed25519:this._claimedEd25519Key}},getClaimedEd25519Key:function(){return this._claimedEd25519Key},getForwardingCurve25519KeyChain:function(){return this._forwardingCurve25519KeyChain},isKeySourceUntrusted:function(){return this._untrusted},getUnsigned:function(){return this.event.unsigned||{}},unmarkLocallyRedacted:function(){const e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=null),!!e},markLocallyRedacted:function(e){this._localRedactionEvent||(this.emit("Event.beforeRedaction",this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)},makeRedacted:function(e){if(!e.event)throw new Error("invalid redaction_event in makeRedacted");let t;for(t in this._localRedactionEvent=null,this.emit("Event.beforeRedaction",this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event,this.event)this.event.hasOwnProperty(t)&&(m[t]||delete this.event[t]);const n=p[this.getType()]||{},i=this.getContent();for(t in i)i.hasOwnProperty(t)&&(n[t]||delete i[t])},isRedacted:function(){return Boolean(this.getUnsigned().redacted_because)},isRedaction:function(){return"m.room.redaction"===this.getType()},getRedactionEvent:function(){return this.isRedacted()?this._clearEvent.unsigned?this._clearEvent.unsigned.redacted_because:this.event.unsigned.redacted_because?this.event.unsigned.redacted_because:{}:null},getPushActions:function(){return this._pushActions},setPushActions:function(e){this._pushActions=e},handleRemoteEcho:function(e){const t=this.getUnsigned(),n=this.getId();this.event=e,t.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=t.redacted_because),this.setStatus(null),this.getId()!==n&&this.emit("Event.localEventIdReplaced",this)},isSending(){return!!this.status},setStatus(e){this.status=e,this.emit("Event.status",this,e)},replaceLocalEventId(e){this.event.event_id=e,this.emit("Event.localEventIdReplaced",this)},isRelation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;const t=this.getWireContent(),n=t&&t["m.relates_to"];return n&&n.rel_type&&n.event_id&&(e&&n.rel_type===e||!e)},getRelation(){return this.isRelation()?this.getWireContent()["m.relates_to"]:null},makeReplaced(e){this.isRedacted()&&e||this._replacingEvent!==e&&(this._replacingEvent=e,this.emit("Event.replaced",this))},getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status},getServerAggregatedRelation(e){const t=this.getUnsigned()["m.relations"];if(t)return t[e]},replacingEventId(){const e=this.getServerAggregatedRelation("m.replace");return e?e.event_id:this._replacingEvent?this._replacingEvent.getId():void 0},replacingEvent(){return this._replacingEvent},replacingEventDate(){const e=this.getServerAggregatedRelation("m.replace");if(e){const t=e.origin_server_ts;if(Number.isFinite(t))return new Date(t)}else if(this._replacingEvent)return this._replacingEvent.getDate()},localRedactionEvent(){return this._localRedactionEvent},getAssociatedId(){const e=this.getRelation();return e?e.event_id:this.isRedaction()?this.event.redacts:void 0},hasAssocation(){return!!this.getAssociatedId()},updateAssociatedId(e){const t=this.getRelation();t?t.event_id=e:this.isRedaction()&&(this.event.redacts=e)},flagCancelled(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isCancelled=e},isCancelled(){return this._isCancelled},toJSON(){const e={type:this.getType(),sender:this.getSender(),content:this.getContent(),event_id:this.getId(),origin_server_ts:this.getTs(),unsigned:this.getUnsigned(),room_id:this.getRoomId()};return this.isRedaction()&&(e.redacts=this.event.redacts),this.isEncrypted()?{decrypted:e,encrypted:this.event}:e},setVerificationRequest:function(e){this.verificationRequest=e},setTxnId(e){this._txnId=e},getTxnId(){return this._txnId}});const m=["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"].reduce((function(e,t){return e[t]=1,e}),{}),p={"m.room.member":{membership:1},"m.room.create":{creator:1},"m.room.join_rules":{join_rule:1},"m.room.power_levels":{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1},"m.room.aliases":{aliases:1}}},a306:function(e){e.exports=JSON.parse('{"caption":{"create":"Create","addPublicChatName":"Add Public Chat Name","addGroupNamePlaceHolder":"Add Group Name","createPublicChat":"Create public chat","publicRoomTitle":"Public Room Preview","chatTopic":"Topic renamed","asModerator":"as moderator","marked":"marked","unmarked":"unmarked","removeBan":"Remove Ban","cancelModeration":"Remove moderation","uploadFiles":"Subir archivos","header":"cabecera","dragAndDropAFile":"Arrastrar y soltar archivo","chatInvite":"Te han invitado a chatear con:","cantJoin":"No puedes unirte al chat con:","chatInviteDecline":"Puedes unirte al chat o rechazar la invitación","creatorLeft":"Porque el creador dejó la sala","encrypted":"Cifrado","noImages":"Todavía no hay imágenes en este chat","noFiles":"Todavía no hay files en este chat","inviteUser":"Invitar a un usuario","invite":"Invitar","add":"Añadir","mute":"Mute","unmute":"Unmute","leave":"Dejar","Info":"Info","new":"New","typing":"typing","accNotFound":"Su registro está en curso, por favor espere...","emptyList":"La lista está vacía ( filtrada o simplemente vacía )","welcome":"Bienvenido al chat","startNewChat":"Iniciar un nuevo chat","chats":"Chats","shareWith":"Compartir con","newChat":"Nuevo chat","moveToChat":"Mover al chat","queryNoResults":"La consulta no reporta resultados","needMoreCharacters":"Necesita más caracteres para el resultado","createGroup":"Crear grupo","unabletoDecrypt":"* Imposible descifrar","messageDeleted":"Mensaje eliminado","sentImage":"Imagen enviada","sentVoiceMessage":"envió un mensaje de voz","invitationToChat":"Invitación al chat","invitationToRoom":"Invitation to room","leftChat":"abandonó el chat","joined":"unido","chatRenamed":"Chat renombrado a ","recentComment":"Comentario reciente:","share":"SHARE","followers":"Seguidores:","reputation":"Reputación:","following":"Following:","theme":"Tema:","contacts":"Contactos","phoneContacts":"Contactos telefónicos","chooseInviteMedia":"Por favor, elige cómo quieres invitar:","admin":"Admin","moderator":"Moderador","videocall":"Videollamada","call":"Llamada","leaveAndDelete":"Dejar y borrar","donate":"Donar","makeModerator":"Hacer Moderador","ban":"Ban","kick":"Kick","members":"Miembros","media":"Media","files":"Files","contactsList":"Lista de contactos","send":"send","pageCaption":"Título de la página","caption":"Caption","text":"text","placeholder":"placeholder","sendTransactionTo":"Enviar transacción a","toBePaidByReceiver":"A pagar por el receptor","toBePaidBySender":"A pagar por el remitente","source":"Fuente","amount":"Importe","receiver":"Receptor","message":"Mensaje","includeFeesInAmount":"Incluir tasas en el importe","transactionFees":"Tasas de transacción","totalAmount":"Importe total","balanceTooLow":"Saldo demasiado bajo","transactionError":"Error, no se puede realizar la transacción","calculateFees":"Calculate Fees","startChatWith":"Iniciar chat con","searchResult":"Resultado de la búsqueda","joinedInTheChat":"unido en el chat","invited":"invitado","hasInvited":"invitado ","inTheChat":"en el chat","banned":"prohibido","andRoom":"y sala","left":"izquierda","theChat":"el chat","made":"made","aModerator":" un moderador","editedChatNameTo ":"editado el nombre del chat a ","somebody":"alguien","sent":"enviado","PKOINto":"PKOIN to","response":"Respuesta","messagefrom":"Mensaje reenviado de","edited":"Editado","settings":"Ajustes","unauthorized":"No autorizado","search":"Buscar","replyOnMessage":"Respuesta en mensaje","editMessage":"Editar mensaje","inviteFriend":"Invitar a amigos","emptyContactList":"La lista de contactos está vacía","joinApp":"Unirse a Pocketnet","hasInvitedToJoin":"te ha invitado a unirte a Pocketnet","contactsempty":"Todavía no tienes contactos, encuéntralos en la búsqueda","chatsearchingempty":"No chats found for the specified filter","sendmessage":"Send message","clearHistory":"Clear history"},"input":{"patientEmailPlaceholder":"Email","refillNamePlaceholder":"Refill name"},"message":{},"button":{"starChatButton":"Iniciar chat","decline":"Declinar","declineandignore":"Ignorar usuario","join":"Unase","ok":"Ok","save":"ahorrar","copy":"Copiar","forward":"Adelante","delete":"Borrar","reply":"Responder","share":"Compartir","download":"Descargar","downloaded":"Descargado","goToPocketnetProfile":"Ir al perfil de Pocketnet","sendFile":"Enviar archivo","takePhotoOrVideo":"Enviar imagen","sendCoins":"Enviar monedas","edit":"Editar","select":"Seleccione","block":"Bloquear","unblock":"Desbloquear","blockUser":"Bloquear usuario"},"yes":"sí","cancel":"Cancelar","teamMessages":{"1-title":"¡Bienvenido al chat privado de Bastyon!","1-list1":"Mensajería privada que NO está conectada a tu número de teléfono","1-list2":"Cifrado de extremo a extremo de cada conversación 1 a 1 por defecto","1-list3":"Todas las imágenes enviadas o recibidas a través del chat se almacenan encriptadas","1-list4":"El historial de mensajes se guarda sólo durante 7 días","2-title":"¡Un gran anuncio! ¡La aplicación Pocketnet se llama ahora Bastyon!","2-message1":"El dominio se trasladará a Bastyon.com. Recientemente hemos lanzado las siguientes actualizaciones importantes:","2-list1":"Mensajería privada encriptada no conectada a tu número de teléfono","2-list2":"Posibilidad de donar PKOIN a los bloggers","2-list3":"Vídeo y transmisión en directo","2-message2":"Invita a tus amigos ahora y forma parte del gran futuro de la Internet descentralizada!","2-button":"Invitar a los amigos"},"sendingerror":"An error occurred while sending the message","details":"Details","settings_pin":"Pin chat window","checked":"Yes","unchecked":"No","settings_read":"Send read receipts","messagewasburn":"This message remains only in the memory of your device","messagewillburn":"The message will be deleted soon","micaccessbrowser":"Access to the microphone is restricted, please check your browser settings.","micaccesscommonproblem":"Sorry, for some reason it is not possible to record voice messages on the device","micaccesscordova":"Access to the microphone is restricted, please check your device settings.","micdevicenotfound":"Audio recording device not found"}')},a376:function(e,t,n){"use strict";function i(){this.fromToken=null}Object.defineProperty(t,"__esModule",{value:!0}),t.StubStore=i,i.prototype={isNewlyCreated:function(){return Promise.resolve(!0)},getSyncToken:function(){return this.fromToken},setSyncToken:function(e){this.fromToken=e},storeGroup:function(e){},getGroup:function(e){return null},getGroups:function(){return[]},storeRoom:function(e){},getRoom:function(e){return null},getRooms:function(){return[]},removeRoom:function(e){},getRoomSummaries:function(){return[]},storeUser:function(e){},getUser:function(e){return null},getUsers:function(){return[]},scrollback:function(e,t){return[]},storeEvents:function(e,t,n,i){},storeFilter:function(e){},getFilter:function(e,t){return null},getFilterIdByName:function(e){return null},setFilterIdByName:function(e,t){},storeAccountDataEvents:function(e){},getAccountData:function(e){},setSyncData:function(e){return Promise.resolve()},wantsSave:function(){return!1},save:function(){},startup:function(){return Promise.resolve()},getSavedSync:function(){return Promise.resolve(null)},getSavedSyncToken:function(){return Promise.resolve(null)},deleteAllData:function(){return Promise.resolve()},getOutOfBandMembers:function(){return Promise.resolve(null)},setOutOfBandMembers:function(){return Promise.resolve()},clearOutOfBandMembers:function(){return Promise.resolve()},getClientOptions:function(){return Promise.resolve()},storeClientOptions:function(){return Promise.resolve()}}},a421:function(e,t,n){"use strict";n("c592")},a45a:function(e,t,n){},a54c:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"dummypreviews"}},e._l(e.a,(function(e){return n("preview",{key:e.id,attrs:{dummy:!0}})})),1)},r=[],o=n("2f62"),s=n("087d"),a={name:"dummypreviews",data:()=>({messagesPreview:!1}),props:{data:Object},components:{preview:s["a"]},computed:Object(o["c"])({auth:e=>e.auth,a:function(){return this.messagesPreview?[1]:[1,2,3,4,5,6]}}),methods:{}},c=a,l=(n("6e9e"),n("2877")),u=Object(l["a"])(c,i,r,!1,null,"7ed73c7c",null);t["a"]=u.exports},a853:function(e,t,n){"use strict";n("95f7")},aa20:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"nameline"},[e.isShowGroupIcon?n("div",{staticClass:"iconGroup"},[n("i",{staticClass:"fas fa-user-friends"})]):e._e(),n("div",{staticClass:"nameofchat"},[e._v(" "+e._s(e.convertedName.toString().slice(0,13))+" ")])])},r=[],o={name:"chatName",props:{chat:Object,preview:Boolean,m_chat:{}},data:function(){return{}},computed:{users:function(){return this.chat?this.core.mtrx.anotherChatUsers(this.chat.roomId):[]},convertedName:function(){if(this.m_chat&&"public"===this.m_chat.getJoinRule()&&this.m_chat.currentState.getStateEvents("m.room.name").length>0)return this.m_chat.currentState.getStateEvents("m.room.name")[0].getContent().name;var e=_.filter(this.users,e=>e.userId!=this.core.user.userinfo.id),t=_.filter(_.map(e,e=>{if(this.$store.state.users[e.userId])return this.$store.state.users[e.userId].name}),(function(e){return e}));return t.length?0==this.m_chat.name.indexOf("@")?this.m_chat.name.replace("@",""):t.join(", "):this.core.mtrx.chatUsers(this.chat.roomId).length?"Empty chat: "+this.chat.roomId:"-"},isShowGroupIcon(){return"@"===this.m_chat.name.slice(0,1)}},mounted:function(){}},s=o,a=(n("1623"),n("2877")),c=Object(a["a"])(s,i,r,!1,null,"52b75186",null);t["a"]=c.exports},ac94:function(e,t,n){},b215:function(e,t,n){"use strict";n("d61d")},b2ca:function(t,n,i){"use strict";var r=i("c973").default;Object.defineProperty(n,"__esModule",{value:!0}),n.LocalStorageCryptoStore=void 0;var o=i("63c7"),s=i("4df7");const a="crypto.",c=a+"account",l=a+"cross_signing_keys",u=a+"notified_error_devices",d=a+"device_data",h=a+"inboundgroupsessions/",m=a+"inboundgroupsessions.withheld/",p=a+"rooms/",f=a+"sessionsneedingbackup";function g(e){return a+"sessions/"+e}function v(e){return a+"session.problems/"+e}function y(e,t){return h+e+"/"+t}function _(e,t){return m+e+"/"+t}function b(e){return p+e}class E extends s.MemoryCryptoStore{constructor(e){super(),this.store=e}static exists(e){const t=e.length;for(let n=0;n<t;n++)if(e.key(n).startsWith(a))return!0;return!1}countEndToEndSessions(e,t){let n=0;for(let i=0;i<this.store.length;++i)this.store.key(i).startsWith(g(""))&&++n;t(n)}_getEndToEndSessions(e,t,n){const i=S(this.store,g(e)),r={};for(const[o,s]of Object.entries(i||{}))r[o]="string"===typeof s?{session:s}:s;return r}getEndToEndSession(e,t,n,i){const r=this._getEndToEndSessions(e);i(r[t]||{})}getEndToEndSessions(e,t,n){n(this._getEndToEndSessions(e)||{})}getAllEndToEndSessions(e,t){for(let n=0;n<this.store.length;++n)if(this.store.key(n).startsWith(g(""))){const e=this.store.key(n).split("/")[1];for(const n of Object.values(this._getEndToEndSessions(e)))t(n)}}storeEndToEndSession(e,t,n,i){const r=this._getEndToEndSessions(e)||{};r[t]=n,w(this.store,g(e),r)}storeEndToEndSessionProblem(e,t,n){var i=this;return r((function*(){const r=v(e),o=S(i.store,r)||[];o.push({type:t,fixed:n,time:Date.now()}),o.sort((e,t)=>e.time-t.time),w(i.store,r,o)}))()}getEndToEndSessionProblem(e,t){var n=this;return r((function*(){const i=v(e),r=S(n.store,i)||[];if(!r.length)return null;const o=r[r.length-1];for(const e of r)if(e.time>t)return Object.assign({},e,{fixed:o.fixed});return o.fixed?null:o}))()}filterOutNotifiedErrorDevices(e){var t=this;return r((function*(){const n=S(t.store,u)||{},i=[];for(const t of e){const{userId:e,deviceInfo:r}=t;e in n?r.deviceId in n[e]||(i.push(t),n[e][r.deviceId]=!0):(i.push(t),n[e]={[r.deviceId]:!0})}return w(t.store,u,n),i}))()}getEndToEndInboundGroupSession(e,t,n,i){i(S(this.store,y(e,t)),S(this.store,_(e,t)))}getAllEndToEndInboundGroupSessions(e,t){for(let n=0;n<this.store.length;++n){const e=this.store.key(n);e.startsWith(h)&&t({senderKey:e.substr(h.length,43),sessionId:e.substr(h.length+44),sessionData:S(this.store,e)})}t(null)}addEndToEndInboundGroupSession(e,t,n,i){const r=S(this.store,y(e,t));r||this.storeEndToEndInboundGroupSession(e,t,n,i)}storeEndToEndInboundGroupSession(e,t,n,i){w(this.store,y(e,t),n)}storeEndToEndInboundGroupSessionWithheld(e,t,n,i){w(this.store,_(e,t),n)}getEndToEndDeviceData(e,t){t(S(this.store,d))}storeEndToEndDeviceData(e,t){w(this.store,d,e)}storeEndToEndRoom(e,t,n){w(this.store,b(e),t)}getEndToEndRooms(e,t){const n={},i=b("");for(let r=0;r<this.store.length;++r){const e=this.store.key(r);if(e.startsWith(i)){const t=e.substr(i.length);n[t]=S(this.store,e)}}t(n)}getSessionsNeedingBackup(e){const t=S(this.store,f)||{},n=[];for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const t=i.substr(0,43),r=i.substr(44);if(this.getEndToEndInboundGroupSession(t,r,null,e=>{n.push({senderKey:t,sessionId:r,sessionData:e})}),e&&i.length>=e)break}return Promise.resolve(n)}countSessionsNeedingBackup(){const e=S(this.store,f)||{};return Promise.resolve(Object.keys(e).length)}unmarkSessionsNeedingBackup(e){const t=S(this.store,f)||{};for(const n of e)delete t[n.senderKey+"/"+n.sessionId];return w(this.store,f,t),Promise.resolve()}markSessionsNeedingBackup(e){const t=S(this.store,f)||{};for(const n of e)t[n.senderKey+"/"+n.sessionId]=!0;return w(this.store,f,t),Promise.resolve()}deleteAllData(){return this.store.removeItem(c),Promise.resolve()}getAccount(e,t){const n=S(this.store,c);t(n)}storeAccount(e,t){w(this.store,c,t)}getCrossSigningKeys(e,t){const n=S(this.store,l);t(n)}getSecretStorePrivateKey(e,t,n){const i=S(this.store,a+"ssss_cache."+n);t(i)}storeCrossSigningKeys(e,t){w(this.store,l,t)}storeSecretStorePrivateKey(e,t,n){w(this.store,a+"ssss_cache."+t,n)}doTxn(e,t,n){return Promise.resolve(n(null))}}function S(t,n){try{return JSON.parse(t.getItem(n))}catch(e){o.logger.log("Error: Failed to get key %s: %s",n,e.stack||e),o.logger.log(e.stack)}return null}function w(e,t,n){e.setItem(t,JSON.stringify(n))}n.LocalStorageCryptoStore=E},b466:function(e,t,n){},b494:function(e,t,n){},b503:function(e,t,n){"use strict";(function(e){n("d9e2");var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBCryptoStore=void 0;var r=n("63c7"),o=n("b2ca"),s=n("4df7"),a=i(n("3c2f")),c=n("0023"),l=i(n("6146"));class u{constructor(e,t){this._indexedDB=e,this._dbName=t,this._backendPromise=null,this._backend=null}static exists(e,t){return l.exists(e,t)}startup(){return this._backendPromise||(this._backendPromise=new Promise((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));r.logger.log("connecting to indexeddb "+this._dbName);const n=this._indexedDB.open(this._dbName,a.VERSION);n.onupgradeneeded=e=>{const t=e.target.result,n=e.oldVersion;a.upgradeDatabase(t,n)},n.onblocked=()=>{r.logger.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{r.logger.log("Error connecting to indexeddb",e),t(e.target.error)},n.onsuccess=t=>{const n=t.target.result;r.logger.log("connected to indexeddb "+this._dbName),e(new a.Backend(n))}}).then(e=>e.doTxn("readonly",[u.STORE_INBOUND_GROUP_SESSIONS,u.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],t=>{e.getEndToEndInboundGroupSession("","",t,()=>{})}).then(()=>e)).catch(t=>{if("VersionError"===t.name)throw r.logger.warn("Crypto DB is too new for us to use!",t),new c.InvalidCryptoStoreError(c.InvalidCryptoStoreError.TOO_NEW);r.logger.warn("unable to connect to indexeddb "+this._dbName+": falling back to localStorage store: "+t);try{return new o.LocalStorageCryptoStore(e.localStorage)}catch(t){return r.logger.warn("unable to open localStorage: falling back to in-memory store: "+t),new s.MemoryCryptoStore}}).then(e=>{this._backend=e})),this._backendPromise}deleteAllData(){return new Promise((e,t)=>{if(!this._indexedDB)return void t(new Error("no indexeddb support available"));r.logger.log("Removing indexeddb instance: "+this._dbName);const n=this._indexedDB.deleteDatabase(this._dbName);n.onblocked=()=>{r.logger.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},n.onerror=e=>{r.logger.log("Error deleting data from indexeddb",e),t(e.target.error)},n.onsuccess=()=>{r.logger.log("Removed indexeddb instance: "+this._dbName),e()}}).catch(e=>{r.logger.warn("unable to delete IndexedDBCryptoStore: "+e)})}getOrAddOutgoingRoomKeyRequest(e){return this._backend.getOrAddOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequest(e){return this._backend.getOutgoingRoomKeyRequest(e)}getOutgoingRoomKeyRequestByState(e){return this._backend.getOutgoingRoomKeyRequestByState(e)}getAllOutgoingRoomKeyRequestsByState(e){return this._backend.getAllOutgoingRoomKeyRequestsByState(e)}getOutgoingRoomKeyRequestsByTarget(e,t,n){return this._backend.getOutgoingRoomKeyRequestsByTarget(e,t,n)}updateOutgoingRoomKeyRequest(e,t,n){return this._backend.updateOutgoingRoomKeyRequest(e,t,n)}deleteOutgoingRoomKeyRequest(e,t){return this._backend.deleteOutgoingRoomKeyRequest(e,t)}getAccount(e,t){this._backend.getAccount(e,t)}storeAccount(e,t){this._backend.storeAccount(e,t)}getCrossSigningKeys(e,t){this._backend.getCrossSigningKeys(e,t)}getSecretStorePrivateKey(e,t,n){this._backend.getSecretStorePrivateKey(e,t,n)}storeCrossSigningKeys(e,t){this._backend.storeCrossSigningKeys(e,t)}storeSecretStorePrivateKey(e,t,n){this._backend.storeSecretStorePrivateKey(e,t,n)}countEndToEndSessions(e,t){this._backend.countEndToEndSessions(e,t)}getEndToEndSession(e,t,n,i){this._backend.getEndToEndSession(e,t,n,i)}getEndToEndSessions(e,t,n){this._backend.getEndToEndSessions(e,t,n)}getAllEndToEndSessions(e,t){this._backend.getAllEndToEndSessions(e,t)}storeEndToEndSession(e,t,n,i){this._backend.storeEndToEndSession(e,t,n,i)}storeEndToEndSessionProblem(e,t,n){return this._backend.storeEndToEndSessionProblem(e,t,n)}getEndToEndSessionProblem(e,t){return this._backend.getEndToEndSessionProblem(e,t)}filterOutNotifiedErrorDevices(e){return this._backend.filterOutNotifiedErrorDevices(e)}getEndToEndInboundGroupSession(e,t,n,i){this._backend.getEndToEndInboundGroupSession(e,t,n,i)}getAllEndToEndInboundGroupSessions(e,t){this._backend.getAllEndToEndInboundGroupSessions(e,t)}addEndToEndInboundGroupSession(e,t,n,i){this._backend.addEndToEndInboundGroupSession(e,t,n,i)}storeEndToEndInboundGroupSession(e,t,n,i){this._backend.storeEndToEndInboundGroupSession(e,t,n,i)}storeEndToEndInboundGroupSessionWithheld(e,t,n,i){this._backend.storeEndToEndInboundGroupSessionWithheld(e,t,n,i)}storeEndToEndDeviceData(e,t){this._backend.storeEndToEndDeviceData(e,t)}getEndToEndDeviceData(e,t){this._backend.getEndToEndDeviceData(e,t)}storeEndToEndRoom(e,t,n){this._backend.storeEndToEndRoom(e,t,n)}getEndToEndRooms(e,t){this._backend.getEndToEndRooms(e,t)}getSessionsNeedingBackup(e){return this._backend.getSessionsNeedingBackup(e)}countSessionsNeedingBackup(e){return this._backend.countSessionsNeedingBackup(e)}unmarkSessionsNeedingBackup(e,t){return this._backend.unmarkSessionsNeedingBackup(e,t)}markSessionsNeedingBackup(e,t){return this._backend.markSessionsNeedingBackup(e,t)}addSharedHistoryInboundGroupSession(e,t,n,i){this._backend.addSharedHistoryInboundGroupSession(e,t,n,i)}getSharedHistoryInboundGroupSessions(e,t){return this._backend.getSharedHistoryInboundGroupSessions(e,t)}doTxn(e,t,n,i){return this._backend.doTxn(e,t,n,i)}}t.IndexedDBCryptoStore=u,u.STORE_ACCOUNT="account",u.STORE_SESSIONS="sessions",u.STORE_INBOUND_GROUP_SESSIONS="inbound_group_sessions",u.STORE_INBOUND_GROUP_SESSIONS_WITHHELD="inbound_group_sessions_withheld",u.STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS="shared_history_inbound_group_sessions",u.STORE_DEVICE_DATA="device_data",u.STORE_ROOMS="rooms",u.STORE_BACKUP="sessions_needing_backup"}).call(this,n("c8ba"))},b551:function(e,t,n){"use strict";n("a0e8")},b5b6:function(e,t,n){},b93b:function(e,t,n){"use strict";n("cc8c")},bb76:function(e,t,n){"use strict";function i(e){this._timeline=[e],this._ourEventIndex=0,this._paginateTokens={b:null,f:null},this._paginateRequests={b:null,f:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.EventContext=i,i.prototype.getEvent=function(){return this._timeline[this._ourEventIndex]},i.prototype.getTimeline=function(){return this._timeline},i.prototype.getOurEventIndex=function(){return this._ourEventIndex},i.prototype.getPaginateToken=function(e){return this._paginateTokens[e?"b":"f"]},i.prototype.setPaginateToken=function(e,t){this._paginateTokens[t?"b":"f"]=e},i.prototype.addEvents=function(e,t){t?(this._timeline=e.concat(this._timeline),this._ourEventIndex+=e.length):this._timeline=this._timeline.concat(e)}},bc22:function(e,t,n){},bec2:function(e,t,n){},bed5:function(e,t,n){},c134:function(e,t,n){},c1af:function(e){e.exports=JSON.parse('{"caption":{"create":"Create","addPublicChatName":"Add Public Chat Name","addGroupNamePlaceHolder":"Add Group Name","createPublicChat":"Create public chat","chatTopic":"Topic renamed","publicRoomTitle":"Public Room","asModerator":"as moderator","marked":"marked","unmarked":"unmarked","removeBan":"Remove Ban","cancelModeration":"Remove moderation","uploadFiles":"파일 업로드","header":"헤더","dragAndDropAFile":"파일 끌어서 놓기","chatInvite":"다음과 채팅하도록 초대되었습니다:","cantJoin":"다음과 채팅하기 위해 참여할 수 없습니다:","chatInviteDecline":"채팅에 참여하거나 초대를 거부할 수 있습니다.","creatorLeft":"크리에이터가 방을 나갔기 때문에","encrypted":"암호화","noImages":"이 채팅에는 아직 이미지가 없습니다","noFiles":"There are no files in this chat yet","inviteUser":"사용자 초대","invite":"초대하다","add":"추가","mute":"음소거","unmute":"음소거 해제","leave":"떠나다","Info":"정보","new":"신규","typing":"타자","accNotFound":"등록이 진행 중입니다. 잠시만 기다려 주십시오...","emptyList":"목록이 비어 있습니다(필터링되었거나 비어 있음)","welcome":"포켓넷 채팅에 오신 것을 환영합니다","startNewChat":"새 채팅 시작","chats":"채팅","shareWith":"공유","newChat":"새 채팅","moveToChat":"채팅으로 이동","queryNoResults":"쿼리가 결과를 보고하지 않음","needMoreCharacters":"결과에 대해 더 많은 문자가 필요합니다","createGroup":"그룹 만들기","unabletoDecrypt":"* 해독할 수 없음","messageDeleted":"메시지 삭제됨","sentImage":"전송된 이미지","sentVoiceMessage":"음성 메시지를 보냈다","invitationToChat":"채팅 초대","invitationToRoom":"Invitation to room","leftChat":"채팅에서 나감","joined":"가입","chatRenamed":"채팅 이름이 (으)로 변경되었습니다 ","recentComment":"최근 댓글:","share":"공유","followers":"팔로워:","reputation":"평판:","following":"팔로잉:","theme":"테마:","contacts":"연락처","phoneContacts":"전화 연락처","chooseInviteMedia":"초대 방법을 선택하십시오:","admin":"관리자","moderator":"진행자","videocall":"영상통화","call":"전화","leaveAndDelete":"나가서 삭제","donate":"기부하다","makeModerator":"모더레이터 만들기","ban":"금지","kick":"킥","members":"회원","media":"미디어","files":"파일","contactsList":"연락처 목록","send":"보내다","pageCaption":"페이지 캡션","caption":"캡션","text":"텍스트","placeholder":"자리 표시자","sendTransactionTo":"트랜잭션 보내기","toBePaidByReceiver":"수취인이 지불함","toBePaidBySender":"발신인이 지불함","source":"소스","amount":"금액","receiver":"수신자","message":"메시지","includeFeesInAmount":"금액에 수수료 포함","transactionFees":"거래 수수료","totalAmount":"총 금액","balanceTooLow":"밸런스가 너무 낮음","transactionError":"오류, 거래를 할 수 없습니다","calculateFees":"수수료 계산","startChatWith":"채팅 시작","searchResult":"검색 결과","joinedInTheChat":"채팅에 참여했습니다","invited":"초대 ","hasInvited":"초대 ","inTheChat":" 채팅 중","banned":"금지된","andRoom":"그리고 방","left":"왼쪽","theChat":" 채팅 ","made":"만든 ","aModerator":" 중재자","editedChatNameTo ":"편집된 채팅 이름을 ","somebody":"누군가","sent":"보낸","PKOINto":" PKOIN to ","response":"응답","messagefrom":"에서 전달된 메시지","edited":"편집됨","settings":"설정","unauthorized":"무단","search":"검색","replyOnMessage":"메시지에 회신","editMessage":"메시지 편집","inviteFriend":"친구 초대","emptyContactList":"연락처 목록이 비어 있습니다","joinApp":"포켓넷 가입","hasInvitedToJoin":"Pocketnet에 가입하도록 초대했습니다","contactsempty":"아직 연락처가 없습니다. 검색에서 찾으십시오","chatsearchingempty":"No chats found for the specified filter","sendmessage":"Send message","clearHistory":"Clear history"},"input":{"patientEmailPlaceholder":"이메일","refillNamePlaceholder":"리필 이름"},"message":{},"button":{"starChatButton":"채팅 시작","decline":"거절","declineandignore":"사용자 무시","join":"가입","ok":"그래","copy":"복사","forward":"앞으로","delete":"삭제","reply":"답장","share":"공유","save":"저장","download":"다운로드","downloaded":"다운로드","goToPocketnetProfile":"Pocketnet 프로필로 이동","sendFile":"파일 보내기","takePhotoOrVideo":"이미지 보내기","sendCoins":"코인 보내기","edit":"편집","select":"고르다","block":"차단","unblock":"차단 해제","blockUser":"사용자 차단"},"yes":"예","cancel":"취소","teamMessages":{"1-title":"Bastyon 비공개 채팅에 오신 것을 환영합니다!","1-list1":"전화번호와 연결되지 않은 비공개 메신저","1-list2":"기본적으로 모든 1:1 대화의 종단 간 암호화","1-list3":"채팅을 통해 주고받는 모든 이미지는 암호화되어 저장됩니다","1-list4":"메시지 기록은 7일 동안만 저장됩니다","2-title":"엄청난 발표! Pocketnet 응용 프로그램은 이제 Bastyon이라고 합니다!","2-message1":"도메인이 Bastyon.com으로 이동됩니다. 최근에 다음과 같은 주요 업데이트를 발표했습니다","2-list1":"귀하의 전화 번호에 연결되지 않은 개인 암호화 메신저","2-list2":"블로거에게 PKOIN 기부 기능","2-list3":"비디오 및 라이브 스트리밍","2-message2":"지금 친구를 초대하고 탈중앙화 인터넷의 큰 미래의 일부가 되십시오!","2-button":"친구를 초대"},"sendingerror":"An error occurred while sending the message","details":"Details","settings_pin":"Pin chat window","checked":"Yes","unchecked":"No","settings_read":"Send read receipts","messagewasburn":"This message remains only in the memory of your device","messagewillburn":"The message will be deleted soon","micaccessbrowser":"Access to the microphone is restricted, please check your browser settings.","micaccesscommonproblem":"Sorry, for some reason it is not possible to record voice messages on the device","micaccesscordova":"Access to the microphone is restricted, please check your device settings.","micdevicenotfound":"Audio recording device not found"}')},c49a:function(e,t,n){},c4a5:function(e,t,n){},c592:function(e,t,n){},c776:function(e,t,n){},c976:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Filter=o;var i=n("4ec4");function r(e,t,n){const i=t.split(".");let r=e;for(let o=0;o<i.length-1;o++)r[i[o]]||(r[i[o]]={}),r=r[i[o]];r[i[i.length-1]]=n}function o(e,t){this.userId=e,this.filterId=t,this.definition={}}o.LAZY_LOADING_MESSAGES_FILTER={lazy_load_members:!0},o.prototype.getFilterId=function(){return this.filterId},o.prototype.getDefinition=function(){return this.definition},o.prototype.setDefinition=function(e){this.definition=e;const t=e.room,n={};t&&(t.rooms&&(n.rooms=t.rooms),t.rooms&&(n.not_rooms=t.not_rooms),this._include_leave=t.include_leave||!1),this._room_filter=new i.FilterComponent(n),this._room_timeline_filter=new i.FilterComponent(t&&t.timeline||{})},o.prototype.getRoomTimelineFilterComponent=function(){return this._room_timeline_filter},o.prototype.filterRoomTimeline=function(e){return this._room_timeline_filter.filter(this._room_filter.filter(e))},o.prototype.setTimelineLimit=function(e){r(this.definition,"room.timeline.limit",e)},o.prototype.setLazyLoadMembers=function(e){r(this.definition,"room.state.lazy_load_members",!!e)},o.prototype.setIncludeLeaveRooms=function(e){r(this.definition,"room.include_leave",e)},o.fromJson=function(e,t,n){const i=new o(e,t);return i.setDefinition(n),i}},cc8c:function(e,t,n){},cdb2:function(e,t,n){},ce3e:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"settingsTopheader"}},[n("topheader",{scopedSlots:e._u([{key:"left",fn:function(){return[n("backButton",{attrs:{action:"back"}})]},proxy:!0},{key:"info",fn:function(){return[n("span",[e._v(e._s(e.$t("caption.settings")))])]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])})],1)},r=[],o=n("2f62"),s={name:"settingsTopheader",props:{},data:function(){return{loading:!1}},created:()=>{},watch:{},computed:Object(o["c"])({auth:e=>e.auth}),methods:{}},a=s,c=(n("fbb2"),n("2877")),l=Object(c["a"])(a,i,r,!1,null,"7cd6d492",null);t["a"]=l.exports},cff8:function(e,t,n){"use strict";n("f6eb")},d0f2:function(e,t,n){"use strict";(function(e){var i=n("c973").default;n("d9e2");var r=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.MatrixBaseApis=d;var o=n("788e"),s=n("63c7"),a=n("ef06"),c=r(n("3987")),l=n("1c8f");function u(e,t){switch(e){case o.SERVICE_TYPES.IS:return t+l.PREFIX_IDENTITY_V2+"/terms";case o.SERVICE_TYPES.IM:return t+"/_matrix/integrations/v1/terms";default:throw new Error("Unsupported service type")}}function d(e){c.checkObjectHasKeys(e,["baseUrl","request"]),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer;const t={baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,request:e.request,prefix:l.PREFIX_R0,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader};this._http=new l.MatrixHttpApi(this,t),this._txnCtr=0}d.prototype.getHomeserverUrl=function(){return this.baseUrl},d.prototype.getIdentityServerUrl=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&(this.idBaseUrl.startsWith("http://")||this.idBaseUrl.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl},d.prototype.setIdentityServerUrl=function(e){this.idBaseUrl=c.ensureNoTrailingSlash(e),this._http.setIdBaseUrl(this.idBaseUrl)},d.prototype.getAccessToken=function(){return this._http.opts.accessToken||null},d.prototype.isLoggedIn=function(){return void 0!==this._http.opts.accessToken},d.prototype.makeTxnId=function(){return"m"+(new Date).getTime()+"."+this._txnCtr++},d.prototype.isUsernameAvailable=function(e){return this._http.authedRequest(void 0,"GET","/register/available",{username:e}).then(e=>e.available)},d.prototype.register=function(e,t,n,i,r,o,s,a){!0===r?r={email:!0}:null!==r&&void 0!==r||(r={}),"function"===typeof s&&(a=s,s=void 0),n&&(i.session=n);const c={auth:i};return void 0!==e&&null!==e&&(c.username=e),void 0!==t&&null!==t&&(c.password=t),r.email&&(c.bind_email=!0),r.msisdn&&(c.bind_msisdn=!0),void 0!==o&&null!==o&&(c.guest_access_token=o),void 0!==s&&null!==s&&(c.inhibit_login=s),void 0!==t&&null!==t&&(c.x_show_msisdn=!0),this.registerRequest(c,void 0,a)},d.prototype.registerGuest=function(e,t){return e=e||{},e.body=e.body||{},this.registerRequest(e.body,"guest",t)},d.prototype.registerRequest=function(e,t,n){const i={};return t&&(i.kind=t),this._http.request(n,"POST","/register",i,e)},d.prototype.loginFlows=function(e){return this._http.request(e,"GET","/login")},d.prototype.login=function(e,t,n){const i={type:e};return c.extend(i,t),this._http.authedRequest((e,t)=>{t&&t.access_token&&t.user_id&&(this._http.opts.accessToken=t.access_token,this.credentials={userId:t.user_id}),n&&n(e,t)},"POST","/login",void 0,i)},d.prototype.loginWithPassword=function(e,t,n){return this.login("m.login.password",{user:e,password:t},n)},d.prototype.loginWithSAML2=function(e,t){return this.login("m.login.saml2",{relay_state:e},t)},d.prototype.getCasLoginUrl=function(e){return this.getSsoLoginUrl(e,"cas")},d.prototype.getSsoLoginUrl=function(e,t,n){void 0===t&&(t="sso");let i=l.PREFIX_R0,r="/login/"+t+"/redirect";return n&&(r+="/"+n,i="/_matrix/client/unstable/org.matrix.msc2858"),this._http.getUrl(r,{redirectUrl:e},i)},d.prototype.loginWithToken=function(e,t){return this.login("m.login.token",{token:e},t)},d.prototype.logout=function(e){return this._http.authedRequest(e,"POST","/logout")},d.prototype.deactivateAccount=function(e,t){if("function"===typeof t)throw new Error("deactivateAccount no longer accepts a callback parameter");const n={};return e&&(n.auth=e),void 0!==t&&(n.erase=t),this._http.authedRequest(void 0,"POST","/account/deactivate",void 0,n)},d.prototype.getFallbackAuthUrl=function(e,t){const n=c.encodeUri("/auth/$loginType/fallback/web",{$loginType:e});return this._http.getUrl(n,{session:t},l.PREFIX_R0)},d.prototype.createRoom=function(){var e=i((function*(e,t){const n=(e.invite_3pid||[]).filter(e=>!e.id_access_token);if(n.length>0&&this.identityServer&&this.identityServer.getAccessToken&&(yield this.doesServerAcceptIdentityAccessToken())){const e=yield this.identityServer.getAccessToken();if(e)for(const t of n)t.id_access_token=e}return this._http.authedRequest(t,"POST","/createRoom",void 0,e)}));return function(t,n){return e.apply(this,arguments)}}(),d.prototype.fetchRelations=function(){var e=i((function*(e,t,n,i,r){const o={};r.from&&(o.from=r.from);const s=c.encodeParams(o),a=c.encodeUri("/rooms/$roomId/relations/$eventId/$relationType/$eventType?"+s,{$roomId:e,$eventId:t,$relationType:n,$eventType:i}),u=yield this._http.authedRequest(void 0,"GET",a,null,null,{prefix:l.PREFIX_UNSTABLE});return u}));return function(t,n,i,r,o){return e.apply(this,arguments)}}(),d.prototype.roomState=function(e,t){const n=c.encodeUri("/rooms/$roomId/state",{$roomId:e});return this._http.authedRequest(t,"GET",n)},d.prototype.fetchRoomEvent=function(e,t,n){const i=c.encodeUri("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:t});return this._http.authedRequest(n,"GET",i)},d.prototype.members=function(e,t,n,i,r){const o={};t&&(o.membership=t),n&&(o.not_membership=n),i&&(o.at=i);const s=c.encodeParams(o),a=c.encodeUri("/rooms/$roomId/members?"+s,{$roomId:e});return this._http.authedRequest(r,"GET",a)},d.prototype.upgradeRoom=function(e,t){const n=c.encodeUri("/rooms/$roomId/upgrade",{$roomId:e});return this._http.authedRequest(void 0,"POST",n,void 0,{new_version:t})},d.prototype.getGroupSummary=function(e){const t=c.encodeUri("/groups/$groupId/summary",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},d.prototype.getGroupProfile=function(e){const t=c.encodeUri("/groups/$groupId/profile",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},d.prototype.setGroupProfile=function(e,t){const n=c.encodeUri("/groups/$groupId/profile",{$groupId:e});return this._http.authedRequest(void 0,"POST",n,void 0,t)},d.prototype.setGroupJoinPolicy=function(e,t){const n=c.encodeUri("/groups/$groupId/settings/m.join_policy",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,{"m.join_policy":t})},d.prototype.getGroupUsers=function(e){const t=c.encodeUri("/groups/$groupId/users",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},d.prototype.getGroupInvitedUsers=function(e){const t=c.encodeUri("/groups/$groupId/invited_users",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},d.prototype.getGroupRooms=function(e){const t=c.encodeUri("/groups/$groupId/rooms",{$groupId:e});return this._http.authedRequest(void 0,"GET",t)},d.prototype.inviteUserToGroup=function(e,t){const n=c.encodeUri("/groups/$groupId/admin/users/invite/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{})},d.prototype.removeUserFromGroup=function(e,t){const n=c.encodeUri("/groups/$groupId/admin/users/remove/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"PUT",n,void 0,{})},d.prototype.addUserToGroupSummary=function(e,t,n){const i=c.encodeUri(n?"/groups/$groupId/summary/$roleId/users/$userId":"/groups/$groupId/summary/users/$userId",{$groupId:e,$roleId:n,$userId:t});return this._http.authedRequest(void 0,"PUT",i,void 0,{})},d.prototype.removeUserFromGroupSummary=function(e,t){const n=c.encodeUri("/groups/$groupId/summary/users/$userId",{$groupId:e,$userId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},d.prototype.addRoomToGroupSummary=function(e,t,n){const i=c.encodeUri(n?"/groups/$groupId/summary/$categoryId/rooms/$roomId":"/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$categoryId:n,$roomId:t});return this._http.authedRequest(void 0,"PUT",i,void 0,{})},d.prototype.removeRoomFromGroupSummary=function(e,t){const n=c.encodeUri("/groups/$groupId/summary/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},d.prototype.addRoomToGroup=function(e,t,n){void 0===n&&(n=!0);const i=c.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"PUT",i,void 0,{"m.visibility":{type:n?"public":"private"}})},d.prototype.updateGroupRoomVisibility=function(e,t,n){const i=c.encodeUri("/groups/$groupId/admin/rooms/$roomId/config/m.visibility",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"PUT",i,void 0,{type:n?"public":"private"})},d.prototype.removeRoomFromGroup=function(e,t){const n=c.encodeUri("/groups/$groupId/admin/rooms/$roomId",{$groupId:e,$roomId:t});return this._http.authedRequest(void 0,"DELETE",n,void 0,{})},d.prototype.acceptGroupInvite=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=c.encodeUri("/groups/$groupId/self/accept_invite",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,t||{})},d.prototype.joinGroup=function(e){const t=c.encodeUri("/groups/$groupId/self/join",{$groupId:e});return this._http.authedRequest(void 0,"PUT",t,void 0,{})},d.prototype.leaveGroup=function(e){const t=c.encodeUri("/groups/$groupId/self/leave",{$groupId:e});return this._http.authedRequest(void 0,"PUT",t,void 0,{})},d.prototype.getJoinedGroups=function(){const e=c.encodeUri("/joined_groups");return this._http.authedRequest(void 0,"GET",e)},d.prototype.createGroup=function(e){const t=c.encodeUri("/create_group");return this._http.authedRequest(void 0,"POST",t,void 0,e)},d.prototype.getPublicisedGroups=function(e){const t=c.encodeUri("/publicised_groups");return this._http.authedRequest(void 0,"POST",t,void 0,{user_ids:e})},d.prototype.setGroupPublicity=function(e,t){const n=c.encodeUri("/groups/$groupId/self/update_publicity",{$groupId:e});return this._http.authedRequest(void 0,"PUT",n,void 0,{publicise:t})},d.prototype.getStateEvent=function(e,t,n,i){const r={$roomId:e,$eventType:t,$stateKey:n};let o=c.encodeUri("/rooms/$roomId/state/$eventType",r);return void 0!==n&&(o=c.encodeUri(o+"/$stateKey",r)),this._http.authedRequest(i,"GET",o)},d.prototype.sendStateEvent=function(e,t,n,i,r){const o={$roomId:e,$eventType:t,$stateKey:i};let s=c.encodeUri("/rooms/$roomId/state/$eventType",o);return void 0!==i&&(s=c.encodeUri(s+"/$stateKey",o)),this._http.authedRequest(r,"PUT",s,void 0,n)},d.prototype.roomInitialSync=function(e,t,n){c.isFunction(t)&&(n=t,t=void 0);const i=c.encodeUri("/rooms/$roomId/initialSync",{$roomId:e});return t||(t=30),this._http.authedRequest(n,"GET",i,{limit:t})},d.prototype.setRoomReadMarkersHttpRequest=function(e,t,n,i){const r=c.encodeUri("/rooms/$roomId/read_markers",{$roomId:e}),o={"m.fully_read":t,"m.read":n,"m.hidden":Boolean(!!i&&i.hidden)};return this._http.authedRequest(void 0,"POST",r,void 0,o)},d.prototype.getJoinedRooms=function(){const e=c.encodeUri("/joined_rooms");return this._http.authedRequest(void 0,"GET",e)},d.prototype.getJoinedRoomMembers=function(e){const t=c.encodeUri("/rooms/$roomId/joined_members",{$roomId:e});return this._http.authedRequest(void 0,"GET",t)},d.prototype.publicRooms=function(e,t){"function"==typeof e&&(t=e,e={}),void 0===e&&(e={});const n={};return e.server&&(n.server=e.server,delete e.server),0===Object.keys(e).length&&0===Object.keys(n).length?this._http.authedRequest(t,"GET","/publicRooms"):this._http.authedRequest(t,"POST","/publicRooms",n,e)},d.prototype.createAlias=function(e,t,n){const i=c.encodeUri("/directory/room/$alias",{$alias:e}),r={room_id:t};return this._http.authedRequest(n,"PUT",i,void 0,r)},d.prototype.deleteAlias=function(e,t){const n=c.encodeUri("/directory/room/$alias",{$alias:e});return this._http.authedRequest(t,"DELETE",n,void 0,void 0)},d.prototype.unstableGetLocalAliases=function(e,t){const n=c.encodeUri("/rooms/$roomId/aliases",{$roomId:e}),i=l.PREFIX_UNSTABLE+"/org.matrix.msc2432";return this._http.authedRequest(t,"GET",n,null,null,{prefix:i})},d.prototype.getRoomIdForAlias=function(e,t){const n=c.encodeUri("/directory/room/$alias",{$alias:e});return this._http.authedRequest(t,"GET",n)},d.prototype.resolveRoomAlias=function(e,t){const n=c.encodeUri("/directory/room/$alias",{$alias:e});return this._http.request(t,"GET",n)},d.prototype.getRoomDirectoryVisibility=function(e,t){const n=c.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this._http.authedRequest(t,"GET",n)},d.prototype.setRoomDirectoryVisibility=function(e,t,n){const i=c.encodeUri("/directory/list/room/$roomId",{$roomId:e});return this._http.authedRequest(n,"PUT",i,void 0,{visibility:t})},d.prototype.setRoomDirectoryVisibilityAppService=function(e,t,n,i){const r=c.encodeUri("/directory/list/appservice/$networkId/$roomId",{$networkId:e,$roomId:t});return this._http.authedRequest(i,"PUT",r,void 0,{visibility:n})},d.prototype.searchUserDirectory=function(e){const t={search_term:e.term};return void 0!==e.limit&&(t.limit=e.limit),this._http.authedRequest(void 0,"POST","/user_directory/search",void 0,t)},d.prototype.uploadContent=function(e,t){return this._http.uploadContent(e,t)},d.prototype.cancelUpload=function(e){return this._http.cancelUpload(e)},d.prototype.getCurrentUploads=function(){return this._http.getCurrentUploads()},d.prototype.getProfileInfo=function(e,t,n){c.isFunction(t)&&(n=t,t=void 0);const i=t?c.encodeUri("/profile/$userId/$info",{$userId:e,$info:t}):c.encodeUri("/profile/$userId",{$userId:e});return this._http.authedRequest(n,"GET",i)},d.prototype.getThreePids=function(e){const t="/account/3pid";return this._http.authedRequest(e,"GET",t,void 0,void 0)},d.prototype.addThreePid=function(e,t,n){const i="/account/3pid",r={threePidCreds:e,bind:t};return this._http.authedRequest(n,"POST",i,null,r)},d.prototype.addThreePidOnly=function(){var e=i((function*(e){const t="/account/3pid/add",n=(yield this.isVersionSupported("r0.6.0"))?l.PREFIX_R0:l.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST",t,null,e,{prefix:n})}));return function(t){return e.apply(this,arguments)}}(),d.prototype.bindThreePid=function(){var e=i((function*(e){const t="/account/3pid/bind",n=(yield this.isVersionSupported("r0.6.0"))?l.PREFIX_R0:l.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST",t,null,e,{prefix:n})}));return function(t){return e.apply(this,arguments)}}(),d.prototype.unbindThreePid=function(){var e=i((function*(e,t){const n="/account/3pid/unbind",i={medium:e,address:t,id_server:this.getIdentityServerUrl(!0)},r=(yield this.isVersionSupported("r0.6.0"))?l.PREFIX_R0:l.PREFIX_UNSTABLE;return this._http.authedRequest(void 0,"POST",n,null,i,{prefix:r})}));return function(t,n){return e.apply(this,arguments)}}(),d.prototype.deleteThreePid=function(e,t){const n="/account/3pid/delete",i={medium:e,address:t};return this._http.authedRequest(void 0,"POST",n,null,i)},d.prototype.setPassword=function(e,t,n){const i="/account/password",r={auth:e,new_password:t};return this._http.authedRequest(n,"POST",i,null,r)},d.prototype.getDevices=function(){return this._http.authedRequest(void 0,"GET","/devices",void 0,void 0)},d.prototype.getDevice=function(e){const t=c.encodeUri("/devices/$device_id",{$device_id:e});return this._http.authedRequest(void 0,"GET",t,void 0,void 0)},d.prototype.setDeviceDetails=function(e,t){const n=c.encodeUri("/devices/$device_id",{$device_id:e});return this._http.authedRequest(void 0,"PUT",n,void 0,t)},d.prototype.deleteDevice=function(e,t){const n=c.encodeUri("/devices/$device_id",{$device_id:e}),i={};return t&&(i.auth=t),this._http.authedRequest(void 0,"DELETE",n,void 0,i)},d.prototype.deleteMultipleDevices=function(e,t){const n={devices:e};t&&(n.auth=t);const i="/delete_devices";return this._http.authedRequest(void 0,"POST",i,void 0,n)},d.prototype.getPushers=function(e){const t="/pushers";return this._http.authedRequest(e,"GET",t,void 0,void 0)},d.prototype.setPusher=function(e,t){const n="/pushers/set";return this._http.authedRequest(t,"POST",n,null,e)},d.prototype.getPushRules=function(e){return this._http.authedRequest(e,"GET","/pushrules/").then(e=>a.PushProcessor.rewriteDefaultRules(e))},d.prototype.addPushRule=function(e,t,n,i,r){const o=c.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this._http.authedRequest(r,"PUT",o,void 0,i)},d.prototype.deletePushRule=function(e,t,n,i){const r=c.encodeUri("/pushrules/"+e+"/$kind/$ruleId",{$kind:t,$ruleId:n});return this._http.authedRequest(i,"DELETE",r)},d.prototype.setPushRuleEnabled=function(e,t,n,i,r){const o=c.encodeUri("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:t,$ruleId:n});return this._http.authedRequest(r,"PUT",o,void 0,{enabled:i})},d.prototype.setPushRuleActions=function(e,t,n,i,r){const o=c.encodeUri("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:t,$ruleId:n});return this._http.authedRequest(r,"PUT",o,void 0,{actions:i})},d.prototype.search=function(e,t){const n={};return e.next_batch&&(n.next_batch=e.next_batch),this._http.authedRequest(t,"POST","/search",n,e.body)},d.prototype.uploadKeysRequest=function(e,t,n){return this._http.authedRequest(n,"POST","/keys/upload",void 0,e)},d.prototype.uploadKeySignatures=function(e){return this._http.authedRequest(void 0,"POST","/keys/signatures/upload",void 0,e,{prefix:l.PREFIX_UNSTABLE})},d.prototype.downloadKeysForUsers=function(e,t){if(c.isFunction(t))throw new Error("downloadKeysForUsers no longer accepts a callback parameter");t=t||{};const n={device_keys:{}};return"token"in t&&(n.token=t.token),e.forEach(e=>{n.device_keys[e]=[]}),this._http.authedRequest(void 0,"POST","/keys/query",void 0,n)},d.prototype.claimOneTimeKeys=function(e,t,n){const i={};void 0===t&&(t="signed_curve25519");for(let s=0;s<e.length;++s){const n=e[s][0],r=e[s][1],o=i[n]||{};i[n]=o,o[r]=t}const r={one_time_keys:i};n&&(r.timeout=n);const o="/keys/claim";return this._http.authedRequest(void 0,"POST",o,void 0,r)},d.prototype.getKeyChanges=function(e,t){const n={from:e,to:t},i="/keys/changes";return this._http.authedRequest(void 0,"GET",i,n,void 0)},d.prototype.uploadDeviceSigningKeys=function(e,t){const n=Object.assign({},t);return e&&Object.assign(n,{auth:e}),this._http.authedRequest(void 0,"POST","/keys/device_signing/upload",void 0,n,{prefix:l.PREFIX_UNSTABLE})},d.prototype.registerWithIdentityServer=function(e){if(!this.idBaseUrl)throw new Error("No Identity Server base URL set");const t=this.idBaseUrl+l.PREFIX_IDENTITY_V2+"/account/register";return this._http.requestOtherUrl(void 0,"POST",t,null,e)},d.prototype.requestEmailToken=function(){var e=i((function*(e,t,n,i,r,o){const s={client_secret:t,email:e,send_attempt:n,next_link:i};return yield this._http.idServerRequest(r,"POST","/validate/email/requestToken",s,l.PREFIX_IDENTITY_V2,o)}));return function(t,n,i,r,o,s){return e.apply(this,arguments)}}(),d.prototype.requestMsisdnToken=function(){var e=i((function*(e,t,n,i,r,o,s){const a={client_secret:n,country:e,phone_number:t,send_attempt:i,next_link:r};return yield this._http.idServerRequest(o,"POST","/validate/msisdn/requestToken",a,l.PREFIX_IDENTITY_V2,s)}));return function(t,n,i,r,o,s,a){return e.apply(this,arguments)}}(),d.prototype.submitMsisdnToken=function(){var e=i((function*(e,t,n,i){const r={sid:e,client_secret:t,token:n};return yield this._http.idServerRequest(void 0,"POST","/validate/msisdn/submitToken",r,l.PREFIX_IDENTITY_V2,i)}));return function(t,n,i,r){return e.apply(this,arguments)}}(),d.prototype.submitMsisdnTokenOtherUrl=function(e,t,n,i){const r={sid:t,client_secret:n,token:i};return this._http.requestOtherUrl(void 0,"POST",e,void 0,r)},d.prototype.getIdentityHashDetails=function(e){return this._http.idServerRequest(void 0,"GET","/hash_details",null,l.PREFIX_IDENTITY_V2,e)},d.prototype.identityHashedLookup=function(){var t=i((function*(t,n){const i={},r=yield this.getIdentityHashDetails(n);if(!r||!r["lookup_pepper"]||!r["algorithms"])throw new Error("Unsupported identity server: bad response");i["pepper"]=r["lookup_pepper"];const o={};if(r["algorithms"].includes("sha256")){const n=new e.Olm.Utility;i["addresses"]=t.map(e=>{const t=e[0].toLowerCase(),r=e[1].toLowerCase(),s=n.sha256(`${t} ${r} ${i["pepper"]}`).replace(/\+/g,"-").replace(/\//g,"_");return o[s]=e[0],s}),i["algorithm"]="sha256"}else{if(!r["algorithms"].includes("none"))throw new Error("Unsupported identity server: unknown hash algorithm");i["addresses"]=t.map(e=>{const t=e[0].toLowerCase(),n=e[1].toLowerCase(),i=`${t} ${n}`;return o[i]=e[0],i}),i["algorithm"]="none"}const s=yield this._http.idServerRequest(void 0,"POST","/lookup",i,l.PREFIX_IDENTITY_V2,n);if(!s||!s["mappings"])return[];const a=[];for(const e of Object.keys(s["mappings"])){const t=s["mappings"][e],n=o[e];if(!n)throw new Error("Identity server returned more results than expected");a.push({address:n,mxid:t})}return a}));return function(e,n){return t.apply(this,arguments)}}(),d.prototype.lookupThreePid=function(){var e=i((function*(e,t,n,i){const r=yield this.identityHashedLookup([[t,e]],i),o=r.find(e=>e.address===t);if(!o)return n&&n(null,{}),{};const s={address:t,medium:e,mxid:o.mxid};return n&&n(null,s),s}));return function(t,n,i,r){return e.apply(this,arguments)}}(),d.prototype.bulkLookupThreePids=function(){var e=i((function*(e,t){const n=yield this.identityHashedLookup(e.map(e=>[e[1],e[0]]),t),i=[];for(const r of n){const t=e.find(e=>e[1]===r.address);if(!t)throw new Error("Identity sever returned unexpected results");i.push([t[0],r.address,r.mxid])}return{threepids:i}}));return function(t,n){return e.apply(this,arguments)}}(),d.prototype.getIdentityAccount=function(e){return this._http.idServerRequest(void 0,"GET","/account",void 0,l.PREFIX_IDENTITY_V2,e)},d.prototype.sendToDevice=function(e,t,n){const i=c.encodeUri("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:n||this.makeTxnId()}),r={messages:t},o=Object.keys(t).reduce((e,n)=>(e[n]=Object.keys(t[n]),e),{});return s.logger.log("PUT "+i,o),this._http.authedRequest(void 0,"PUT",i,void 0,r)},d.prototype.getThirdpartyProtocols=function(){return this._http.authedRequest(void 0,"GET","/thirdparty/protocols",void 0,void 0).then(e=>{if(!e||"object"!==typeof e)throw new Error("/thirdparty/protocols did not return an object: "+e);return e})},d.prototype.getThirdpartyLocation=function(e,t){const n=c.encodeUri("/thirdparty/location/$protocol",{$protocol:e});return this._http.authedRequest(void 0,"GET",n,t,void 0)},d.prototype.getThirdpartyUser=function(e,t){const n=c.encodeUri("/thirdparty/user/$protocol",{$protocol:e});return this._http.authedRequest(void 0,"GET",n,t,void 0)},d.prototype.getTerms=function(e,t){const n=u(e,t);return this._http.requestOtherUrl(void 0,"GET",n)},d.prototype.agreeToTerms=function(e,t,n,i){const r=u(e,t),o={Authorization:"Bearer "+n};return this._http.requestOtherUrl(void 0,"POST",r,null,{user_accepts:i},{headers:o})},d.prototype.reportEvent=function(e,t,n,i){const r=c.encodeUri("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:t});return this._http.authedRequest(void 0,"POST",r,null,{score:n,reason:i})},d.prototype.getSpaceSummary=function(e,t,n,i,r,o){const s=c.encodeUri("/rooms/$roomId/spaces",{$roomId:e});return this._http.authedRequest(void 0,"POST",s,null,{max_rooms_per_space:t,suggested_only:n,auto_join_only:i,limit:r,batch:o},{prefix:"/_matrix/client/unstable/org.matrix.msc2946"})}}).call(this,n("c8ba"))},d136:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"chatsTopheader"}},[n("topheader",{scopedSlots:e._u([{key:"left",fn:function(){return[e.share?n("div",{staticClass:"iconbutton",on:{click:e.cancelShare}},[n("i",{staticClass:"fas fa-times"})]):e._e(),e.minimized&&!e.active||!e.pocketnet||e.share?e._e():n("div",{staticClass:"iconbutton",on:{click:e.minimizeall}},[n("i",{staticClass:"fas fa-times"})]),e.pocketnet||!e.mobile||e.share||e.isLocalStorageChatAuth?e._e():n("div",{staticClass:"iconbutton",on:{click:e.gotoapp}},[n("i",{staticClass:"fas fa-angle-left"})])]},proxy:!0},{key:"leftadd",fn:function(){},proxy:!0},{key:"info",fn:function(){return[e.recipients.length?n("div",{staticClass:"progress-mailing"},[n("div",{staticClass:"mailing-label"},[n("span",[e._v(" Mailing progress ")]),e.processMassMailing?e._e():n("i",{staticClass:"fa fa-play",on:{click:function(t){return e.resumeProcess()}}})]),n("progress",{attrs:{id:"mailing",max:e.recipientsTotal},domProps:{value:e.recipientsCompleted}},[e._v(" "+e._s(e.recipientsCompleted)+"% ")])]):e._e(),e.recipients.length||e.share?e._e():n("span",[e._v(e._s(e.$t("caption.chats")))]),!e.recipients.length&&e.share?n("span",[e._v(e._s(e.$t("caption.shareWith")))]):e._e()]},proxy:!0},{key:"rightadd",fn:function(){return[!e.share&&e.pocketnet?n("div",{staticClass:"chatSettingsButton",on:{click:function(t){return e.gotona("settings")}}},[n("div",{staticClass:"iconbuttonsmall"},[n("i",{staticClass:"fas fa-cog"})])]):e._e()]},proxy:!0},{key:"right",fn:function(){return[e.share||e.minimized&&!e.active?n("div",[e.window.cordova?n("div",{staticClass:"iconbutton",on:{click:e.cordovashare}},[n("i",{staticClass:"fas fa-share-alt"})]):e._e()]):n("div",{staticClass:"iconbutton",on:{click:e.newchat}},[n("i",{staticClass:"fas fa-plus"})])]},proxy:!0}])})],1)},r=[],o=n("2f62"),s=n("71da"),a={name:"chatsTopheader",props:{},components:{contacts:s["a"]},data:function(){return{loading:!1,newchatopened:!1,createGroup:!1,contacts:!1,isLocalStorageChatAuth:this.$store.state.isLocalStorageChatAuth}},created(){this.$store.commit("SET_CURRENT_ROOM","all")},destroyed(){this.$store.commit("SET_CURRENT_ROOM",!1)},watch:{},computed:Object(o["c"])({auth:e=>e.auth,minimized:e=>e.minimized,pocketnet:e=>e.pocketnet,mobile:e=>e.mobile,active:e=>e.active,...Object(o["c"])(["share","closebybg","recipients","recipientsTotal","processMassMailing"]),window:function(){return window},recipientsCompleted(){return this.recipientsTotal-this.recipients.length}}),methods:{resumeProcess:function(){const e=JSON.parse(localStorage.getItem("chat_mass_message")||"{}");console.log("chatMassMessage",e),this.$emit("sendMassMessage",e)},changeCloseByBg:function(){this.$store.commit("closebybg",!this.closebybg)},gotoapp:function(){this.core.backtoapp&&this.core.backtoapp()},cordovashare:function(){var e=this.share,t={};e.messages&&(t.message=e.messages.join(". ")),(e.images||e.files)&&(t.files=[].concat(e.images,e.files),t.files=_.filter(t.files,(function(e){return e}))),window.plugins&&window.plugins.socialsharing&&window.plugins.socialsharing.shareWithOptions(t),this.cancelShare()},cancelShare:function(){this.share&&this.share.route&&this.$router.push(this.share.route).catch(e=>{}),this.$store.commit("SHARE",null)},newchatmenu:function(){this.newchatopened=!this.newchatopened},minimizeall:function(){this.$store.commit("minimize",!0)},newchat:function(){this.$emit("newchat")},gotona(e){this.$router.push({path:this.$router.path,query:{...this.$route.query,page:e}})}}},c=a,l=(n("12df"),n("2877")),u=Object(l["a"])(c,i,r,!1,null,"6a54a7f6",null);t["a"]=u.exports},d15f:function(e,t,n){"use strict";var i=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.Group=s;var r=i(n("3987")),o=n("faa1");function s(e){this.groupId=e,this.name=null,this.avatarUrl=null,this.myMembership=null,this.inviter=null}r.inherits(s,o.EventEmitter),s.prototype.setProfile=function(e,t){this.name===e&&this.avatarUrl===t||(this.name=e||this.groupId,this.avatarUrl=t,this.emit("Group.profile",this))},s.prototype.setMyMembership=function(e){this.myMembership!==e&&(this.myMembership=e,this.emit("Group.myMembership",this))},s.prototype.setInviter=function(e){this.inviter=e}},d3ff:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active,isBlocked:e.blocked},attrs:{id:"contact"}},[n("div",{staticClass:"viewWrapper"},[n("div",{staticClass:"uviewwr"},[n("userView",{attrs:{userinfo:e.contact,blocked:e.blocked}})],1)]),e.contact.id!==e.activeuser.id?n("div",{staticClass:"actionsWrapper"},[n("contactActions",{attrs:{contact:e.contact,blocked:e.blocked}})],1):n("div",{staticClass:"actionsWrapper"},[n("div",{staticClass:"youw"},[e._v(" It is you ")])])])},r=[],o=n("2f62"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"contactView"}},[n("div",{staticClass:"imageWrapper"},[n("userpic",{attrs:{userinfo:e.contact}})],1),n("div",{staticClass:"nameWrapper"},[n("span",[e._v(e._s(e.contact.name))])])])},a=[],c={name:"contactView",props:{contact:Object},data:function(){return{loading:!1}},created:()=>{},watch:{},computed:Object(o["c"])({auth:e=>e.auth}),methods:{}},l=c,u=(n("d5de"),n("2877")),d=Object(u["a"])(l,s,a,!1,null,"756bd822",null),h=d.exports,m=n("42cd"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"contactActions"}},[n("div",{staticClass:"actions"},[e.tetatetid?n("div",{staticClass:"actionWrapper"},[e.blocked?e._e():n("router-link",{attrs:{to:"chat?id="+e.tetatetid+"&u="+e.contact.id}},[0!==e.readyChat.length?n("button",{staticClass:"button bright rounded small"},[e._v(e._s(e.$t("caption.moveToChat"))+" "),n("i",{staticClass:"far fa-comment-alt"})]):n("button",{staticClass:"button bright rounded small"},[e._v(e._s(e.$t("button.starChatButton"))),n("i",{staticClass:"far fa-comment-alt"})])])],1):e._e(),e.blocked?n("button",{staticClass:"unBlockButton",on:{click:function(t){return e.unblock()}}},[e._v(e._s(e.$t("button.unblock")))]):n("button",{staticClass:"blockButton",on:{click:function(t){return e.blockUser()}}},[e._v(e._s(e.$t("button.blockUser")))])])])},f=[],g={name:"contactActions",props:{contact:Object,blocked:Boolean},data:function(){return{loading:!1}},created:()=>{},watch:{},computed:Object(o["c"])({auth:e=>e.auth,tetatetid:function(){return this.core.mtrx.kit.tetatetid(this.contact,this.core.user.userinfo)},readyChat:function(){var e=this.$store.state.chats,t=this.tetatetid;return _.filter(e,e=>e.info.title.replace(/#/,"")===t)}}),methods:{chat:function(){this.core.mtrx.kit.tetatetid(this.contact,this.core.user.userinfo)},blockUser(){this.core.mtrx.blockUser(this.contact.id).catch(e=>{console.error(e)})},unblock(){this.core.mtrx.unblockUser(this.contact.id).catch(e=>{console.error(e)})}}},v=g,y=(n("9205"),Object(u["a"])(v,p,f,!1,null,"6fd14ec6",null)),b=y.exports,E={name:"contact",props:{contact:Object},components:{contactView:h,contactActions:b,userView:m["a"]},data:function(){return{loading:!1}},created:()=>{},watch:{},mounted(){this.$store.commit("active",!0),this.$store.commit("blockactive",{value:!0,item:"contact"})},destroyed(){this.$store.commit("blockactive",{value:!1,item:"contact"})},computed:Object(o["c"])({auth:e=>e.auth,activeuser:function(){return this.core.user.userinfo},blocked:function(){if(0!==this.$store.state.chats.length)return this.core.mtrx.blockeduser(this.contact.id)},pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active}),methods:{}},S=E,w=(n("81bf"),Object(u["a"])(S,i,r,!1,null,"7650772c",null));t["default"]=w.exports},d591:function(e,t,n){},d5de:function(e,t,n){"use strict";n("cdb2")},d613:function(e,t,n){"use strict";let i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.RoomType=t.RoomCreateTypeField=t.MsgType=t.EventType=void 0,t.EventType=i,function(e){e["RoomCanonicalAlias"]="m.room.canonical_alias",e["RoomCreate"]="m.room.create",e["RoomJoinRules"]="m.room.join_rules",e["RoomMember"]="m.room.member",e["RoomThirdPartyInvite"]="m.room.third_party_invite",e["RoomPowerLevels"]="m.room.power_levels",e["RoomName"]="m.room.name",e["RoomTopic"]="m.room.topic",e["RoomAvatar"]="m.room.avatar",e["RoomPinnedEvents"]="m.room.pinned_events",e["RoomEncryption"]="m.room.encryption",e["RoomHistoryVisibility"]="m.room.history_visibility",e["RoomGuestAccess"]="m.room.guest_access",e["RoomServerAcl"]="m.room.server_acl",e["RoomTombstone"]="m.room.tombstone",e["RoomAliases"]="m.room.aliases",e["SpaceChild"]="org.matrix.msc1772.space.child",e["SpaceParent"]="org.matrix.msc1772.space.parent",e["RoomRedaction"]="m.room.redaction",e["RoomMessage"]="m.room.message",e["RoomMessageEncrypted"]="m.room.encrypted",e["Sticker"]="m.sticker",e["CallInvite"]="m.call.invite",e["CallCandidates"]="m.call.candidates",e["CallAnswer"]="m.call.answer",e["CallHangup"]="m.call.hangup",e["CallReject"]="m.call.reject",e["CallSelectAnswer"]="m.call.select_answer",e["CallNegotiate"]="m.call.negotiate",e["CallReplaces"]="m.call.replaces",e["KeyVerificationRequest"]="m.key.verification.request",e["KeyVerificationStart"]="m.key.verification.start",e["KeyVerificationCancel"]="m.key.verification.cancel",e["KeyVerificationMac"]="m.key.verification.mac",e["KeyVerificationDone"]="m.key.verification.done",e["RoomMessageFeedback"]="m.room.message.feedback",e["Typing"]="m.typing",e["Receipt"]="m.receipt",e["Presence"]="m.presence",e["FullyRead"]="m.fully_read",e["Tag"]="m.tag",e["PushRules"]="m.push_rules",e["Direct"]="m.direct",e["IgnoredUserList"]="m.ignored_user_list",e["RoomKey"]="m.room_key",e["RoomKeyRequest"]="m.room_key_request",e["ForwardedRoomKey"]="m.forwarded_room_key",e["Dummy"]="m.dummy"}(i||(t.EventType=i={})),t.MsgType=r,function(e){e["Text"]="m.text",e["Emote"]="m.emote",e["Notice"]="m.notice",e["Image"]="m.image",e["File"]="m.file",e["Audio"]="m.audio",e["Location"]="m.location",e["Video"]="m.video"}(r||(t.MsgType=r={}));const o="org.matrix.msc1772.type";let s;t.RoomCreateTypeField=o,t.RoomType=s,function(e){e["Space"]="org.matrix.msc1772.space"}(s||(t.RoomType=s={}))},d61d:function(e,t,n){},d6cc:function(e,t,n){"use strict";n("dc68")},d74d:function(e,t,n){},d854:function(e,t,n){"use strict";n.r(t),n.d(t,"error",(function(){return r})),n.d(t,"byError",(function(){return o}));var i={500:"networkerror",401:"unauthorized",511:"needcredentials",527:"emptyresponse",600:"Wrong token",601:"Can not login",602:"Empty response"};function r(e,t){return{code:e,error:t||i[e]||"undefined",isError:!0}}function o(e){if(!e)return null;var t=_.findKey(i,t=>t==e);return t?r(t):e}},d936:function(e,t,n){},da9d:function(e,t,n){"use strict";n("d9e2"),Object.defineProperty(t,"__esModule",{value:!0}),t.TimelineWindow=c,t.TimelineIndex=l;var i=n("e685"),r=n("63c7");const o=!1,s=o?r.logger.log.bind(r.logger):function(){},a=5;function c(e,t,n){n=n||{},this._client=e,this._timelineSet=t,this._start=null,this._end=null,this._eventCount=0,this._windowLimit=n.windowLimit||1e3}function l(e,t){this.timeline=e,this.index=t}c.prototype.load=function(e,t){const n=this;t=t||20;const i=function(i){let r;const o=i.getEvents();if(e){for(let t=0;t<o.length;t++)if(o[t].getId()==e){r=t;break}if(void 0===r)throw new Error("getEventTimeline result didn't include requested event")}else r=o.length;const s=Math.min(o.length,r+Math.ceil(t/2)),a=Math.max(0,s-t);n._start=new l(i,a-i.getBaseIndex()),n._end=new l(i,s-i.getBaseIndex()),n._eventCount=s-a};if(e){const t=this._timelineSet.getTimelineForEvent(e);if(t)return i(t),Promise.resolve(t);const n=this._client.getEventTimeline(this._timelineSet,e);return n.then(i)}{const e=this._timelineSet.getLiveTimeline();return i(e),Promise.resolve()}},c.prototype.getTimelineIndex=function(e){if(e==i.EventTimeline.BACKWARDS)return this._start;if(e==i.EventTimeline.FORWARDS)return this._end;throw new Error("Invalid direction '"+e+"'")},c.prototype.extend=function(e,t){const n=this.getTimelineIndex(e);if(!n)return s("TimelineWindow: no timeline yet"),!1;const r=e==i.EventTimeline.BACKWARDS?n.retreat(t):n.advance(t);if(r){this._eventCount+=r,s("TimelineWindow: increased cap by "+r+" (now "+this._eventCount+")");const t=this._eventCount-this._windowLimit;return t>0&&this.unpaginate(t,e!=i.EventTimeline.BACKWARDS),!0}return!1},c.prototype.canPaginate=function(e){const t=this.getTimelineIndex(e);if(!t)return s("TimelineWindow: no timeline yet"),!1;if(e==i.EventTimeline.BACKWARDS){if(t.index>t.minIndex())return!0}else if(t.index<t.maxIndex())return!0;return Boolean(t.timeline.getNeighbouringTimeline(e)||t.timeline.getPaginationToken(e))},c.prototype.paginate=function(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=a);const o=this.getTimelineIndex(e);if(!o)return s("TimelineWindow: no timeline yet"),Promise.resolve(!1);if(o.pendingPaginate)return o.pendingPaginate;if(this.extend(e,t))return Promise.resolve(!0);if(!n||0===r)return Promise.resolve(!1);const c=o.timeline.getPaginationToken(e);if(!c)return s("TimelineWindow: no token"),Promise.resolve(!1);s("TimelineWindow: starting request");const l=this,u=this._client.paginateEventTimeline(o.timeline,{backwards:e==i.EventTimeline.BACKWARDS,limit:t}).finally((function(){o.pendingPaginate=null})).then((function(n){return s("TimelineWindow: request completed with result "+n),!!n&&l.paginate(e,t,!0,r-1)}));return o.pendingPaginate=u,u},c.prototype.unpaginate=function(e,t){const n=t?this._start:this._end;if(e>this._eventCount||e<0)throw new Error("Attemting to unpaginate "+e+" events, but only have "+this._eventCount+" in the timeline");while(e>0){const i=t?n.advance(e):n.retreat(e);if(i<=0)throw new Error("Unable to unpaginate any further, but still have "+this._eventCount+" events");e-=i,this._eventCount-=i,s("TimelineWindow.unpaginate: dropped "+i+" (now "+this._eventCount+")")}},c.prototype.getEvents=function(){if(!this._start)return[];const e=[];let t=this._start.timeline;while(1){const n=t.getEvents();let r=0,o=n.length;t===this._start.timeline&&(r=this._start.index+t.getBaseIndex()),t===this._end.timeline&&(o=this._end.index+t.getBaseIndex());for(let t=r;t<o;t++)e.push(n[t]);if(t===this._end.timeline)break;t=t.getNeighbouringTimeline(i.EventTimeline.FORWARDS)}return e},l.prototype.minIndex=function(){return-1*this.timeline.getBaseIndex()},l.prototype.maxIndex=function(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()},l.prototype.advance=function(e){if(!e)return 0;let t;if(e<0){if(t=Math.max(e,this.minIndex()-this.index),t<0)return this.index+=t,t}else if(t=Math.min(e,this.maxIndex()-this.index),t>0)return this.index+=t,t;const n=this.timeline.getNeighbouringTimeline(e<0?i.EventTimeline.BACKWARDS:i.EventTimeline.FORWARDS);return n?(this.timeline=n,this.index=e<0?this.maxIndex():this.minIndex(),s("paginate: switched to new neighbour"),this.advance(e)):0},l.prototype.retreat=function(e){return-1*this.advance(-1*e)}},dc68:function(e,t,n){},dd5f:function(t,n,i){"use strict";var r=i("c973").default;i("d9e2");var o=i("dbce"),s=i("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.InteractiveAuth=h;var a=s(i("0b16")),c=o(i("3987")),l=i("63c7");const u="m.login.email.identity",d="m.login.msisdn";function h(e){this._matrixClient=e.matrixClient,this._data=e.authData||{},this._requestCallback=e.doRequest,this._busyChangedCallback=e.busyChanged,this._stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this._resolveFunc=null,this._rejectFunc=null,this._inputs=e.inputs||{},this._requestEmailTokenCallback=e.requestEmailToken,e.sessionId&&(this._data.session=e.sessionId),this._clientSecret=e.clientSecret||this._matrixClient.generateClientSecret(),this._emailSid=e.emailSid,void 0===this._emailSid&&(this._emailSid=null),this._requestingEmailToken=!1,this._chosenFlow=null,this._currentStage=null,this._submitPromise=null}h.prototype={attemptAuth:function(){return new Promise((e,t)=>{this._resolveFunc=e,this._rejectFunc=t;const n=this._data&&this._data.flows;if(n)this._startNextAuthStage();else{this._busyChangedCallback&&this._busyChangedCallback(!0);let e=null;this._data.session&&(e={session:this._data.session}),this._doRequest(e).finally(()=>{this._busyChangedCallback&&this._busyChangedCallback(!1)})}})},poll:function(){var e=r((function*(){if(!this._data.session)return;if(!this._resolveFunc)return;if(this._submitPromise)return;let e={};if(this._currentStage==u&&this._emailSid){const t={sid:this._emailSid,client_secret:this._clientSecret};if(yield this._matrixClient.doesServerRequireIdServerParam()){const e=a.default.parse(this._matrixClient.getIdentityServerUrl());t.id_server=e.host}e={type:u,threepid_creds:t,threepidCreds:t}}this.submitAuthDict(e,!0)}));return function(){return e.apply(this,arguments)}}(),getSessionId:function(){return this._data?this._data.session:void 0},getClientSecret:function(){return this._clientSecret},getStageParams:function(e){let t={};return this._data&&this._data.params&&(t=this._data.params),t[e]},getChosenFlow(){return this._chosenFlow},submitAuthDict:function(){var t=r((function*(t,n){if(!this._resolveFunc)throw new Error("submitAuthDict() called before attemptAuth()");!n&&this._busyChangedCallback&&this._busyChangedCallback(!0);while(this._submitPromise)try{yield this._submitPromise}catch(e){}let i;this._data.session?(i={session:this._data.session},c.extend(i,t)):i=t;try{this._submitPromise=this._doRequest(i,n),yield this._submitPromise}finally{this._submitPromise=null,!n&&this._busyChangedCallback&&this._busyChangedCallback(!1)}}));return function(e,n){return t.apply(this,arguments)}}(),getEmailSid:function(){return this._emailSid},setEmailSid:function(e){this._emailSid=e},_doRequest:function(){var t=r((function*(t,n){try{const e=yield this._requestCallback(t,n);this._resolveFunc(e),this._resolveFunc=null,this._rejectFunc=null}catch(i){const t=i.data?i.data.flows:null,r=this._data.flows||Boolean(t);401===i.httpStatus&&i.data&&r||(n?l.logger.log("Background poll request failed doing UI auth: ignoring",i):this._rejectFunc(i)),i.data.flows||i.data.completed||i.data.session||(i.data.flows=this._data.flows,i.data.completed=this._data.completed,i.data.session=this._data.session),this._data=i.data;try{this._startNextAuthStage()}catch(e){this._rejectFunc(e),this._resolveFunc=null,this._rejectFunc=null}if(!this._emailSid&&!this._requestingEmailToken&&this._chosenFlow.stages.includes("m.login.email.identity")){this._requestingEmailToken=!0;try{const e=yield this._requestEmailTokenCallback(this._inputs.emailAddress,this._clientSecret,1,this._data.session);this._emailSid=e.sid}catch(e){this._rejectFunc(e),this._resolveFunc=null,this._rejectFunc=null}finally{this._requestingEmailToken=!1}}}}));return function(e,n){return t.apply(this,arguments)}}(),_startNextAuthStage:function(){const e=this._chooseStage();if(!e)throw new Error("No incomplete flows from the server");if(this._currentStage=e,"m.login.dummy"===e)return void this.submitAuthDict({type:"m.login.dummy"});if(this._data&&this._data.errcode||this._data.error)return void this._stateUpdatedCallback(e,{errcode:this._data.errcode||"",error:this._data.error||""});const t={};e==u&&(t.emailSid=this._emailSid),this._stateUpdatedCallback(e,t)},_chooseStage:function(){null===this._chosenFlow&&(this._chosenFlow=this._chooseFlow()),l.logger.log("Active flow => %s",JSON.stringify(this._chosenFlow));const e=this._firstUncompletedStage(this._chosenFlow);return l.logger.log("Next stage: %s",e),e},_chooseFlow:function(){const e=this._data.flows||[],t=Boolean(this._inputs.emailAddress)||Boolean(this._emailSid),n=Boolean(this._inputs.phoneCountry)&&Boolean(this._inputs.phoneNumber);for(const r of e){let e=!1,i=!1;for(const t of r.stages)t===u?e=!0:t==d&&(i=!0);if(e==t&&i==n)return r}const i=new Error("No appropriate authentication flow found");throw i.name="NoAuthFlowFoundError",i.required_stages=[],t&&i.required_stages.push(u),n&&i.required_stages.push(d),i.available_flows=e,i},_firstUncompletedStage:function(e){const t=(this._data||{}).completed||[];for(let n=0;n<e.stages.length;++n){const i=e.stages[n];if(-1===t.indexOf(i))return i}}}},de56:function(e,t,n){"use strict";n("9d78")},df31:function(e,t,n){},e072:function(e,t,n){},e281:function(e,t,n){"use strict";n("3b0a")},e296:function(e,t,n){},e2ff:function(e,t,n){},e3c0:function(e,t,n){},e53f:function(e,t,n){},e619:function(e,t,n){"use strict";n("0e7d")},e685:function(e,t,n){"use strict";n("d9e2"),Object.defineProperty(t,"__esModule",{value:!0}),t.EventTimeline=r;var i=n("420b");function r(e){this._eventTimelineSet=e,this._roomId=e.room?e.room.roomId:null,this._events=[],this._baseIndex=0,this._startState=new i.RoomState(this._roomId),this._startState.paginationToken=null,this._endState=new i.RoomState(this._roomId),this._endState.paginationToken=null,this._prevTimeline=null,this._nextTimeline=null,this._paginationRequests={b:null,f:null},this._name=this._roomId+":"+(new Date).toISOString()}r.BACKWARDS="b",r.FORWARDS="f",r.prototype.initialiseState=function(e){if(this._events.length>0)throw new Error("Cannot initialise state after events are added");for(const t of e)Object.freeze(t);this._startState.setStateEvents(e),this._endState.setStateEvents(e)},r.prototype.forkLive=function(e){const t=this.getState(e),n=new r(this._eventTimelineSet);return n._startState=t.clone(),n._endState=t,this._endState=t.clone(),n},r.prototype.fork=function(e){const t=this.getState(e),n=new r(this._eventTimelineSet);return n._startState=t.clone(),n._endState=t.clone(),n},r.prototype.getRoomId=function(){return this._roomId},r.prototype.getFilter=function(){return this._eventTimelineSet.getFilter()},r.prototype.getTimelineSet=function(){return this._eventTimelineSet},r.prototype.getBaseIndex=function(){return this._baseIndex},r.prototype.getEvents=function(){return this._events},r.prototype.getState=function(e){if(e==r.BACKWARDS)return this._startState;if(e==r.FORWARDS)return this._endState;throw new Error("Invalid direction '"+e+"'")},r.prototype.getPaginationToken=function(e){return this.getState(e).paginationToken},r.prototype.setPaginationToken=function(e,t){this.getState(t).paginationToken=e},r.prototype.getNeighbouringTimeline=function(e){if(e==r.BACKWARDS)return this._prevTimeline;if(e==r.FORWARDS)return this._nextTimeline;throw new Error("Invalid direction '"+e+"'")},r.prototype.setNeighbouringTimeline=function(e,t){if(this.getNeighbouringTimeline(t))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+t+")");if(t==r.BACKWARDS)this._prevTimeline=e;else{if(t!=r.FORWARDS)throw new Error("Invalid direction '"+t+"'");this._nextTimeline=e}this.setPaginationToken(null,t)},r.prototype.addEvent=function(e,t){const n=t?this._startState:this._endState,i=this.getTimelineSet();let o;i.room&&i.room.getUnfilteredTimelineSet()===i&&(r.setEventMetadata(e,n,t),e.isState()&&(n.setStateEvents([e]),e.sender&&("m.room.member"!==e.getType()||t)||r.setEventMetadata(e,n,t))),o=t?0:this._events.length,this._events.splice(o,0,e),t&&this._baseIndex++},r.setEventMetadata=function(e,t,n){e.sender=t.getSentinelMember(e.getSender()),"m.room.member"===e.getType()&&(e.target=t.getSentinelMember(e.getStateKey())),e.isState()&&n&&(e.forwardLooking=!1)},r.prototype.removeEvent=function(e){for(let t=this._events.length-1;t>=0;t--){const n=this._events[t];if(n.getId()==e)return this._events.splice(t,1),t<this._baseIndex&&this._baseIndex--,n}return null},r.prototype.toString=function(){return this._name}},e7f6:function(t,n,i){"use strict";(function(t){var r=i("ade3"),o=i("4f5a"),s=i("3139");class a extends o["a"]{constructor(){super(...arguments),Object(r["a"])(this,"matrixCredentials",(function(){var e=bitcoin.crypto.sha256(bitcoin.crypto.sha256(t.from(this.credentials.privateKey))).toString("hex");return Promise.resolve({address:this.credentials.address,password:e,type:"m.login.password",user:this.credentials.address,sessionId:"",username:this.credentials.address.toLowerCase()})})),Object(r["a"])(this,"path33",(function(e){return"m/33'/0'/0'/"+e+"'"}))}initKeysProcess(){return this.initKeys().catch(e=>e&&_.isNumber(e)?new Promise((t,n)=>{this.keysupdatetimeout&&clearTimeout(this.keysupdatetimeout),this.keysupdatetimeout=setTimeout((function(){initKeysProcess().then(t).catch(n)}),e)}):Promise.reject(e))}initKeys(){return this.state?!this.userinfo.name||this.userinfo.deleted||this.userinfo.keys&&this.userinfo.keys.length?Promise.resolve():(window.POCKETNETINSTANCE&&window.POCKETNETINSTANCE.platform.sdk.keys.init().then(e=>"exist"==e||"processing"==e?Promise.reject(6e4):Promise.reject(e)).catch(e=>Promise.reject()),Promise.reject()):Promise.reject()}generateKeysLS(t,n){var i={};try{i=JSON.parse(localStorage["wifkeya"]||"{}")}catch(e){}i.address!=n&&(i={}),i.address=n,i.storage||(i.storage=[]);var{ckeys:r}=this.generateKeys(t,i.storage);return localStorage["wifkeya"]=JSON.stringify(i),r}generateKeys(e,t){var n=[];if(t||(t=[]),e)for(var i=1;i<13;i++){var r=t[i-1]||bitcoin.bip32.fromSeed(e).derivePath(this.path33(i)).toWIF();t[i-1]=r;var o=bitcoin.ECPair.fromWIF(r);n.push({pair:o,public:o.publicKey.toString("hex"),private:o.privateKey})}return{ckeys:n,storage:t}}generateprivate(){}checkCredentials(){if(!this.credentials)return Promise.reject("unauthorized");var n=s["a"].hexDecode(this.credentials.address);try{var i=t.from(this.credentials.privateKey,"hex");setTimeout(()=>{this.private=this.generateKeysLS(i,n)},1e3)}catch(e){return this.state=0,Promise.reject("unauthorized")}return this.core.api.pocketnet.userStateMe(n).then(e=>(this.state=1,Promise.resolve(this.state))).catch(e=>Promise.reject("unknown"))}convertUser(e){return{image:e.i||"",name:e.name?decodeURI(e.name):"",id:s["a"].hexEncode(e.address),source:e,keys:_.filter((e.k||"").split(","),(function(e){return e})),deleted:e.deleted,nocache:e.nocache||!1}}searchContacts(e){this.core;return this.core.api.pocketnet.search(e).then(e=>(e=_.map(e,e=>(e.nocache=!0,this.convertUser(e))),this.setUsersInfo(e),Promise.resolve(e)))}userInfo(e){return this.usersInfo(this.credentials.address,!1,e).then(e=>(this.userinfo=e[0],Promise.resolve(e[0])))}usersInfo(e,t,n,i){return _.isArray(e)||(e=[e]),t||(e=_.map(e,(function(e){return s["a"].hexDecode(e)}))),this.core.api.pocketnet.userInfoCached(e,n,i).then(e=>(e=_.map(e,e=>this.convertUser(e)),this.setUsersInfo(e,n),Promise.resolve(e)))}signature(n,i){n||(n="pocketnetproxy"),i||(i=360);try{var r=bitcoin.ECPair.fromPrivateKey(t.from(this.credentials.privateKey,"hex"));const e=(new Date).toISOString();var o="date="+e+",exp="+i+",s="+s["a"].hexEncode(n),a=r.sign(bitcoin.crypto.sha256(t.from(o))),c={nonce:o,signature:a.toString("hex"),pubkey:r.publicKey.toString("hex"),address:this.credentials.address,v:1}}catch(e){return null}return c}getContacts(){return this.state?Promise.resolve([]):Promise.reject("unauthorized")}}n["a"]=a}).call(this,i("b639").Buffer)},eb25:function(t,n,i){"use strict";i("d9e2");var r=i("dbce");Object.defineProperty(n,"__esModule",{value:!0}),n.WebStorageSessionStore=l;var o=r(i("3987")),s=i("63c7");const a=!1,c="session.e2e.";function l(e){if(this.store=e,!o.isFunction(e.getItem)||!o.isFunction(e.setItem)||!o.isFunction(e.removeItem)||!o.isFunction(e.key)||"number"!==typeof e.length)throw new Error("Supplied webStore does not meet the WebStorage API interface")}l.prototype={removeEndToEndAccount:function(){this.store.removeItem(u)},getEndToEndAccount:function(){return this.store.getItem(u)},getAllEndToEndDevices:function(){const e=p(""),t={};for(let n=0;n<this.store.length;++n){const i=this.store.key(n),r=i.substr(e.length);i.startsWith(e)&&(t[r]=y(this.store,i))}return t},getEndToEndDeviceTrackingStatus:function(){return y(this.store,h)},getEndToEndDeviceSyncToken:function(){return y(this.store,d)},removeEndToEndDeviceData:function(){b(this.store,p("")),b(this.store,h),b(this.store,d)},getEndToEndSessions:function(e){return y(this.store,f(e))},getAllEndToEndSessions:function(){const e=_(this.store,f("")),t={};for(const n of e){const e=n.substr(f("").length);t[e]=y(this.store,n)}return t},removeAllEndToEndSessions:function(){b(this.store,f(""))},getAllEndToEndInboundGroupSessionKeys:function(){const e=c+"inboundgroupsessions/",t=[];for(let n=0;n<this.store.length;n++){const i=this.store.key(n);i.startsWith(e)&&t.push({senderKey:i.substr(e.length,43),sessionId:i.substr(e.length+44)})}return t},getEndToEndInboundGroupSession:function(e,t){const n=g(e,t);return this.store.getItem(n)},removeAllEndToEndInboundGroupSessions:function(){b(this.store,c+"inboundgroupsessions/")},getAllEndToEndRooms:function(){const e=_(this.store,v("")),t={};for(const n of e){const e=n.substr(v("").length);t[e]=y(this.store,n)}return t},removeAllEndToEndRooms:function(){b(this.store,v(""))},setLocalTrustedBackupPubKey:function(e){this.store.setItem(m,e)},getLocalTrustedBackupPubKey:function(){return this.store.getItem(m)}};const u=c+"account",d=c+"device_sync_token",h=c+"device_tracking",m=c+"trusted_backup_pubkey";function p(e){return c+"devices/"+e}function f(e){return c+"sessions/"+e}function g(e,t){return c+"inboundgroupsessions/"+e+"/"+t}function v(e){return c+"rooms/"+e}function y(t,n){try{return JSON.parse(t.getItem(n))}catch(e){E("Failed to get key %s: %s",n,e),E(e.stack)}return null}function _(e,t){const n=[];for(let i=0;i<e.length;++i){const r=e.key(i);r.startsWith(t)&&n.push(r)}return n}function b(e,t){const n=[];for(let i=0;i<e.length;++i){const r=e.key(i);r.startsWith(t)&&n.push(r)}for(const i of n)e.removeItem(i)}function E(){a&&s.logger.log(...arguments)}},ebaa:function(e,t,n){"use strict";var i=n("3139"),r=function(e){var t=this,n=!1,i=null;t.focus=!0,t.clbks={resume:{},pause:{}},window.focus();var r=function(n,r){var o=e.currentTime(),s=o-(i||o);t.focus=!0,_.each(t.clbks.resume,(function(e){e(s)})),t.titleManager&&t.titleManager.clear()},o=function(){t.focus=!1,i=e.currentTime(),_.each(t.clbks.pause,(function(e){e()}))};return t.init=function(){if(n=!0,window.cordova)return document.addEventListener("pause",o,!1),void document.addEventListener("resume",r,!1);window.addEventListener("blur",o),window.addEventListener("focus",r)},t.destroy=function(){if(t.clbk={resume:{},pause:{}},n){if(window.cordova)return document.removeEventListener("pause",o,!1),void document.removeEventListener("resume",r,!1);window.removeEventListener("blur",o),window.removeEventListener("focus",r),n=!1}},t},o=function(e){var t=this,n=null;return t.online=i["a"].deep(window,"navigator.onLine"),t.clbks={online:{},offline:{}},t.online||e.currentTime(),t.init=function(){},t.destroy=function(){n&&(clearInterval(n),n=null),t.clbks={online:{},offline:{}}},t};t["a"]={focus:r,online:o}},ecec:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.userinfo.length>1?n("div",{staticClass:"aboutRoomAvatar"},[e.userinfo.length<5?n("div",{staticClass:"small"},[n("div",{staticClass:"userinfopicwrapper",class:{twoAvatars:2===e.userinfo.length,threeAvatars:3===e.userinfo.length,fourAvatars:4===e.userinfo.length}},e._l(e.userinfo,(function(t,i){return n("div",{staticClass:"userwrapper"},[n("userpic",{attrs:{status:e.status[t.id],userinfo:t}})],1)})),0)]):n("div",{staticClass:"swiperWrapper"},[n("div",{staticClass:"swiperWrapperFlex noswipepnt"},e._l(e.userinfo,(function(t,i){return n("div",{staticClass:"imageSwiper"},[n("userpic",{attrs:{status:e.status[t.id],userinfo:t}})],1)})),0)])]):e._e()},r=[],o={props:{userinfo:Array,slidesPerView:Number,status:{type:Object,default:{}}},data:function(){return{}}},s=o,a=(n("1570"),n("2877")),c=Object(a["a"])(s,i,r,!1,null,"71d5e826",null);t["a"]=c.exports},ed03:function(t,n,i){"use strict";(function(t){var r=i("c973").default;i("d9e2");var o=i("dbce");Object.defineProperty(n,"__esModule",{value:!0}),n.IndexedDBStore=f;var s=i("696c"),a=o(i("3987")),c=i("faa1"),l=i("9e54"),u=i("0b9e"),d=i("87d6"),h=i("a120"),m=i("63c7");const p=3e5;function f(e){if(s.MemoryStore.call(this,e),!e.indexedDB)throw new Error("Missing required option: indexedDB");if(e.workerScript){let n=e.workerApi;n||(n=t.Worker),this.backend=new u.RemoteIndexedDBStoreBackend(e.workerScript,e.dbName,n)}else this.backend=new l.LocalIndexedDBStoreBackend(e.indexedDB,e.dbName);this.startedUp=!1,this._syncTs=0,this._userModifiedMap={}}function g(t,n){return r((function*(){for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];try{return yield t.call(this,...r)}catch(e){m.logger.error("IndexedDBStore failure, degrading to MemoryStore",e),this.emit("degraded",e);try{m.logger.log("IndexedDBStore trying to delete degraded data"),yield this.backend.clearDatabase(),m.logger.log("IndexedDBStore delete after degrading succeeeded")}catch(e){m.logger.warn("IndexedDBStore delete after degrading failed",e)}if(Object.setPrototypeOf(this,s.MemoryStore.prototype),n)return yield s.MemoryStore.prototype[n].call(this,...r)}}))}a.inherits(f,s.MemoryStore),a.extend(f.prototype,c.EventEmitter.prototype),f.exists=function(e,t){return l.LocalIndexedDBStoreBackend.exists(e,t)},f.prototype.startup=function(){return this.startedUp?(m.logger.log("IndexedDBStore.startup: already started"),Promise.resolve()):(m.logger.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect().then(()=>(m.logger.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{m.logger.log("IndexedDBStore.startup: processing presence events"),e.forEach(e=>{let[t,n]=e;const i=new d.User(t);n&&i.setPresenceEvent(new h.MatrixEvent(n)),this._userModifiedMap[i.userId]=i.getLastModifiedTime(),this.storeUser(i)})}))},f.prototype.getSavedSync=g((function(){return this.backend.getSavedSync()}),"getSavedSync"),f.prototype.isNewlyCreated=g((function(){return this.backend.isNewlyCreated()}),"isNewlyCreated"),f.prototype.getSavedSyncToken=g((function(){return this.backend.getNextBatchToken()}),"getSavedSyncToken"),f.prototype.deleteAllData=g((function(){return s.MemoryStore.prototype.deleteAllData.call(this),this.backend.clearDatabase().then(()=>{m.logger.log("Deleted indexeddb data.")},e=>{throw m.logger.error("Failed to delete indexeddb data: "+e),e})})),f.prototype.wantsSave=function(){const e=Date.now();return e-this._syncTs>p},f.prototype.save=function(e){return e||this.wantsSave()?this._reallySave():Promise.resolve()},f.prototype._reallySave=g((function(){this._syncTs=Date.now();const e=[];for(const t of this.getUsers())this._userModifiedMap[t.userId]!==t.getLastModifiedTime()&&t.events.presence&&(e.push([t.userId,t.events.presence.event]),this._userModifiedMap[t.userId]=t.getLastModifiedTime());return this.backend.syncToDatabase(e)})),f.prototype.setSyncData=g((function(e){return this.backend.setSyncData(e)}),"setSyncData"),f.prototype.getOutOfBandMembers=g((function(e){return this.backend.getOutOfBandMembers(e)}),"getOutOfBandMembers"),f.prototype.setOutOfBandMembers=g((function(e,t){return s.MemoryStore.prototype.setOutOfBandMembers.call(this,e,t),this.backend.setOutOfBandMembers(e,t)}),"setOutOfBandMembers"),f.prototype.clearOutOfBandMembers=g((function(e){return s.MemoryStore.prototype.clearOutOfBandMembers.call(this),this.backend.clearOutOfBandMembers(e)}),"clearOutOfBandMembers"),f.prototype.getClientOptions=g((function(){return this.backend.getClientOptions()}),"getClientOptions"),f.prototype.storeClientOptions=g((function(e){return s.MemoryStore.prototype.storeClientOptions.call(this,e),this.backend.storeClientOptions(e)}),"storeClientOptions")}).call(this,i("c8ba"))},ed32:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input_component",class:e.type},[n("div",{staticClass:"input-wrapper"},[n("div",{staticClass:"textarea"},[n("textarea",{ref:"textarea",staticClass:"chat-input",attrs:{id:"textInput",type:"text",row:"1",spellcheck:"true",autocorrect:"on",placeholder:e.$t("massmailing"===e.type?"caption.addMassMessageHolder":"caption.sendmessage")},domProps:{value:e.text},on:{focus:e.focused,blur:e.blured,keydown:e.keydown,input:e.textchange,keyup:e.keyup,click:e.keyup,paste:e.paste_image}}),e.emojiIndex?n("transition",{attrs:{name:"fade",mode:"out-in"}},[n("picker",{directives:[{name:"show",rawName:"v-show",value:e.display_emoji,expression:"display_emoji"},{name:"click-outside",rawName:"v-click-outside",value:e.close_emoji_picker,expression:"close_emoji_picker"}],style:e.style,attrs:{data:e.emojiIndex,exclude:e.exclude,showPreview:!1,showSearch:!1,native:!0,set:"emojione"},on:{select:e.insert_emoji}})],1):e._e()],1)]),n("div",{staticClass:"iconbutton emojipicker",on:{click:function(t){return e.toggle_emoji_picker()}}},[n("div",{staticClass:"leftdummy"},[n("div",{staticClass:"idummy"},[e.display_emoji?n("i",{staticClass:"fas fa-times"}):n("i",{staticClass:"far fa-smile"})])])]),e.send&&"massmailing"!==e.type?n("div",{staticClass:"iconbutton",on:{click:function(t){return e.send_text(t)}}},[e._m(0)]):e._e()])},r=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"rightdummy"},[n("div",{staticClass:"idummy"},[n("i",{staticClass:"far fa-paper-plane"})])])}],o=n("5059"),s=(n("01ce"),n("3139")),a=n("41fb"),c=n("c28b"),l=n.n(c),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.is_opened?n("div",{staticClass:"wrapper"},[n("img",{staticClass:"preview-picture",attrs:{src:e.base64,alt:"picture preview"}}),n("i",{staticClass:"fas fa-times fa-sm",on:{click:e.hide}})]):e._e()},d=[],h={name:"picturePreview",props:["base64"],data(){return{is_opened:!0}},methods:{hide(){this.is_opened=!1}}},m=h,p=(n("cff8"),n("2877")),f=Object(p["a"])(m,u,d,!1,null,"4b882d9f",null),g=f.exports;let v=new o["a"];var y={name:"InputField",components:{Picker:a["Picker"],picturePreview:g},directives:{clickOutside:l.a.directive},watch:{text:{immediately:!0,handler:function(e,t){e?(this.send=!0,this.$emit("FilledInput")):(this.send=!1,this.$emit("emptyInput")),this.textarea_resize()}}},data(){return{send:!1,ready:!1,text:"",exclude:["flags"],display_emoji:!1,content_height:26,pasted_data:[],block:!1,upload:{multiple:!0,extensions:["image/jpg","image/jpeg","image/png"],images:{resize:{type:"fit"}}},hidden_previews:null,emojiIndex:null}},computed:{style(){return{zIndex:2,height:"318px",width:"325px",position:"absolute",top:"massmailing"===this.type&&"40px",bottom:"massmailing"===this.type?"0":"32px",right:"massmailing"===this.type?"-38px":"-60px",fontSize:"0.8em",fontFamily:"Segoe UI"}},mobile:function(){return!this.$store.state.pocketnet&&this.$store.state.mobile}},methods:{prepareemoji:function(){if(window.emojiIndex)this.emojiIndex=window.emojiIndex;else{let e=n("364d");window.emojiIndex=new a["EmojiIndex"](e),this.emojiIndex=window.emojiIndex}},setText:function(e){this.text=e,this.savetextinstorage(),setTimeout(()=>{this.textarea_resize(),this.focus()})},focused:function(){this.$emit("focused")},textchange:function(e){this.text=e.target.value||"","massmailing"===this.type&&this.$emit("input",this.text)},savetextinstorage:function(){this.storagekey&&(localStorage[this.storagekey]=this.text||"")},send_empty_array(){this.$emit("userSearched",[])},focus(){this.$refs["textarea"].focus()},blur(){this.$refs["textarea"].blur()},blurifempty(){this.text||this.blur()},close_emoji_picker(e){"i"!==e.target.localName&&"matrix-element"!==e.target.localName&&"textarea"!==e.target.localName&&(this.display_emoji=!1)},textarea_resize(){this.text?(this.$refs.textarea.style.height="1px",this.$refs.textarea.style.height=this.$refs.textarea.scrollHeight+"px",this.display_emoji=!1):this.textarea_resize_reset()},textarea_resize_reset(){this.$refs.textarea.style.height=this.content_height+"px"},toggle_emoji_picker(){this.display_emoji=!this.display_emoji},send_text(e){this.text&&"\n"!==this.text&&(this.display_emoji=!1,this.$emit("chatMessage",this.text),this.$emit("emptyInput"),this.send=!1,this.text=""),this.savetextinstorage()},insert_emoji(e){this.text+=e.native,this.savetextinstorage()},paste_image(e){this.get_base64(e)},get_base64(e){if(this.pasted_data=e.clipboardData.items,this.pasted_data.length)for(let i in this.pasted_data){let e=this.pasted_data[i],r=this.upload.extensions.includes(e.type);if(r){var t=e.getAsFile(),n=new FileReader;n.onload=t=>{this.$dialog.confirm("Do you really want to send attachment?",{okText:"Yes",cancelText:"No, cancel"}).then(n=>{var i=t.target.result;this.resize_image(i,e.type)})},n.readAsDataURL(t)}}},resize_image(e,t){return v.autorotation(null,e).then(e=>{let n=this.upload.images.resize.type||"def";return v.resize[n](e,1024,1024,t,.9).then(e=>{this.$emit("base64",e)}).catch(e=>console.error("Failed to resize image",e))}).catch(e=>console.error("Failed to resize image",e))},getsearchposition(e){if(!e.start||!this.text.length)return null;var t={start:e.start,middle:0,end:e.end},n=e.start,i=!1,r=!1,o=/[a-zA-Z0-9]{1}/;t.middle=n;do{var s=this.text[n];"@"==s?e.start==n||n>0&&o.test(this.text[n-1])?r=!0:i=!0:o.test(s)?t.start=n:r=!0,n--}while(n>=0&&n<=e.start&&!i&&!r);if(i){r=!1,n=e.end;do{!this.text[n]||o.test(this.text[n])?t.end=n:r=!0,n++}while(n<=this.text.length&&!r)}else t=null;return t},getsearch(e){var t=this.getsearchposition(e);return t?this.text.substring(t.start,t.middle):null},keydown(e){return(40===e.keyCode||38===e.keyCode)&&this.tipusers&&this.tipusers.length?(this.$emit("browsetip",40===e.keyCode),e.preventDefault(),!1):(39===e.keyCode||13===e.keyCode)&&this.tipusers&&this.tipusers.length?(this.$emit("selectcurrenttip"),e.preventDefault(),!1):13===e.keyCode?(this.mobile?this.text=this.text+"\n":this.send_text(e),e.preventDefault(),!1):void 0},keyup(e){if(this.block)return e.preventDefault(),!1;var t=s["a"].getCaretPosition(this.$refs["textarea"]),n=this.getsearch(t);this.$emit("tipsearchrequest",n),this.savetextinstorage()},blured(){setTimeout(()=>{this.$emit("tipsearchrequest",null)},300)},inserttip(e){this.$emit("tipsearchrequest",null),this.block=!0,this.$refs["textarea"];var t=this.getsearchposition(s["a"].getCaretPosition(this.$refs["textarea"]));this.text=this.text.substring(0,t.start)+e+this.text.substring(t.end+1),this.text[t.end+1]||(this.text=this.text+" ")," "==!this.text[t.end+1]&&t.end++,s["a"].setCaretPosition(this.$refs["textarea"],t.end+1,t.end+1),setTimeout(()=>{this.block=!1},350)}},props:{storagekey:String,tipusers:Array,type:String},creared(){},mounted(){this.mobile||this.focus(),this.prepareemoji(),this.$refs.textarea.style.height="26px",this.storagekey&&localStorage[this.storagekey]&&(this.text=localStorage[this.storagekey])}},_=y,b=(n("84de"),Object(p["a"])(_,i,r,!1,null,"35200506",null));t["a"]=b.exports},edd4:function(e){e.exports=JSON.parse('{"caption":{"create":"Create","addGroupNamePlaceHolder":"Add Group Name","addPublicChatName":"Add Public Chat Name","addMassMessageHolder":"Message holder","createPublicChat":"Create public chat","chatTopic":"Topic renamed","publicRoomTitle":"Public Room","asModerator":"as moderator","marked":"marked","unmarked":"unmarked","removeBan":"Remove Ban","cancelModeration":"Remove moderation","uploadFiles":"Upload files","header":"header","dragAndDropAFile":"Drag and drop file","chatInvite":"You were invited to chat with:","cantJoin":"You can\'t join to chat with:","chatInviteDecline":"You can join in chat or decline invitation","creatorLeft":"Because creator left the room","encrypted":"Encrypted","noImages":"There are no images in this chat yet","noFiles":"There are no files in this chat yet","inviteUser":"Invite User","invite":"Invite","add":"Add","mute":"Mute","unmute":"Unmute","leave":"Leave","Info":"Info","new":"New","typing":"typing","accNotFound":"Your registration is in progress, please wait...","emptyList":"list is empty ( filtered or just empty )","welcome":"Welcome to chat","startNewChat":"Start a new chat","chats":"Chats","shareWith":"Share with","newChat":"New Chat","moveToChat":"Move to chat","queryNoResults":"Query reports no results","needMoreCharacters":"Need more characters for result","createGroup":"Create Group","unabletoDecrypt":"* Unable to decrypt","messageDeleted":"Message Deleted","sentImage":"sent image","sentVoiceMessage":"sent a voice message","invitationToChat":"Invitation to chat","invitationToRoom":"Invitation to room","leftChat":"left the chat","joined":"joined","chatRenamed":"Chat renamed to ","recentComment":"Recent comment:","share":"SHARE","followers":"Followers","reputation":"Reputation","unsubscribe":"Unsubscribe","following":"Following","theme":"Theme:","contacts":"Contacts","contactsForMailing":"Choose contact with subscribers","phoneContacts":"Phone contacts","chooseInviteMedia":"Please choose how you want to invite:","admin":"Admin","moderator":"Moderator","videocall":"Video Call","call":"Call","leaveAndDelete":"Leave and Delete","donate":"Donate","makeModerator":"Make Moderator","ban":"Ban","kick":"Kick","members":"Members","media":"Media","files":"Files","contactsList":"Contacts List","send":"send","pageCaption":"Page caption","caption":"Caption","text":"text","placeholder":"placeholder","sendTransactionTo":"Send Transaction To","toBePaidByReceiver":"To be paid by Receiver","toBePaidBySender":"To be paid by Sender","source":"Source","amount":"Amount","receiver":"Receiver","message":"Message","includeFeesInAmount":"Include Fees in Amount","transactionFees":"Transaction Fees","totalAmount":"Total amount","balanceTooLow":"Balance too low","transactionError":"Error, can\'t make the transaction","calculateFees":"Calculate Fees","startChatWith":"Start chat with","searchResult":"Search result","joinedInTheChat":"joined the chat","invited":"invited ","hasInvited":"has invited ","inTheChat":" in the chat","banned":"banned","andRoom":"and room","left":"left","theChat":" the chat ","made":"made ","aModerator":" a moderator","editedChatNameTo ":"edited chat name to ","somebody":"Somebody","sent":"sent","PKOINto":" PKOIN to ","response":"Response","messagefrom":"Forwarded message from","edited":"Edited","settings":"Settings","unauthorized":"Unauthorized","search":"Search","replyOnMessage":"Reply on Message","editMessage":"Edit Message","inviteFriend":"Invite friends","emptyContactList":"Contacts list is empty","joinApp":"Please connect with me for secure chat.","hasInvitedToJoin":"It is private and NOT connected to your phone number. Let\'s chat!","contactsempty":"You do not have contacts yet, find them in the search","usernotgen":"User did not generate their encryption keys yet. You will be able to chat them when their keys are generated.","younotgen":"Please wait a minute, Your encryption keys are being generated...","messageRead":"Message read","open":"Open","You":"You","chatsearchingempty":"No chats found for the specified filter","sendmessage":"Send message","clearHistory":"Clear history"},"input":{"patientEmailPlaceholder":"Email","refillNamePlaceholder":"Refill name"},"message":{},"button":{"starChatButton":"Start chat","decline":"Decline","declineandignore":"Ignore User","join":"Join","ok":"Ok","save":"Save","copy":"Copy","forward":"Forward","delete":"Delete","reply":"Reply","share":"Share","download":"Download","downloaded":"Downloaded","goToPocketnetProfile":"Go to profile","sendFile":"Send File","takePhotoOrVideo":"Send image","sendCoins":"Send coins","edit":"Edit","select":"Select","block":"Block","unblock":"Unblock","blockUser":"Block user","Complain":"Complain"},"type":{"publicgroup":"Create Public group","privategroup":"Create Private group","massmailing":"Mass mailing","one":"One on one chat"},"typelabel":{"publicgroup":"Public group creation","privategroup":"Private group creation","massmailing":"Mass mailing creation","one":"One on one chat creation"},"yes":"Yes","cancel":"Cancel","teamMessages":{"1-title":"Welcome to Bastyon Private Chat!","1-list1":"Private messenger that is NOT connected to your phone number","1-list2":"End-To-End Encryption of every 1-on-1 conversation by default","1-list3":"All images sent or received through chat are stored encrypted","1-list4":"History of messages is saved for 7 days only","2-title":"A Huge Announcement! Pocketnet application is now called Bastyon!","2-message1":"The domain will be moved to Bastyon.com. We released the following major updates recently:","2-list1":"Private encrypted messenger not connected to your phone number","2-list2":"Ability to donate PKOIN to bloggers","2-list3":"Video and Live Streaming","2-message2":"Invite your friends now and be a part of the big future of decentralized internet!","2-button":"Invite friends"},"sendingerror":"An error occurred while sending the message","details":"Details","settings_pin":"Pin chat window","checked":"Yes","unchecked":"No","settings_read":"Send read receipts","messagewasburn":"This message remains only in the memory of your device","messagewillburn":"The message will be deleted soon","micaccessbrowser":"Access to the microphone is restricted, please check your browser settings.","micaccesscommonproblem":"Sorry, for some reason it is not possible to record voice messages on the device","micaccesscordova":"Access to the microphone is restricted, please check your device settings.","micdevicenotfound":"Audio recording device not found"}')},edd7:function(e,t,n){},edeb:function(e,t,n){"use strict";n("9f70")},ef06:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PushProcessor=a;var i=n("3987"),r=n("63c7");const o=["override","content","room","sender","underride"],s=[{rule_id:".m.rule.tombstone",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.room.tombstone"},{kind:"event_match",key:"state_key",pattern:""}],actions:["notify",{set_tweak:"highlight",value:!0}]},{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:"event_match",key:"type",pattern:"m.reaction"}],actions:["dont_notify"]}];function a(e){const t={},n=(e,t)=>{for(let n=0;n<o.length;++n){const i=o[n],s=t[i];if(s)for(let t=0;t<s.length;++t){const n=s[t];if(!n.enabled)continue;const o=r(i,n);if(o&&this.ruleMatchesEvent(o,e))return n.kind=i,n}}return null},r=function(e,t){const n={rule_id:t.rule_id,actions:t.actions,conditions:[]};switch(e){case"underride":case"override":n.conditions=t.conditions;break;case"room":if(!t.rule_id)return null;n.conditions.push({kind:"event_match",key:"room_id",value:t.rule_id});break;case"sender":if(!t.rule_id)return null;n.conditions.push({kind:"event_match",key:"user_id",value:t.rule_id});break;case"content":if(!t.pattern)return null;n.conditions.push({kind:"event_match",key:"content.body",pattern:t.pattern});break}return n},s=function(e,t){const n={event_match:d,contains_display_name:u,room_member_count:l,sender_notification_permission:c};return!!n[e.kind]&&n[e.kind](e,t)},c=function(t,n){const i=t["key"];if(!i)return!1;const r=e.getRoom(n.getRoomId());return!(!r||!r.currentState)&&r.currentState.mayTriggerNotifOfType(i,n.getSender())},l=function(t,n){if(!t.is)return!1;const i=e.getRoom(n.getRoomId());if(!i||!i.currentState||!i.currentState.members)return!1;const r=i.currentState.getJoinedMemberCount(),o=t.is.match(/^([=<>]*)([0-9]*)$/);if(!o)return!1;const s=o[1],a=parseInt(o[2]);if(isNaN(a))return!1;switch(s){case"":case"==":return r==a;case"<":return r<a;case">":return r>a;case"<=":return r<=a;case">=":return r>=a;default:return!1}},u=function(t,n){let r=n.getContent();if(n.isEncrypted()&&n.getClearContent()&&(r=n.getClearContent()),!r||!r.body||"string"!=typeof r.body)return!1;const o=e.getRoom(n.getRoomId());if(!o||!o.currentState||!o.currentState.members||!o.currentState.getMember(e.credentials.userId))return!1;const s=o.currentState.getMember(e.credentials.userId).name,a=new RegExp("(^|\\W)"+(0,i.escapeRegExp)(s)+"(\\W|$)","i");return r.body.search(a)>-1},d=function(e,t){if(!e.key)return!1;const n=m(e.key,t);if("string"!==typeof n)return!1;if(e.value)return e.value===n;if("string"!==typeof e.pattern)return!1;let i;return i="content.body"==e.key?h("(^|\\W)",e.pattern,"(\\W|$)"):h("^",e.pattern,"$"),!!n.match(i)},h=function(e,n,r){return t[n]||(t[n]=new RegExp(e+(0,i.globToRegexp)(n)+r,"i")),t[n]},m=function(e,t){const n=e.split(".");let r;const o=n[0];"content"===o?(r=t.getContent(),n.shift()):"type"===o?(r=t.getType(),n.shift()):r=t.event;while(n.length>0){const e=n.shift();if((0,i.isNullOrUndefined)(r[e]))return null;r=r[e]}return r},p=function(t,i){return i?t.getSender()===e.credentials.userId?null:n(t,i.global):null},f=function(e,t){const n=p(e,t);if(!n)return{};const i=a.actionListToActionsObject(n.actions);return void 0===i.tweaks.highlight&&(i.tweaks.highlight="content"==n.kind),i};this.ruleMatchesEvent=function(e,t){let n=!0;for(let i=0;i<e.conditions.length;++i){const r=e.conditions[i];n&=s(r,t)}return n},this.actionsForEvent=function(t){return f(t,e.pushRules)},this.getPushRuleById=function(t){for(const n of["global"])if(void 0!==e.pushRules[n])for(const i of o)if(void 0!==e.pushRules[n][i])for(const r of e.pushRules[n][i])if(r.rule_id===t)return r;return null}}a.actionListToActionsObject=function(e){const t={notify:!1,tweaks:{}};for(let n=0;n<e.length;++n){const i=e[n];"notify"===i?t.notify=!0:"object"===typeof i&&(void 0===i.value&&(i.value=!0),t.tweaks[i.set_tweak]=i.value)}return t},a.rewriteDefaultRules=function(e){let t=JSON.parse(JSON.stringify(e));t||(t={}),t.global||(t.global={}),t.global.override||(t.global.override=[]);const n=t.global.override;for(const i of s){const e=n.find(e=>e.rule_id===i.rule_id);if(e)e.default=i.default,e.conditions=i.conditions,e.actions=i.actions;else{const e=i.rule_id;r.logger.warn("Adding default global override for "+e),n.push(i)}}return t}},f024:function(e,t,n){"use strict";n("b494")},f408:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=s,t.randomLowercaseString=a,t.randomUppercaseString=c;const i="abcdefghijklmnopqrstuvwxyz",r="ABCDEFGHIJKLMNOPQRSTUVWXYZ",o="0123456789";function s(e){return l(e,r+i+o)}function a(e){return l(e,i)}function c(e){return l(e,r)}function l(e,t){let n="";for(let i=0;i<e;++i)n+=t.charAt(Math.floor(Math.random()*t.length));return n}},f41f:function(e,t,n){},f693:function(e){e.exports=JSON.parse('{"caption":{"create":"Create","addPublicChatName":"Add Public Chat Name","addGroupNamePlaceHolder":"Add Group Name","createPublicChat":"Create public chat","chatTopic":"Topic renamed","publicRoomTitle":"Public Room","asModerator":"as moderator","marked":"marked","unmarked":"unmarked","removeBan":"Remove Ban","cancelModeration":"Remove moderation","uploadFiles":"Télécharger fichiers","header":"En-tête","dragAndDropAFile":"Glisser déposer fichier","chatInvite":"Vous avez été invité à discuter avec:","cantJoin":"Vous ne pouvez pas rejoindre la conversation avec:","chatInviteDecline":"Vous pouvez rejoindre la conversation ou refuser l\'invitation","creatorLeft":"Car l\'administrateur a quitté la conversation","encrypted":"Encrypté","noImages":"Il n\'y a pas encore d\'images dans la conversation","noFiles":"Il n\'y a pas encore d\'files dans la conversation","inviteUser":"Inviter utilisateur","invite":"Inviter","add":"Ajouter","mute":"Mode silence","unmute":"Mode son","leave":"Quitter","Info":"Info","new":"Nouveau","typing":"en train d\'écrire","accNotFound":"Votre inscription est en cours, veuillez patienter...","emptyList":"liste vide (filtrée ou juste vide)","welcome":"Bienvenue sur Pocketnet chat","startNewChat":"Commencer une conversation","chats":"Conversations","shareWith":"Partager avec","newChat":"Nouvelle conversation","moveToChat":"Aller à la conversation","queryNoResults":"Auncun résulats","needMoreCharacters":"Veuillez saisir plus de caractères","createGroup":"Créer groupe","unabletoDecrypt":"* Impossible de decrypter","messageDeleted":"Message supprimé","sentImage":"envoyé image","sentVoiceMessage":"envoyé un message vocal","invitationToChat":"Invitation à discuter","invitationToRoom":"Invitation to room","leftChat":"a quitté la conversation","joined":"a rejoint","chatRenamed":"Conversation renommé en ","recentComment":"Commentaire récent:","share":"PARTAGER","followers":"Abonnés:","reputation":"Réputation:","following":"Abonnements:","theme":"Thème:","contacts":"Contacts","phoneContacts":"Contacts téléphone","chooseInviteMedia":"Veuillez choisir comment inviter:","admin":"Administrateur","moderator":"Modérateur","videocall":"Appel Vidéo","call":"Appel","leaveAndDelete":"Quitter et supprimer","donate":"Faire un don","makeModerator":"Définir comme Modérateur","ban":"Bannir","kick":"Expulser","members":"Membres","media":"Médias","files":"Fichiers","contactsList":"Liste de contacts","send":"envoyer","pageCaption":"Légende de page","caption":"Légende","text":"Texte","placeholder":"placeholder","sendTransactionTo":"Envoyer transaction à","toBePaidByReceiver":"Payé par le receveur","toBePaidBySender":"Payé par l\'expéditeur","source":"Source","amount":"Montant","receiver":"Receveur","message":"Message","includeFeesInAmount":"Inclure les frais dans le montant","transactionFees":"Frais de transaction","totalAmount":"Montant total","balanceTooLow":"Solde trop faible","transactionError":"Erreur, la transaction ne peut être effectuée","calculateFees":"Calculer les frais","startChatWith":"Discuter avec:","searchResult":"Résultat de la recherche","joinedInTheChat":"à rejoint la conversation","invited":"invité ","hasInvited":"invité ","inTheChat":" dans la conversation","banned":"banni","andRoom":"et conversation","left":"quiité","theChat":" la conversation ","made":"fait ","aModerator":" un modérateur","editedChatNameTo ":"edité le nom de la conversation en ","somebody":"Quelqu\'un","sent":"a envoyé","PKOINto":" PKOIN à ","response":"Réponse","messagefrom":"Transférer message de","edited":"Edité","settings":"Paramètres","unauthorized":"Non autorisé","search":"Recherche","replyOnMessage":"Répondre au message","editMessage":"Editer message","inviteFriend":"Inviter des amis","emptyContactList":"Liste de contacts vide","joinApp":"Rejoindre Pocketnet","hasInvitedToJoin":"vous a invité à rejoindre Pocketnet","contactsempty":"Vous n\'avez pas encore de contacts, vous pouvez utiliser la recherche","usernotgen":"User did not generate their encryption keys yet. You will be able to chat them when their keys are generated.","younotgen":"Please wait a minute, Your encryption keys are being generated...","chatsearchingempty":"No chats found for the specified filter","sendmessage":"Send message","clearHistory":"Clear history"},"input":{"patientEmailPlaceholder":"Email","refillNamePlaceholder":"Saisissez à nouveau le nom"},"message":{},"button":{"starChatButton":"Commencer une conversation ","decline":"Refuser","declineandignore":"Ignorer utilisateur","join":"Rejoindre","ok":"Ok","copy":"Copier","forward":"Transférer","delete":"Supprimer","save":"Enregistrer","reply":"Répondre","share":"Partager","download":"Télécharger","downloaded":"Téléchargé","goToPocketnetProfile":"Aller au profile Pocketnet","sendFile":"Envoyer fichier","takePhotoOrVideo":"Envoyer image","sendCoins":"Envoyer PKOIN","edit":"Editer","select":"Sélectionner","block":"Bloquer","unblock":"Débloquer","blockUser":"Bloquer utilisateur"},"yes":"Oui","cancel":"Annuler","teamMessages":{"1-title":"Bienvenue sur la messagerie privée Bastyon!","1-list1":"Messagerie privée qui n\'est PAS connectée à votre numéro de téléphone","1-list2":"Chiffrement de bout en bout pour chaque conversation","1-list3":"Toutes les images envoyées ou reçues par le biais du chat sont stockées sous forme cryptée","1-list4":"L\'historique des messages est conservé pendant 7 jours uniquement","2-title":"Bonne nouvelle! L\'application Pocketnet s\'appelle désormais Bastyon!","2-message1":"Le domaine sera déplacé vers Bastyon.com. Nous avons récemment publié les mises à jour majeures suivantes:","2-list1":"Messagerie privée cryptée non connectée à votre numéro de téléphone","2-list2":"Possibilité de faire des dons en PKOIN aux blogueurs","2-list3":"Vidéo et Streaming en direct","2-message2":"Invitez dès maintenant vos amis et faites partie du grand avenir de l\'internet décentralisé!","2-button":"Inviter des amis"},"sendingerror":"An error occurred while sending the message","details":"Details","settings_pin":"Pin chat window","checked":"Yes","unchecked":"No","settings_read":"Send read receipts","messagewasburn":"This message remains only in the memory of your device","messagewillburn":"The message will be deleted soon","micaccessbrowser":"Access to the microphone is restricted, please check your browser settings.","micaccesscommonproblem":"Sorry, for some reason it is not possible to record voice messages on the device","micaccesscordova":"Access to the microphone is restricted, please check your device settings.","micdevicenotfound":"Audio recording device not found"}')},f6eb:function(e,t,n){},f703:function(e,t,n){},f860:function(e,t,n){},f978:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"contactList",class:{minimized:e.minimized}},[n("RecycleScroller",{staticClass:"scroller",attrs:{"page-mode":"",items:e.users,"item-size":60,"key-field":"id"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item;return[n("div",{staticClass:"previewWrapper minimizeex"},["Contacts"===e.mode||"Select"===e.mode?n("div",{staticClass:"previewContact",on:{click:function(t){return e.navigateToProfile(i.id,i)}}},[n("preview",{attrs:{contact:i,mode:e.mode}})],1):e._e(),"Selectmany"===e.mode?n("div",{staticClass:"previewBox",on:{click:function(t){return e.toggleUser(i)}}},[n("div",{staticClass:"previewContactSelect"},[n("preview",{attrs:{mode:e.mode,contact:i}})],1),n("div",{staticClass:"checkBox"},[e.selected[i.id]?n("i",{staticClass:"far fa-check-circle"}):e._e(),e.selected[i.id]?e._e():n("i",{staticClass:"far fa-circle"})])]):e._e()])]}}])})],1)},r=[],o=n("2f62"),s=n("92a6"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mod-wrapper"},[n("div",{staticClass:"modal-window"},[n("span",{staticClass:"message"},[e._v(e._s(e.message))]),n("button",{staticClass:"btn",on:{click:e.close}},[e._v("OK")])])])},c=[],l={name:"ModalWindow",props:["message"],methods:{close(){this.$emit("Close")}}},u=l,d=(n("706e"),n("2877")),h=Object(d["a"])(u,a,c,!1,null,"96a5a68e",null),m=h.exports,p={name:"contactsList",data:function(){return{loading:!1}},components:{preview:s["a"],ModalWindow:m},props:{mode:{default:"",type:String},users:Array,selected:Object,title:String},watch:{},computed:Object(o["c"])({auth:e=>e.auth,minimized:e=>e.minimized,...Object(o["b"])(["PREPARE_USERDATA"]),...Object(o["c"])(["contactsMap","signedUpUsers"])}),methods:{select(e){this.$emit("select",e)},navigateToProfile(e,t){"Select"==this.mode?this.select(t):this.$router.push({path:"/contact",query:{...this.$route.query,id:e}})},toggleUser(e){this.$emit("toggleUser",e.id)}},mounted(){}},f=p,g=(n("ff89"),Object(d["a"])(f,i,r,!1,null,"691bf714",null));t["default"]=g.exports},f9d6:function(e,t,n){"use strict";n("bc22")},fbb2:function(e,t,n){"use strict";n("4a44")},fdca:function(e,t,n){"use strict";n("a0b4")},ff6c:function(e,t,n){"use strict";n("195d")},ff89:function(e,t,n){"use strict";n("e3c0")}});
//# sourceMappingURL=app.c956b65b.js.map