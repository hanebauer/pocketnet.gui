/*! For license information please see 1.chunk.js.LICENSE.txt?v=3874 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{201:function(e,t,s){"use strict";var i;s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return U})),function(e){e.SegmentLoaded="segment_loaded",e.SegmentError="segment_error",e.SegmentSize="segment_size",e.SegmentAbort="segment_abort",e.SegmentStartLoad="segment_start_load",e.PeerConnect="peer_connect",e.PeerClose="peer_close",e.PieceBytesDownloaded="piece_bytes_downloaded",e.PieceBytesUploaded="piece_bytes_uploaded"}(i||(i={}));var n=s(1),o=s(161),a=s.n(o),r=s(159),d=s(198),h=s.n(d);class g extends r.EventEmitter{constructor(){super(...arguments),this.on=(e,t)=>super.on(e,t),this.emit=(e,...t)=>super.emit(e,...t)}}class l extends g{}class m extends l{constructor(e){super(),this.settings=e,this.xhrRequests=new Map,this.failedSegments=new Map,this.debug=a()("p2pml:http-media-manager"),this.download=(e,t)=>{if(this.isDownloading(e))return;this.cleanTimedOutFailedSegments(),this.emit("segment-start-load",e);const s=this.buildSegmentUrl(e);this.debug("http segment download",s),e.requestUrl=s;const i=new XMLHttpRequest;if(i.open("GET",s,!0),i.responseType="arraybuffer",e.range)i.setRequestHeader("Range",e.range),t=void 0;else if(void 0!==t&&this.settings.httpUseRanges){let e=0;for(const s of t)e+=s.byteLength;i.setRequestHeader("Range",`bytes=${e}-`),this.debug("continue download from",e)}else t=void 0;this.setupXhrEvents(i,e,t),this.settings.xhrSetup&&this.settings.xhrSetup(i,s),this.xhrRequests.set(e.id,{xhr:i,segment:e,initialPriority:e.priority,segmentUrl:s}),i.send()},this.updatePriority=e=>{const t=this.xhrRequests.get(e.id);if(!t)throw new Error("Cannot update priority of not downloaded segment "+e.id);e.priority<=this.settings.requiredSegmentsPriority&&t.initialPriority>this.settings.requiredSegmentsPriority&&t.segmentUrl!==this.buildSegmentUrl(e)&&(this.debug("aborting http segment abort because the segment is now in a high priority",e.id),this.abort(e),this.download(e))},this.abort=e=>{const t=this.xhrRequests.get(e.id);t&&(t.xhr.abort(),this.xhrRequests.delete(e.id),this.debug("http segment abort",e.id))},this.isDownloading=e=>this.xhrRequests.has(e.id),this.isFailed=e=>{const t=this.failedSegments.get(e.id);return void 0!==t&&t>this.now()},this.getActiveDownloads=()=>this.xhrRequests,this.getActiveDownloadsCount=()=>this.xhrRequests.size,this.destroy=()=>{this.xhrRequests.forEach((e=>e.xhr.abort())),this.xhrRequests.clear()},this.setupXhrEvents=(e,t,s)=>{let i=0;e.addEventListener("progress",(e=>{const s=e.loaded-i;this.emit("bytes-downloaded",t,s),i=e.loaded,e.lengthComputable&&this.emit("segment-size",t,e.total)})),e.addEventListener("load",(i=>Object(n.a)(this,void 0,void 0,(function*(){if(e.status<200||e.status>=300)return void this.segmentFailure(t,i,e);let n=e.response;if(void 0!==s&&206===e.status){let e=0;for(const t of s)e+=t.byteLength;const t=new Uint8Array(e+n.byteLength);let i=0;for(const e of s)t.set(new Uint8Array(e),i),i+=e.byteLength;t.set(new Uint8Array(n),i),n=t.buffer}yield this.segmentDownloadFinished(t,n,e)})))),e.addEventListener("error",(s=>{this.segmentFailure(t,s,e)})),e.addEventListener("timeout",(s=>{this.segmentFailure(t,s,e)}))},this.segmentDownloadFinished=(e,t,s)=>Object(n.a)(this,void 0,void 0,(function*(){if(e.responseUrl=null===s.responseURL?void 0:s.responseURL,this.settings.segmentValidator)try{yield this.settings.segmentValidator(Object.assign(Object.assign({},e),{data:t}),"http")}catch(t){return this.debug("segment validator failed",t),void this.segmentFailure(e,t,s)}this.xhrRequests.delete(e.id),this.emit("segment-loaded",e,t)})),this.segmentFailure=(e,t,s)=>{e.responseUrl=null===s.responseURL?void 0:s.responseURL,this.xhrRequests.delete(e.id),this.failedSegments.set(e.id,this.now()+this.settings.httpFailedSegmentTimeout),this.emit("segment-error",e,t)},this.cleanTimedOutFailedSegments=()=>{const e=this.now(),t=[];this.failedSegments.forEach(((s,i)=>{s<e&&t.push(i)})),t.forEach((e=>this.failedSegments.delete(e)))},this.now=()=>performance.now()}buildSegmentUrl(e){return this.settings.segmentUrlBuilder?this.settings.segmentUrlBuilder(e):e.url}}var u,c,p=s(276),S=s.n(p),f=s(73),w=s(220),y=s.n(w);!function(e){e[e.SegmentData=0]="SegmentData",e[e.SegmentAbsent=1]="SegmentAbsent",e[e.SegmentsMap=2]="SegmentsMap",e[e.SegmentRequest=3]="SegmentRequest",e[e.CancelSegmentRequest=4]="CancelSegmentRequest"}(u||(u={})),function(e){e[e.Loaded=0]="Loaded",e[e.LoadingByHttp=1]="LoadingByHttp"}(c||(c={}));class b{constructor(e,t){this.id=e,this.size=t,this.bytesDownloaded=0,this.pieces=[]}}class v extends g{constructor(e,t){super(),this.peer=e,this.settings=t,this.remoteAddress="",this.downloadingSegmentId=null,this.downloadingSegment=null,this.segmentsMap=new Map,this.debug=a()("p2pml:media-peer"),this.timer=null,this.onPeerConnect=()=>{this.debug("peer connect",this.id,this),this.remoteAddress=this.peer.remoteAddress,this.emit("connect",this)},this.onPeerClose=()=>{this.debug("peer close",this.id,this),this.terminateSegmentRequest(),this.emit("close",this)},this.onPeerError=e=>{this.debug("peer error",this.id,e,this)},this.receiveSegmentPiece=e=>{if(!this.downloadingSegment)return void this.debug("peer segment not requested",this.id,this);this.downloadingSegment.bytesDownloaded+=e.byteLength,this.downloadingSegment.pieces.push(e);const t=this.downloadingSegment.id;if(this.emit("bytes-downloaded",this,t,e.byteLength),this.downloadingSegment.bytesDownloaded===this.downloadingSegment.size){const e=new Uint8Array(this.downloadingSegment.size);let s=0;for(const t of this.downloadingSegment.pieces)e.set(new Uint8Array(t),s),s+=t.byteLength;this.debug("peer segment download done",this.id,t,this),this.terminateSegmentRequest(),this.emit("segment-loaded",this,t,e.buffer)}else this.downloadingSegment.bytesDownloaded>this.downloadingSegment.size&&(this.debug("peer segment download bytes mismatch",this.id,t,this),this.terminateSegmentRequest(),this.emit("segment-error",this,t,"Too many bytes received for segment"))},this.getJsonCommand=e=>{const t=new Uint8Array(e);if(123===t[0]&&34===t[1]&&125===t[e.byteLength-1])try{return JSON.parse((new TextDecoder).decode(e))}catch(e){return null}return null},this.onPeerData=e=>{const t=this.getJsonCommand(e);if(null!==t){if(this.downloadingSegment){this.debug("peer segment download is interrupted by a command",this.id,this);const e=this.downloadingSegment.id;return this.terminateSegmentRequest(),void this.emit("segment-error",this,e,"Segment download is interrupted by a command")}switch(this.debug("peer receive command",this.id,t,this),t.c){case u.SegmentsMap:this.segmentsMap=this.createSegmentsMap(t.m),this.emit("data-updated");break;case u.SegmentRequest:this.emit("segment-request",this,t.i);break;case u.SegmentData:this.downloadingSegmentId&&this.downloadingSegmentId===t.i&&"number"==typeof t.s&&t.s>=0&&(this.downloadingSegment=new b(t.i,t.s),this.emit("segment-start-load",this.downloadingSegment.id),this.emit("segment-size",this.downloadingSegment.id,this.downloadingSegment.size),this.cancelResponseTimeoutTimer());break;case u.SegmentAbsent:this.downloadingSegmentId&&this.downloadingSegmentId===t.i&&(this.terminateSegmentRequest(),this.segmentsMap.delete(t.i),this.emit("segment-absent",this,t.i));break;case u.CancelSegmentRequest:}}else this.receiveSegmentPiece(e)},this.createSegmentsMap=e=>{if(!(e instanceof Object))return new Map;const t=new Map;for(const s of Object.keys(e)){const i=e[s];if(!(i instanceof Array&&2===i.length&&"string"==typeof i[0]&&i[1]instanceof Array))return new Map;const n=i[0].split("|"),o=i[1];if(n.length!==o.length)return new Map;for(let e=0;e<n.length;e++){const i=o[e];if("number"!=typeof i||void 0===c[i])return new Map;t.set(`${s}+${n[e]}`,i)}}return t},this.sendCommand=e=>{this.debug("peer send command",this.id,e,this),this.peer.write(JSON.stringify(e))},this.destroy=()=>{this.debug("peer destroy",this.id,this),this.terminateSegmentRequest(),this.peer.destroy()},this.getDownloadingSegmentId=()=>this.downloadingSegmentId,this.getSegmentsMap=()=>this.segmentsMap,this.sendSegmentsMap=e=>{this.sendCommand({c:u.SegmentsMap,m:e})},this.sendSegmentData=(e,t)=>{this.sendCommand({c:u.SegmentData,i:e,s:t.byteLength});let s=t.byteLength;for(;s>0;){const e=s>=this.settings.webRtcMaxMessageSize?this.settings.webRtcMaxMessageSize:s,i=f.Buffer.from(t,t.byteLength-s,e);this.peer.write(i),s-=e}this.emit("bytes-uploaded",this,e,t.byteLength)},this.sendSegmentAbsent=e=>{this.sendCommand({c:u.SegmentAbsent,i:e})},this.requestSegment=e=>{if(this.downloadingSegmentId)throw new Error("A segment is already downloading: "+this.downloadingSegmentId);this.sendCommand({c:u.SegmentRequest,i:e}),this.downloadingSegmentId=e,this.runResponseTimeoutTimer()},this.cancelSegmentRequest=()=>{let e;if(this.downloadingSegmentId){const t=this.downloadingSegmentId;e=this.downloadingSegment?this.downloadingSegment.pieces:void 0,this.terminateSegmentRequest(),this.sendCommand({c:u.CancelSegmentRequest,i:t})}return e},this.runResponseTimeoutTimer=()=>{this.timer=setTimeout((()=>{if(this.timer=null,!this.downloadingSegmentId)return;const e=this.downloadingSegmentId;this.cancelSegmentRequest(),this.emit("segment-timeout",this,e)}),this.settings.p2pSegmentDownloadTimeout)},this.cancelResponseTimeoutTimer=()=>{this.timer&&(clearTimeout(this.timer),this.timer=null)},this.terminateSegmentRequest=()=>{this.downloadingSegmentId=null,this.downloadingSegment=null,this.cancelResponseTimeoutTimer()},this.peer.on("connect",this.onPeerConnect),this.peer.on("close",this.onPeerClose),this.peer.on("error",this.onPeerError),this.peer.on("data",this.onPeerData),this.id=e.id}}const P=`-WW${"0.6.2".replace(/\d*./g,(e=>("0"+parseInt(e,10)%100).slice(-2))).slice(0,4)}-`;class M{constructor(e,t){this.peerId=e,this.segment=t}}class I extends g{constructor(e,t){super(),this.segmentsStorage=e,this.settings=t,this.trackerClient=null,this.peers=new Map,this.peerCandidates=new Map,this.peerSegmentRequests=new Map,this.streamSwarmId=null,this.debug=a()("p2pml:p2p-media-manager"),this.pendingTrackerClient=null,this.getPeers=()=>this.peers,this.getPeerId=()=>f.Buffer.from(this.peerId).toString("hex"),this.setStreamSwarmId=(e,t)=>{if(this.streamSwarmId===e)return;this.destroy(!0),this.streamSwarmId=e,this.masterSwarmId=t,this.debug("stream swarm ID",this.streamSwarmId),this.pendingTrackerClient={isDestroyed:!1};const s=this.pendingTrackerClient,i=(new y.a).update(`2${this.streamSwarmId}`).digest();s.isDestroyed?null!==this.trackerClient&&(this.trackerClient.destroy(),this.trackerClient=null):(this.pendingTrackerClient=null,this.createClient(i))},this.createClient=e=>{if(!this.settings.useP2P)return;const t={infoHash:f.Buffer.from(e,0,20),peerId:f.Buffer.from(this.peerId,0,20),announce:this.settings.trackerAnnounce,rtcConfig:this.settings.rtcConfig,port:6881,getAnnounceOpts:()=>({numwant:this.settings.peerRequestsPerAnnounce})};let s=this.trackerClient;this.trackerClient=new S.a(t),this.trackerClient.on("error",this.onTrackerError),this.trackerClient.on("warning",this.onTrackerWarning),this.trackerClient.on("update",this.onTrackerUpdate),this.trackerClient.on("peer",this.onTrackerPeer),this.trackerClient.start(),null!==s&&(s.destroy(),s=null)},this.onTrackerError=e=>{this.debug("tracker error",e)},this.onTrackerWarning=e=>{this.debug("tracker warning",e)},this.onTrackerUpdate=e=>{this.debug("tracker update",e),this.emit("tracker-update",e)},this.onTrackerPeer=e=>{if(this.debug("tracker peer",e.id,e),this.peers.has(e.id))return this.debug("tracker peer already connected",e.id,e),void e.destroy();const t=new v(e,this.settings);t.on("connect",this.onPeerConnect),t.on("close",this.onPeerClose),t.on("data-updated",this.onPeerDataUpdated),t.on("segment-request",this.onSegmentRequest),t.on("segment-loaded",this.onSegmentLoaded),t.on("segment-absent",this.onSegmentAbsent),t.on("segment-error",this.onSegmentError),t.on("segment-size",this.onSegmentSize),t.on("segment-start-load",this.onSegmentStartLoad),t.on("segment-timeout",this.onSegmentTimeout),t.on("bytes-downloaded",this.onPieceBytesDownloaded),t.on("bytes-uploaded",this.onPieceBytesUploaded);let s=this.peerCandidates.get(t.id);s||(s=[],this.peerCandidates.set(t.id,s)),s.push(t)},this.download=e=>{if(this.isDownloading(e))return!1;const t=[];for(const s of this.peers.values())null===s.getDownloadingSegmentId()&&s.getSegmentsMap().get(e.id)===c.Loaded&&t.push(s);if(0===t.length)return!1;const s=t[Math.floor(Math.random()*t.length)];return s.requestSegment(e.id),this.peerSegmentRequests.set(e.id,new M(s.id,e)),!0},this.abort=e=>{let t;const s=this.peerSegmentRequests.get(e.id);if(s){const i=this.peers.get(s.peerId);i&&(t=i.cancelSegmentRequest()),this.peerSegmentRequests.delete(e.id)}return t},this.isDownloading=e=>this.peerSegmentRequests.has(e.id),this.getActiveDownloadsCount=()=>this.peerSegmentRequests.size,this.destroy=(e=!1)=>{this.streamSwarmId=null,this.trackerClient&&(this.trackerClient.stop(),e?(this.trackerClient.removeAllListeners("error"),this.trackerClient.removeAllListeners("warning"),this.trackerClient.removeAllListeners("update"),this.trackerClient.removeAllListeners("peer")):(this.trackerClient.destroy(),this.trackerClient=null)),this.pendingTrackerClient&&(this.pendingTrackerClient.isDestroyed=!0,this.pendingTrackerClient=null),this.peers.forEach((e=>e.destroy())),this.peers.clear(),this.peerSegmentRequests.clear();for(const e of this.peerCandidates.values())for(const t of e)t.destroy();this.peerCandidates.clear()},this.sendSegmentsMapToAll=e=>{this.peers.forEach((t=>t.sendSegmentsMap(e)))},this.sendSegmentsMap=(e,t)=>{const s=this.peers.get(e);s&&s.sendSegmentsMap(t)},this.getOverallSegmentsMap=()=>{const e=new Map;for(const t of this.peers.values())for(const[s,i]of t.getSegmentsMap())i===c.Loaded?e.set(s,c.Loaded):e.get(s)||e.set(s,c.LoadingByHttp);return e},this.onPieceBytesDownloaded=(e,t,s)=>{const i=this.peerSegmentRequests.get(t);i&&this.emit("bytes-downloaded",i.segment,s,e.id)},this.onPieceBytesUploaded=(e,t,s)=>{const i=this.peerSegmentRequests.get(t);this.emit("bytes-uploaded",i?i.segment:null,s,e.id)},this.onPeerConnect=e=>{if(this.peers.get(e.id))return this.debug("tracker peer already connected (in peer connect)",e.id,e),void e.destroy();this.peers.set(e.id,e);const t=this.peerCandidates.get(e.id);if(t){for(const s of t)s!==e&&s.destroy();this.peerCandidates.delete(e.id)}this.emit("peer-connected",{id:e.id,remoteAddress:e.remoteAddress})},this.onPeerClose=e=>{if(this.peers.get(e.id)!==e){const t=this.peerCandidates.get(e.id);if(!t)return;const s=t.indexOf(e);return-1!==s&&t.splice(s,1),void(0===t.length&&this.peerCandidates.delete(e.id))}for(const[t,s]of this.peerSegmentRequests)s.peerId===e.id&&this.peerSegmentRequests.delete(t);this.peers.delete(e.id),this.emit("peer-data-updated"),this.emit("peer-closed",e.id)},this.onPeerDataUpdated=()=>{this.emit("peer-data-updated")},this.onSegmentRequest=(e,t)=>Object(n.a)(this,void 0,void 0,(function*(){if(void 0===this.masterSwarmId)return;const s=yield this.segmentsStorage.getSegment(t,this.masterSwarmId);s&&s.data?e.sendSegmentData(t,s.data):e.sendSegmentAbsent(t)})),this.onSegmentLoaded=(e,t,s)=>Object(n.a)(this,void 0,void 0,(function*(){const i=this.peerSegmentRequests.get(t);if(!i)return;const n=i.segment;if(this.settings.segmentValidator)try{yield this.settings.segmentValidator(Object.assign(Object.assign({},n),{data:s}),"p2p",e.id)}catch(s){return this.debug("segment validator failed",s),this.peerSegmentRequests.delete(t),this.emit("segment-error",n,s,e.id),void this.onPeerClose(e)}this.peerSegmentRequests.delete(t),this.emit("segment-loaded",n,s,e.id)})),this.onSegmentAbsent=(e,t)=>{this.peerSegmentRequests.delete(t),this.emit("peer-data-updated")},this.onSegmentError=(e,t,s)=>{const i=this.peerSegmentRequests.get(t);i&&(this.peerSegmentRequests.delete(t),this.emit("segment-error",i.segment,s,e.id))},this.onSegmentSize=(e,t)=>{const s=this.peerSegmentRequests.get(e);s&&this.emit("segment-size",s.segment,t)},this.onSegmentStartLoad=(e,t)=>{const s=this.peerSegmentRequests.get(e);s&&this.emit("segment-start-load",s.segment,t)},this.onSegmentTimeout=(e,t)=>{const s=this.peerSegmentRequests.get(t);s&&(this.peerSegmentRequests.delete(t),e.destroy(),this.peers.delete(s.peerId)&&this.emit("peer-data-updated"))},this.peerId=t.useP2P?function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t=P;for(let s=0;s<20-P.length;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return(new TextEncoder).encode(t).buffer}():new ArrayBuffer(0),this.debug.enabled&&this.debug("peer ID",this.getPeerId(),(new TextDecoder).decode(this.peerId))}}const R=a()("p2pml:bandwidth-approximator"),q=2e3;class T{constructor(e,t){this.value=e,this.timeStamp=t}}class D{constructor(){this.lastBytes=[],this.currentBytesSum=0,this.lastBandwidth=[],this.addBytes=(e,t)=>{for(R("Add %d bytes.",e),this.lastBytes.push(new T(e,t)),this.currentBytesSum+=e;t-this.lastBytes[0].timeStamp>q;)this.currentBytesSum-=this.lastBytes.shift().value;const s=Math.min(q,t);this.lastBandwidth.push(new T(this.currentBytesSum/s,t))},this.getBandwidth=e=>{for(;0!==this.lastBandwidth.length&&e-this.lastBandwidth[0].timeStamp>4e4;)this.lastBandwidth.shift();let t=0;for(const e of this.lastBandwidth)e.value>t&&(t=e.value);return R("Max bandwidth: %d.",t),t},this.getSmoothInterval=()=>q,this.getMeasureInterval=()=>4e4}}class C{constructor(e){this.settings=e,this.cache=new Map,this.storeSegment=e=>Object(n.a)(this,void 0,void 0,(function*(){this.cache.set(e.id,{segment:e,lastAccessed:performance.now()})})),this.getSegmentsMap=()=>Object(n.a)(this,void 0,void 0,(function*(){return this.cache})),this.getSegment=e=>Object(n.a)(this,void 0,void 0,(function*(){const t=this.cache.get(e);if(void 0!==t)return t.lastAccessed=performance.now(),t.segment})),this.hasSegment=e=>Object(n.a)(this,void 0,void 0,(function*(){return this.cache.has(e)})),this.clean=(e,t)=>Object(n.a)(this,void 0,void 0,(function*(){const e=[],s=[],i=performance.now();for(const t of this.cache.values())i-t.lastAccessed>this.settings.cachedSegmentExpiration?e.push(t.segment.id):s.push(t);let n=s.length-this.settings.cachedSegmentsCount;if(n>0){s.sort(((e,t)=>e.lastAccessed-t.lastAccessed));for(const i of s)if((void 0===t||!t(i.segment.id))&&(e.push(i.segment.id),n--,0===n))break}return e.forEach((e=>this.cache.delete(e))),e.length>0})),this.destroy=()=>Object(n.a)(this,void 0,void 0,(function*(){this.cache.clear()}))}}const L={cachedSegmentExpiration:6e5,cachedSegmentsCount:1e3,useP2P:!0,consumeOnly:!1,requiredSegmentsPriority:3,simultaneousHttpDownloads:2,httpDownloadProbability:.06,httpDownloadProbabilityInterval:1e3,httpDownloadProbabilitySkipIfNoPeers:!1,httpFailedSegmentTimeout:1500,httpDownloadMaxPriority:20,httpDownloadInitialTimeout:0,httpDownloadInitialTimeoutPerSegment:100,httpUseRanges:!1,simultaneousP2PDownloads:20,p2pDownloadMaxPriority:50,p2pSegmentDownloadTimeout:6e4,webRtcMaxMessageSize:65535,trackerAnnounce:["wss://tracker.novage.com.ua","wss://tracker.openwebtorrent.com"],peerRequestsPerAnnounce:10,rtcConfig:h.a.config};class U extends r.EventEmitter{constructor(e={}){super(),this.debug=a()("p2pml:hybrid-loader"),this.debugSegments=a()("p2pml:hybrid-loader-segments"),this.segmentsQueue=[],this.bandwidthApproximator=new D,this.httpDownloadInitialTimeoutTimestamp=-1/0,this.createHttpManager=()=>new m(this.settings),this.createP2PManager=()=>new I(this.segmentsStorage,this.settings),this.load=(e,t)=>Object(n.a)(this,void 0,void 0,(function*(){void 0===this.httpRandomDownloadInterval&&(this.httpRandomDownloadInterval=setInterval(this.downloadRandomSegmentOverHttp,this.settings.httpDownloadProbabilityInterval),this.settings.httpDownloadInitialTimeout>0&&this.settings.httpDownloadInitialTimeoutPerSegment>0&&(this.debugSegments("enable initial HTTP download timeout",this.settings.httpDownloadInitialTimeout,"per segment",this.settings.httpDownloadInitialTimeoutPerSegment),this.httpDownloadInitialTimeoutTimestamp=this.now(),setTimeout(this.processInitialSegmentTimeout,this.settings.httpDownloadInitialTimeoutPerSegment+100))),e.length>0&&(this.masterSwarmId=e[0].masterSwarmId),void 0!==this.masterSwarmId&&this.p2pManager.setStreamSwarmId(t,this.masterSwarmId),this.debug("load segments");let s=!1;for(const t of this.segmentsQueue)e.find((e=>e.url===t.url))||(this.debug("remove segment",t.url),this.httpManager.isDownloading(t)?(s=!0,this.httpManager.abort(t)):this.p2pManager.abort(t),this.emit(i.SegmentAbort,t));if(this.debug.enabled)for(const t of e)this.segmentsQueue.find((e=>e.url===t.url))||this.debug("add segment",t.url);if(this.segmentsQueue=e,void 0===this.masterSwarmId)return;let n=yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId);s=this.processSegmentsQueue(n)||s,(yield this.cleanSegmentsStorage())&&(n=yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId),s=!0),s&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(n))})),this.getSegment=e=>Object(n.a)(this,void 0,void 0,(function*(){return void 0===this.masterSwarmId?void 0:this.segmentsStorage.getSegment(e,this.masterSwarmId)})),this.getSettings=()=>this.settings,this.getDetails=()=>({peerId:this.p2pManager.getPeerId()}),this.getBandwidthEstimate=()=>this.bandwidthApproximator.getBandwidth(this.now()),this.destroy=()=>Object(n.a)(this,void 0,void 0,(function*(){void 0!==this.httpRandomDownloadInterval&&(clearInterval(this.httpRandomDownloadInterval),this.httpRandomDownloadInterval=void 0),this.httpDownloadInitialTimeoutTimestamp=-1/0,this.segmentsQueue=[],this.httpManager.destroy(),this.p2pManager.destroy(),this.masterSwarmId=void 0,yield this.segmentsStorage.destroy()})),this.processInitialSegmentTimeout=()=>Object(n.a)(this,void 0,void 0,(function*(){if(void 0!==this.httpRandomDownloadInterval){if(void 0!==this.masterSwarmId){const e=yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId);this.processSegmentsQueue(e)&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(e))}this.httpDownloadInitialTimeoutTimestamp!==-1/0&&setTimeout(this.processInitialSegmentTimeout,this.settings.httpDownloadInitialTimeoutPerSegment)}})),this.processSegmentsQueue=e=>{if(this.debugSegments("process segments queue. priority",this.segmentsQueue.length>0?this.segmentsQueue[0].priority:0),void 0===this.masterSwarmId||0===this.segmentsQueue.length)return!1;let t,s=!1,i=!0;if(this.httpDownloadInitialTimeoutTimestamp!==-1/0){let t;for(const s of this.segmentsQueue)if(!e.has(s.id)){t=s.priority;break}const s=this.now()-this.httpDownloadInitialTimeoutTimestamp;i=s>=this.settings.httpDownloadInitialTimeout||void 0!==t&&s>this.settings.httpDownloadInitialTimeoutPerSegment&&t<=0,i&&(this.debugSegments("cancel initial HTTP download timeout - timed out"),this.httpDownloadInitialTimeoutTimestamp=-1/0)}for(let n=0;n<this.segmentsQueue.length;n++){const o=this.segmentsQueue[n];if(!e.has(o.id))if(this.httpManager.isDownloading(o))this.httpManager.updatePriority(o);else{if(o.priority<=this.settings.requiredSegmentsPriority&&i&&!this.httpManager.isFailed(o)){if(this.httpManager.getActiveDownloadsCount()>=this.settings.simultaneousHttpDownloads)for(let e=this.segmentsQueue.length-1;e>n;e--){const t=this.segmentsQueue[e];if(this.httpManager.isDownloading(t)){this.debugSegments("cancel HTTP download",t.priority,t.url),this.httpManager.abort(t);break}}if(this.httpManager.getActiveDownloadsCount()<this.settings.simultaneousHttpDownloads){const e=this.p2pManager.abort(o);this.httpManager.download(o,e),this.debugSegments("HTTP download (priority)",o.priority,o.url),s=!0;continue}}if(!this.p2pManager.isDownloading(o))if(o.priority<=this.settings.requiredSegmentsPriority){if(t=t||this.p2pManager.getOverallSegmentsMap(),t.get(o.id)!==c.Loaded)continue;if(this.p2pManager.getActiveDownloadsCount()>=this.settings.simultaneousP2PDownloads)for(let e=this.segmentsQueue.length-1;e>n;e--){const t=this.segmentsQueue[e];if(this.p2pManager.isDownloading(t)){this.debugSegments("cancel P2P download",t.priority,t.url),this.p2pManager.abort(t);break}}if(this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&this.p2pManager.download(o)){this.debugSegments("P2P download (priority)",o.priority,o.url);continue}}else this.p2pManager.getActiveDownloadsCount()<this.settings.simultaneousP2PDownloads&&o.priority<=this.settings.p2pDownloadMaxPriority&&this.p2pManager.download(o)&&this.debugSegments("P2P download",o.priority,o.url)}}return s},this.downloadRandomSegmentOverHttp=()=>Object(n.a)(this,void 0,void 0,(function*(){if(void 0===this.masterSwarmId||void 0===this.httpRandomDownloadInterval||this.httpDownloadInitialTimeoutTimestamp!==-1/0||this.httpManager.getActiveDownloadsCount()>=this.settings.simultaneousHttpDownloads||this.settings.httpDownloadProbabilitySkipIfNoPeers&&0===this.p2pManager.getPeers().size||this.settings.consumeOnly)return;const e=yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId),t=this.p2pManager.getOverallSegmentsMap(),s=this.segmentsQueue.filter((s=>!this.p2pManager.isDownloading(s)&&!this.httpManager.isDownloading(s)&&!t.has(s.id)&&!this.httpManager.isFailed(s)&&s.priority<=this.settings.httpDownloadMaxPriority&&!e.has(s.id)));if(0===s.length)return;if(Math.random()>this.settings.httpDownloadProbability*s.length)return;const i=s[Math.floor(Math.random()*s.length)];this.debugSegments("HTTP download (random)",i.priority,i.url),this.httpManager.download(i),this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(e))})),this.onSegmentStartLoad=(e,t)=>{this.emit(i.SegmentStartLoad,e,t)},this.onPieceBytesDownloaded=(e,t,s,n)=>{this.bandwidthApproximator.addBytes(s,this.now()),this.emit(i.PieceBytesDownloaded,e,t,s,n)},this.onPieceBytesUploaded=(e,t,s,n)=>{this.emit(i.PieceBytesUploaded,e,t,s,n)},this.onSegmentLoaded=(e,t,s)=>Object(n.a)(this,void 0,void 0,(function*(){if(this.debugSegments("segment loaded",e.id,e.url),void 0===this.masterSwarmId)return;e.data=t,e.downloadBandwidth=this.bandwidthApproximator.getBandwidth(this.now()),yield this.segmentsStorage.storeSegment(e),this.emit(i.SegmentLoaded,e,s);const n=yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId);this.processSegmentsQueue(n),this.settings.consumeOnly||this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(n))})),this.onSegmentError=(e,t,s)=>Object(n.a)(this,void 0,void 0,(function*(){if(this.debugSegments("segment error",e.id,e.url,s,t),this.emit(i.SegmentError,e,t,s),void 0!==this.masterSwarmId){const e=yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId);this.processSegmentsQueue(e)&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(e))}})),this.onSegmentSize=(e,t)=>Object(n.a)(this,void 0,void 0,(function*(){this.debugSegments("segment size",e.id,t),this.emit(i.SegmentSize,e,t)})),this.getStreamSwarmId=e=>void 0===e.streamId?e.masterSwarmId:`${e.masterSwarmId}+${e.streamId}`,this.createSegmentsMap=e=>{const t={},s=(e,s)=>{const i=this.getStreamSwarmId(e),n=e.sequence;let o=t[i];void 0===o&&(o=["",[]],t[i]=o);const a=o[1];o[0]+=0===a.length?n:`|${n}`,a.push(s)};for(const t of e.values())s(t.segment,c.Loaded);for(const e of this.httpManager.getActiveDownloads().values())s(e.segment,c.LoadingByHttp);return t},this.onPeerConnect=e=>Object(n.a)(this,void 0,void 0,(function*(){this.emit(i.PeerConnect,e),this.settings.consumeOnly||void 0===this.masterSwarmId||this.p2pManager.sendSegmentsMap(e.id,this.createSegmentsMap(yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId)))})),this.onPeerClose=e=>{this.emit(i.PeerClose,e)},this.onTrackerUpdate=e=>Object(n.a)(this,void 0,void 0,(function*(){if(this.httpDownloadInitialTimeoutTimestamp!==-1/0&&void 0!==e.incomplete&&e.incomplete<=1&&(this.debugSegments("cancel initial HTTP download timeout - no peers"),this.httpDownloadInitialTimeoutTimestamp=-1/0,void 0!==this.masterSwarmId)){const e=yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId);this.processSegmentsQueue(e)&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(e))}})),this.cleanSegmentsStorage=()=>Object(n.a)(this,void 0,void 0,(function*(){return void 0!==this.masterSwarmId&&this.segmentsStorage.clean(this.masterSwarmId,(e=>void 0!==this.segmentsQueue.find((t=>t.id===e))))})),this.now=()=>performance.now(),this.settings=Object.assign(Object.assign({},L),e);const{bufferedSegmentsCount:t}=e;"number"==typeof t&&(void 0===e.p2pDownloadMaxPriority&&(this.settings.p2pDownloadMaxPriority=t),void 0===e.httpDownloadMaxPriority&&(this.settings.p2pDownloadMaxPriority=t)),this.segmentsStorage=void 0===this.settings.segmentsStorage?new C(this.settings):this.settings.segmentsStorage,this.debug("loader settings",this.settings),this.httpManager=this.createHttpManager(),this.httpManager.on("segment-start-load",(e=>this.onSegmentStartLoad("http",e))),this.httpManager.on("segment-loaded",this.onSegmentLoaded),this.httpManager.on("segment-error",this.onSegmentError),this.httpManager.on("segment-size",this.onSegmentSize),this.httpManager.on("bytes-downloaded",((e,t)=>{this.onPieceBytesDownloaded("http",e,t)})),this.p2pManager=this.createP2PManager(),this.p2pManager.on("segment-start-load",(e=>this.onSegmentStartLoad("p2p",e))),this.p2pManager.on("segment-loaded",this.onSegmentLoaded),this.p2pManager.on("segment-error",this.onSegmentError),this.p2pManager.on("segment-size",this.onSegmentSize),this.p2pManager.on("peer-data-updated",(()=>Object(n.a)(this,void 0,void 0,(function*(){if(void 0===this.masterSwarmId)return;const e=yield this.segmentsStorage.getSegmentsMap(this.masterSwarmId);this.processSegmentsQueue(e)&&!this.settings.consumeOnly&&this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(e))})))),this.p2pManager.on("bytes-downloaded",((e,t,s)=>this.onPieceBytesDownloaded("p2p",e,t,s))),this.p2pManager.on("bytes-uploaded",((e,t,s)=>this.onPieceBytesUploaded("p2p",e,t,s))),this.p2pManager.on("peer-connected",this.onPeerConnect),this.p2pManager.on("peer-closed",this.onPeerClose),this.p2pManager.on("tracker-update",this.onTrackerUpdate)}}U.isSupported=()=>void 0!==window.RTCPeerConnection.prototype.createDataChannel},264:function(e,t){},265:function(e,t){},278:function(e,t){},279:function(e,t){},280:function(e,t){},283:function(e,t){},284:function(e,t){},289:function(e,t){},516:function(e,t,s){"use strict";s.r(t),s.d(t,"version",(function(){return S})),s.d(t,"Engine",(function(){return p})),s.d(t,"SegmentManager",(function(){return l})),s.d(t,"initHlsJsPlayer",(function(){return f})),s.d(t,"initClapprPlayer",(function(){return w})),s.d(t,"initFlowplayerHlsJsPlayer",(function(){return y})),s.d(t,"initVideoJsContribHlsJsPlayer",(function(){return b})),s.d(t,"initVideoJsHlsJsPlugin",(function(){return v})),s.d(t,"initMediaElementJsPlayer",(function(){return P})),s.d(t,"initJwPlayer",(function(){return M}));var i=s(1),n=s(159),o=s(201),a=s(517);function r(e){return e.rangeEnd&&void 0!==e.rangeStart?{offset:e.rangeStart,length:e.rangeEnd-e.rangeStart}:void 0}function d(e,t){return void 0===e?void 0===t:void 0!==t&&e.length===t.length&&e.offset===t.offset}function h(e){if(void 0===e)return;const t=e.offset+e.length-1;return`bytes=${e.offset}-${t}`}const g={forwardSegmentCount:20,swarmId:void 0,assetsStorage:void 0};class l{constructor(e,t={}){this.masterPlaylist=null,this.variantPlaylists=new Map,this.segmentRequest=null,this.playQueue=[],this.onSegmentLoaded=e=>{this.segmentRequest&&this.segmentRequest.segmentUrl===e.url&&h(this.segmentRequest.segmentByteRange)===e.range&&(this.segmentRequest.onSuccess(e.data.slice(0),e.downloadBandwidth),this.segmentRequest=null)},this.onSegmentError=(e,t)=>{this.segmentRequest&&this.segmentRequest.segmentUrl===e.url&&h(this.segmentRequest.segmentByteRange)===e.range&&(this.segmentRequest.onError(t),this.segmentRequest=null)},this.onSegmentAbort=e=>{this.segmentRequest&&this.segmentRequest.segmentUrl===e.url&&h(this.segmentRequest.segmentByteRange)===e.range&&(this.segmentRequest.onError("Loading aborted: internal abort"),this.segmentRequest=null)},this.settings=Object.assign(Object.assign({},g),t),this.loader=e,this.loader.on(o.a.SegmentLoaded,this.onSegmentLoaded),this.loader.on(o.a.SegmentError,this.onSegmentError),this.loader.on(o.a.SegmentAbort,this.onSegmentAbort)}getSettings(){return this.settings}processPlaylist(e,t,s){const i=new a.a;i.push(t),i.end();const n=new m(e,s,i.manifest);if(n.manifest.playlists){this.masterPlaylist=n;for(const[e,t]of this.variantPlaylists){const{streamSwarmId:s,found:i,index:n}=this.getStreamSwarmId(t.requestUrl);i?(t.streamSwarmId=s,t.streamId="V"+n.toString()):this.variantPlaylists.delete(e)}}else{const{streamSwarmId:t,found:s,index:i}=this.getStreamSwarmId(e);(s||null===this.masterPlaylist)&&(n.streamSwarmId=t,n.streamId=null===this.masterPlaylist?void 0:"V"+i.toString(),this.variantPlaylists.set(e,n),this.updateSegments())}}loadPlaylist(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=this.settings.assetsStorage;let s;if(void 0!==t){let i;i=this.getMasterSwarmId(),void 0===i&&(i=e.split("?")[0]);const n=yield t.getAsset(e,void 0,i);void 0!==n?s={responseURL:n.responseUri,response:n.data}:(s=yield this.loadContent(e,"text"),t.storeAsset({masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:e,masterSwarmId:i,requestUri:e,responseUri:s.responseURL,data:s.response}))}else s=yield this.loadContent(e,"text");return this.processPlaylist(e,s.response,s.responseURL),s}))}loadSegment(e,t){var s;return Object(i.a)(this,void 0,void 0,(function*(){const i=this.getSegmentLocation(e,t),n=h(t);if(!i){let t;const i=this.settings.assetsStorage;if(void 0!==i){let o,a=null===(s=this.masterPlaylist)||void 0===s?void 0:s.requestUrl;if(o=this.getMasterSwarmId(),void 0===o&&1===this.variantPlaylists.size){const e=this.variantPlaylists.values().next();e.done||(o=e.value.requestUrl.split("?")[0])}if(void 0===a&&1===this.variantPlaylists.size){const e=this.variantPlaylists.values().next();e.done||(a=e.value.requestUrl)}if(void 0!==o&&void 0!==a){const s=yield i.getAsset(e,n,o);if(void 0!==s)t=s.data;else{const s=yield this.loadContent(e,"arraybuffer",n);t=s.response,i.storeAsset({masterManifestUri:a,masterSwarmId:o,requestUri:e,requestRange:n,responseUri:s.responseURL,data:t})}}}if(void 0===t){t=(yield this.loadContent(e,"arraybuffer",n)).response}return{content:t,downloadBandwidth:0}}const o=(i.playlist.manifest.mediaSequence?i.playlist.manifest.mediaSequence:0)+i.segmentIndex;if(this.playQueue.length>0){this.playQueue[this.playQueue.length-1].segmentSequence!==o-1&&(this.playQueue=[])}this.segmentRequest&&this.segmentRequest.onError("Cancel segment request: simultaneous segment requests are not supported");const a=new Promise(((s,n)=>{this.segmentRequest=new u(e,t,o,i.playlist.requestUrl,((e,t)=>s({content:e,downloadBandwidth:t})),(e=>n(e)))}));return this.playQueue.push({segmentUrl:e,segmentByteRange:t,segmentSequence:o}),this.loadSegments(i.playlist,i.segmentIndex,!0),a}))}setPlayingSegment(e,t,s,i){const n=this.playQueue.findIndex((s=>s.segmentUrl===e&&d(s.segmentByteRange,t)));n>=0&&(this.playQueue=this.playQueue.slice(n),this.playQueue[0].playPosition={start:s,duration:i},this.updateSegments())}setPlayingSegmentByCurrentTime(e){if(0===this.playQueue.length||!this.playQueue[0].playPosition)return;const t=this.playQueue[0].playPosition;t.start+t.duration-e<.2&&(this.playQueue=this.playQueue.slice(1),this.updateSegments())}abortSegment(e,t){this.segmentRequest&&this.segmentRequest.segmentUrl===e&&d(this.segmentRequest.segmentByteRange,t)&&(this.segmentRequest.onSuccess(void 0,0),this.segmentRequest=null)}destroy(){return Object(i.a)(this,void 0,void 0,(function*(){this.segmentRequest&&(this.segmentRequest.onError("Loading aborted: object destroyed"),this.segmentRequest=null),this.masterPlaylist=null,this.variantPlaylists.clear(),this.playQueue=[],void 0!==this.settings.assetsStorage&&(yield this.settings.assetsStorage.destroy()),yield this.loader.destroy()}))}updateSegments(){if(!this.segmentRequest)return;const e=this.getSegmentLocation(this.segmentRequest.segmentUrl,this.segmentRequest.segmentByteRange);e&&this.loadSegments(e.playlist,e.segmentIndex,!1)}getSegmentLocation(e,t){for(const s of this.variantPlaylists.values()){const i=s.getSegmentIndex(e,t);if(i>=0)return{playlist:s,segmentIndex:i}}}loadSegments(e,t,s){var n;return Object(i.a)(this,void 0,void 0,(function*(){const i=[],o=e.manifest.segments,a=null!==(n=e.manifest.mediaSequence)&&void 0!==n?n:0;let r=null,d=Math.max(0,this.playQueue.length-1);const g=this.getMasterSwarmId();for(let n=t;n<o.length&&i.length<this.settings.forwardSegmentCount;++n){const t=e.manifest.segments[n],o=e.getSegmentAbsoluteUrl(t.uri),l=t.byterange,m=this.getSegmentId(e,a+n);i.push({id:m,url:o,masterSwarmId:void 0!==g?g:e.streamSwarmId,masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:e.requestUrl,streamId:e.streamId,sequence:(a+n).toString(),range:h(l),priority:d++}),s&&!r&&(r=m)}if(this.loader.load(i,e.streamSwarmId),r){const e=yield this.loader.getSegment(r);e&&this.onSegmentLoaded(e)}}))}getSegmentId(e,t){return`${e.streamSwarmId}+${t}`}getMasterSwarmId(){const e=this.settings.swarmId&&0!==this.settings.swarmId.length?this.settings.swarmId:void 0;return void 0!==e?e:null!==this.masterPlaylist?this.masterPlaylist.requestUrl.split("?")[0]:void 0}getStreamSwarmId(e){const t=this.getMasterSwarmId();if(this.masterPlaylist&&this.masterPlaylist.manifest.playlists&&t)for(let s=0;s<this.masterPlaylist.manifest.playlists.length;++s){if(new URL(this.masterPlaylist.manifest.playlists[s].uri,this.masterPlaylist.responseUrl).toString()===e)return{streamSwarmId:`${t}+V${s}`,found:!0,index:s}}return{streamSwarmId:null!=t?t:e.split("?")[0],found:!1,index:-1}}loadContent(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){return new Promise(((i,n)=>{const o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=t,s&&o.setRequestHeader("Range",s),o.addEventListener("readystatechange",(()=>{4===o.readyState&&(o.status>=200&&o.status<300?i(o):n(o.statusText))}));const a=this.loader.getSettings().xhrSetup;a&&a(o,e),o.send()}))}))}}class m{constructor(e,t,s){this.requestUrl=e,this.responseUrl=t,this.manifest=s,this.streamSwarmId=""}getSegmentIndex(e,t){for(let s=0;s<this.manifest.segments.length;++s){const i=this.manifest.segments[s];if(e===this.getSegmentAbsoluteUrl(i.uri)&&d(i.byterange,t))return s}return-1}getSegmentAbsoluteUrl(e){return new URL(e,this.responseUrl).toString()}}class u{constructor(e,t,s,i,n,o){this.segmentUrl=e,this.segmentByteRange=t,this.segmentSequence=s,this.playlistRequestUrl=i,this.onSuccess=n,this.onError=o}}class c{constructor(e){this.isLoaded=!1,this.stats={loaded:0,total:0,aborted:!1,retry:0,chunkCount:0,bwEstimate:0,loading:{start:0,end:0,first:0},parsing:{start:0,end:0},buffering:{start:0,end:0,first:0}},this.segmentManager=e}load(e,t,s){return Object(i.a)(this,void 0,void 0,(function*(){if(c.updateStatsToStartLoading(this.stats),e.type)try{const t=yield this.segmentManager.loadPlaylist(e.url);this.isLoaded=!0,this.successPlaylist(t,e,s)}catch(t){this.error(t,e,s)}else if(e.frag){const{loader:t}=this.segmentManager,i=r(e),n=t=>t.url===e.url&&t.range===h(i);let a=setInterval((()=>{c.updateStatsToStartLoading(this.stats)}),200);const d=(e,t)=>{n(e)&&(this.stats.total=t)};t.on(o.a.SegmentSize,d);const g=(e,t,s)=>{n(t)&&(this.stats.loaded+=s)},l=(e,s)=>{a&&"http"===e&&n(s)&&(clearInterval(a),a=void 0,c.updateStatsToStartLoading(this.stats),t.on(o.a.PieceBytesDownloaded,g))};t.on(o.a.SegmentStartLoad,l);try{const n=yield this.segmentManager.loadSegment(e.url,i),{content:r}=n;r&&(this.isLoaded=!0,setTimeout((()=>this.successSegment(r,e,s)),0))}catch(t){setTimeout((()=>this.error(t,e,s)),0)}finally{clearInterval(a),t.off(o.a.SegmentStartLoad,l),t.off(o.a.SegmentSize,d),t.off(o.a.PieceBytesDownloaded,g)}}else console.warn("Unknown load request",e)}))}abort(e,t){if(this.isLoaded)return;this.segmentManager.abortSegment(e.url,r(e)),this.stats.aborted=!0;const s=null==t?void 0:t.onAbort;s&&s(this.stats,e,void 0)}successPlaylist(e,t,s){const i=performance.now();this.stats.loading.end=i,this.stats.loaded=e.response.length,this.stats.total=e.response.length,s.onSuccess({url:e.responseURL,data:e.response},this.stats,t,void 0)}successSegment(e,t,s){const i=performance.now();this.stats.loading.end=i,this.stats.loaded=e.byteLength,this.stats.total=e.byteLength,s.onProgress&&s.onProgress(this.stats,t,e,void 0),s.onSuccess({url:t.url,data:e},this.stats,t,void 0)}error(e,t,s){s.onError(e,t,void 0)}static updateStatsToStartLoading(e){const t=performance.now();e.loading.start=t,e.loading.first=t}}class p extends n.EventEmitter{constructor(e={}){super(),this.loader=new o.b(e.loader),this.segmentManager=new l(this.loader,e.segments),Object.keys(o.a).map((e=>o.a[e])).forEach((e=>this.loader.on(e,((...t)=>this.emit(e,...t)))))}static isSupported(){return o.b.isSupported()}createLoaderClass(){var e;const t=this;return(e=class{constructor(){this.load=(e,t,s)=>Object(i.a)(this,void 0,void 0,(function*(){this.context=e,this.callbacks=s,this.impl.load(e,t,s)})),this.abort=()=>{this.context&&this.impl.abort(this.context,this.callbacks)},this.destroy=()=>{this.context&&this.impl.abort(this.context)},this.getResponseHeader=()=>{},this.impl=new c(t.segmentManager),this.stats=this.impl.stats}}).getEngine=()=>t,e}destroy(){return Object(i.a)(this,void 0,void 0,(function*(){yield this.segmentManager.destroy()}))}getSettings(){return{segments:this.segmentManager.getSettings(),loader:this.loader.getSettings()}}getDetails(){return{loader:this.loader.getDetails()}}setPlayingSegment(e,t,s,i){this.segmentManager.setPlayingSegment(e,t,s,i)}setPlayingSegmentByCurrentTime(e){this.segmentManager.setPlayingSegmentByCurrentTime(e)}}const S="0.6.2";function f(e){e&&e.config&&e.config.loader&&"function"==typeof e.config.loader.getEngine&&I(e,e.config.loader.getEngine())}function w(e){e.on("play",(()=>{const t=e.core.getCurrentPlayback();t._hls&&!t._hls._p2pm_linitialized&&(t._hls._p2pm_linitialized=!0,f(e.core.getCurrentPlayback()._hls))}))}function y(e){e.on("ready",(()=>{var t;return f(null!==(t=e.engine.hlsjs)&&void 0!==t?t:e.engine.hls)}))}function b(e){e.ready((()=>{const t=e.tech_.options_;t&&t.hlsjsConfig&&t.hlsjsConfig.loader&&"function"==typeof t.hlsjsConfig.loader.getEngine&&I(e.tech_,t.hlsjsConfig.loader.getEngine())}))}function v(){null!=videojs&&null!=videojs.Html5Hlsjs&&videojs.Html5Hlsjs.addHook("beforeinitialize",((e,t)=>{t.config&&t.config.loader&&"function"==typeof t.config.loader.getEngine&&I(t,t.config.loader.getEngine())}))}function P(e){e.addEventListener("hlsFragChanged",(t=>{const s=e.hlsPlayer;if(s&&s.config&&s.config.loader&&"function"==typeof s.config.loader.getEngine){const e=s.config.loader.getEngine();if(t.data&&t.data.length>1){const s=t.data[1].frag,i=2!==s.byteRange.length?void 0:{offset:s.byteRange[0],length:s.byteRange[1]-s.byteRange[0]};e.setPlayingSegment(s.url,i,s.start,s.duration)}}})),e.addEventListener("hlsDestroying",(()=>Object(i.a)(this,void 0,void 0,(function*(){const t=e.hlsPlayer;if(t&&t.config&&t.config.loader&&"function"==typeof t.config.loader.getEngine){const e=t.config.loader.getEngine();yield e.destroy()}})))),e.addEventListener("hlsError",(t=>{const s=e.hlsPlayer;if(s&&s.config&&s.config.loader&&"function"==typeof s.config.loader.getEngine&&void 0!==t.data&&"bufferStalledError"===t.data.details){s.config.loader.getEngine().setPlayingSegmentByCurrentTime(s.media.currentTime)}}))}function M(e,t){const s=setInterval((()=>{e.hls&&e.hls.config&&(clearInterval(s),Object.assign(e.hls.config,t),f(e.hls))}),200)}function I(e,t){e.on("hlsFragChanged",((e,s)=>{const i=s.frag,n=2!==i.byteRange.length?void 0:{offset:i.byteRange[0],length:i.byteRange[1]-i.byteRange[0]};t.setPlayingSegment(i.url,n,i.start,i.duration)})),e.on("hlsDestroying",(()=>Object(i.a)(this,void 0,void 0,(function*(){yield t.destroy()})))),e.on("hlsError",((s,i)=>{if("bufferStalledError"===i.details){const s=void 0===e.media?e.el_:e.media;s&&t.setPlayingSegmentByCurrentTime(s.currentTime)}}))}}}]);
//# sourceMappingURL=1.chunk.js.map