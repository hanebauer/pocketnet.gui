{"version":3,"file":"526.chunk.js?v=2488","mappings":"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","sources":["webpack://peertube-client/./src/assets/player/shared/videojs-helpers/guid.js","webpack://peertube-client/./src/assets/player/shared/videojs-helpers/fn.js","webpack://peertube-client/./src/assets/player/shared/videojs-helpers/hotkeys.js","webpack://peertube-client/./src/assets/player/peertube-player-local-storage.ts","webpack://peertube-client/./src/assets/player/shared/upnext/end-card.ts","webpack://peertube-client/./src/assets/player/shared/upnext/upnext-plugin.ts","webpack://peertube-client/./src/assets/player/shared/stats/stats-card.ts","webpack://peertube-client/./src/assets/player/shared/stats/stats-plugin.ts","webpack://peertube-client/./src/assets/player/shared/bezels/pause-bezel.ts","webpack://peertube-client/./src/assets/player/shared/bezels/bezels-plugin.ts","webpack://peertube-client/./src/assets/player/shared/peertube/peertube-plugin.ts","webpack://peertube-client/./src/assets/player/shared/resolutions/peertube-resolutions-plugin.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/next-previous-video-button.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/p2p-info-button.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/picture-in-picture-bastyon.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/peertube-load-progress-bar.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/theater-button.ts","webpack://peertube-client/./src/assets/player/shared/settings/resolution-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/settings/resolution-menu-button.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-dialog.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-menu-button.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-panel.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-panel-child.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-button.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-menu.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-plugin.ts","webpack://peertube-client/./src/assets/player/shared/mobile/peertube-mobile-plugin.ts","webpack://peertube-client/./src/assets/player/shared/mobile/peertube-mobile-buttons.ts","webpack://peertube-client/./src/assets/player/shared/hotkeys/peertube-hotkeys-plugin.ts","webpack://peertube-client/./src/root-helpers/utils.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/control-bar-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/redundancy-url-manager.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/segment-url-builder.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/segment-validator.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/hls-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/webtorrent-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/manager-options-builder.ts","webpack://peertube-client/./src/assets/player/peertube-player-manager.ts","webpack://peertube-client/./src/assets/player/shared/common/utils.ts","webpack://peertube-client/./src/root-helpers/web-browser.ts","webpack://peertube-client/./src/shims/path.ts","webpack://peertube-client/../shared/core-utils/i18n/i18n.ts","webpack://peertube-client/../shared/core-utils/common/date.ts","webpack://peertube-client/../shared/core-utils/common/object.ts","webpack://peertube-client/../shared/core-utils/common/url.ts","webpack://peertube-client/../shared/core-utils/renderer/markdown.ts"],"sourcesContent":["/**\n * @file guid.js\n * @module guid\n */\n\n// Default value for GUIDs. This allows us to reset the GUID counter in tests.\n//\n// The initial GUID is 3 because some users have come to rely on the first\n// default player ID ending up as `vjs_video_3`.\n//\n// See: https://github.com/videojs/video.js/pull/6216\nconst _initialGuid = 3;\n\n/**\n * Unique ID for an element or function\n *\n * @type {Number}\n */\nlet _guid = _initialGuid;\n\n/**\n * Get a unique auto-incrementing ID by number that has not been returned before.\n *\n * @return {number}\n *         A new unique ID.\n */\nexport function newGUID() {\n  return _guid++;\n}\n\n/**\n * Reset the unique auto-incrementing ID for testing only.\n */\nexport function resetGuidInTestsOnly() {\n  _guid = _initialGuid;\n}","\n/**\n * @file fn.js\n * @module fn\n */\n import { newGUID } from './guid.js';\n import window from 'global/window';\n \n export const UPDATE_REFRESH_INTERVAL = 30;\n \n /**\n  * Bind (a.k.a proxy or context). A simple method for changing the context of\n  * a function.\n  *\n  * It also stores a unique id on the function so it can be easily removed from\n  * events.\n  *\n  * @function\n  * @param    {Mixed} context\n  *           The object to bind as scope.\n  *\n  * @param    {Function} fn\n  *           The function to be bound to a scope.\n  *\n  * @param    {number} [uid]\n  *           An optional unique ID for the function to be set\n  *\n  * @return   {Function}\n  *           The new function that will be bound into the context given\n  */\n export const bind = function(context, fn, uid) {\n   // Make sure the function has a unique ID\n   if (!fn.guid) {\n     fn.guid = newGUID();\n   }\n \n   // Create the new function that changes the context\n   const bound = fn.bind(context);\n \n   // Allow for the ability to individualize this function\n   // Needed in the case where multiple objects might share the same prototype\n   // IF both items add an event listener with the same function, then you try to remove just one\n   // it will remove both because they both have the same guid.\n   // when using this, you need to use the bind method when you remove the listener as well.\n   // currently used in text tracks\n   bound.guid = (uid) ? uid + '_' + fn.guid : fn.guid;\n \n   return bound;\n };\n \n /**\n  * Wraps the given function, `fn`, with a new function that only invokes `fn`\n  * at most once per every `wait` milliseconds.\n  *\n  * @function\n  * @param    {Function} fn\n  *           The function to be throttled.\n  *\n  * @param    {number}   wait\n  *           The number of milliseconds by which to throttle.\n  *\n  * @return   {Function}\n  */\n export const throttle = function(fn, wait) {\n   let last = window.performance.now();\n \n   const throttled = function(...args) {\n     const now = window.performance.now();\n \n     if (now - last >= wait) {\n       fn(...args);\n       last = now;\n     }\n   };\n \n   return throttled;\n };\n \n /**\n  * Creates a debounced function that delays invoking `func` until after `wait`\n  * milliseconds have elapsed since the last time the debounced function was\n  * invoked.\n  *\n  * Inspired by lodash and underscore implementations.\n  *\n  * @function\n  * @param    {Function} func\n  *           The function to wrap with debounce behavior.\n  *\n  * @param    {number} wait\n  *           The number of milliseconds to wait after the last invocation.\n  *\n  * @param    {boolean} [immediate]\n  *           Whether or not to invoke the function immediately upon creation.\n  *\n  * @param    {Object} [context=window]\n  *           The \"context\" in which the debounced function should debounce. For\n  *           example, if this function should be tied to a Video.js player,\n  *           the player can be passed here. Alternatively, defaults to the\n  *           global `window` object.\n  *\n  * @return   {Function}\n  *           A debounced function.\n  */\n export const debounce = function(func, wait, immediate, context = window) {\n   let timeout;\n \n   const cancel = () => {\n     context.clearTimeout(timeout);\n     timeout = null;\n   };\n \n   /* eslint-disable consistent-this */\n   const debounced = function() {\n     const self = this;\n     const args = arguments;\n \n     let later = function() {\n       timeout = null;\n       later = null;\n       if (!immediate) {\n         func.apply(self, args);\n       }\n     };\n \n     if (!timeout && immediate) {\n       func.apply(self, args);\n     }\n \n     context.clearTimeout(timeout);\n     timeout = context.setTimeout(later, wait);\n   };\n   /* eslint-enable consistent-this */\n \n   debounced.cancel = cancel;\n \n   return debounced;\n };","/*\n * Video.js Hotkeys\n * https://github.com/ctd1500/videojs-hotkeys\n *\n * Copyright (c) 2015 Chris Dougherty\n * Licensed under the Apache-2.0 license.\n */\n\n;(function(root, factory) {\n    if (typeof window !== 'undefined' && window.videojs) {\n      factory(window.videojs);\n    } else if (typeof define === 'function' && define.amd) {\n      define('videojs-hotkeys', ['video.js'], function (module) {\n        return factory(module.default || module);\n      });\n    } else if (typeof module !== 'undefined' && module.exports) {\n      module.exports = factory(require('video.js'));\n    }\n  }(this, function (videojs) {\n    \"use strict\";\n    if (typeof window !== 'undefined') {\n      window['videojs_hotkeys'] = { version: \"0.2.27\" };\n    }\n\n    console.log(\"????????????????\")\n  \n    var hotkeys = function(options) {\n      var player = this;\n      var pEl = player.el();\n      var doc = document;\n      var def_options = {\n        volumeStep: 0.1,\n        seekStep: 5,\n        enableMute: true,\n        enableVolumeScroll: true,\n        enableHoverScroll: false,\n        enableFullscreen: true,\n        enableNumbers: true,\n        enableJogStyle: false,\n        alwaysCaptureHotkeys: false,\n        captureDocumentHotkeys: false,\n        documentHotkeysFocusElementFilter: function () { return false },\n        enableModifiersForNumbers: true,\n        enableInactiveFocus: true,\n        skipInitialFocus: false,\n        playPauseKey: playPauseKey,\n        rewindKey: rewindKey,\n        forwardKey: forwardKey,\n        volumeUpKey: volumeUpKey,\n        volumeDownKey: volumeDownKey,\n        muteKey: muteKey,\n        fullscreenKey: fullscreenKey,\n        customKeys: {}\n      };\n  \n      var cPlay = 1,\n        cRewind = 2,\n        cForward = 3,\n        cVolumeUp = 4,\n        cVolumeDown = 5,\n        cMute = 6,\n        cFullscreen = 7;\n  \n      // Use built-in merge function from Video.js v5.0+ or v4.4.0+\n      var mergeOptions = videojs.mergeOptions || videojs.util.mergeOptions;\n      options = mergeOptions(def_options, options || {});\n  \n      var volumeStep = options.volumeStep,\n        seekStep = options.seekStep,\n        enableMute = options.enableMute,\n        enableVolumeScroll = options.enableVolumeScroll,\n        enableHoverScroll = options.enableHoverScroll,\n        enableFull = options.enableFullscreen,\n        enableNumbers = options.enableNumbers,\n        enableJogStyle = options.enableJogStyle,\n        alwaysCaptureHotkeys = options.alwaysCaptureHotkeys,\n        captureDocumentHotkeys = options.captureDocumentHotkeys,\n        documentHotkeysFocusElementFilter = options.documentHotkeysFocusElementFilter,\n        enableModifiersForNumbers = options.enableModifiersForNumbers,\n        enableInactiveFocus = options.enableInactiveFocus,\n        skipInitialFocus = options.skipInitialFocus;\n  \n      var videojsVer = videojs.VERSION;\n  \n      // Set default player tabindex to handle keydown and doubleclick events\n      if (!pEl.hasAttribute('tabIndex')) {\n        pEl.setAttribute('tabIndex', '-1');\n      }\n  \n      // Remove player outline to fix video performance issue\n      pEl.style.outline = \"none\";\n  \n      if (alwaysCaptureHotkeys || !player.autoplay()) {\n        if (!skipInitialFocus) {\n          player.one('play', function() {\n            pEl.focus(); // Fixes the .vjs-big-play-button handing focus back to body instead of the player\n          });\n        }\n      }\n  \n      if (enableInactiveFocus) {\n        player.on('userinactive', function() {\n          // When the control bar fades, re-apply focus to the player if last focus was a control button\n          var cancelFocusingPlayer = function() {\n            clearTimeout(focusingPlayerTimeout);\n          };\n          var focusingPlayerTimeout = setTimeout(function() {\n            player.off('useractive', cancelFocusingPlayer);\n            var activeElement = doc.activeElement;\n            var controlBar = pEl.querySelector('.vjs-control-bar');\n            if (activeElement && activeElement.parentElement == controlBar) {\n              pEl.focus();\n            }\n          }, 10);\n  \n          player.one('useractive', cancelFocusingPlayer);\n        });\n      }\n  \n      player.on('play', function() {\n        // Fix allowing the YouTube plugin to have hotkey support.\n        var ifblocker = pEl.querySelector('.iframeblocker');\n        if (ifblocker && ifblocker.style.display === '') {\n          ifblocker.style.display = \"block\";\n          ifblocker.style.bottom = \"39px\";\n        }\n      });\n  \n      var keyDown = function keyDown(event) {\n        console.log(event)\n        var ewhich = event.which, wasPlaying, seekTime;\n        var ePreventDefault = event.preventDefault.bind(event);\n        var duration = player.duration();\n        // When controls are disabled, hotkeys will be disabled as well\n        if (player.controls()) {\n  \n          // Don't catch keys if any control buttons are focused, unless alwaysCaptureHotkeys is true\n          var activeEl = doc.activeElement;\n          if (\n            alwaysCaptureHotkeys ||\n            (captureDocumentHotkeys && documentHotkeysFocusElementFilter(activeEl)) ||\n  \n            activeEl == pEl ||\n            activeEl == pEl.querySelector('.vjs-tech') ||\n            activeEl == pEl.querySelector('.vjs-control-bar') ||\n            activeEl == pEl.querySelector('.iframeblocker')\n          ) {\n  \n            switch (checkKeys(event, player)) {\n              // Spacebar toggles play/pause\n              case cPlay:\n                ePreventDefault();\n                if (alwaysCaptureHotkeys || captureDocumentHotkeys) {\n                  // Prevent control activation with space\n                  event.stopPropagation();\n                }\n  \n                if (player.paused()) {\n                  silencePromise(player.play());\n                } else {\n                  player.pause();\n                }\n                break;\n  \n              // Seeking with the left/right arrow keys\n              case cRewind: // Seek Backward\n                wasPlaying = !player.paused();\n                ePreventDefault();\n                /*if (wasPlaying) {\n                  player.pause();\n                }*/\n                seekTime = player.currentTime() - seekStepD(event);\n                // The flash player tech will allow you to seek into negative\n                // numbers and break the seekbar, so try to prevent that.\n                if (seekTime <= 0) {\n                  seekTime = 0;\n                }\n\n                player.currentTime(seekTime);\n               /* if (wasPlaying) {\n                  silencePromise(player.play());\n                }*/\n                break;\n              case cForward: // Seek Forward\n                wasPlaying = !player.paused();\n                ePreventDefault();\n                /*if (wasPlaying) {\n                  player.pause();\n                }*/\n                seekTime = player.currentTime() + seekStepD(event);\n                // Fixes the player not sending the end event if you\n                // try to seek past the duration on the seekbar.\n                if (seekTime >= duration) {\n                  seekTime = wasPlaying ? duration - .001 : duration;\n                }\n                player.currentTime(seekTime);\n                /*if (wasPlaying) {\n                  silencePromise(player.play());\n                }*/\n                break;\n  \n              // Volume control with the up/down arrow keys\n              case cVolumeDown:\n                ePreventDefault();\n                if (!enableJogStyle) {\n                  player.volume(player.volume() - volumeStep);\n                } else {\n                  seekTime = player.currentTime() - 1;\n                  if (player.currentTime() <= 1) {\n                    seekTime = 0;\n                  }\n                  player.currentTime(seekTime);\n                }\n                break;\n              case cVolumeUp:\n                ePreventDefault();\n                if (!enableJogStyle) {\n                  player.volume(player.volume() + volumeStep);\n                } else {\n                  seekTime = player.currentTime() + 1;\n                  if (seekTime >= duration) {\n                    seekTime = duration;\n                  }\n                  player.currentTime(seekTime);\n                }\n                break;\n  \n              // Toggle Mute with the M key\n              case cMute:\n                if (enableMute) {\n                  player.muted(!player.muted());\n                }\n                break;\n  \n              // Toggle Fullscreen with the F key\n              case  cFullscreen:\n                if (enableFull) {\n                  if (player.isFullscreen()) {\n                    player.exitFullscreen();\n                  } else {\n                    player.requestFullscreen();\n                  }\n                }\n                break;\n  \n              default:\n                // Number keys from 0-9 skip to a percentage of the video. 0 is 0% and 9 is 90%\n                if ((ewhich > 47 && ewhich < 59) || (ewhich > 95 && ewhich < 106)) {\n                  // Do not handle if enableModifiersForNumbers set to false and keys are Ctrl, Cmd or Alt\n                  if (enableModifiersForNumbers || !(event.metaKey || event.ctrlKey || event.altKey)) {\n                    if (enableNumbers) {\n                      var sub = 48;\n                      if (ewhich > 95) {\n                        sub = 96;\n                      }\n                      var number = ewhich - sub;\n                      ePreventDefault();\n                      player.currentTime(player.duration() * number * 0.1);\n                    }\n                  }\n                }\n  \n                // Handle any custom hotkeys\n                for (var customKey in options.customKeys) {\n                  var customHotkey = options.customKeys[customKey];\n                  // Check for well formed custom keys\n                  if (customHotkey && customHotkey.key && customHotkey.handler) {\n                    // Check if the custom key's condition matches\n                    if (customHotkey.key(event)) {\n                      ePreventDefault();\n                      customHotkey.handler(player, options, event);\n                    }\n                  }\n                }\n            }\n          }\n        }\n      };\n  \n      var doubleClick = function doubleClick(event) {\n        // Video.js added double-click fullscreen in 7.1.0\n        if (videojsVer != null && videojsVer <= \"7.1.0\") {\n          // When controls are disabled, hotkeys will be disabled as well\n          if (player.controls()) {\n  \n            // Don't catch clicks if any control buttons are focused\n            var activeEl = event.relatedTarget || event.toElement || doc.activeElement;\n            if (activeEl == pEl ||\n                activeEl == pEl.querySelector('.vjs-tech') ||\n                activeEl == pEl.querySelector('.iframeblocker')) {\n  \n              if (enableFull) {\n                if (player.isFullscreen()) {\n                  player.exitFullscreen();\n                } else {\n                  player.requestFullscreen();\n                }\n              }\n            }\n          }\n        }\n      };\n  \n      var volumeHover = false;\n      var volumeSelector = pEl.querySelector('.vjs-volume-menu-button') || pEl.querySelector('.vjs-volume-panel');\n      if (volumeSelector != null) {\n        volumeSelector.onmouseover = function() { volumeHover = true; };\n        volumeSelector.onmouseout = function() { volumeHover = false; };\n      }\n  \n      var mouseScroll = function mouseScroll(event) {\n        if (enableHoverScroll) {\n          // If we leave this undefined then it can match non-existent elements below\n          var activeEl = 0;\n        } else {\n          var activeEl = doc.activeElement;\n        }\n  \n        // When controls are disabled, hotkeys will be disabled as well\n        if (player.controls()) {\n          if (alwaysCaptureHotkeys ||\n              activeEl == pEl ||\n              activeEl == pEl.querySelector('.vjs-tech') ||\n              activeEl == pEl.querySelector('.iframeblocker') ||\n              activeEl == pEl.querySelector('.vjs-control-bar') ||\n              volumeHover) {\n  \n            if (enableVolumeScroll) {\n              event = window.event || event;\n              var delta = Math.max(-1, Math.min(1, (event.wheelDelta || -event.detail)));\n              event.preventDefault();\n  \n              if (delta == 1) {\n                player.volume(player.volume() + volumeStep);\n              } else if (delta == -1) {\n                player.volume(player.volume() - volumeStep);\n              }\n            }\n          }\n        }\n      };\n  \n      var checkKeys = function checkKeys(e, player) {\n        // Allow some modularity in defining custom hotkeys\n  \n        // Play/Pause check\n        if (options.playPauseKey(e, player)) {\n          return cPlay;\n        }\n  \n        // Seek Backward check\n        if (options.rewindKey(e, player)) {\n          return cRewind;\n        }\n  \n        // Seek Forward check\n        if (options.forwardKey(e, player)) {\n          return cForward;\n        }\n  \n        // Volume Up check\n        if (options.volumeUpKey(e, player)) {\n          return cVolumeUp;\n        }\n  \n        // Volume Down check\n        if (options.volumeDownKey(e, player)) {\n          return cVolumeDown;\n        }\n  \n        // Mute check\n        if (options.muteKey(e, player)) {\n          return cMute;\n        }\n  \n        // Fullscreen check\n        if (options.fullscreenKey(e, player)) {\n          return cFullscreen;\n        }\n      };\n  \n      function playPauseKey(e) {\n        // Space bar or MediaPlayPause\n        return (e.which === 32 || e.which === 179);\n      }\n  \n      function rewindKey(e) {\n        // Left Arrow or MediaRewind\n        return (e.which === 37 || e.which === 177);\n      }\n  \n      function forwardKey(e) {\n        // Right Arrow or MediaForward\n        return (e.which === 39 || e.which === 176);\n      }\n  \n      function volumeUpKey(e) {\n        // Up Arrow\n        return (e.which === 38);\n      }\n  \n      function volumeDownKey(e) {\n        // Down Arrow\n        return (e.which === 40);\n      }\n  \n      function muteKey(e) {\n        // M key\n        return (e.which === 77);\n      }\n  \n      function fullscreenKey(e) {\n        // F key\n        return (e.which === 70);\n      }\n  \n      function seekStepD(e) {\n        // SeekStep caller, returns an int, or a function returning an int\n        return (typeof seekStep === \"function\" ? seekStep(e) : seekStep);\n      }\n  \n      function silencePromise(value) {\n        if (value != null && typeof value.then === 'function') {\n          value.then(null, function(e) {console.log(\"E\", e)});\n        }\n      }\n\n\n      var active = false\n\n      console.log(\"HEREEE\")\n\n      player.on('enablehotkeys', function(){\n\n        console.log('enablehotkeys')\n\n        player.on('keydown', keyDown);\n        player.on('dblclick', doubleClick);\n        player.on('mousewheel', mouseScroll);\n        player.on(\"DOMMouseScroll\", mouseScroll);\n    \n        if (captureDocumentHotkeys) {\n          document.addEventListener('keydown', keyDown);\n        }\n\n        active = true\n      })\n\n      var off = function(){\n\n        if(active){\n          player.off('keydown', keyDown);\n          player.off('dblclick', doubleClick);\n          player.off('mousewheel', mouseScroll);\n          player.off(\"DOMMouseScroll\", mouseScroll);\n      \n          if (captureDocumentHotkeys) {\n            document.removeEventListener('keydown', keyDown);\n          }\n        }\n\n        active = false\n       \n      }\n  \n      player.on('disablehotkeys', off)\n      player.on('dispose', function(){\n\n        off()\n\n        player = null\n        pEl = null\n      })\n  \n      return this;\n    };\n  \n    var registerPlugin = videojs.registerPlugin || videojs.plugin;\n    registerPlugin('hotkeys', hotkeys);\n  }));","import { logger } from '@root-helpers/logger'\n\nfunction getStoredVolume () {\n  const value = getLocalStorage('volume')\n  if (value !== null && value !== undefined) {\n    const valueNumber = parseFloat(value)\n    if (isNaN(valueNumber)) return undefined\n\n    return valueNumber\n  }\n\n  return undefined\n}\n\nfunction getStoredMute () {\n  const value = getLocalStorage('mute')\n  if (value !== null && value !== undefined) return value === 'true'\n\n  return undefined\n}\n\nfunction getStoredTheater () {\n  const value = getLocalStorage('theater-enabled')\n  if (value !== null && value !== undefined) return value === 'true'\n\n  return false\n}\n\nfunction saveVolumeInStore (value: number) {\n  return setLocalStorage('volume', value.toString())\n}\n\nfunction saveMuteInStore (value: boolean) {\n  return setLocalStorage('mute', value.toString())\n}\n\nfunction saveTheaterInStore (enabled: boolean) {\n  return setLocalStorage('theater-enabled', enabled.toString())\n}\n\nfunction saveAverageBandwidth (value: number) {\n  /** used to choose the most fitting resolution */\n  return setLocalStorage('average-bandwidth', value.toString())\n}\n\nfunction getAverageBandwidthInStore () {\n  const value = getLocalStorage('average-bandwidth')\n  if (value !== null && value !== undefined) {\n    const valueNumber = parseInt(value, 10)\n    if (isNaN(valueNumber)) return undefined\n\n    return valueNumber\n  }\n\n  return undefined\n}\n\nfunction saveLastSubtitle (language: string) {\n  return setLocalStorage('last-subtitle', language)\n}\n\nfunction getStoredLastSubtitle () {\n  return getLocalStorage('last-subtitle')\n}\n\nfunction saveVideoWatchHistory (videoUUID: string, duration: number) {\n  return setLocalStorage(`video-watch-history`, JSON.stringify({\n    ...getStoredVideoWatchHistory(),\n\n    [videoUUID]: {\n      duration,\n      date: `${(new Date()).toISOString()}`\n    }\n  }))\n}\n\nfunction getStoredVideoWatchHistory (videoUUID?: string) {\n  let data\n\n  try {\n    const value = getLocalStorage('video-watch-history')\n    if (!value) return {}\n\n    data = JSON.parse(value)\n  } catch (error) {\n    logger.error('Cannot parse video watch history from local storage/', error)\n  }\n\n  data = data || {}\n\n  if (videoUUID) return data[videoUUID]\n\n  return data\n}\n\nfunction cleanupVideoWatch () {\n  const data = getStoredVideoWatchHistory()\n  if (!data) return\n\n  const newData = Object.keys(data).reduce((acc, videoUUID) => {\n    const date = Date.parse(data[videoUUID].date)\n\n    const diff = Math.ceil(((new Date()).getTime() - date) / (1000 * 3600 * 24))\n\n    if (diff > 30) return acc\n\n    return {\n      ...acc,\n      [videoUUID]: data[videoUUID]\n    }\n  }, {})\n\n  setLocalStorage('video-watch-history', JSON.stringify(newData))\n}\n\n// ---------------------------------------------------------------------------\n\nexport {\n  getStoredVolume,\n  getStoredMute,\n  getStoredTheater,\n  saveVolumeInStore,\n  saveMuteInStore,\n  saveTheaterInStore,\n  saveAverageBandwidth,\n  getAverageBandwidthInStore,\n  saveLastSubtitle,\n  getStoredLastSubtitle,\n  saveVideoWatchHistory,\n  getStoredVideoWatchHistory,\n  cleanupVideoWatch\n}\n\n// ---------------------------------------------------------------------------\n\nconst KEY_PREFIX = 'peertube-videojs-'\n\nfunction getLocalStorage (key: string) {\n  try {\n    return localStorage.getItem(KEY_PREFIX + key)\n  } catch {\n    return undefined\n  }\n}\n\nfunction setLocalStorage (key: string, value: string) {\n  try {\n    localStorage.setItem(KEY_PREFIX + key, value)\n  } catch { /* empty */\n  }\n}\n","import videojs from 'video.js'\n\nfunction getMainTemplate (options: any) {\n  return `\n    <div class=\"vjs-upnext-top\">\n      <span class=\"vjs-upnext-headtext\">${options.headText}</span>\n      <div class=\"vjs-upnext-title\"></div>\n    </div>\n    <div class=\"vjs-upnext-autoplay-icon\">\n      <svg height=\"100%\" version=\"1.1\" viewbox=\"0 0 98 98\" width=\"100%\">\n        <circle class=\"vjs-upnext-svg-autoplay-circle\" cx=\"49\" cy=\"49\" fill=\"#000\" fill-opacity=\"0.8\" r=\"48\"></circle>\n        <circle class=\"vjs-upnext-svg-autoplay-ring\" cx=\"-49\" cy=\"49\" fill-opacity=\"0\" r=\"46.5\"\n                stroke=\"#FFFFFF\" stroke-width=\"4\" transform=\"rotate(-90)\"\n        ></circle>\n        <polygon class=\"vjs-upnext-svg-autoplay-triangle\" fill=\"#fff\" points=\"32,27 72,49 32,71\"></polygon></svg>\n    </div>\n    <span class=\"vjs-upnext-bottom\">\n      <span class=\"vjs-upnext-cancel\">\n        <button class=\"vjs-upnext-cancel-button\" tabindex=\"0\" aria-label=\"Cancel autoplay\">${options.cancelText}</button>\n      </span>\n      <span class=\"vjs-upnext-suspended\">${options.suspendedText}</span>\n    </span>\n  `\n}\n\nexport interface EndCardOptions extends videojs.ComponentOptions {\n  next: () => void\n  getTitle: () => string\n  timeout: number\n  cancelText: string\n  headText: string\n  suspendedText: string\n  condition: () => boolean\n  suspended: () => boolean\n}\n\nconst Component = videojs.getComponent('Component')\nclass EndCard extends Component {\n  options_: EndCardOptions\n\n  dashOffsetTotal = 586\n  dashOffsetStart = 293\n  interval = 50\n  upNextEvents = new videojs.EventTarget()\n  ticks = 0\n  totalTicks: number\n\n  container: HTMLDivElement\n  title: HTMLElement\n  autoplayRing: HTMLElement\n  cancelButton: HTMLElement\n  suspendedMessage: HTMLElement\n  nextButton: HTMLElement\n\n  constructor (player: videojs.Player, options: EndCardOptions) {\n    super(player, options)\n\n    this.totalTicks = this.options_.timeout / this.interval\n\n    player.on('ended', (_: any) => {\n      if (!this.options_.condition()) return\n\n      player.addClass('vjs-upnext--showing')\n      this.showCard((canceled: boolean) => {\n        player.removeClass('vjs-upnext--showing')\n        this.container.style.display = 'none'\n        if (!canceled) {\n          this.options_.next()\n        }\n      })\n    })\n\n    player.on('playing', () => {\n      this.upNextEvents.trigger('playing')\n    })\n  }\n\n  createEl () {\n    const container = super.createEl('div', {\n      className: 'vjs-upnext-content',\n      innerHTML: getMainTemplate(this.options_)\n    }) as HTMLDivElement\n\n    this.container = container\n    container.style.display = 'none'\n\n    this.autoplayRing = container.getElementsByClassName('vjs-upnext-svg-autoplay-ring')[0] as HTMLElement\n    this.title = container.getElementsByClassName('vjs-upnext-title')[0] as HTMLElement\n    this.cancelButton = container.getElementsByClassName('vjs-upnext-cancel-button')[0] as HTMLElement\n    this.suspendedMessage = container.getElementsByClassName('vjs-upnext-suspended')[0] as HTMLElement\n    this.nextButton = container.getElementsByClassName('vjs-upnext-autoplay-icon')[0] as HTMLElement\n\n    this.cancelButton.onclick = () => {\n      this.upNextEvents.trigger('cancel')\n    }\n\n    this.nextButton.onclick = () => {\n      this.upNextEvents.trigger('next')\n    }\n\n    return container\n  }\n\n  showCard (cb: (value: boolean) => void) {\n    let timeout: any\n\n    this.autoplayRing.setAttribute('stroke-dasharray', `${this.dashOffsetStart}`)\n    this.autoplayRing.setAttribute('stroke-dashoffset', `${-this.dashOffsetStart}`)\n\n    this.title.innerHTML = this.options_.getTitle()\n\n    this.upNextEvents.one('cancel', () => {\n      clearTimeout(timeout)\n      cb(true)\n    })\n\n    this.upNextEvents.one('playing', () => {\n      clearTimeout(timeout)\n      cb(true)\n    })\n\n    this.upNextEvents.one('next', () => {\n      clearTimeout(timeout)\n      cb(false)\n    })\n\n    const goToPercent = (percent: number) => {\n      const newOffset = Math.max(-this.dashOffsetTotal, -this.dashOffsetStart - percent * this.dashOffsetTotal / 2 / 100)\n      this.autoplayRing.setAttribute('stroke-dashoffset', '' + newOffset)\n    }\n\n    const tick = () => {\n      goToPercent((this.ticks++) * 100 / this.totalTicks)\n    }\n\n    const update = () => {\n      if (this.options_.suspended()) {\n        this.suspendedMessage.innerText = this.options_.suspendedText\n        goToPercent(0)\n        this.ticks = 0\n        timeout = setTimeout(update.bind(this), 300) // checks once supsended can be a bit longer\n      } else if (this.ticks >= this.totalTicks) {\n        clearTimeout(timeout)\n        cb(false)\n      } else {\n        this.suspendedMessage.innerText = ''\n        tick()\n        timeout = setTimeout(update.bind(this), this.interval)\n      }\n    }\n\n    this.container.style.display = 'block'\n    timeout = setTimeout(update.bind(this), this.interval)\n  }\n}\n\nvideojs.registerComponent('EndCard', EndCard)\n","import videojs from 'video.js'\nimport { EndCardOptions } from './end-card'\n\nconst Plugin = videojs.getPlugin('plugin')\n\nclass UpNextPlugin extends Plugin {\n\n  constructor (player: videojs.Player, options: Partial<EndCardOptions> = {}) {\n    const settings = {\n      next: options.next,\n      getTitle: options.getTitle,\n      timeout: options.timeout || 5000,\n      cancelText: options.cancelText || 'Cancel',\n      headText: options.headText || 'Up Next',\n      suspendedText: options.suspendedText || 'Autoplay is suspended',\n      condition: options.condition,\n      suspended: options.suspended\n    }\n\n    super(player)\n\n    this.player.ready(() => {\n      player.addClass('vjs-upnext')\n    })\n\n    player.addChild('EndCard', settings)\n  }\n}\n\nvideojs.registerPlugin('upnext', UpNextPlugin)\nexport { UpNextPlugin }\n","import videojs from 'video.js'\nimport { logger } from '@root-helpers/logger'\nimport { secondsToTime } from '@shared/core-utils'\nimport { PlayerNetworkInfo as EventPlayerNetworkInfo } from '../../types'\nimport { bytes } from '../common'\n\ninterface StatsCardOptions extends videojs.ComponentOptions {\n  videoUUID: string\n  videoIsLive: boolean\n  mode: 'webtorrent' | 'p2p-media-loader' | 'localvideo'\n  p2pEnabled: boolean\n}\n\ninterface PlayerNetworkInfo {\n  downloadSpeed?: string\n  uploadSpeed?: string\n  totalDownloaded?: string\n  totalUploaded?: string\n  numPeers?: number\n  averageBandwidth?: string\n\n  downloadedFromServer?: string\n  downloadedFromPeers?: string\n}\n\ninterface InfoElement {\n  root: HTMLElement\n  value: HTMLElement\n}\n\nconst Component = videojs.getComponent('Component')\nclass StatsCard extends Component {\n  options_: StatsCardOptions\n\n  updateInterval: any\n\n  mode: 'webtorrent' | 'p2p-media-loader'\n\n  metadataStore: any = {}\n\n  intervalMs = 300\n  playerNetworkInfo: PlayerNetworkInfo = {}\n\n  private containerEl: HTMLDivElement\n  private infoListEl: HTMLDivElement\n\n  private playerMode: InfoElement\n  private p2p: InfoElement\n  private uuid: InfoElement\n  private viewport: InfoElement\n  private resolution: InfoElement\n  private volume: InfoElement\n  private codecs: InfoElement\n  private color: InfoElement\n  private connection: InfoElement\n\n  private network: InfoElement\n  private transferred: InfoElement\n  private download: InfoElement\n\n  private bufferProgress: InfoElement\n  private bufferState: InfoElement\n\n  private liveLatency: InfoElement\n\n  createEl () {\n    this.containerEl = videojs.dom.createEl('div', {\n      className: 'vjs-stats-content'\n    }) as HTMLDivElement\n    this.containerEl.style.display = 'none'\n\n    this.infoListEl = videojs.dom.createEl('div', {\n      className: 'vjs-stats-list'\n    }) as HTMLDivElement\n\n    const closeButton = videojs.dom.createEl('button', {\n      className: 'vjs-stats-close',\n      tabindex: '0',\n      title: 'Close stats',\n      innerText: '[x]'\n    }, { 'aria-label': 'Close stats' }) as HTMLElement\n    closeButton.onclick = () => this.hide()\n\n    this.containerEl.appendChild(closeButton)\n    this.containerEl.appendChild(this.infoListEl)\n\n    this.populateInfoBlocks()\n\n    this.player_.on('p2pInfo', (event: any, data: EventPlayerNetworkInfo) => {\n      if (!data) return // HTTP fallback\n\n      this.mode = data.source\n\n      const p2pStats = data.p2p\n      const httpStats = data.http\n\n      this.playerNetworkInfo.downloadSpeed = bytes(p2pStats.downloadSpeed + httpStats.downloadSpeed).join(' ')\n      this.playerNetworkInfo.uploadSpeed = bytes(p2pStats.uploadSpeed + httpStats.uploadSpeed).join(' ')\n      this.playerNetworkInfo.totalDownloaded = bytes(p2pStats.downloaded + httpStats.downloaded).join(' ')\n      this.playerNetworkInfo.totalUploaded = bytes(p2pStats.uploaded + httpStats.uploaded).join(' ')\n      this.playerNetworkInfo.numPeers = p2pStats.numPeers\n      this.playerNetworkInfo.averageBandwidth = bytes(data.bandwidthEstimate).join(' ') + '/s'\n\n      if (data.source === 'p2p-media-loader') {\n        this.playerNetworkInfo.downloadedFromServer = bytes(httpStats.downloaded).join(' ')\n        this.playerNetworkInfo.downloadedFromPeers = bytes(p2pStats.downloaded).join(' ')\n      }\n    })\n\n    return this.containerEl\n  }\n\n  toggle () {\n    if (this.updateInterval) this.hide()\n    else this.show()\n  }\n\n  show () {\n    this.containerEl.style.display = 'block'\n\n    this.updateInterval = setInterval(async () => {\n      try {\n        const options = this.mode === 'p2p-media-loader'\n          ? this.buildHLSOptions()\n          : await this.buildWebTorrentOptions() // Default\n\n        this.populateInfoValues(options)\n      } catch (err) {\n        logger.error('Cannot update stats.', err)\n        clearInterval(this.updateInterval)\n      }\n    }, this.intervalMs)\n  }\n\n  hide () {\n    clearInterval(this.updateInterval)\n    this.containerEl.style.display = 'none'\n  }\n\n  private buildHLSOptions () {\n    const p2pMediaLoader = this.player_.p2pMediaLoader()\n    const level = p2pMediaLoader.getCurrentLevel()\n\n    const codecs = level?.videoCodec || level?.audioCodec\n      ? `${level?.videoCodec || ''} / ${level?.audioCodec || ''}`\n      : undefined\n\n    const resolution = `${level?.height}p${level?.attrs['FRAME-RATE'] || ''}`\n    const buffer = this.timeRangesToString(this.player().buffered())\n\n    let progress: number\n    let latency: string\n\n    if (this.options_.videoIsLive) {\n      latency = secondsToTime(p2pMediaLoader.getLiveLatency())\n    } else {\n      progress = this.player().bufferedPercent()\n    }\n\n    return {\n      playerNetworkInfo: this.playerNetworkInfo,\n      resolution,\n      codecs,\n      buffer,\n      latency,\n      progress\n    }\n  }\n\n  private async buildWebTorrentOptions () {\n    const videoFile = this.player_.webtorrent().getCurrentVideoFile()\n\n    if (!this.metadataStore[videoFile.fileUrl]) {\n      this.metadataStore[videoFile.fileUrl] = await fetch(videoFile.metadataUrl).then(res => res.json())\n    }\n\n    const metadata = this.metadataStore[videoFile.fileUrl]\n\n    let colorSpace = 'unknown'\n    let codecs = 'unknown'\n\n    if (metadata?.streams[0]) {\n      const stream = metadata.streams[0]\n\n      colorSpace = stream['color_space'] !== 'unknown'\n        ? stream['color_space']\n        : 'bt709'\n\n      codecs = stream['codec_name'] || 'avc1'\n    }\n\n    const resolution = videoFile?.resolution.label + videoFile?.fps\n    const buffer = this.timeRangesToString(this.player().buffered())\n    const progress = this.player_.webtorrent().getTorrent()?.progress\n\n    return {\n      playerNetworkInfo: this.playerNetworkInfo,\n      progress,\n      colorSpace,\n      codecs,\n      resolution,\n      buffer\n    }\n  }\n\n  private populateInfoBlocks () {\n    this.playerMode = this.buildInfoRow(this.player().localize('Player mode'))\n    this.p2p = this.buildInfoRow(this.player().localize('P2P'))\n    this.uuid = this.buildInfoRow(this.player().localize('Video UUID'))\n    this.viewport = this.buildInfoRow(this.player().localize('Viewport / Frames'))\n    this.resolution = this.buildInfoRow(this.player().localize('Resolution'))\n    this.volume = this.buildInfoRow(this.player().localize('Volume'))\n    this.codecs = this.buildInfoRow(this.player().localize('Codecs'))\n    this.color = this.buildInfoRow(this.player().localize('Color'))\n    this.connection = this.buildInfoRow(this.player().localize('Connection Speed'))\n\n    this.network = this.buildInfoRow(this.player().localize('Network Activity'))\n    this.transferred = this.buildInfoRow(this.player().localize('Total Transfered'))\n    this.download = this.buildInfoRow(this.player().localize('Download Breakdown'))\n\n    this.bufferProgress = this.buildInfoRow(this.player().localize('Buffer Progress'))\n    this.bufferState = this.buildInfoRow(this.player().localize('Buffer State'))\n\n    this.liveLatency = this.buildInfoRow(this.player().localize('Live Latency'))\n\n    this.infoListEl.appendChild(this.playerMode.root)\n    this.infoListEl.appendChild(this.p2p.root)\n    this.infoListEl.appendChild(this.uuid.root)\n    this.infoListEl.appendChild(this.viewport.root)\n    this.infoListEl.appendChild(this.resolution.root)\n    this.infoListEl.appendChild(this.volume.root)\n    this.infoListEl.appendChild(this.codecs.root)\n    this.infoListEl.appendChild(this.color.root)\n    this.infoListEl.appendChild(this.connection.root)\n    this.infoListEl.appendChild(this.network.root)\n    this.infoListEl.appendChild(this.transferred.root)\n    this.infoListEl.appendChild(this.download.root)\n    this.infoListEl.appendChild(this.bufferProgress.root)\n    this.infoListEl.appendChild(this.bufferState.root)\n    this.infoListEl.appendChild(this.liveLatency.root)\n  }\n\n  private populateInfoValues (options: {\n    playerNetworkInfo: PlayerNetworkInfo\n    progress: number\n    codecs: string\n    resolution: string\n    buffer: string\n\n    latency?: string\n    colorSpace?: string\n  }) {\n    const { playerNetworkInfo, progress, colorSpace, codecs, resolution, buffer, latency } = options\n    const player = this.player()\n\n    const videoQuality: VideoPlaybackQuality = player.getVideoPlaybackQuality()\n    const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)\n    const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)\n    const pr = (window.devicePixelRatio || 1).toFixed(2)\n    const frames = `${vw}x${vh}*${pr} / ${videoQuality.droppedVideoFrames} dropped of ${videoQuality.totalVideoFrames}`\n\n    const duration = player.duration()\n\n    let volume = `${Math.round(player.volume() * 100)}`\n    if (player.muted()) volume += ' (muted)'\n\n    const networkActivity = playerNetworkInfo.downloadSpeed\n      ? `${playerNetworkInfo.downloadSpeed} &dArr; / ${playerNetworkInfo.uploadSpeed} &uArr;`\n      : undefined\n\n    const totalTransferred = playerNetworkInfo.totalDownloaded\n      ? `${playerNetworkInfo.totalDownloaded} &dArr; / ${playerNetworkInfo.totalUploaded} &uArr;`\n      : undefined\n    const downloadBreakdown = playerNetworkInfo.downloadedFromServer\n      ? `${playerNetworkInfo.downloadedFromServer} from servers · ${playerNetworkInfo.downloadedFromPeers} from peers`\n      : undefined\n\n    const bufferProgress = progress !== undefined\n      ? `${(progress * 100).toFixed(1)}% (${(progress * duration).toFixed(1)}s)`\n      : undefined\n\n    this.setInfoValue(this.playerMode, this.mode || 'HTTP')\n    this.setInfoValue(this.p2p, player.localize(this.options_.p2pEnabled ? 'enabled' : 'disabled'))\n    this.setInfoValue(this.uuid, this.options_.videoUUID)\n\n    this.setInfoValue(this.viewport, frames)\n    this.setInfoValue(this.resolution, resolution)\n    this.setInfoValue(this.volume, volume)\n    this.setInfoValue(this.codecs, codecs)\n    this.setInfoValue(this.color, colorSpace)\n    this.setInfoValue(this.connection, playerNetworkInfo.averageBandwidth)\n\n    this.setInfoValue(this.network, networkActivity)\n    this.setInfoValue(this.transferred, totalTransferred)\n    this.setInfoValue(this.download, downloadBreakdown)\n\n    this.setInfoValue(this.bufferProgress, bufferProgress)\n    this.setInfoValue(this.bufferState, buffer)\n\n    this.setInfoValue(this.liveLatency, latency)\n  }\n\n  private setInfoValue (el: InfoElement, value: string) {\n    if (!value) {\n      el.root.style.display = 'none'\n      return\n    }\n\n    el.root.style.display = 'block'\n\n    if (el.value.innerHTML === value) return\n    el.value.innerHTML = value\n  }\n\n  private buildInfoRow (labelText: string, valueHTML?: string) {\n    const root = videojs.dom.createEl('div') as HTMLElement\n    root.style.display = 'none'\n\n    const label = videojs.dom.createEl('div', { innerText: labelText }) as HTMLElement\n    const value = videojs.dom.createEl('span', { innerHTML: valueHTML }) as HTMLElement\n\n    root.appendChild(label)\n    root.appendChild(value)\n\n    return { root, value }\n  }\n\n  private timeRangesToString (r: videojs.TimeRange) {\n    let result = ''\n\n    for (let i = 0; i < r.length; i++) {\n      const start = Math.floor(r.start(i))\n      const end = Math.floor(r.end(i))\n\n      result += `[${secondsToTime(start)}, ${secondsToTime(end)}] `\n    }\n\n    return result\n  }\n}\n\nvideojs.registerComponent('StatsCard', StatsCard)\n\nexport {\n  StatsCard,\n  StatsCardOptions\n}\n","import videojs from 'video.js'\nimport { StatsCard, StatsCardOptions } from './stats-card'\n\nconst Plugin = videojs.getPlugin('plugin')\n\nclass StatsForNerdsPlugin extends Plugin {\n  private statsCard: StatsCard\n\n  constructor (player: videojs.Player, options: StatsCardOptions) {\n    const settings = {\n      ...options\n    }\n\n    super(player)\n\n    this.player.ready(() => {\n      player.addClass('vjs-stats-for-nerds')\n    })\n\n    this.statsCard = new StatsCard(player, options)\n\n    player.addChild(this.statsCard, settings)\n  }\n\n  show () {\n    this.statsCard.show()\n  }\n}\n\nvideojs.registerPlugin('stats', StatsForNerdsPlugin)\nexport { StatsForNerdsPlugin }\n","import videojs from 'video.js'\nimport { isMobile } from '@root-helpers/web-browser'\n\nfunction getPauseBezel () {\n  return `\n  <div class=\"vjs-bezels-pause\">\n    <div class=\"vjs-bezel\" role=\"status\" aria-label=\"Pause\">\n      <div class=\"vjs-bezel-icon\">\n        <svg height=\"100%\" version=\"1.1\" viewBox=\"0 0 36 36\" width=\"100%\">\n          <use class=\"vjs-svg-shadow\" xlink:href=\"#vjs-id-1\"></use>\n          <path class=\"vjs-svg-fill\" d=\"M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z\" id=\"vjs-id-1\"></path>\n        </svg>\n      </div>\n    </div>\n  </div>\n  `\n}\n\nfunction getPlayBezel () {\n  return `\n  <div class=\"vjs-bezels-play\">\n    <div class=\"vjs-bezel\" role=\"status\" aria-label=\"Play\">\n      <div class=\"vjs-bezel-icon\">\n        <svg height=\"100%\" version=\"1.1\" viewBox=\"0 0 36 36\" width=\"100%\">\n          <use class=\"vjs-svg-shadow\" xlink:href=\"#vjs-id-2\"></use>\n          <path class=\"vjs-svg-fill\" d=\"M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z\" id=\"ytp-id-2\"></path>\n        </svg>\n      </div>\n    </div>\n  </div>\n  `\n}\n\nconst Component = videojs.getComponent('Component')\nclass PauseBezel extends Component {\n  container: HTMLDivElement\n\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\n    super(player, options)\n\n    // Hide bezels on mobile since we already have our mobile overlay\n    if (isMobile()) return\n\n    player.on('pause', (_: any) => {\n      if (player.seeking() || player.ended()) return\n      this.container.innerHTML = getPauseBezel()\n      this.showBezel()\n    })\n\n    player.on('play', (_: any) => {\n      if (player.seeking()) return\n      this.container.innerHTML = getPlayBezel()\n      this.showBezel()\n    })\n  }\n\n  createEl () {\n    this.container = super.createEl('div', {\n      className: 'vjs-bezels-content'\n    }) as HTMLDivElement\n\n    this.container.style.display = 'none'\n\n    return this.container\n  }\n\n  showBezel () {\n    this.container.style.display = 'inherit'\n\n    setTimeout(() => {\n      this.container.style.display = 'none'\n    }, 500) // matching the animation duration\n  }\n}\n\nvideojs.registerComponent('PauseBezel', PauseBezel)\n","import videojs from 'video.js'\nimport './pause-bezel'\n\nconst Plugin = videojs.getPlugin('plugin')\n\nclass BezelsPlugin extends Plugin {\n\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\n    super(player)\n\n    this.player.ready(() => {\n      player.addClass('vjs-bezels')\n    })\n\n    player.addChild('PauseBezel', options)\n  }\n}\n\nvideojs.registerPlugin('bezels', BezelsPlugin)\n\nexport { BezelsPlugin }\n","import debug from 'debug'\nimport videojs from 'video.js'\nimport { logger } from '@root-helpers/logger'\nimport { isMobile } from '@root-helpers/web-browser'\nimport { timeToInt } from '@shared/core-utils'\nimport { VideoView, VideoViewEvent } from '@shared/models/videos'\nimport {\n  getStoredLastSubtitle,\n  getStoredMute,\n  getStoredVolume,\n  saveLastSubtitle,\n  saveMuteInStore,\n  saveVideoWatchHistory,\n  saveVolumeInStore\n} from '../../peertube-player-local-storage'\nimport { PeerTubePluginOptions, VideoJSCaption } from '../../types'\nimport { SettingsButton } from '../settings/settings-menu-button'\n\nconst debugLogger = debug('peertube:player:peertube')\n\nconst Plugin = videojs.getPlugin('plugin')\n\nclass PeerTubePlugin extends Plugin {\n  private readonly videoViewUrl: string\n  private readonly authorizationHeader: string\n\n  private readonly videoUUID: string\n  private readonly startTime: number\n\n  private readonly CONSTANTS = {\n    USER_VIEW_VIDEO_INTERVAL: 5000 // Every 5 seconds, notify the user is watching the video\n  }\n\n  //private videoCaptions: VideoJSCaption[]\n  private defaultSubtitle: string\n\n  private videoViewInterval: any\n\n  private menuOpened = false\n  private mouseInControlBar = false\n  private mouseInSettings = false\n  private readonly initialInactivityTimeout: number\n\n  constructor (player: videojs.Player, options?: PeerTubePluginOptions) {\n    super(player)\n\n    this.videoViewUrl = options.videoViewUrl\n    this.authorizationHeader = options.authorizationHeader\n    this.videoUUID = options.videoUUID\n    this.startTime = timeToInt(options.startTime)\n\n    //this.videoCaptions = options.videoCaptions\n    this.initialInactivityTimeout = this.player.options_.inactivityTimeout\n\n    if (options.autoplay) this.player.addClass('vjs-has-autoplay')\n\n    this.player.on('autoplay-failure', () => {\n      this.player.removeClass('vjs-has-autoplay')\n    })\n\n    this.player.ready(() => {\n      const playerOptions = this.player.options_\n\n      const volume = getStoredVolume()\n      if (volume !== undefined) this.player.volume(volume)\n\n      const muted = playerOptions.muted !== undefined ? playerOptions.muted : getStoredMute()\n      if (muted !== undefined) this.player.muted(muted)\n\n      this.defaultSubtitle = options.subtitle || getStoredLastSubtitle()\n\n      this.player.on('volumechange', () => {\n        saveVolumeInStore(this.player.volume())\n        saveMuteInStore(this.player.muted())\n      })\n\n      if (options.stopTime) {\n        const stopTime = timeToInt(options.stopTime)\n        const self = this\n\n        this.player.on('timeupdate', function onTimeUpdate () {\n          if (self.player.currentTime() > stopTime) {\n            self.player.pause()\n            self.player.trigger('stopped')\n\n            self.player.off('timeupdate', onTimeUpdate)\n          }\n        })\n      }\n\n      this.player.textTracks().addEventListener('change', () => {\n        const showing = this.player.textTracks().tracks_.find(t => {\n          return t.kind === 'captions' && t.mode === 'showing'\n        })\n\n        if (!showing) {\n          saveLastSubtitle('off')\n          return\n        }\n\n        saveLastSubtitle(showing.language)\n      })\n\n      //this.player.on('sourcechange', () => this.initCaptions())\n\n      this.player.duration(options.videoDuration)\n\n      this.initializePlayer()\n      this.runUserViewing()\n    })\n  }\n\n  dispose () {\n    if (this.videoViewInterval) clearInterval(this.videoViewInterval)\n  }\n\n  onMenuOpened () {\n    this.menuOpened = true\n    this.alterInactivity()\n  }\n\n  onMenuClosed () {\n    this.menuOpened = false\n    this.alterInactivity()\n  }\n\n  displayFatalError () {\n    this.player.addClass('vjs-error-display-enabled')\n  }\n\n  hideFatalError () {\n    this.player.removeClass('vjs-error-display-enabled')\n  }\n\n  private initializePlayer () {\n    if (isMobile()) this.player.addClass('vjs-is-mobile')\n\n    this.initSmoothProgressBar()\n\n    //this.initCaptions()\n\n    this.listenControlBarMouse()\n\n    this.listenFullScreenChange()\n  }\n\n  private runUserViewing () {\n    let lastCurrentTime = this.startTime\n    let lastViewEvent: VideoViewEvent\n\n    this.player.one('play', () => {\n      this.notifyUserIsWatching(this.startTime, lastViewEvent)\n    })\n\n    this.player.on('seeked', () => {\n      // Don't take into account small seek events\n      if (Math.abs(this.player.currentTime() - lastCurrentTime) < 3) return\n\n      lastViewEvent = 'seek'\n    })\n\n    this.player.one('ended', () => {\n      const currentTime = Math.round(this.player.duration())\n      lastCurrentTime = currentTime\n\n      this.notifyUserIsWatching(currentTime, lastViewEvent)\n\n      lastViewEvent = undefined\n    })\n\n    this.videoViewInterval = setInterval(() => {\n      const currentTime = Math.round(this.player.currentTime())\n\n      // No need to update\n      if (currentTime === lastCurrentTime) return\n\n      lastCurrentTime = currentTime\n\n      this.notifyUserIsWatching(currentTime, lastViewEvent)\n        .catch(err => logger.error('Cannot notify user is watching.', err))\n\n      lastViewEvent = undefined\n\n      // Server won't save history, so save the video position in local storage\n      if (!this.authorizationHeader) {\n        saveVideoWatchHistory(this.videoUUID, currentTime)\n      }\n    }, this.CONSTANTS.USER_VIEW_VIDEO_INTERVAL)\n  }\n\n  private notifyUserIsWatching (currentTime: number, viewEvent: VideoViewEvent) {\n    if (!this.videoViewUrl) return Promise.resolve(undefined)\n\n    const body: VideoView = {\n      currentTime,\n      viewEvent\n    }\n\n    const headers = new Headers({\n      'Content-type': 'application/json; charset=UTF-8'\n    })\n\n    if (this.authorizationHeader) headers.set('Authorization', this.authorizationHeader)\n\n    return fetch(this.videoViewUrl, { method: 'POST', body: JSON.stringify(body), headers })\n  }\n\n  private listenFullScreenChange () {\n    this.player.on('fullscreenchange', () => {\n      if (this.player.isFullscreen()) this.player.focus()\n    })\n  }\n\n  private listenControlBarMouse () {\n    const controlBar = this.player.controlBar\n    const settingsButton: SettingsButton = (controlBar as any).settingsButton\n\n    controlBar.on('mouseenter', () => {\n      this.mouseInControlBar = true\n      this.alterInactivity()\n    })\n\n    controlBar.on('mouseleave', () => {\n      this.mouseInControlBar = false\n      this.alterInactivity()\n    })\n\n    settingsButton.dialog.on('mouseenter', () => {\n      this.mouseInSettings = true\n      this.alterInactivity()\n    })\n\n    settingsButton.dialog.on('mouseleave', () => {\n      this.mouseInSettings = false\n      this.alterInactivity()\n    })\n  }\n\n  private alterInactivity () {\n    if (this.menuOpened || this.mouseInSettings || this.mouseInControlBar) {\n      this.setInactivityTimeout(0)\n      return\n    }\n\n    this.setInactivityTimeout(this.initialInactivityTimeout)\n    this.player.reportUserActivity(true)\n  }\n\n  private setInactivityTimeout (timeout: number) {\n    (this.player as any).cache_.inactivityTimeout = timeout\n    this.player.options_.inactivityTimeout = timeout\n\n    debugLogger('Set player inactivity to ' + timeout)\n  }\n\n  /*private initCaptions () {\n    for (const caption of this.videoCaptions) {\n      this.player.addRemoteTextTrack({\n        kind: 'captions',\n        label: caption.label,\n        language: caption.language,\n        id: caption.language,\n        src: caption.src,\n        default: this.defaultSubtitle === caption.language\n      }, false)\n    }\n\n    this.player.trigger('captionsChanged')\n  }*/\n\n  // Thanks: https://github.com/videojs/video.js/issues/4460#issuecomment-312861657\n  private initSmoothProgressBar () {\n    const SeekBar = videojs.getComponent('SeekBar') as any\n    SeekBar.prototype.getPercent = function getPercent () {\n      // Allows for smooth scrubbing, when player can't keep up.\n      // const time = (this.player_.scrubbing()) ?\n      //   this.player_.getCache().currentTime :\n      //   this.player_.currentTime()\n      const time = this.player_.currentTime()\n      const percent = time / this.player_.duration()\n      return percent >= 1 ? 1 : percent\n    }\n    SeekBar.prototype.handleMouseMove = function handleMouseMove (event: any) {\n      let newTime = this.calculateDistance(event) * this.player_.duration()\n      if (newTime === this.player_.duration()) {\n        newTime = newTime - 0.1\n      }\n      this.player_.currentTime(newTime)\n      this.update()\n    }\n  }\n}\n\nvideojs.registerPlugin('peertube', PeerTubePlugin)\nexport { PeerTubePlugin }\n","import videojs from 'video.js'\nimport { PeerTubeResolution } from '../../types'\n\nconst Plugin = videojs.getPlugin('plugin')\n\nclass PeerTubeResolutionsPlugin extends Plugin {\n  private currentSelection: PeerTubeResolution\n  private resolutions: PeerTubeResolution[] = []\n\n  private autoResolutionChosenId: number\n  private autoResolutionEnabled = true\n\n  add (resolutions: PeerTubeResolution[]) {\n    for (const r of resolutions) {\n      this.resolutions.push(r)\n    }\n\n    this.currentSelection = this.getSelected()\n\n    this.sort()\n    this.trigger('resolutionsAdded')\n  }\n\n  getResolutions () {\n    return this.resolutions\n  }\n\n  getSelected () {\n    return this.resolutions.find(r => r.selected)\n  }\n\n  getAutoResolutionChosen () {\n    return this.resolutions.find(r => r.id === this.autoResolutionChosenId)\n  }\n\n  select (options: {\n    id: number\n    byEngine: boolean\n    autoResolutionChosenId?: number\n  }) {\n    const { id, autoResolutionChosenId, byEngine } = options\n\n    if (this.currentSelection?.id === id && this.autoResolutionChosenId === autoResolutionChosenId) return\n\n    this.autoResolutionChosenId = autoResolutionChosenId\n\n    for (const r of this.resolutions) {\n      r.selected = r.id === id\n\n      if (r.selected) {\n        this.currentSelection = r\n\n        if (!byEngine) r.selectCallback()\n      }\n    }\n\n    this.trigger('resolutionChanged')\n  }\n\n  disableAutoResolution () {\n    this.autoResolutionEnabled = false\n    this.trigger('autoResolutionEnabledChanged')\n  }\n\n  enabledAutoResolution () {\n    this.autoResolutionEnabled = true\n    this.trigger('autoResolutionEnabledChanged')\n  }\n\n  isAutoResolutionEnabeld () {\n    return this.autoResolutionEnabled\n  }\n\n  private sort () {\n    this.resolutions.sort((a, b) => {\n      if (a.id === -1) return 1\n      if (b.id === -1) return -1\n\n      if (a.height > b.height) return -1\n      if (a.height === b.height) return 0\n      return 1\n    })\n  }\n\n}\n\nvideojs.registerPlugin('peertubeResolutions', PeerTubeResolutionsPlugin)\nexport { PeerTubeResolutionsPlugin }\n","import videojs from 'video.js'\nimport { NextPreviousVideoButtonOptions } from '../../types'\n\nconst Button = videojs.getComponent('Button')\n\nclass NextPreviousVideoButton extends Button {\n  private readonly nextPreviousVideoButtonOptions: NextPreviousVideoButtonOptions\n\n  constructor (player: videojs.Player, options?: NextPreviousVideoButtonOptions) {\n    super(player, options as any)\n\n    this.nextPreviousVideoButtonOptions = options\n\n    this.update()\n  }\n\n  createEl () {\n    const type = (this.options_ as NextPreviousVideoButtonOptions).type\n\n    const button = videojs.dom.createEl('button', {\n      className: 'vjs-' + type + '-video'\n    }) as HTMLButtonElement\n    const nextIcon = videojs.dom.createEl('span', {\n      className: 'icon icon-' + type\n    })\n    button.appendChild(nextIcon)\n\n    if (type === 'next') {\n      button.title = this.player_.localize('Next video')\n    } else {\n      button.title = this.player_.localize('Previous video')\n    }\n\n    return button\n  }\n\n  handleClick () {\n    this.nextPreviousVideoButtonOptions.handler()\n  }\n\n  update () {\n    const disabled = this.nextPreviousVideoButtonOptions.isDisabled()\n\n    if (disabled) this.addClass('vjs-disabled')\n    else this.removeClass('vjs-disabled')\n  }\n}\n\nvideojs.registerComponent('NextVideoButton', NextPreviousVideoButton)\nvideojs.registerComponent('PreviousVideoButton', NextPreviousVideoButton)\n","import videojs from 'video.js'\nimport { PeerTubeP2PInfoButtonOptions, PlayerNetworkInfo } from '../../types'\nimport { bytes } from '../common'\n\nconst Button = videojs.getComponent('Button')\nclass P2pInfoButton extends Button {\n\n  constructor (player: videojs.Player, options?: PeerTubeP2PInfoButtonOptions) {\n    super(player, options as any)\n  }\n\n  createEl () {\n    const div = videojs.dom.createEl('div', {\n      className: 'vjs-peertube'\n    })\n    const subDivWebtorrent = videojs.dom.createEl('div', {\n      className: 'vjs-peertube-hidden' // Hide the stats before we get the info\n    }) as HTMLDivElement\n    div.appendChild(subDivWebtorrent)\n\n    // Stop here if P2P is not enabled\n    const p2pEnabled = (this.options_ as PeerTubeP2PInfoButtonOptions).p2pEnabled\n    if (!p2pEnabled) return div as HTMLButtonElement\n\n    const downloadIcon = videojs.dom.createEl('span', {\n      className: 'icon icon-download'\n    })\n    subDivWebtorrent.appendChild(downloadIcon)\n\n    const downloadSpeedText = videojs.dom.createEl('span', {\n      className: 'download-speed-text'\n    })\n    const downloadSpeedNumber = videojs.dom.createEl('span', {\n      className: 'download-speed-number'\n    })\n    const downloadSpeedUnit = videojs.dom.createEl('span')\n    downloadSpeedText.appendChild(downloadSpeedNumber)\n    downloadSpeedText.appendChild(downloadSpeedUnit)\n    subDivWebtorrent.appendChild(downloadSpeedText)\n\n    const uploadIcon = videojs.dom.createEl('span', {\n      className: 'icon icon-upload'\n    })\n    subDivWebtorrent.appendChild(uploadIcon)\n\n    const uploadSpeedText = videojs.dom.createEl('span', {\n      className: 'upload-speed-text'\n    })\n    const uploadSpeedNumber = videojs.dom.createEl('span', {\n      className: 'upload-speed-number'\n    })\n    const uploadSpeedUnit = videojs.dom.createEl('span')\n    uploadSpeedText.appendChild(uploadSpeedNumber)\n    uploadSpeedText.appendChild(uploadSpeedUnit)\n    subDivWebtorrent.appendChild(uploadSpeedText)\n\n    const peersText = videojs.dom.createEl('span', {\n      className: 'peers-text'\n    })\n    const peersNumber = videojs.dom.createEl('span', {\n      className: 'peers-number'\n    })\n    subDivWebtorrent.appendChild(peersNumber)\n    subDivWebtorrent.appendChild(peersText)\n\n    const subDivHttp = videojs.dom.createEl('div', {\n      className: 'vjs-peertube-hidden'\n    })\n    const subDivHttpText = videojs.dom.createEl('span', {\n      className: 'http-fallback',\n      textContent: 'HTTP'\n    })\n\n    subDivHttp.appendChild(subDivHttpText)\n    div.appendChild(subDivHttp)\n\n    this.player_.on('p2pInfo', (event: any, data: PlayerNetworkInfo) => {\n      // We are in HTTP fallback\n      if (!data) {\n        subDivHttp.className = 'vjs-peertube-displayed'\n        subDivWebtorrent.className = 'vjs-peertube-hidden'\n\n        return\n      }\n\n      const p2pStats = data.p2p\n      const httpStats = data.http\n\n      const downloadSpeed = bytes(p2pStats.downloadSpeed + httpStats.downloadSpeed)\n      const uploadSpeed = bytes(p2pStats.uploadSpeed + httpStats.uploadSpeed)\n      const totalDownloaded = bytes(p2pStats.downloaded + httpStats.downloaded)\n      const totalUploaded = bytes(p2pStats.uploaded + httpStats.uploaded)\n      const numPeers = p2pStats.numPeers\n\n      subDivWebtorrent.title = this.player().localize('Total downloaded: ') + totalDownloaded.join(' ') + '\\n'\n\n      if (data.source === 'p2p-media-loader') {\n        const downloadedFromServer = bytes(httpStats.downloaded).join(' ')\n        const downloadedFromPeers = bytes(p2pStats.downloaded).join(' ')\n\n        subDivWebtorrent.title +=\n          ' * ' + this.player().localize('From servers: ') + downloadedFromServer + '\\n' +\n          ' * ' + this.player().localize('From peers: ') + downloadedFromPeers + '\\n'\n      }\n      subDivWebtorrent.title += this.player().localize('Total uploaded: ') + totalUploaded.join(' ')\n\n      downloadSpeedNumber.textContent = downloadSpeed[0]\n      downloadSpeedUnit.textContent = ' ' + downloadSpeed[1]\n\n      uploadSpeedNumber.textContent = uploadSpeed[0]\n      uploadSpeedUnit.textContent = ' ' + uploadSpeed[1]\n\n      peersNumber.textContent = numPeers.toString()\n      peersText.textContent = ' ' + (numPeers > 1 ? this.player().localize('peers') : this.player_.localize('peer'))\n\n      subDivHttp.className = 'vjs-peertube-hidden'\n      subDivWebtorrent.className = 'vjs-peertube-displayed'\n    })\n\n    return div as HTMLButtonElement\n  }\n}\n\nvideojs.registerComponent('P2PInfoButton', P2pInfoButton)\n","/**\n * @file picture-in-picture-toggle.js\n */\n /*import Button from '../button.js';\n import Component from '../component.js';\n import document from 'global/document';*/\n\n import videojs from \"video.js\";\n\n const Button = videojs.getComponent(\"Button\");\n const MenuButton = videojs.getComponent(\"MenuButton\");\n  \n  /**\n   * Toggle Picture-in-Picture mode\n   *\n   * @extends Button\n   */\n  class PictureInPictureBastyon extends MenuButton {\n  \n \n    constructor(player : any, options : any) {\n      super(player, options);\n \n      this.controlText('Mini Player')\n    }\n \n    createEl(){\n     return this.buildElement();\n    }\n \n    handleClick(event : any) {\n     this.player_.trigger('pictureInPictureRequest', event)\n    }\n \n    private buildElement() {\n \n     const el = super.createEl();\n     \n     el.classList.add(\"vjs-picture-in-picture-control\");\n \n     return el as HTMLButtonElement;\n   }\n  \n  }\n \n  videojs.registerComponent(\"PictureInPictureBastyon\", PictureInPictureBastyon);\n  ","import videojs from 'video.js'\n\nconst Component = videojs.getComponent('Component')\n\nclass PeerTubeLoadProgressBar extends Component {\n\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\n    super(player, options)\n\n    this.on(player, 'progress', this.update)\n  }\n\n  createEl () {\n    return super.createEl('div', {\n      className: 'vjs-load-progress',\n      innerHTML: `<span class=\"vjs-control-text\"><span>${this.localize('Loaded')}</span>: 0%</span>`\n    })\n  }\n\n  dispose () {\n    super.dispose()\n  }\n\n  update () {\n    const torrent = this.player().webtorrent().getTorrent()\n    if (!torrent) return\n\n    // @ts-ignore\n    (this.el() as HTMLElement).style['transform-origin'] = 'left'\n    (this.el() as HTMLElement).style['transform'] = 'scaleX('+(torrent.progress).toFixed(2)+')'\n\n    //(this.el() as HTMLElement).style.width = (torrent.progress * 100) + '%'\n  }\n\n}\n\nComponent.registerComponent('PeerTubeLoadProgressBar', PeerTubeLoadProgressBar)\n","import videojs from 'video.js'\nimport { getStoredTheater, saveTheaterInStore } from '../../peertube-player-local-storage'\n\nconst Button = videojs.getComponent('Button')\nclass TheaterButton extends Button {\n\n  private static readonly THEATER_MODE_CLASS = 'vjs-theater-enabled'\n\n  constructor (player: videojs.Player, options: videojs.ComponentOptions) {\n    super(player, options)\n\n    const enabled = getStoredTheater()\n    if (enabled === true) {\n      this.player().addClass(TheaterButton.THEATER_MODE_CLASS)\n\n      this.handleTheaterChange()\n    }\n\n    this.controlText('Theater mode')\n\n    this.player().theaterEnabled = enabled\n  }\n\n  buildCSSClass () {\n    return `vjs-theater-control ${super.buildCSSClass()}`\n  }\n\n  handleTheaterChange () {\n    const theaterEnabled = this.isTheaterEnabled()\n\n    if (theaterEnabled) {\n      this.controlText('Normal mode')\n    } else {\n      this.controlText('Theater mode')\n    }\n\n    saveTheaterInStore(theaterEnabled)\n\n    this.player_.trigger('theaterChange', theaterEnabled)\n  }\n\n  handleClick () {\n    this.player_.toggleClass(TheaterButton.THEATER_MODE_CLASS)\n\n    this.handleTheaterChange()\n  }\n\n  private isTheaterEnabled () {\n    return this.player_.hasClass(TheaterButton.THEATER_MODE_CLASS)\n  }\n}\n\nvideojs.registerComponent('TheaterButton', TheaterButton)\n","import videojs from 'video.js'\n\nconst MenuItem = videojs.getComponent('MenuItem')\n\nexport interface ResolutionMenuItemOptions extends videojs.MenuItemOptions {\n  resolutionId: number\n}\n\nclass ResolutionMenuItem extends MenuItem {\n  private readonly resolutionId: number\n  private readonly label: string\n\n  private autoResolutionEnabled: boolean\n  private autoResolutionChosen: string\n\n  constructor (player: videojs.Player, options?: ResolutionMenuItemOptions) {\n    options.selectable = true\n\n    super(player, options)\n\n    this.autoResolutionEnabled = true\n    this.autoResolutionChosen = ''\n\n    this.resolutionId = options.resolutionId\n    this.label = options.label\n\n    player.peertubeResolutions().on('resolutionChanged', () => this.updateSelection())\n\n    // We only want to disable the \"Auto\" item\n    if (this.resolutionId === -1) {\n      player.peertubeResolutions().on('autoResolutionEnabledChanged', () => this.updateAutoResolution())\n    }\n  }\n\n  handleClick (event: any) {\n    // Auto button disabled?\n    if (this.autoResolutionEnabled === false && this.resolutionId === -1) return\n\n    super.handleClick(event)\n\n    this.player().peertubeResolutions().select({ id: this.resolutionId, byEngine: false })\n  }\n\n  updateSelection () {\n    const selectedResolution = this.player().peertubeResolutions().getSelected()\n\n    if (this.resolutionId === -1) {\n      this.autoResolutionChosen = this.player().peertubeResolutions().getAutoResolutionChosen()?.label\n    }\n\n    this.selected(this.resolutionId === selectedResolution.id)\n  }\n\n  updateAutoResolution () {\n    const enabled = this.player().peertubeResolutions().isAutoResolutionEnabeld()\n\n    // Check if the auto resolution is enabled or not\n    if (enabled === false) {\n      this.addClass('disabled')\n    } else {\n      this.removeClass('disabled')\n    }\n\n    this.autoResolutionEnabled = enabled\n  }\n\n  getLabel () {\n    if (this.resolutionId === -1) {\n      return this.label + ' <small>' + this.autoResolutionChosen + '</small>'\n    }\n\n    return this.label\n  }\n}\nvideojs.registerComponent('ResolutionMenuItem', ResolutionMenuItem)\n\nexport { ResolutionMenuItem }\n","import videojs from 'video.js'\nimport { ResolutionMenuItem } from './resolution-menu-item'\n\nconst Menu = videojs.getComponent('Menu')\nconst MenuButton = videojs.getComponent('MenuButton')\nclass ResolutionMenuButton extends MenuButton {\n  labelEl_: HTMLElement\n\n  constructor (player: videojs.Player, options?: videojs.MenuButtonOptions) {\n    super(player, options)\n\n    this.controlText('Quality')\n\n    player.peertubeResolutions().on('resolutionsAdded', () => this.buildQualities())\n\n    // For parent\n    player.peertubeResolutions().on('resolutionChanged', () => {\n      setTimeout(() => this.trigger('labelUpdated'))\n    })\n  }\n\n  createEl () {\n    const el = super.createEl()\n\n    this.labelEl_ = videojs.dom.createEl('div', {\n      className: 'vjs-resolution-value'\n    }) as HTMLElement\n\n    el.appendChild(this.labelEl_)\n\n    return el\n  }\n\n  updateARIAAttributes () {\n    this.el().setAttribute('aria-label', 'Quality')\n  }\n\n  createMenu () {\n    return new Menu(this.player_)\n  }\n\n  buildCSSClass () {\n    return super.buildCSSClass() + ' vjs-resolution-button'\n  }\n\n  buildWrapperCSSClass () {\n    return 'vjs-resolution-control ' + super.buildWrapperCSSClass()\n  }\n\n  private addClickListener (component: any) {\n    component.on('click', () => {\n      const children = this.menu.children()\n\n      for (const child of children) {\n        if (component !== child) {\n          (child as videojs.MenuItem).selected(false)\n        }\n      }\n    })\n  }\n\n  private buildQualities () {\n    for (const d of this.player().peertubeResolutions().getResolutions()) {\n      const label = d.label === '0p'\n        ? this.player().localize('Audio-only')\n        : d.label\n\n      this.menu.addChild(new ResolutionMenuItem(\n        this.player_,\n        {\n          id: d.id + '',\n          resolutionId: d.id,\n          label,\n          selected: d.selected\n        })\n      )\n    }\n\n    for (const m of this.menu.children()) {\n      this.addClickListener(m)\n    }\n\n    this.trigger('menuChanged')\n  }\n}\n\nvideojs.registerComponent('ResolutionMenuButton', ResolutionMenuButton)\n","import videojs from 'video.js'\n\nconst Component = videojs.getComponent('Component')\n\nclass SettingsDialog extends Component {\n  constructor (player: videojs.Player) {\n    super(player)\n\n    this.hide()\n  }\n\n  /**\n   * Create the component's DOM element\n   *\n   */\n  createEl () {\n    const uniqueId = this.id()\n    const dialogLabelId = 'TTsettingsDialogLabel-' + uniqueId\n    const dialogDescriptionId = 'TTsettingsDialogDescription-' + uniqueId\n\n    return super.createEl('div', {\n      className: 'vjs-settings-dialog vjs-modal-overlay',\n      innerHTML: '',\n      tabIndex: -1\n    }, {\n      role: 'dialog',\n      'aria-labelledby': dialogLabelId,\n      'aria-describedby': dialogDescriptionId\n    })\n  }\n}\n\nComponent.registerComponent('SettingsDialog', SettingsDialog)\n\nexport { SettingsDialog }\n","import videojs from 'video.js'\nimport { toTitleCase } from '../common'\nimport { SettingsDialog } from './settings-dialog'\nimport { SettingsButton } from './settings-menu-button'\nimport { SettingsPanel } from './settings-panel'\nimport { SettingsPanelChild } from './settings-panel-child'\n\nconst MenuItem = videojs.getComponent('MenuItem')\nconst component = videojs.getComponent('Component')\n\nexport interface SettingsMenuItemOptions extends videojs.MenuItemOptions {\n  entry: string\n  menuButton: SettingsButton\n}\n\nclass SettingsMenuItem extends MenuItem {\n  settingsButton: SettingsButton\n  dialog: SettingsDialog\n  mainMenu: videojs.Menu\n  panel: SettingsPanel\n  panelChild: SettingsPanelChild\n  panelChildEl: HTMLElement\n  size: number[]\n  menuToLoad: string\n  subMenu: SettingsButton\n\n  submenuClickHandler: typeof SettingsMenuItem.prototype.onSubmenuClick\n  transitionEndHandler: typeof SettingsMenuItem.prototype.onTransitionEnd\n\n  settingsSubMenuTitleEl_: HTMLElement\n  settingsSubMenuValueEl_: HTMLElement\n  settingsSubMenuEl_: HTMLElement\n\n  constructor (player: videojs.Player, options?: SettingsMenuItemOptions) {\n    super(player, options)\n\n    this.settingsButton = options.menuButton\n    this.dialog = this.settingsButton.dialog\n    this.mainMenu = this.settingsButton.menu\n    this.panel = this.dialog.getChild('settingsPanel')\n    this.panelChild = this.panel.getChild('settingsPanelChild')\n    this.panelChildEl = this.panelChild.el() as HTMLElement\n\n    this.size = null\n\n    // keep state of what menu type is loading next\n    this.menuToLoad = 'mainmenu'\n\n    const subMenuName = toTitleCase(options.entry)\n    const SubMenuComponent = videojs.getComponent(subMenuName)\n\n    if (!SubMenuComponent) {\n      throw new Error(`Component ${subMenuName} does not exist`)\n    }\n\n    const newOptions = Object.assign({}, options, { entry: options.menuButton, menuButton: this })\n\n    this.subMenu = new SubMenuComponent(this.player(), newOptions) as SettingsButton\n    const subMenuClass = this.subMenu.buildCSSClass().split(' ')[0]\n    this.settingsSubMenuEl_.className += ' ' + subMenuClass\n\n    this.eventHandlers()\n\n    player.ready(() => {\n      // Voodoo magic for IOS\n      setTimeout(() => {\n        // Player was destroyed\n        if (!this.player_) return\n\n        this.build()\n\n        // Update on rate change\n        player.on('ratechange', this.submenuClickHandler)\n\n        if (subMenuName === 'CaptionsButton') {\n          // Hack to regenerate captions on HTTP fallback\n          player.on('captionsChanged', () => {\n            setTimeout(() => {\n              this.settingsSubMenuEl_.innerHTML = ''\n              this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el())\n              this.update()\n              this.bindClickEvents()\n            }, 0)\n          })\n        }\n\n        this.reset()\n      }, 0)\n    })\n  }\n\n  eventHandlers () {\n    this.submenuClickHandler = this.onSubmenuClick.bind(this)\n    this.transitionEndHandler = this.onTransitionEnd.bind(this)\n  }\n\n  onSubmenuClick (event: any) {\n    let target = null\n\n    if (event.type === 'tap') {\n      target = event.target\n    } else {\n      target = event.currentTarget || event.target\n    }\n\n    if (target?.classList.contains('vjs-back-button')) {\n      this.loadMainMenu()\n      return\n    }\n\n    // To update the sub menu value on click, setTimeout is needed because\n    // updating the value is not instant\n    setTimeout(() => this.update(event), 0)\n\n    // Seems like videojs adds a vjs-hidden class on the caption menu after a click\n    // We don't need it\n    this.subMenu.menu.removeClass('vjs-hidden')\n  }\n\n  /**\n   * Create the component's DOM element\n   *\n   */\n  createEl () {\n    const el = videojs.dom.createEl('li', {\n      className: 'vjs-menu-item',\n      tabIndex: -1\n    })\n\n    this.settingsSubMenuTitleEl_ = videojs.dom.createEl('div', {\n      className: 'vjs-settings-sub-menu-title'\n    }) as HTMLElement\n\n    el.appendChild(this.settingsSubMenuTitleEl_)\n\n    this.settingsSubMenuValueEl_ = videojs.dom.createEl('div', {\n      className: 'vjs-settings-sub-menu-value'\n    }) as HTMLElement\n\n    el.appendChild(this.settingsSubMenuValueEl_)\n\n    this.settingsSubMenuEl_ = videojs.dom.createEl('div', {\n      className: 'vjs-settings-sub-menu'\n    }) as HTMLElement\n\n    return el as HTMLLIElement\n  }\n\n  /**\n   * Handle click on menu item\n   *\n   * @method handleClick\n   */\n  handleClick (event: videojs.EventTarget.Event) {\n    this.menuToLoad = 'submenu'\n    // Remove open class to ensure only the open submenu gets this class\n    videojs.dom.removeClass(this.el(), 'open')\n\n    super.handleClick(event);\n\n    (this.mainMenu.el() as HTMLElement).style.opacity = '0'\n    // Whether to add or remove vjs-hidden class on the settingsSubMenuEl element\n    if (videojs.dom.hasClass(this.settingsSubMenuEl_, 'vjs-hidden')) {\n      videojs.dom.removeClass(this.settingsSubMenuEl_, 'vjs-hidden')\n\n      // animation not played without timeout\n      setTimeout(() => {\n        this.settingsSubMenuEl_.style.opacity = '1'\n        this.settingsSubMenuEl_.style.marginRight = '0px'\n      }, 0)\n\n      this.settingsButton.setDialogSize(this.size)\n\n      const firstChild = this.subMenu.menu.children()[0]\n      if (firstChild) firstChild.focus()\n    } else {\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\n    }\n  }\n\n  /**\n   * Create back button\n   *\n   * @method createBackButton\n   */\n  createBackButton () {\n    const button = this.subMenu.menu.addChild('MenuItem', {}, 0)\n\n    button.addClass('vjs-back-button');\n    (button.el() as HTMLElement).innerHTML = this.player().localize(this.subMenu.controlText())\n  }\n\n  /**\n   * Add/remove prefixed event listener for CSS Transition\n   *\n   * @method PrefixedEvent\n   */\n  PrefixedEvent (element: any, type: any, callback: any, action = 'addEvent') {\n    const prefix = [ 'webkit', 'moz', 'MS', 'o', '' ]\n\n    for (let p = 0; p < prefix.length; p++) {\n      if (!prefix[p]) {\n        type = type.toLowerCase()\n      }\n\n      if (action === 'addEvent') {\n        element.addEventListener(prefix[p] + type, callback, false)\n      } else if (action === 'removeEvent') {\n        element.removeEventListener(prefix[p] + type, callback, false)\n      }\n    }\n  }\n\n  onTransitionEnd (event: any) {\n    if (event.propertyName !== 'margin-right') {\n      return\n    }\n\n    if (this.menuToLoad === 'mainmenu') {\n      // hide submenu\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\n\n      // reset opacity to 0\n      this.settingsSubMenuEl_.style.opacity = '0'\n    }\n  }\n\n  reset () {\n    videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\n    this.settingsSubMenuEl_.style.opacity = '0'\n    this.setMargin()\n  }\n\n  loadMainMenu () {\n    const mainMenuEl = this.mainMenu.el() as HTMLElement\n    this.menuToLoad = 'mainmenu'\n    this.mainMenu.show()\n    mainMenuEl.style.opacity = '0'\n\n    // back button will always take you to main menu, so set dialog sizes\n    const mainMenuAny = this.mainMenu as any\n    this.settingsButton.setDialogSize([ mainMenuAny.width, mainMenuAny.height ])\n\n    // animation not triggered without timeout (some async stuff ?!?)\n    setTimeout(() => {\n      // animate margin and opacity before hiding the submenu\n      // this triggers CSS Transition event\n      this.setMargin()\n      mainMenuEl.style.opacity = '1'\n\n      const firstChild = this.mainMenu.children()[0]\n      if (firstChild) firstChild.focus()\n    }, 0)\n  }\n\n  build () {\n    this.subMenu.on('labelUpdated', () => {\n      this.update()\n    })\n    this.subMenu.on('menuChanged', () => {\n      this.bindClickEvents()\n      this.setSize()\n      this.update()\n    })\n\n    this.settingsSubMenuTitleEl_.innerHTML = this.player().localize(this.subMenu.controlText())\n    this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el())\n    this.panelChildEl.appendChild(this.settingsSubMenuEl_)\n    this.update()\n\n    this.createBackButton()\n    this.setSize()\n    this.bindClickEvents()\n\n    // prefixed event listeners for CSS TransitionEnd\n    this.PrefixedEvent(\n      this.settingsSubMenuEl_,\n      'TransitionEnd',\n      this.transitionEndHandler,\n      'addEvent'\n    )\n  }\n\n  update (event?: any) {\n    let target: HTMLElement = null\n    const subMenu = this.subMenu.name()\n\n    if (event && event.type === 'tap') {\n      target = event.target\n    } else if (event) {\n      target = event.currentTarget\n    }\n\n    // Playback rate menu button doesn't get a vjs-selected class\n    // or sets options_['selected'] on the selected playback rate.\n    // Thus we get the submenu value based on the labelEl of playbackRateMenuButton\n    if (subMenu === 'PlaybackRateMenuButton') {\n      const html = (this.subMenu as any).labelEl_.innerHTML\n\n      setTimeout(() => {\n        this.settingsSubMenuValueEl_.innerHTML = html\n      }, 250)\n    } else {\n      // Loop through the submenu items to find the selected child\n      for (const subMenuItem of this.subMenu.menu.children_) {\n        if (!(subMenuItem instanceof component)) {\n          continue\n        }\n\n        if (subMenuItem.hasClass('vjs-selected')) {\n          const subMenuItemUntyped = subMenuItem as any\n\n          // Prefer to use the function\n          if (typeof subMenuItemUntyped.getLabel === 'function') {\n            this.settingsSubMenuValueEl_.innerHTML = subMenuItemUntyped.getLabel()\n            break\n          }\n\n          this.settingsSubMenuValueEl_.innerHTML = this.player().localize(subMenuItemUntyped.options_.label)\n        }\n      }\n    }\n\n    if (target && !target.classList.contains('vjs-back-button')) {\n      this.settingsButton.hideDialog()\n    }\n  }\n\n  bindClickEvents () {\n    for (const item of this.subMenu.menu.children()) {\n      if (!(item instanceof component)) {\n        continue\n      }\n      item.on([ 'tap', 'click' ], this.submenuClickHandler)\n    }\n  }\n\n  // save size of submenus on first init\n  // if number of submenu items change dynamically more logic will be needed\n  setSize () {\n    this.dialog.removeClass('vjs-hidden')\n    videojs.dom.removeClass(this.settingsSubMenuEl_, 'vjs-hidden')\n    this.size = this.settingsButton.getComponentSize(this.settingsSubMenuEl_)\n    this.setMargin()\n    this.dialog.addClass('vjs-hidden')\n    videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\n  }\n\n  setMargin () {\n    if (!this.size) return\n\n    const [ width ] = this.size\n\n    this.settingsSubMenuEl_.style.marginRight = `-${width}px`\n  }\n\n  /**\n   * Hide the sub menu\n   */\n  hideSubMenu () {\n    // after removing settings item this.el_ === null\n    if (!this.el()) {\n      return\n    }\n\n    if (videojs.dom.hasClass(this.el(), 'open')) {\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\n      videojs.dom.removeClass(this.el(), 'open')\n    }\n  }\n\n}\n\n(SettingsMenuItem as any).prototype.contentElType = 'button'\nvideojs.registerComponent('SettingsMenuItem', SettingsMenuItem)\n\nexport { SettingsMenuItem }\n","import videojs from 'video.js'\nimport { toTitleCase } from '../common'\nimport { SettingsDialog } from './settings-dialog'\nimport { SettingsMenuItem } from './settings-menu-item'\nimport { SettingsPanel } from './settings-panel'\nimport { SettingsPanelChild } from './settings-panel-child'\n\nconst Button = videojs.getComponent('Button')\nconst Menu = videojs.getComponent('Menu')\nconst Component = videojs.getComponent('Component')\n\nexport interface SettingsButtonOptions extends videojs.ComponentOptions {\n  entries: any[]\n  setup?: {\n    maxHeightOffset: number\n  }\n}\n\nclass SettingsButton extends Button {\n  dialog: SettingsDialog\n  dialogEl: HTMLElement\n  menu: videojs.Menu\n  panel: SettingsPanel\n  panelChild: SettingsPanelChild\n\n  addSettingsItemHandler: typeof SettingsButton.prototype.onAddSettingsItem\n  disposeSettingsItemHandler: typeof SettingsButton.prototype.onDisposeSettingsItem\n  documentClickHandler: typeof SettingsButton.prototype.onDocumentClick\n  userInactiveHandler: typeof SettingsButton.prototype.onUserInactive\n\n  private settingsButtonOptions: SettingsButtonOptions\n\n  constructor (player: videojs.Player, options?: SettingsButtonOptions) {\n    super(player, options)\n\n    this.settingsButtonOptions = options\n\n    this.controlText('Settings')\n\n    this.dialog = this.player().addChild('settingsDialog')\n    this.dialogEl = this.dialog.el() as HTMLElement\n    this.menu = null\n    this.panel = this.dialog.addChild('settingsPanel')\n    this.panelChild = this.panel.addChild('settingsPanelChild')\n\n    this.addClass('vjs-settings')\n    this.el().setAttribute('aria-label', 'Settings Button')\n\n    // Event handlers\n    this.addSettingsItemHandler = this.onAddSettingsItem.bind(this)\n    this.disposeSettingsItemHandler = this.onDisposeSettingsItem.bind(this)\n    this.documentClickHandler = this.onDocumentClick.bind(this)\n    this.userInactiveHandler = this.onUserInactive.bind(this)\n\n    this.buildMenu()\n    this.bindEvents()\n\n    // Prepare the dialog\n    this.player().one('play', () => this.hideDialog())\n  }\n\n  onDocumentClick (event: MouseEvent) {\n    const element = event.target as HTMLElement\n\n    if (element?.classList?.contains('vjs-settings') || element?.parentElement?.classList?.contains('vjs-settings')) {\n      return\n    }\n\n    if (!this.dialog.hasClass('vjs-hidden')) {\n      this.hideDialog()\n    }\n  }\n\n  onDisposeSettingsItem (event: any, name: string) {\n    if (name === undefined) {\n      const children = this.menu.children()\n\n      while (children.length > 0) {\n        children[0].dispose()\n        this.menu.removeChild(children[0])\n      }\n\n      this.addClass('vjs-hidden')\n    } else {\n      const item = this.menu.getChild(name)\n\n      if (item) {\n        item.dispose()\n        this.menu.removeChild(item)\n      }\n    }\n\n    this.hideDialog()\n\n    if (this.settingsButtonOptions.entries.length === 0) {\n      this.addClass('vjs-hidden')\n    }\n  }\n\n  dispose () {\n    document.removeEventListener('click', this.documentClickHandler)\n\n    if (this.isInIframe()) {\n      window.removeEventListener('blur', this.documentClickHandler)\n    }\n  }\n\n  onAddSettingsItem (event: any, data: any) {\n    const [ entry, options ] = data\n\n    this.addMenuItem(entry, options)\n    this.removeClass('vjs-hidden')\n  }\n\n  onUserInactive () {\n    if (!this.dialog.hasClass('vjs-hidden')) {\n      this.hideDialog()\n    }\n  }\n\n  bindEvents () {\n    document.addEventListener('click', this.documentClickHandler)\n    if (this.isInIframe()) {\n      window.addEventListener('blur', this.documentClickHandler)\n    }\n\n    this.player().on('addsettingsitem', this.addSettingsItemHandler)\n    this.player().on('disposesettingsitem', this.disposeSettingsItemHandler)\n    this.player().on('userinactive', this.userInactiveHandler)\n  }\n\n  buildCSSClass () {\n    return `vjs-icon-settings ${super.buildCSSClass()}`\n  }\n\n  handleClick () {\n    if (this.dialog.hasClass('vjs-hidden')) {\n      this.showDialog()\n    } else {\n      this.hideDialog()\n    }\n  }\n\n  showDialog () {\n    this.player().peertube().onMenuOpened();\n\n    (this.menu.el() as HTMLElement).style.opacity = '1'\n\n    this.dialog.show()\n    this.el().setAttribute('aria-expanded', 'true')\n\n    this.setDialogSize(this.getComponentSize(this.menu))\n\n    const firstChild = this.menu.children()[0]\n    if (firstChild) firstChild.focus()\n  }\n\n  hideDialog () {\n    this.player_.peertube().onMenuClosed()\n\n    this.dialog.hide()\n    this.el().setAttribute('aria-expanded', 'false')\n\n    this.setDialogSize(this.getComponentSize(this.menu));\n    (this.menu.el() as HTMLElement).style.opacity = '1'\n    this.resetChildren()\n  }\n\n  getComponentSize (element: videojs.Component | HTMLElement) {\n    let width: number = null\n    let height: number = null\n\n    // Could be component or just DOM element\n    if (element instanceof Component) {\n      const el = element.el() as HTMLElement\n\n      width = el.offsetWidth\n      height = el.offsetHeight;\n\n      (element as any).width = width;\n      (element as any).height = height\n    } else {\n      width = element.offsetWidth\n      height = element.offsetHeight\n    }\n\n    return [ width, height ]\n  }\n\n  setDialogSize ([ width, height ]: number[]) {\n    if (typeof height !== 'number') {\n      return\n    }\n\n    const offset = this.settingsButtonOptions.setup.maxHeightOffset\n    const maxHeight = (this.player().el() as HTMLElement).offsetHeight - offset\n\n    const panelEl = this.panel.el() as HTMLElement\n\n    if (height > maxHeight) {\n      height = maxHeight\n      width += 17\n      panelEl.style.maxHeight = `${height}px`\n    } else if (panelEl.style.maxHeight !== '') {\n      panelEl.style.maxHeight = ''\n    }\n\n    this.dialogEl.style.width = `${width}px`\n    this.dialogEl.style.height = `${height}px`\n  }\n\n  buildMenu () {\n    this.menu = new Menu(this.player())\n    this.menu.addClass('vjs-main-menu')\n    const entries = this.settingsButtonOptions.entries\n\n    if (entries.length === 0) {\n      this.addClass('vjs-hidden')\n      this.panelChild.addChild(this.menu)\n      return\n    }\n\n    for (const entry of entries) {\n      this.addMenuItem(entry, this.settingsButtonOptions)\n    }\n\n    this.panelChild.addChild(this.menu)\n  }\n\n  addMenuItem (entry: any, options: any) {\n    const openSubMenu = function (this: any) {\n      if (videojs.dom.hasClass(this.el_, 'open')) {\n        videojs.dom.removeClass(this.el_, 'open')\n      } else {\n        videojs.dom.addClass(this.el_, 'open')\n      }\n    }\n\n    options.name = toTitleCase(entry)\n\n    const newOptions = Object.assign({}, options, { entry, menuButton: this })\n    const settingsMenuItem = new SettingsMenuItem(this.player(), newOptions)\n\n    this.menu.addChild(settingsMenuItem)\n\n    // Hide children to avoid sub menus stacking on top of each other\n    // or having multiple menus open\n    settingsMenuItem.on('click', videojs.bind(this, this.hideChildren))\n\n    // Whether to add or remove selected class on the settings sub menu element\n    settingsMenuItem.on('click', openSubMenu)\n  }\n\n  resetChildren () {\n    for (const menuChild of this.menu.children()) {\n      (menuChild as SettingsMenuItem).reset()\n    }\n  }\n\n  /**\n   * Hide all the sub menus\n   */\n  hideChildren () {\n    for (const menuChild of this.menu.children()) {\n      (menuChild as SettingsMenuItem).hideSubMenu()\n    }\n  }\n\n  isInIframe () {\n    return window.self !== window.top\n  }\n\n}\n\nComponent.registerComponent('SettingsButton', SettingsButton)\n\nexport { SettingsButton }\n","import videojs from 'video.js'\n\nconst Component = videojs.getComponent('Component')\n\nclass SettingsPanel extends Component {\n\n  createEl () {\n    return super.createEl('div', {\n      className: 'vjs-settings-panel',\n      innerHTML: '',\n      tabIndex: -1\n    })\n  }\n}\n\nComponent.registerComponent('SettingsPanel', SettingsPanel)\n\nexport { SettingsPanel }\n","import videojs from 'video.js'\n\nconst Component = videojs.getComponent('Component')\n\nclass SettingsPanelChild extends Component {\n\n  createEl () {\n    return super.createEl('div', {\n      className: 'vjs-settings-panel-child',\n      innerHTML: '',\n      tabIndex: -1\n    })\n  }\n}\n\nComponent.registerComponent('SettingsPanelChild', SettingsPanelChild)\n\nexport { SettingsPanelChild }\n","import videojs from 'video.js'\nimport { PlaylistPluginOptions } from '../../types'\nimport { PlaylistMenu } from './playlist-menu'\n\nconst ClickableComponent = videojs.getComponent('ClickableComponent')\n\nclass PlaylistButton extends ClickableComponent {\n  private playlistInfoElement: HTMLElement\n  private wrapper: HTMLElement\n\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions & { playlistMenu: PlaylistMenu }) {\n    super(player, options as any)\n  }\n\n  createEl () {\n    this.wrapper = super.createEl('div', {\n      className: 'vjs-playlist-button',\n      innerHTML: '',\n      tabIndex: -1\n    }) as HTMLElement\n\n    const icon = super.createEl('div', {\n      className: 'vjs-playlist-icon',\n      innerHTML: '',\n      tabIndex: -1\n    })\n\n    this.playlistInfoElement = super.createEl('div', {\n      className: 'vjs-playlist-info',\n      innerHTML: '',\n      tabIndex: -1\n    }) as HTMLElement\n\n    this.wrapper.appendChild(icon)\n    this.wrapper.appendChild(this.playlistInfoElement)\n\n    this.update()\n\n    return this.wrapper\n  }\n\n  update () {\n    const options = this.options_ as PlaylistPluginOptions\n\n    this.playlistInfoElement.innerHTML = options.getCurrentPosition() + '/' + options.playlist.videosLength\n    this.wrapper.title = this.player().localize('Playlist: {1}', [ options.playlist.displayName ])\n  }\n\n  handleClick () {\n    const playlistMenu = this.getPlaylistMenu()\n    playlistMenu.open()\n  }\n\n  private getPlaylistMenu () {\n    return (this.options_ as any).playlistMenu as PlaylistMenu\n  }\n}\n\nvideojs.registerComponent('PlaylistButton', PlaylistButton)\n\nexport { PlaylistButton }\n","import videojs from 'video.js'\nimport { secondsToTime } from '@shared/core-utils'\nimport { VideoPlaylistElement } from '@shared/models'\nimport { PlaylistItemOptions } from '../../types'\n\nconst Component = videojs.getComponent('Component')\n\nclass PlaylistMenuItem extends Component {\n  private element: VideoPlaylistElement\n\n  constructor (player: videojs.Player, options?: PlaylistItemOptions) {\n    super(player, options as any)\n\n    this.emitTapEvents()\n\n    this.element = options.element\n\n    this.on([ 'click', 'tap' ], () => this.switchPlaylistItem())\n    this.on('keydown', event => this.handleKeyDown(event))\n  }\n\n  createEl () {\n    const options = this.options_ as PlaylistItemOptions\n\n    const li = super.createEl('li', {\n      className: 'vjs-playlist-menu-item',\n      innerHTML: ''\n    }) as HTMLElement\n\n    if (!options.element.video) {\n      li.classList.add('vjs-disabled')\n    }\n\n    const positionBlock = super.createEl('div', {\n      className: 'item-position-block'\n    }) as HTMLElement\n\n    const position = super.createEl('div', {\n      className: 'item-position',\n      innerHTML: options.element.position\n    })\n\n    positionBlock.appendChild(position)\n    li.appendChild(positionBlock)\n\n    if (options.element.video) {\n      this.buildAvailableVideo(li, positionBlock, options)\n    } else {\n      this.buildUnavailableVideo(li)\n    }\n\n    return li\n  }\n\n  setSelected (selected: boolean) {\n    if (selected) this.addClass('vjs-selected')\n    else this.removeClass('vjs-selected')\n  }\n\n  getElement () {\n    return this.element\n  }\n\n  private buildAvailableVideo (li: HTMLElement, positionBlock: HTMLElement, options: PlaylistItemOptions) {\n    const videoElement = options.element\n\n    const player = super.createEl('div', {\n      className: 'item-player'\n    })\n\n    positionBlock.appendChild(player)\n\n    const thumbnail = super.createEl('img', {\n      src: window.location.origin + videoElement.video.thumbnailPath\n    })\n\n    const infoBlock = super.createEl('div', {\n      className: 'info-block'\n    })\n\n    const title = super.createEl('div', {\n      innerHTML: videoElement.video.name,\n      className: 'title'\n    })\n\n    const channel = super.createEl('div', {\n      innerHTML: videoElement.video.channel.displayName,\n      className: 'channel'\n    })\n\n    infoBlock.appendChild(title)\n    infoBlock.appendChild(channel)\n\n    if (videoElement.startTimestamp || videoElement.stopTimestamp) {\n      let html = ''\n\n      if (videoElement.startTimestamp) html += secondsToTime(videoElement.startTimestamp)\n      if (videoElement.stopTimestamp) html += ' - ' + secondsToTime(videoElement.stopTimestamp)\n\n      const timestamps = super.createEl('div', {\n        innerHTML: html,\n        className: 'timestamps'\n      })\n\n      infoBlock.append(timestamps)\n    }\n\n    li.append(thumbnail)\n    li.append(infoBlock)\n  }\n\n  private buildUnavailableVideo (li: HTMLElement) {\n    const block = super.createEl('div', {\n      className: 'item-unavailable',\n      innerHTML: this.player().localize('Unavailable video')\n    })\n\n    li.appendChild(block)\n  }\n\n  private handleKeyDown (event: KeyboardEvent) {\n    if (event.code === 'Space' || event.code === 'Enter') {\n      this.switchPlaylistItem()\n    }\n  }\n\n  private switchPlaylistItem () {\n    const options = this.options_ as PlaylistItemOptions\n\n    options.onClicked()\n  }\n}\n\nComponent.registerComponent('PlaylistMenuItem', PlaylistMenuItem)\n\nexport { PlaylistMenuItem }\n","import videojs from 'video.js'\nimport { VideoPlaylistElement } from '@shared/models'\nimport { PlaylistPluginOptions } from '../../types'\nimport { PlaylistMenuItem } from './playlist-menu-item'\n\nconst Component = videojs.getComponent('Component')\n\nclass PlaylistMenu extends Component {\n  private menuItems: PlaylistMenuItem[]\n\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions) {\n    super(player, options as any)\n\n    const self = this\n\n    function userInactiveHandler () {\n      self.close()\n    }\n\n    this.el().addEventListener('mouseenter', () => {\n      this.player().off('userinactive', userInactiveHandler)\n    })\n\n    this.el().addEventListener('mouseleave', () => {\n      this.player().one('userinactive', userInactiveHandler)\n    })\n\n    this.player().on('click', event => {\n      let current = event.target as HTMLElement\n\n      do {\n        if (\n          current.classList.contains('vjs-playlist-menu') ||\n          current.classList.contains('vjs-playlist-button')\n        ) {\n          return\n        }\n\n        current = current.parentElement\n      } while (current)\n\n      this.close()\n    })\n  }\n\n  createEl () {\n    this.menuItems = []\n\n    const options = this.getOptions()\n\n    const menu = super.createEl('div', {\n      className: 'vjs-playlist-menu',\n      innerHTML: '',\n      tabIndex: -1\n    })\n\n    const header = super.createEl('div', {\n      className: 'header'\n    })\n\n    const headerLeft = super.createEl('div')\n\n    const leftTitle = super.createEl('div', {\n      innerHTML: options.playlist.displayName,\n      className: 'title'\n    })\n\n    const playlistChannel = options.playlist.videoChannel\n    const leftSubtitle = super.createEl('div', {\n      innerHTML: playlistChannel\n        ? this.player().localize('By {1}', [ playlistChannel.displayName ])\n        : '',\n      className: 'channel'\n    })\n\n    headerLeft.appendChild(leftTitle)\n    headerLeft.appendChild(leftSubtitle)\n\n    const tick = super.createEl('div', {\n      className: 'cross'\n    })\n    tick.addEventListener('click', () => this.close())\n\n    header.appendChild(headerLeft)\n    header.appendChild(tick)\n\n    const list = super.createEl('ol')\n\n    for (const playlistElement of options.elements) {\n      const item = new PlaylistMenuItem(this.player(), {\n        element: playlistElement,\n        onClicked: () => this.onItemClicked(playlistElement)\n      })\n\n      list.appendChild(item.el())\n\n      this.menuItems.push(item)\n    }\n\n    menu.appendChild(header)\n    menu.appendChild(list)\n\n    return menu\n  }\n\n  update () {\n    const options = this.getOptions()\n\n    this.updateSelected(options.getCurrentPosition())\n  }\n\n  open () {\n    this.player().addClass('playlist-menu-displayed')\n  }\n\n  close () {\n    this.player().removeClass('playlist-menu-displayed')\n  }\n\n  updateSelected (newPosition: number) {\n    for (const item of this.menuItems) {\n      item.setSelected(item.getElement().position === newPosition)\n    }\n  }\n\n  private getOptions () {\n    return this.options_ as PlaylistPluginOptions\n  }\n\n  private onItemClicked (element: VideoPlaylistElement) {\n    this.getOptions().onItemClicked(element)\n  }\n}\n\nComponent.registerComponent('PlaylistMenu', PlaylistMenu)\n\nexport { PlaylistMenu }\n","import videojs from 'video.js'\nimport { PlaylistPluginOptions } from '../../types'\nimport { PlaylistButton } from './playlist-button'\nimport { PlaylistMenu } from './playlist-menu'\n\nconst Plugin = videojs.getPlugin('plugin')\n\nclass PlaylistPlugin extends Plugin {\n  private playlistMenu: PlaylistMenu\n  private playlistButton: PlaylistButton\n  private options: PlaylistPluginOptions\n\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions) {\n    super(player, options)\n\n    this.options = options\n\n    this.player.ready(() => {\n      player.addClass('vjs-playlist')\n    })\n\n    this.playlistMenu = new PlaylistMenu(player, options)\n    this.playlistButton = new PlaylistButton(player, { ...options, playlistMenu: this.playlistMenu })\n\n    player.addChild(this.playlistMenu, options)\n    player.addChild(this.playlistButton, options)\n  }\n\n  updateSelected () {\n    this.playlistMenu.updateSelected(this.options.getCurrentPosition())\n  }\n}\n\nvideojs.registerPlugin('playlist', PlaylistPlugin)\nexport { PlaylistPlugin }\n","import debug from 'debug'\nimport videojs from 'video.js'\nimport { logger } from '@root-helpers/logger'\nimport { PeerTubeMobileButtons } from './peertube-mobile-buttons'\n\nconst debugLogger = debug('peertube:player:mobile')\n\nconst Plugin = videojs.getPlugin('plugin')\n\nclass PeerTubeMobilePlugin extends Plugin {\n  private static readonly DOUBLE_TAP_DELAY_MS = 250\n  private static readonly SET_CURRENT_TIME_DELAY = 1000\n\n  private peerTubeMobileButtons: PeerTubeMobileButtons\n\n  private seekAmount = 0\n\n  private lastTapEvent: TouchEvent\n  private tapTimeout: ReturnType<typeof setTimeout>\n  private newActiveState: boolean\n\n  private setCurrentTimeTimeout: ReturnType<typeof setTimeout>\n\n  constructor (player: videojs.Player, options: videojs.PlayerOptions) {\n    super(player, options)\n\n    this.peerTubeMobileButtons = player.addChild('PeerTubeMobileButtons', { reportTouchActivity: false }) as PeerTubeMobileButtons\n\n    if (videojs.browser.IS_ANDROID && screen.orientation) {\n      this.handleFullscreenRotation()\n    }\n\n    if (!this.player.options_.userActions) this.player.options_.userActions = {};\n\n    // FIXME: typings\n    (this.player.options_.userActions as any).click = false\n    this.player.options_.userActions.doubleClick = false\n\n    this.player.one('play', () => {\n      this.initTouchStartEvents()\n    })\n  }\n\n  private handleFullscreenRotation () {\n    this.player.on('fullscreenchange', () => {\n      if (!this.player.isFullscreen() || this.isPortraitVideo()) return\n\n      screen.orientation.lock('landscape')\n        .catch(err => logger.error('Cannot lock screen to landscape.', err))\n    })\n  }\n\n  private isPortraitVideo () {\n    return this.player.videoWidth() < this.player.videoHeight()\n  }\n\n  private initTouchStartEvents () {\n    const handleTouchStart = (event: TouchEvent) => {\n      if (this.tapTimeout) {\n        clearTimeout(this.tapTimeout)\n        this.tapTimeout = undefined\n      }\n\n      if (this.lastTapEvent && event.timeStamp - this.lastTapEvent.timeStamp < PeerTubeMobilePlugin.DOUBLE_TAP_DELAY_MS) {\n        debugLogger('Detected double tap')\n\n        this.lastTapEvent = undefined\n        this.onDoubleTap(event)\n        return\n      }\n\n      this.newActiveState = !this.player.userActive()\n\n      this.tapTimeout = setTimeout(() => {\n        debugLogger('No double tap detected, set user active state to %s.', this.newActiveState)\n\n        this.player.userActive(this.newActiveState)\n      }, PeerTubeMobilePlugin.DOUBLE_TAP_DELAY_MS)\n\n      this.lastTapEvent = event\n    }\n\n    this.player.on('touchstart', (event: TouchEvent) => {\n      // Only enable user active on player touch, we listen event on peertube mobile buttons to disable it\n      if (this.player.userActive()) return\n\n      handleTouchStart(event)\n    })\n\n    this.peerTubeMobileButtons.el().addEventListener('touchstart', (event: TouchEvent) => {\n      // Prevent mousemove/click events firing on the player, that conflict with our user active logic\n      event.preventDefault()\n\n      handleTouchStart(event)\n    }, { passive: false })\n  }\n\n  private onDoubleTap (event: TouchEvent) {\n    const playerWidth = this.player.currentWidth()\n\n    const rect = this.findPlayerTarget((event.target as HTMLElement)).getBoundingClientRect()\n    const offsetX = event.targetTouches[0].pageX - rect.left\n\n    debugLogger('Calculating double tap zone (player width: %d, offset X: %d)', playerWidth, offsetX)\n\n    if (offsetX > 0.66 * playerWidth) {\n      if (this.seekAmount < 0) this.seekAmount = 0\n\n      this.seekAmount += 10\n\n      debugLogger('Will forward %d seconds', this.seekAmount)\n    } else if (offsetX < 0.33 * playerWidth) {\n      if (this.seekAmount > 0) this.seekAmount = 0\n\n      this.seekAmount -= 10\n      debugLogger('Will rewind %d seconds', this.seekAmount)\n    }\n\n    this.peerTubeMobileButtons.displayFastSeek(this.seekAmount)\n\n    this.scheduleSetCurrentTime()\n  }\n\n  private findPlayerTarget (target: HTMLElement): HTMLElement {\n    if (target.classList.contains('video-js')) return target\n\n    return this.findPlayerTarget(target.parentElement)\n  }\n\n  private scheduleSetCurrentTime () {\n    this.player.pause()\n    this.player.addClass('vjs-fast-seeking')\n\n    if (this.setCurrentTimeTimeout) clearTimeout(this.setCurrentTimeTimeout)\n\n    this.setCurrentTimeTimeout = setTimeout(() => {\n      let newTime = this.player.currentTime() + this.seekAmount\n      this.seekAmount = 0\n\n      newTime = Math.max(0, newTime)\n      newTime = Math.min(this.player.duration(), newTime)\n\n      this.player.currentTime(newTime)\n      this.seekAmount = 0\n      this.peerTubeMobileButtons.displayFastSeek(0)\n\n      this.player.removeClass('vjs-fast-seeking')\n      this.player.userActive(false)\n\n      this.player.play()\n    }, PeerTubeMobilePlugin.SET_CURRENT_TIME_DELAY)\n  }\n}\n\nvideojs.registerPlugin('peertubeMobile', PeerTubeMobilePlugin)\nexport { PeerTubeMobilePlugin }\n","import videojs from 'video.js'\n\nconst Component = videojs.getComponent('Component')\nclass PeerTubeMobileButtons extends Component {\n\n  private rewind: Element\n  private forward: Element\n  private rewindText: Element\n  private forwardText: Element\n\n  createEl () {\n    const container = super.createEl('div', {\n      className: 'vjs-mobile-buttons-overlay'\n    }) as HTMLDivElement\n\n    const mainButton = super.createEl('div', {\n      className: 'main-button'\n    }) as HTMLDivElement\n\n    mainButton.addEventListener('touchstart', e => {\n      e.stopPropagation()\n\n      if (this.player_.paused() || this.player_.ended()) {\n        this.player_.play()\n        return\n      }\n\n      this.player_.pause()\n    })\n\n    this.rewind = super.createEl('div', { className: 'rewind-button vjs-hidden' })\n    this.forward = super.createEl('div', { className: 'forward-button vjs-hidden' })\n\n    for (let i = 0; i < 3; i++) {\n      this.rewind.appendChild(super.createEl('span', { className: 'icon' }))\n      this.forward.appendChild(super.createEl('span', { className: 'icon' }))\n    }\n\n    this.rewindText = this.rewind.appendChild(super.createEl('div', { className: 'text' }))\n    this.forwardText = this.forward.appendChild(super.createEl('div', { className: 'text' }))\n\n    container.appendChild(this.rewind)\n    container.appendChild(mainButton)\n    container.appendChild(this.forward)\n\n    return container\n  }\n\n  displayFastSeek (amount: number) {\n    if (amount === 0) {\n      this.hideRewind()\n      this.hideForward()\n      return\n    }\n\n    if (amount > 0) {\n      this.hideRewind()\n      this.displayForward(amount)\n      return\n    }\n\n    if (amount < 0) {\n      this.hideForward()\n      this.displayRewind(amount)\n      return\n    }\n  }\n\n  private hideRewind () {\n    this.rewind.classList.add('vjs-hidden')\n    this.rewindText.textContent = ''\n  }\n\n  private displayRewind (amount: number) {\n    this.rewind.classList.remove('vjs-hidden')\n    this.rewindText.textContent = this.player().localize('{1} seconds', [ amount + '' ])\n  }\n\n  private hideForward () {\n    this.forward.classList.add('vjs-hidden')\n    this.forwardText.textContent = ''\n  }\n\n  private displayForward (amount: number) {\n    this.forward.classList.remove('vjs-hidden')\n    this.forwardText.textContent = this.player().localize('{1} seconds', [ amount + '' ])\n  }\n}\n\nvideojs.registerComponent('PeerTubeMobileButtons', PeerTubeMobileButtons)\n\nexport {\n  PeerTubeMobileButtons\n}\n","import videojs from 'video.js'\n\ntype KeyHandler = { accept: (event: KeyboardEvent) => boolean, cb: (e: KeyboardEvent) => void }\n\nconst Plugin = videojs.getPlugin('plugin')\n\nclass PeerTubeHotkeysPlugin extends Plugin {\n  private static readonly VOLUME_STEP = 0.1\n  private static readonly SEEK_STEP = 5\n\n  private readonly handleKeyFunction: (event: KeyboardEvent) => void\n\n  private readonly handlers: KeyHandler[]\n\n  constructor (player: videojs.Player, options: videojs.PlayerOptions) {\n    super(player, options)\n\n    this.handlers = this.buildHandlers()\n\n    this.handleKeyFunction = (event: KeyboardEvent) => this.onKeyDown(event)\n    document.addEventListener('keydown', this.handleKeyFunction)\n  }\n\n  dispose () {\n    document.removeEventListener('keydown', this.handleKeyFunction)\n  }\n\n  private onKeyDown (event: KeyboardEvent) {\n    if (!this.isValidKeyTarget(event.target as HTMLElement)) return\n\n    for (const handler of this.handlers) {\n      if (handler.accept(event)) {\n        handler.cb(event)\n        return\n      }\n    }\n  }\n\n  private buildHandlers () {\n    const handlers: KeyHandler[] = [\n      // Play\n      {\n        accept: e => (e.key === ' ' || e.key === 'MediaPlayPause'),\n        cb: e => {\n          e.preventDefault()\n          e.stopPropagation()\n\n          if (this.player.paused()) this.player.play()\n          else this.player.pause()\n        }\n      },\n\n      // Increase volume\n      {\n        accept: e => this.isNaked(e, 'ArrowUp'),\n        cb: e => {\n          e.preventDefault()\n          this.player.volume(this.player.volume() + PeerTubeHotkeysPlugin.VOLUME_STEP)\n        }\n      },\n\n      // Decrease volume\n      {\n        accept: e => this.isNaked(e, 'ArrowDown'),\n        cb: e => {\n          e.preventDefault()\n          this.player.volume(this.player.volume() - PeerTubeHotkeysPlugin.VOLUME_STEP)\n        }\n      },\n\n      // Rewind\n      {\n        accept: e => this.isNaked(e, 'ArrowLeft') || this.isNaked(e, 'MediaRewind'),\n        cb: e => {\n          e.preventDefault()\n\n          const target = Math.max(0, this.player.currentTime() - PeerTubeHotkeysPlugin.SEEK_STEP)\n          this.player.currentTime(target)\n        }\n      },\n\n      // Forward\n      {\n        accept: e => this.isNaked(e, 'ArrowRight') || this.isNaked(e, 'MediaForward'),\n        cb: e => {\n          e.preventDefault()\n\n          const target = Math.min(this.player.duration(), this.player.currentTime() + PeerTubeHotkeysPlugin.SEEK_STEP)\n          this.player.currentTime(target)\n        }\n      },\n\n      // Fullscreen\n      {\n        // f key or Ctrl + Enter\n        accept: e => this.isNaked(e, 'f') || (!e.altKey && e.ctrlKey && e.key === 'Enter'),\n        cb: e => {\n          e.preventDefault()\n\n          if (this.player.isFullscreen()) this.player.exitFullscreen()\n          else this.player.requestFullscreen()\n        }\n      },\n\n      // Mute\n      {\n        accept: e => this.isNaked(e, 'm'),\n        cb: e => {\n          e.preventDefault()\n\n          this.player.muted(!this.player.muted())\n        }\n      },\n\n      // Increase playback rate\n      {\n        accept: e => e.key === '>',\n        cb: () => {\n          const target = Math.min(this.player.playbackRate() + 0.1, 5)\n\n          this.player.playbackRate(parseFloat(target.toFixed(2)))\n        }\n      },\n\n      // Decrease playback rate\n      {\n        accept: e => e.key === '<',\n        cb: () => {\n          const target = Math.max(this.player.playbackRate() - 0.1, 0.10)\n\n          this.player.playbackRate(parseFloat(target.toFixed(2)))\n        }\n      },\n\n      // Previous frame\n      {\n        accept: e => e.key === ',',\n        cb: () => {\n          this.player.pause()\n\n          // Calculate movement distance (assuming 30 fps)\n          const dist = 1 / 30\n          this.player.currentTime(this.player.currentTime() - dist)\n        }\n      },\n\n      // Next frame\n      {\n        accept: e => e.key === '.',\n        cb: () => {\n          this.player.pause()\n\n          // Calculate movement distance (assuming 30 fps)\n          const dist = 1 / 30\n          this.player.currentTime(this.player.currentTime() + dist)\n        }\n      }\n    ]\n\n    // 0-9 key handlers\n    for (let i = 0; i < 10; i++) {\n      handlers.push({\n        accept: e => e.key === i + '' && !e.ctrlKey, // If using ctrl key, it's a web browser hotkey\n        cb: e => {\n          e.preventDefault()\n\n          this.player.currentTime(this.player.duration() * i * 0.1)\n        }\n      })\n    }\n\n    return handlers\n  }\n\n  private isValidKeyTarget (eventEl: HTMLElement) {\n    const playerEl = this.player.el()\n    const activeEl = document.activeElement\n    const currentElTagName = eventEl.tagName.toLowerCase()\n\n    return (\n      activeEl === playerEl ||\n      activeEl === playerEl.querySelector('.vjs-tech') ||\n      activeEl === playerEl.querySelector('.vjs-control-bar') ||\n      eventEl.id === 'content' ||\n      currentElTagName === 'body' ||\n      currentElTagName === 'video'\n    )\n  }\n\n  private isNaked (event: KeyboardEvent, key: string) {\n    return (!event.ctrlKey && !event.altKey && !event.metaKey && !event.shiftKey && event.key === key)\n  }\n}\n\nvideojs.registerPlugin('peerTubeHotkeysPlugin', PeerTubeHotkeysPlugin)\nexport { PeerTubeHotkeysPlugin }\n","function copyToClipboard (text: string) {\n  const el = document.createElement('textarea')\n  el.value = text\n  el.setAttribute('readonly', '')\n  el.style.position = 'absolute'\n  el.style.left = '-9999px'\n  document.body.appendChild(el)\n  el.select()\n  document.execCommand('copy')\n  document.body.removeChild(el)\n}\n\nfunction wait (ms: number) {\n  return new Promise<void>(res => {\n    setTimeout(() => res(), ms)\n  })\n}\n\nexport {\n  copyToClipboard,\n  wait\n}\n","import {\n  CommonOptions,\n  NextPreviousVideoButtonOptions,\n  PeerTubeLinkButtonOptions,\n  PeertubePlayerManagerOptions,\n  PlayerMode\n} from '../../types'\n\nexport class ControlBarOptionsBuilder {\n  private options: CommonOptions\n\n  constructor (\n    globalOptions: PeertubePlayerManagerOptions,\n    private mode: PlayerMode\n  ) {\n    this.options = globalOptions.common\n  }\n\n  getChildrenOptions () {\n    const children = {}\n\n    if (this.options.previousVideo) {\n      Object.assign(children, this.getPreviousVideo())\n    }\n\n    Object.assign(children, { playToggle: {} })\n\n    if (this.options.nextVideo) {\n      Object.assign(children, this.getNextVideo())\n    }\n\n    Object.assign(children, {\n      currentTimeDisplay: {},\n      timeDivider: {},\n      durationDisplay: {},\n      liveDisplay: {},\n\n      flexibleWidthSpacer: {},\n\n      ...this.getProgressControl(),\n\n      p2PInfoButton: {\n        p2pEnabled: this.options.p2pEnabled\n      },\n\n      muteToggle: {},\n      volumeControl: {},\n\n      ...this.getSettingsButton()\n    })\n\n    /*if (this.options.peertubeLink === true) {\n      Object.assign(children, {\n        peerTubeLinkButton: {\n          shortUUID: this.options.videoShortUUID,\n          //instanceName: this.options.instanceName\n        } as PeerTubeLinkButtonOptions\n      })\n    }*/\n\n    Object.assign(children, {\n      PictureInPictureBastyon: {}\n    })\n\n    if (this.options.theaterButton === true) {\n      Object.assign(children, {\n        theaterButton: {}\n      })\n    }\n\n    Object.assign(children, {\n      fullscreenToggle: {}\n    })\n\n    return children\n  }\n\n  private getSettingsButton () {\n    const settingEntries: string[] = []\n\n    settingEntries.push('playbackRateMenuButton')\n\n    //if (this.options.captions === true) settingEntries.push('captionsButton')\n\n    settingEntries.push('resolutionMenuButton')\n\n    return {\n      settingsButton: {\n        setup: {\n          maxHeightOffset: 40\n        },\n        entries: settingEntries\n      }\n    }\n  }\n\n  private getProgressControl () {\n    const loadProgressBar = this.mode === 'webtorrent'\n      ? 'peerTubeLoadProgressBar'\n      : 'loadProgressBar'\n\n    return {\n      progressControl: {\n        children: {\n          seekBar: {\n            children: {\n              [loadProgressBar]: {},\n              mouseTimeDisplay: {},\n              playProgressBar: {}\n            }\n          }\n        }\n      }\n    }\n  }\n\n  private getPreviousVideo () {\n    const buttonOptions: NextPreviousVideoButtonOptions = {\n      type: 'previous',\n      handler: this.options.previousVideo,\n      isDisabled: () => {\n        if (!this.options.hasPreviousVideo) return false\n\n        return !this.options.hasPreviousVideo()\n      }\n    }\n\n    return { previousVideoButton: buttonOptions }\n  }\n\n  private getNextVideo () {\n    const buttonOptions: NextPreviousVideoButtonOptions = {\n      type: 'next',\n      handler: this.options.nextVideo,\n      isDisabled: () => {\n        if (!this.options.hasNextVideo) return false\n\n        return !this.options.hasNextVideo()\n      }\n    }\n\n    return { nextVideoButton: buttonOptions }\n  }\n}\n","import { basename, dirname } from 'path'\nimport { logger } from '@root-helpers/logger'\n\nclass RedundancyUrlManager {\n\n  constructor (private baseUrls: string[] = []) {\n    // empty\n  }\n\n  removeBySegmentUrl (segmentUrl: string) {\n    logger.info(`Removing redundancy of segment URL ${segmentUrl}.`)\n\n    const baseUrl = dirname(segmentUrl)\n\n    this.baseUrls = this.baseUrls.filter(u => u !== baseUrl && u !== baseUrl + '/')\n  }\n\n  buildUrl (url: string) {\n    const max = this.baseUrls.length + 1\n    const i = this.getRandomInt(max)\n\n    if (i === max - 1) return url\n\n    const newBaseUrl = this.baseUrls[i]\n    const slashPart = newBaseUrl.endsWith('/') ? '' : '/'\n\n    return newBaseUrl + slashPart + basename(url)\n  }\n\n  countBaseUrls () {\n    return this.baseUrls.length\n  }\n\n  private getRandomInt (max: number) {\n    return Math.floor(Math.random() * Math.floor(max))\n  }\n}\n\n// ---------------------------------------------------------------------------\n\nexport {\n  RedundancyUrlManager\n}\n","import { Segment } from 'p2p-media-loader-core-basyton'\nimport { RedundancyUrlManager } from './redundancy-url-manager'\n\nfunction segmentUrlBuilderFactory (redundancyUrlManager: RedundancyUrlManager) {\n  return function segmentBuilder (segment: Segment) {\n    return redundancyUrlManager.buildUrl(segment.url)\n  }\n}\n\n// ---------------------------------------------------------------------------\n\nexport {\n  segmentUrlBuilderFactory\n}\n","import { basename } from 'path'\nimport { Segment } from 'p2p-media-loader-core-basyton'\nimport { logger } from '@root-helpers/logger'\nimport { wait } from '@root-helpers/utils'\n\ntype SegmentsJSON = { [filename: string]: string | { [byterange: string]: string } }\n\nconst maxRetries = 3\n\nfunction segmentValidatorFactory (segmentsSha256Url: string, isLive: boolean) {\n  let segmentsJSON = fetchSha256Segments(segmentsSha256Url)\n  const regex = /bytes=(\\d+)-(\\d+)/\n\n  return async function segmentValidator (segment: Segment, _method: string, _peerId: string, retry = 1) {\n    // Wait for hash generation from the server\n    if (isLive) await wait(1000)\n\n    const filename = basename(segment.url)\n\n    const segmentValue = (await segmentsJSON)[filename]\n\n    if (!segmentValue && retry > maxRetries) {\n      throw new Error(`Unknown segment name ${filename} in segment validator`)\n    }\n\n    if (!segmentValue) {\n      logger.info(`Refetching sha segments for ${filename}`)\n\n      await wait(1000)\n\n      segmentsJSON = fetchSha256Segments(segmentsSha256Url)\n      await segmentValidator(segment, _method, _peerId, retry + 1)\n\n      return\n    }\n\n    let hashShouldBe: string\n    let range = ''\n\n    if (typeof segmentValue === 'string') {\n      hashShouldBe = segmentValue\n    } else {\n      const captured = regex.exec(segment.range)\n      range = captured[1] + '-' + captured[2]\n\n      hashShouldBe = segmentValue[range]\n    }\n\n    if (hashShouldBe === undefined) {\n      throw new Error(`Unknown segment name ${filename}/${range} in segment validator`)\n    }\n\n    const calculatedSha = await sha256Hex(segment.data)\n    if (calculatedSha !== hashShouldBe) {\n      throw new Error(\n        `Hashes does not correspond for segment ${filename}/${range}` +\n        `(expected: ${hashShouldBe} instead of ${calculatedSha})`\n      )\n    }\n  }\n}\n\n// ---------------------------------------------------------------------------\n\nexport {\n  segmentValidatorFactory\n}\n\n// ---------------------------------------------------------------------------\n\nfunction fetchSha256Segments (url: string) {\n  return fetch(url)\n    .then(res => res.json() as Promise<SegmentsJSON>)\n    .catch(err => {\n      logger.error('Cannot get sha256 segments', err)\n      return {}\n    })\n}\n\nasync function sha256Hex (data?: ArrayBuffer) {\n  if (!data) return undefined\n\n  if (window.crypto.subtle) {\n    return window.crypto.subtle.digest('SHA-256', data)\n      .then(data => bufferToHex(data))\n  }\n\n  // Fallback for non HTTPS context\n  const shaModule = (await import('sha.js') as any).default\n  // eslint-disable-next-line new-cap\n  return new shaModule.sha256().update(Buffer.from(data)).digest('hex')\n}\n\n// Thanks: https://stackoverflow.com/a/53307879\nfunction bufferToHex (buffer?: ArrayBuffer) {\n  if (!buffer) return ''\n\n  let s = ''\n  const h = '0123456789abcdef'\n  const o = new Uint8Array(buffer)\n\n  o.forEach((v: any) => {\n    s += h[v >> 4] + h[v & 15]\n  })\n\n  return s\n}\n","import { HybridLoaderSettings } from 'p2p-media-loader-core-basyton'\nimport { HlsJsEngineSettings } from 'p2p-media-loader-hlsjs-basyton'\nimport { logger } from '@root-helpers/logger'\nimport { LiveVideoLatencyMode } from '@shared/models'\nimport { getAverageBandwidthInStore } from '../../peertube-player-local-storage'\nimport { P2PMediaLoader, P2PMediaLoaderPluginOptions } from '../../types'\nimport { PeertubePlayerManagerOptions } from '../../types/manager-options'\nimport { getRtcConfig } from '../common'\nimport { RedundancyUrlManager } from '../p2p-media-loader/redundancy-url-manager'\nimport { segmentUrlBuilderFactory } from '../p2p-media-loader/segment-url-builder'\nimport { segmentValidatorFactory } from '../p2p-media-loader/segment-validator'\n//import CapLevelController from './peertube-cap-level-controller'\n\nexport class HLSOptionsBuilder {\n\n  constructor (\n    private options: PeertubePlayerManagerOptions,\n    private p2pMediaLoaderModule?: any\n  ) {\n\n  }\n\n  getPluginOptions () {\n    const commonOptions = this.options.common\n\n    const redundancyUrlManager = new RedundancyUrlManager(this.options.p2pMediaLoader.redundancyBaseUrls)\n\n    const p2pMediaLoaderConfig = this.getP2PMediaLoaderOptions(redundancyUrlManager)\n    const loader = new this.p2pMediaLoaderModule.Engine(p2pMediaLoaderConfig).createLoaderClass() as P2PMediaLoader\n\n    console.log('p2pMediaLoaderConfig', p2pMediaLoaderConfig)\n\n    const p2pMediaLoader: P2PMediaLoaderPluginOptions = {\n      redundancyUrlManager,\n      type: 'application/x-mpegURL',\n      startTime: commonOptions.startTime,\n      src: this.options.p2pMediaLoader.playlistUrl,\n      loader\n    }\n\n    const hlsjs = {\n      levelLabelHandler: (level: { height: number, width: number }) => {\n        const resolution = Math.min(level.height || 0, level.width || 0)\n\n        const file = this.options.p2pMediaLoader.videoFiles.find(f => f.resolution.id === resolution)\n        // We don't have files for live videos\n        if (!file) return level.height\n\n        let label = file.resolution.label\n        if (file.fps >= 50) label += file.fps\n\n        return label\n      }\n    }\n\n    const html5 = {\n      hlsjsConfig: this.getHLSJSOptions(loader)\n    }\n\n    return { p2pMediaLoader, hlsjs, html5 }\n  }\n\n  // ---------------------------------------------------------------------------\n\n  private getP2PMediaLoaderOptions (redundancyUrlManager: RedundancyUrlManager): HlsJsEngineSettings {\n    let consumeOnly = false\n    if ((navigator as any)?.connection?.type === 'cellular') {\n      logger.info('We are on a cellular connection: disabling seeding.')\n      consumeOnly = true\n    }\n\n    const trackerAnnounce = this.options.p2pMediaLoader.trackerAnnounce\n                                                 .filter(t => t.startsWith('ws'))\n\n    const specificLiveOrVODOptions = this.options.common.isLive\n      ? this.getP2PMediaLoaderLiveOptions()\n      : this.getP2PMediaLoaderVODOptions()\n\n    return {\n      loader: {\n        trackerAnnounce,\n        rtcConfig: getRtcConfig(),\n\n        simultaneousHttpDownloads: 1,\n        httpFailedSegmentTimeout: 1000,\n\n        segmentValidator: segmentValidatorFactory(this.options.p2pMediaLoader.segmentsSha256Url, this.options.common.isLive),\n        segmentUrlBuilder: segmentUrlBuilderFactory(redundancyUrlManager),\n\n        useP2P: this.options.common.p2pEnabled,\n        consumeOnly,\n        segmentsStorage : this.options.segmentsStorage,\n\n        localTransport : this.options.common.localTransport,\n\n        ...specificLiveOrVODOptions\n      },\n      segments: {\n        assetsStorage : this.options.assetsStorage,\n        swarmId: this.options.p2pMediaLoader.playlistUrl,\n        forwardSegmentCount: specificLiveOrVODOptions.p2pDownloadMaxPriority ?? 20\n      }\n    }\n  }\n\n  private getP2PMediaLoaderLiveOptions (): Partial<HybridLoaderSettings> {\n    const base = {\n      requiredSegmentsPriority: 1\n    }\n\n    const latencyMode = this.options.common.liveOptions.latencyMode\n\n    switch (latencyMode) {\n      case LiveVideoLatencyMode.SMALL_LATENCY:\n        return {\n          ...base,\n\n          useP2P: false,\n          httpDownloadProbability: 1\n        }\n\n      case LiveVideoLatencyMode.HIGH_LATENCY:\n        return base\n\n      default:\n        return base\n    }\n  }\n\n  private getP2PMediaLoaderVODOptions (): Partial<HybridLoaderSettings> {\n    return {\n      requiredSegmentsPriority: 3,\n      skipSegmentBuilderPriority: 1,\n\n      cachedSegmentExpiration: 86400000,\n      cachedSegmentsCount: 100,\n\n      httpDownloadMaxPriority: 9,\n      httpDownloadProbability: 0.06,\n      httpDownloadProbabilitySkipIfNoPeers: true,\n\n      p2pDownloadMaxPriority: 50\n    }\n  }\n\n  // ---------------------------------------------------------------------------\n\n  private getHLSJSOptions (loader: P2PMediaLoader) {\n    const specificLiveOrVODOptions = this.options.common.isLive\n      ? this.getHLSLiveOptions()\n      : this.getHLSVODOptions()\n\n    const base = {\n      capLevelToPlayerSize: true,\n      autoStartLoad: false,\n\n      loader,\n\n      ...specificLiveOrVODOptions\n    }\n\n    const averageBandwidth = getAverageBandwidthInStore()\n    if (!averageBandwidth) return base\n\n    return {\n      ...base,\n\n      abrEwmaDefaultEstimate: averageBandwidth * 8, // We want bit/s\n      backBufferLength: 90,\n      startLevel: -1,\n      testBandwidth: false,\n      debug: false,\n\n     // capLevelController : CapLevelController\n    }\n  }\n\n  private getHLSLiveOptions () {\n    const latencyMode = this.options.common.liveOptions.latencyMode\n\n    switch (latencyMode) {\n      case LiveVideoLatencyMode.SMALL_LATENCY:\n        return {\n          liveSyncDurationCount: 2\n        }\n\n      case LiveVideoLatencyMode.HIGH_LATENCY:\n        return {\n          liveSyncDurationCount: 10\n        }\n\n      default:\n        return {\n          liveSyncDurationCount: 5\n        }\n    }\n  }\n\n  private getHLSVODOptions () {\n    return {\n      liveSyncDurationCount: 5\n    }\n  }\n}\n","import { PeertubePlayerManagerOptions } from '../../types'\n\nexport class WebTorrentOptionsBuilder {\n\n  constructor (\n    private options: PeertubePlayerManagerOptions,\n    private autoPlayValue: any\n  ) {\n\n  }\n\n  getPluginOptions () {\n    const commonOptions = this.options.common\n    const webtorrentOptions = this.options.webtorrent\n    const p2pMediaLoaderOptions = this.options.p2pMediaLoader\n\n    const autoplay = this.autoPlayValue === 'play'\n\n    const webtorrent = {\n      autoplay,\n\n      playerRefusedP2P: commonOptions.p2pEnabled === false,\n      videoDuration: commonOptions.videoDuration,\n      playerElement: commonOptions.playerElement,\n\n      videoFiles: webtorrentOptions.videoFiles.length !== 0\n        ? webtorrentOptions.videoFiles\n        // The WebTorrent plugin won't be able to play these files, but it will fallback to HTTP mode\n        : p2pMediaLoaderOptions?.videoFiles || [],\n\n      startTime: commonOptions.startTime\n    }\n\n    return { webtorrent }\n  }\n}\n","import videojs from 'video.js'\nimport { copyToClipboard } from '@root-helpers/utils'\nimport { isIOS, isSafari } from '@root-helpers/web-browser'\nimport { buildVideoLink, decorateVideoLink, pick } from '@shared/core-utils'\nimport { isDefaultLocale } from '@shared/core-utils/i18n'\nimport { VideoJSPluginOptions } from '../../types'\nimport { CommonOptions, PeertubePlayerManagerOptions, PlayerMode } from '../../types/manager-options'\nimport { ControlBarOptionsBuilder } from './control-bar-options-builder'\nimport { HLSOptionsBuilder } from './hls-options-builder'\nimport { WebTorrentOptionsBuilder } from './webtorrent-options-builder'\n\nexport class ManagerOptionsBuilder {\n\n  constructor (\n    private mode: PlayerMode,\n    private options: PeertubePlayerManagerOptions,\n    private p2pMediaLoaderModule?: any\n  ) {\n\n  }\n\n  getVideojsOptions (alreadyPlayed: boolean): videojs.PlayerOptions {\n    const commonOptions = this.options.common\n\n    let autoplay = this.getAutoPlayValue(commonOptions.autoplay, alreadyPlayed)\n    const html5 = {\n      preloadTextTracks: false\n    }\n\n    const plugins: VideoJSPluginOptions = {\n      peertube: {\n        mode: this.mode,\n        autoplay, // Use peertube plugin autoplay because we could get the file by webtorrent\n\n        ...pick(commonOptions, [\n          'videoViewUrl',\n          'authorizationHeader',\n          'startTime',\n          'videoDuration',\n          'subtitle',\n        //  'videoCaptions',\n          'stopTime',\n          'isLive',\n          'videoUUID',\n        ])\n      }\n    }\n\n    /*if (commonOptions.playlist) {\n      plugins.playlist = commonOptions.playlist\n    }*/\n\n\n\n    if (this.mode === 'p2p-media-loader') {\n      const hlsOptionsBuilder = new HLSOptionsBuilder(this.options, this.p2pMediaLoaderModule)\n      const options = hlsOptionsBuilder.getPluginOptions()\n\n      Object.assign(plugins, pick(options, [ 'hlsjs', 'p2pMediaLoader' ]))\n      Object.assign(html5, options.html5)\n    } else if (this.mode === 'webtorrent') {\n      const webtorrentOptionsBuilder = new WebTorrentOptionsBuilder(this.options, this.getAutoPlayValue(autoplay, alreadyPlayed))\n\n      Object.assign(plugins, webtorrentOptionsBuilder.getPluginOptions())\n\n      // WebTorrent plugin handles autoplay, because we do some hackish stuff in there\n      autoplay = false\n    }\n\n    Object.assign(plugins, {\n      hotkeys : {}\n    })\n\n    const controlBarOptionsBuilder = new ControlBarOptionsBuilder(this.options, this.mode)\n\n    const videojsOptions = {\n      html5,\n\n      // We don't use text track settings for now\n      textTrackSettings: false as any, // FIXME: typings\n      controls: commonOptions.controls !== undefined ? commonOptions.controls : true,\n      loop: commonOptions.loop !== undefined ? commonOptions.loop : false,\n\n      muted: commonOptions.muted !== undefined\n        ? commonOptions.muted\n        : undefined, // Undefined so the player knows it has to check the local storage\n\n      autoplay: this.getAutoPlayValue(autoplay, alreadyPlayed),\n\n      poster: commonOptions.poster,\n      inactivityTimeout: commonOptions.inactivityTimeout,\n      playbackRates: [ 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2 ],\n\n      plugins,\n\n      sources : commonOptions.sources,\n\n      controlBar: {\n        children: controlBarOptionsBuilder.getChildrenOptions() as any // FIXME: typings\n      },\n\n      \n    }\n\n    if (commonOptions.language && !isDefaultLocale(commonOptions.language)) {\n      Object.assign(videojsOptions, { language: commonOptions.language })\n    }\n\n    return videojsOptions\n  }\n\n  private getAutoPlayValue (autoplay: any, alreadyPlayed: boolean) {\n    if (autoplay !== true) return autoplay\n\n    // On first play, disable autoplay to avoid issues\n    // But if the player already played videos, we can safely autoplay next ones\n    if (isIOS() || isSafari()) {\n      return alreadyPlayed ? 'play' : false\n    }\n\n    return 'play'\n  }\n\n  getContextMenuOptions (player: videojs.Player, commonOptions: CommonOptions) {\n    const content = () => {\n      const isLoopEnabled = player.options_['loop']\n\n      const items = [\n        {\n          icon: 'repeat',\n          label: player.localize('Play in loop') + (isLoopEnabled ? '<span class=\"vjs-icon-tick-white\"></span>' : ''),\n          listener: function () {\n            player.options_['loop'] = !isLoopEnabled\n          }\n        },\n        {\n          label: player.localize('Copy the video URL'),\n          listener: function () {\n            copyToClipboard(buildVideoLink({ shortUUID: commonOptions.videoShortUUID }))\n          }\n        },\n        {\n          label: player.localize('Copy the video URL at the current time'),\n          listener: function (this: videojs.Player) {\n            const url = buildVideoLink({ shortUUID: commonOptions.videoShortUUID })\n\n            copyToClipboard(decorateVideoLink({ url, startTime: this.currentTime() }))\n          }\n        },\n        /*{\n          icon: 'code',\n          label: player.localize('Copy embed code'),\n          listener: () => {\n            copyToClipboard(buildVideoOrPlaylistEmbed(commonOptions.embedUrl, commonOptions.embedTitle))\n          }\n        }*/\n      ]\n\n      if (this.mode === 'webtorrent') {\n        items.push({\n          label: player.localize('Copy magnet URI'),\n          listener: function (this: videojs.Player) {\n            copyToClipboard(this.webtorrent().getCurrentVideoFile().magnetUri)\n          }\n        })\n      }\n\n      items.push({\n        icon: 'info',\n        label: player.localize('Stats for nerds'),\n        listener: () => {\n          player.stats().show()\n        }\n      })\n\n      return items.map(i => ({\n        ...i,\n        label: `<span class=\"vjs-icon-${i.icon || 'link-2'}\"></span>` + i.label\n      }))\n    }\n\n    return { content }\n  }\n}\n","import '@peertube/videojs-contextmenu'\nimport './shared/upnext/end-card'\nimport './shared/upnext/upnext-plugin'\nimport './shared/stats/stats-card'\nimport './shared/stats/stats-plugin'\nimport './shared/bezels/bezels-plugin'\nimport './shared/peertube/peertube-plugin'\nimport './shared/resolutions/peertube-resolutions-plugin'\nimport './shared/control-bar/next-previous-video-button'\nimport './shared/control-bar/p2p-info-button'\n//import './shared/control-bar/peertube-link-button'\nimport './shared/control-bar/picture-in-picture-bastyon'\nimport './shared/control-bar/peertube-load-progress-bar'\nimport './shared/control-bar/theater-button'\nimport './shared/settings/resolution-menu-button'\nimport './shared/settings/resolution-menu-item'\nimport './shared/settings/settings-dialog'\nimport './shared/settings/settings-menu-button'\nimport './shared/settings/settings-menu-item'\nimport './shared/settings/settings-panel'\nimport './shared/settings/settings-panel-child'\nimport './shared/playlist/playlist-plugin'\nimport './shared/mobile/peertube-mobile-plugin'\nimport './shared/mobile/peertube-mobile-buttons'\nimport './shared/hotkeys/peertube-hotkeys-plugin'\nimport \"./shared/videojs-helpers/hotkeys.js\";\n\nimport videojs from 'video.js'\nimport { logger } from '@root-helpers/logger'\nimport { isMobile } from '@root-helpers/web-browser'\nimport { saveAverageBandwidth } from './peertube-player-local-storage'\nimport { ManagerOptionsBuilder } from './shared/manager-options'\nimport { TranslationsManager } from './translations-manager'\nimport { CommonOptions, PeertubePlayerManagerOptions, PlayerMode, PlayerNetworkInfo } from './types'\n\n\nconst Fn: any = require('./shared/videojs-helpers/fn.js');\n\n\nconst Slider = videojs.getComponent('Slider') as any\nconst SeekBar = videojs.getComponent('SeekBar') as any\n\nSlider.prototype.update = function(){\n\n    // In VolumeBar init we have a setTimeout for update that pops and update\n    // to the end of the execution stack. The player is destroyed before then\n    // update will cause an error\n    // If there's no bar...\n    if (!this.el_ || !this.bar) {\n      return;\n    }\n\n    // clamp progress between 0 and 1\n    // and only round to four decimal places, as we round to two below\n    const progress = this.getProgress();\n\n    if (progress === this.progress_) {\n      return progress;\n    }\n\n    this.progress_ = progress;\n\n    // Set the new bar width or height\n    var el = this.bar.el()\n\n    if(!this.vertical()){\n      //el.style['transform-origin'] = 'left'\n      el.style['transform'] = 'scaleX('+(progress).toFixed(2)+')'\n    }\n    else{\n      el.style['transform-origin'] = 'bottom'\n      el.style['transform'] = 'scaleY('+(progress).toFixed(2)+')'\n    }\n\n    return progress;\n}\n\nSeekBar.prototype.getPercent = function getPercent () {\n  const time = this.player_.currentTime()\n  const percent = time / this.player_.duration()\n  return percent >= 1 ? 1 : percent\n}\n\nSeekBar.prototype.setEventHandlers_ = function () {\n\n  this.update_ = Fn.bind(this, this.update);\n  this.update = Fn.throttle(this.update_, Fn.UPDATE_REFRESH_INTERVAL);\n\n  this.on(this.player_, ['ended', 'durationchange', 'timeupdate'], this.update);\n  if (this.player_.liveTracker) {\n    this.on(this.player_.liveTracker, 'liveedgechange', this.update);\n  }\n\n  // when playing, let's ensure we smoothly update the play progress bar\n  // via an interval\n  this.updateInterval = null;\n\n  this.enableIntervalHandler_ = (e :any) => this.enableInterval_(e);\n  this.disableIntervalHandler_ = (e :any) => this.disableInterval_(e);\n\n  this.on(this.player_, ['playing'], this.enableIntervalHandler_);\n\n  this.on(this.player_, ['ended', 'pause', 'waiting'], this.disableIntervalHandler_);\n\n  // we don't need to update the play progress if the document is hidden,\n  // also, this causes the CPU to spike and eventually crash the page on IE11.\n  if ('hidden' in document && 'visibilityState' in document) {\n    this.on(document, 'visibilitychange', this.toggleVisibility_);\n  }\n}\n\nSeekBar.prototype.enableInterval_ = function() {\n  if (this.updateInterval) {\n    return;\n\n  }\n  this.updateInterval = this.setInterval(this.update, Fn.UPDATE_REFRESH_INTERVAL);\n}\n\nSeekBar.prototype.update = function (event : any) {\n\n  // ignore updates while the tab is hidden\n  if (document.visibilityState === 'hidden') {\n    return;\n  }\n\n  const percent = this.getPercent();\n\n    \n    /*const currentTime = this.player_.ended() ?\n    \n    this.player_.duration() : this.getCurrentTime_();\n\n    const liveTracker = this.player_.liveTracker;\n\n    let duration = this.player_.duration();\n\n    if (liveTracker && liveTracker.isLive()) {\n      duration = this.player_.liveTracker.liveCurrentTime();\n    }\n\n    if (this.percent_ !== percent) {\n      // machine readable value of progress bar (percentage complete)\n      //this.el_.setAttribute('aria-valuenow', (percent * 100).toFixed(2));\n      this.percent_ = percent;\n    }\n\n    if (this.currentTime_ !== currentTime || this.duration_ !== duration) {\n      // human readable value of progress bar (time complete)\n\n      this.currentTime_ = currentTime;\n      this.duration_ = duration;\n    }*/\n\n    var el = this.bar.el()\n\n    el.style['transform-origin'] = 'left'\n    el.style['transform'] = 'scaleX('+(percent).toFixed(2)+')'\n\n\n  return percent;\n  \n}\n\nSeekBar.prototype.handleMouseMove = function handleMouseMove (event: any) {\n\n  let newTime = this.calculateDistance(event) * this.player_.duration()\n  if (newTime === this.player_.duration()) {\n    newTime = newTime - 0.1\n  }\n\n  this.player_.currentTime(newTime)\n  this.update()\n}\n\n// Change 'Playback Rate' to 'Speed' (smaller for our settings menu)\n//(videojs.getComponent('PlaybackRateMenuButton') as any).prototype.controlText_ = 'Speed'\n\nconst CaptionsButton = videojs.getComponent('CaptionsButton') as any\n// Change Captions to Subtitles/CC\nCaptionsButton.prototype.controlText_ = 'Subtitles/CC'\n// We just want to display 'Off' instead of 'captions off', keep a space so the variable == true (hacky I know)\nCaptionsButton.prototype.label_ = ' '\n\nexport class PeertubePlayerManager {\n  private static playerElementClassName: string\n  private static onPlayerChange: (player: videojs.Player) => void\n  private static alreadyPlayed = false\n  //private static pluginsManager: PluginsManager\n\n  private static videojsDecodeErrors = 0\n\n  private static p2pMediaLoaderModule: any\n\n  static initState () {\n    this.alreadyPlayed = false\n  }\n\n  static async initialize (mode: PlayerMode, options: PeertubePlayerManagerOptions, onPlayerChange: (player: videojs.Player) => void) {\n    //this.pluginsManager = options.pluginsManager\n\n    this.onPlayerChange = onPlayerChange\n    this.playerElementClassName = options.common.playerElement.className\n\n    if (mode === 'webtorrent') await import('./shared/webtorrent/webtorrent-plugin')\n    if (mode === 'p2p-media-loader') {\n      const [ p2pMediaLoaderModule ] = await Promise.all([\n        import('p2p-media-loader-hlsjs-basyton'),\n        import('./shared/p2p-media-loader/p2p-media-loader-plugin')\n      ])\n\n      this.p2pMediaLoaderModule = p2pMediaLoaderModule\n    }\n\n    //await TranslationsManager.loadLocaleInVideoJS(options.common.serverUrl, options.common.language, videojs)\n\n\n    return this.buildPlayer(mode, options)\n  }\n\n  private static async buildPlayer (mode: PlayerMode, options: PeertubePlayerManagerOptions): Promise<videojs.Player> {\n    const videojsOptionsBuilder = new ManagerOptionsBuilder(mode, options, this.p2pMediaLoaderModule)\n    const videojsOptions = videojsOptionsBuilder.getVideojsOptions(this.alreadyPlayed)\n\n    /*const videojsOptions = await this.pluginsManager.runHook(\n      'filter:internal.player.videojs.options.result',\n      videojsOptionsBuilder.getVideojsOptions(this.alreadyPlayed)\n    )*/\n\n    const self = this\n    return new Promise(res => {\n      videojs(options.common.playerElement, videojsOptions, function (this: videojs.Player) {\n        const player = this\n\n        let alreadyFallback = false\n\n        const handleError = () => {\n          if (alreadyFallback) return\n          alreadyFallback = true\n\n          if (mode === 'p2p-media-loader') {\n            self.tryToRecoverHLSError(player.error(), player, options)\n          } else {\n            /// remove torrent /// self.maybeFallbackToWebTorrent(mode, player, options)\n          }\n        }\n\n        player.one('error', () => handleError())\n\n        player.one('play', () => {\n          self.alreadyPlayed = true\n        })\n\n        self.addContextMenu(videojsOptionsBuilder, player, options.common)\n\n        if (isMobile() || options.mobile) player.peertubeMobile()\n        //if (options.common.enableHotkeys === true) player.peerTubeHotkeysPlugin()\n        if (options.common.controlBar === false) player.controlBar.addClass('control-bar-hidden')\n\n        player.bezels()\n\n        player.stats({\n          videoUUID: options.common.videoUUID,\n          videoIsLive: options.common.isLive,\n          mode,\n          p2pEnabled: options.common.p2pEnabled\n        })\n\n        player.on('p2pInfo', (_, data: PlayerNetworkInfo) => {\n          if (data.source !== 'p2p-media-loader' || isNaN(data.bandwidthEstimate)) return\n\n          saveAverageBandwidth(data.bandwidthEstimate)\n        })\n\n        return res(player)\n      })\n    })\n  }\n\n  private static async tryToRecoverHLSError (err: any, currentPlayer: videojs.Player, options: PeertubePlayerManagerOptions) {\n    if (err.code === 3) { // Decode error\n\n      // Display a notification to user\n      if (this.videojsDecodeErrors === 0) {\n        options.common.errorNotifier(currentPlayer.localize('The video failed to play, will try to fast forward.'))\n      }\n\n      if (this.videojsDecodeErrors === 20) {\n        this.maybeFallbackToWebTorrent('p2p-media-loader', currentPlayer, options)\n        return\n      }\n\n      logger.info('Fast forwarding HLS to recover from an error.')\n\n      this.videojsDecodeErrors++\n\n      options.common.startTime = currentPlayer.currentTime() + 2\n      options.common.autoplay = true\n      this.rebuildAndUpdateVideoElement(currentPlayer, options.common)\n\n      const newPlayer = await this.buildPlayer('p2p-media-loader', options)\n      this.onPlayerChange(newPlayer)\n    } else {\n      this.maybeFallbackToWebTorrent('p2p-media-loader', currentPlayer, options)\n    }\n  }\n\n  private static async maybeFallbackToWebTorrent (\n    currentMode: PlayerMode,\n    currentPlayer: videojs.Player,\n    options: PeertubePlayerManagerOptions\n  ) {\n    if (options.webtorrent.videoFiles.length === 0 || currentMode === 'webtorrent') {\n      currentPlayer.peertube().displayFatalError()\n      return\n    }\n\n    logger.info('Fallback to webtorrent.')\n\n    this.rebuildAndUpdateVideoElement(currentPlayer, options.common)\n\n    await import('./shared/webtorrent/webtorrent-plugin')\n\n    const newPlayer = await this.buildPlayer('webtorrent', options)\n    this.onPlayerChange(newPlayer)\n  }\n\n  private static rebuildAndUpdateVideoElement (player: videojs.Player, commonOptions: CommonOptions) {\n    const newVideoElement = document.createElement('video')\n    newVideoElement.className = this.playerElementClassName\n\n    // VideoJS wraps our video element inside a div\n    let currentParentPlayerElement = commonOptions.playerElement.parentNode\n    // Fix on IOS, don't ask me why\n    if (!currentParentPlayerElement) currentParentPlayerElement = document.getElementById(commonOptions.playerElement.id).parentNode\n\n    currentParentPlayerElement.parentNode.insertBefore(newVideoElement, currentParentPlayerElement)\n\n    commonOptions.playerElement = newVideoElement\n    commonOptions.onPlayerElementChange(newVideoElement)\n\n    player.dispose()\n\n    return newVideoElement\n  }\n\n  private static addContextMenu (optionsBuilder: ManagerOptionsBuilder, player: videojs.Player, commonOptions: CommonOptions) {\n    const options = optionsBuilder.getContextMenuOptions(player, commonOptions)\n\n    player.contextmenuUI(options)\n  }\n}\n\n// ############################################################################\n\nexport {\n  videojs\n}\n","import { VideoFile } from '@shared/models'\n\nfunction toTitleCase (str: string) {\n  return str.charAt(0).toUpperCase() + str.slice(1)\n}\n\nconst dictionaryBytes = [\n  { max: 1024, type: 'B', decimals: 0 },\n  { max: 1048576, type: 'KB', decimals: 0 },\n  { max: 1073741824, type: 'MB', decimals: 0 },\n  { max: 1.0995116e12, type: 'GB', decimals: 1 }\n]\nfunction bytes (value: number) {\n  const format = dictionaryBytes.find(d => value < d.max) || dictionaryBytes[dictionaryBytes.length - 1]\n  const calc = (value / (format.max / 1024)).toFixed(format.decimals)\n\n  return [ calc, format.type ]\n}\n\nfunction videoFileMaxByResolution (files: VideoFile[]) {\n  let max = files[0]\n\n  for (let i = 1; i < files.length; i++) {\n    const file = files[i]\n    if (max.resolution.id < file.resolution.id) max = file\n  }\n\n  return max\n}\n\nfunction videoFileMinByResolution (files: VideoFile[]) {\n  let min = files[0]\n\n  for (let i = 1; i < files.length; i++) {\n    const file = files[i]\n    if (min.resolution.id > file.resolution.id) min = file\n  }\n\n  return min\n}\n\nfunction getRtcConfig () {\n  return {\n    iceServers: [\n      {\n        urls: 'stun:stun.stunprotocol.org'\n      },\n      {\n        urls: 'stun:stun.framasoft.org'\n      }\n    ]\n  }\n}\n\n// ---------------------------------------------------------------------------\n\nexport {\n  getRtcConfig,\n  toTitleCase,\n\n  videoFileMaxByResolution,\n  videoFileMinByResolution,\n  bytes\n}\n","function isIOS () {\n  if (/iPad|iPhone|iPod/.test(navigator.platform)) {\n    return true\n  }\n\n  // Detect iPad Desktop mode\n  return !!(navigator.maxTouchPoints &&\n      navigator.maxTouchPoints > 2 &&\n      navigator.platform.includes('MacIntel'))\n}\n\nfunction isSafari () {\n  return /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\n}\n\nfunction isMobile () {\n  return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)\n}\n\nexport {\n  isIOS,\n  isSafari,\n  isMobile\n}\n","module.exports = require('path-browserify')\n","export const LOCALE_FILES = [ 'player', 'server' ]\n\nexport const I18N_LOCALES = {\n  // Always first to avoid issues when using express acceptLanguages function when no accept language header is set\n  'en-US': 'English',\n\n  'ar': 'العربية',\n  'ca-ES': 'Català',\n  'cs-CZ': 'Čeština',\n  'de-DE': 'Deutsch',\n  'el-GR': 'ελληνικά',\n  'eo': 'Esperanto',\n  'es-ES': 'Español',\n  'eu-ES': 'Euskara',\n  'fi-FI': 'suomi',\n  'fr-FR': 'Français',\n  'gd': 'Gàidhlig',\n  'gl-ES': 'galego',\n  'hr': 'hrvatski',\n  'hu-HU': 'magyar',\n  'fa-IR': 'فارسی',\n  'it-IT': 'Italiano',\n  'ja-JP': '日本語',\n  'kab': 'Taqbaylit',\n  'nl-NL': 'Nederlands',\n  'oc': 'Occitan',\n  'pl-PL': 'Polski',\n  'pt-BR': 'Português (Brasil)',\n  'pt-PT': 'Português (Portugal)',\n  'ru-RU': 'русский',\n  'sq': 'Shqip',\n  'sv-SE': 'Svenska',\n  'nn': 'norsk nynorsk',\n  'nb-NO': 'norsk bokmål',\n  'th-TH': 'ไทย',\n  'vi-VN': 'Tiếng Việt',\n  'tok': 'Toki Pona',\n  'zh-Hans-CN': '简体中文（中国）',\n  'zh-Hant-TW': '繁體中文（台灣）'\n}\n\nconst I18N_LOCALE_ALIAS = {\n  'ar-001': 'ar',\n  'ca': 'ca-ES',\n  'cs': 'cs-CZ',\n  'de': 'de-DE',\n  'el': 'el-GR',\n  'en': 'en-US',\n  'es': 'es-ES',\n  'eu': 'eu-ES',\n  'fi': 'fi-FI',\n  'gl': 'gl-ES',\n  'fa': 'fa-IR',\n  'fr': 'fr-FR',\n  'hu': 'hu-HU',\n  'it': 'it-IT',\n  'ja': 'ja-JP',\n  'nl': 'nl-NL',\n  'pl': 'pl-PL',\n  'pt': 'pt-BR',\n  'nb': 'nb-NO',\n  'ru': 'ru-RU',\n  'sv': 'sv-SE',\n  'th': 'th-TH',\n  'vi': 'vi-VN',\n  'zh-CN': 'zh-Hans-CN',\n  'zh-Hans': 'zh-Hans-CN',\n  'zh-Hant': 'zh-Hant-TW',\n  'zh-TW': 'zh-Hant-TW',\n  'zh': 'zh-Hans-CN'\n}\n\nexport const POSSIBLE_LOCALES = Object.keys(I18N_LOCALES)\n                                      .concat(Object.keys(I18N_LOCALE_ALIAS))\n\nexport function getDefaultLocale () {\n  return 'en-US'\n}\n\nexport function isDefaultLocale (locale: string) {\n  return getCompleteLocale(locale) === getCompleteLocale(getDefaultLocale())\n}\n\nexport function peertubeTranslate (str: string, translations?: { [ id: string ]: string }) {\n  if (!translations || !translations[str]) return str\n\n  return translations[str]\n}\n\nconst possiblePaths = POSSIBLE_LOCALES.map(l => '/' + l)\nexport function is18nPath (path: string) {\n  return possiblePaths.includes(path)\n}\n\nexport function is18nLocale (locale: string) {\n  return POSSIBLE_LOCALES.includes(locale)\n}\n\nexport function getCompleteLocale (locale: string) {\n  if (!locale) return locale\n\n  if (I18N_LOCALE_ALIAS[locale]) return I18N_LOCALE_ALIAS[locale]\n\n  return locale\n}\n\nexport function getShortLocale (locale: string) {\n  if (locale.includes('-') === false) return locale\n\n  return locale.split('-')[0]\n}\n\nexport function buildFileLocale (locale: string) {\n  return getCompleteLocale(locale)\n}\n","function isToday (d: Date) {\n  const today = new Date()\n\n  return areDatesEqual(d, today)\n}\n\nfunction isYesterday (d: Date) {\n  const yesterday = new Date()\n  yesterday.setDate(yesterday.getDate() - 1)\n\n  return areDatesEqual(d, yesterday)\n}\n\nfunction isThisWeek (d: Date) {\n  const minDateOfThisWeek = new Date()\n  minDateOfThisWeek.setHours(0, 0, 0)\n\n  // getDay() -> Sunday - Saturday : 0 - 6\n  // We want to start our week on Monday\n  let dayOfWeek = minDateOfThisWeek.getDay() - 1\n  if (dayOfWeek < 0) dayOfWeek = 6 // Sunday\n\n  minDateOfThisWeek.setDate(minDateOfThisWeek.getDate() - dayOfWeek)\n\n  return d >= minDateOfThisWeek\n}\n\nfunction isThisMonth (d: Date) {\n  const thisMonth = new Date().getMonth()\n\n  return d.getMonth() === thisMonth\n}\n\nfunction isLastMonth (d: Date) {\n  const now = new Date()\n\n  return getDaysDifferences(now, d) <= 30\n}\n\nfunction isLastWeek (d: Date) {\n  const now = new Date()\n\n  return getDaysDifferences(now, d) <= 7\n}\n\n// ---------------------------------------------------------------------------\n\nfunction timeToInt (time: number | string) {\n  if (!time) return 0\n  if (typeof time === 'number') return time\n\n  const reg = /^((\\d+)[h:])?((\\d+)[m:])?((\\d+)s?)?$/\n  const matches = time.match(reg)\n\n  if (!matches) return 0\n\n  const hours = parseInt(matches[2] || '0', 10)\n  const minutes = parseInt(matches[4] || '0', 10)\n  const seconds = parseInt(matches[6] || '0', 10)\n\n  return hours * 3600 + minutes * 60 + seconds\n}\n\nfunction secondsToTime (seconds: number, full = false, symbol?: string) {\n  let time = ''\n\n  if (seconds === 0 && !full) return '0s'\n\n  const hourSymbol = (symbol || 'h')\n  const minuteSymbol = (symbol || 'm')\n  const secondsSymbol = full ? '' : 's'\n\n  const hours = Math.floor(seconds / 3600)\n  if (hours >= 1) time = hours + hourSymbol\n  else if (full) time = '0' + hourSymbol\n\n  seconds %= 3600\n  const minutes = Math.floor(seconds / 60)\n  if (minutes >= 1 && minutes < 10 && full) time += '0' + minutes + minuteSymbol\n  else if (minutes >= 1) time += minutes + minuteSymbol\n  else if (full) time += '00' + minuteSymbol\n\n  seconds %= 60\n  if (seconds >= 1 && seconds < 10 && full) time += '0' + seconds + secondsSymbol\n  else if (seconds >= 1) time += seconds + secondsSymbol\n  else if (full) time += '00'\n\n  return time\n}\n\n// ---------------------------------------------------------------------------\n\nexport {\n  isYesterday,\n  isThisWeek,\n  isThisMonth,\n  isToday,\n  isLastMonth,\n  isLastWeek,\n  timeToInt,\n  secondsToTime\n}\n\n// ---------------------------------------------------------------------------\n\nfunction areDatesEqual (d1: Date, d2: Date) {\n  return d1.getFullYear() === d2.getFullYear() &&\n    d1.getMonth() === d2.getMonth() &&\n    d1.getDate() === d2.getDate()\n}\n\nfunction getDaysDifferences (d1: Date, d2: Date) {\n  return (d1.getTime() - d2.getTime()) / (86400000)\n}\n","function pick <O extends object, K extends keyof O> (object: O, keys: K[]): Pick<O, K> {\n  const result: any = {}\n\n  for (const key of keys) {\n    if (Object.prototype.hasOwnProperty.call(object, key)) {\n      result[key] = object[key]\n    }\n  }\n\n  return result\n}\n\nfunction getKeys <O extends object, K extends keyof O> (object: O, keys: K[]): K[] {\n  return (Object.keys(object) as K[]).filter(k => keys.includes(k))\n}\n\nfunction sortObjectComparator (key: string, order: 'asc' | 'desc') {\n  return (a: any, b: any) => {\n    if (a[key] < b[key]) {\n      return order === 'asc' ? -1 : 1\n    }\n\n    if (a[key] > b[key]) {\n      return order === 'asc' ? 1 : -1\n    }\n\n    return 0\n  }\n}\n\nexport {\n  pick,\n  getKeys,\n  sortObjectComparator\n}\n","import { Video, VideoPlaylist } from '../../models'\nimport { secondsToTime } from './date'\n\nfunction buildPlaylistLink (playlist: Pick<VideoPlaylist, 'shortUUID'>, base?: string) {\n  return (base ?? window.location.origin) + buildPlaylistWatchPath(playlist)\n}\n\nfunction buildPlaylistWatchPath (playlist: Pick<VideoPlaylist, 'shortUUID'>) {\n  return '/w/p/' + playlist.shortUUID\n}\n\nfunction buildVideoWatchPath (video: Pick<Video, 'shortUUID'>) {\n  return '/w/' + video.shortUUID\n}\n\nfunction buildVideoLink (video: Pick<Video, 'shortUUID'>, base?: string) {\n  return (base ?? window.location.origin) + buildVideoWatchPath(video)\n}\n\nfunction buildPlaylistEmbedPath (playlist: Pick<VideoPlaylist, 'uuid'>) {\n  return '/video-playlists/embed/' + playlist.uuid\n}\n\nfunction buildPlaylistEmbedLink (playlist: Pick<VideoPlaylist, 'uuid'>, base?: string) {\n  return (base ?? window.location.origin) + buildPlaylistEmbedPath(playlist)\n}\n\nfunction buildVideoEmbedPath (video: Pick<Video, 'uuid'>) {\n  return '/videos/embed/' + video.uuid\n}\n\nfunction buildVideoEmbedLink (video: Pick<Video, 'uuid'>, base?: string) {\n  return (base ?? window.location.origin) + buildVideoEmbedPath(video)\n}\n\nfunction decorateVideoLink (options: {\n  url: string\n\n  startTime?: number\n  stopTime?: number\n\n  subtitle?: string\n\n  loop?: boolean\n  autoplay?: boolean\n  muted?: boolean\n\n  // Embed options\n  title?: boolean\n  warningTitle?: boolean\n\n  controls?: boolean\n  controlBar?: boolean\n\n  peertubeLink?: boolean\n  p2p?: boolean\n}) {\n  const { url } = options\n\n  const params = new URLSearchParams()\n\n  if (options.startTime !== undefined && options.startTime !== null) {\n    const startTimeInt = Math.floor(options.startTime)\n    params.set('start', secondsToTime(startTimeInt))\n  }\n\n  if (options.stopTime) {\n    const stopTimeInt = Math.floor(options.stopTime)\n    params.set('stop', secondsToTime(stopTimeInt))\n  }\n\n  if (options.subtitle) params.set('subtitle', options.subtitle)\n\n  if (options.loop === true) params.set('loop', '1')\n  if (options.autoplay === true) params.set('autoplay', '1')\n  if (options.muted === true) params.set('muted', '1')\n  if (options.title === false) params.set('title', '0')\n  if (options.warningTitle === false) params.set('warningTitle', '0')\n\n  if (options.controls === false) params.set('controls', '0')\n  if (options.controlBar === false) params.set('controlBar', '0')\n\n  if (options.peertubeLink === false) params.set('peertubeLink', '0')\n  if (options.p2p !== undefined) params.set('p2p', options.p2p ? '1' : '0')\n\n  return buildUrl(url, params)\n}\n\nfunction decoratePlaylistLink (options: {\n  url: string\n\n  playlistPosition?: number\n}) {\n  const { url } = options\n\n  const params = new URLSearchParams()\n\n  if (options.playlistPosition) params.set('playlistPosition', '' + options.playlistPosition)\n\n  return buildUrl(url, params)\n}\n\n// ---------------------------------------------------------------------------\n\nexport {\n  buildPlaylistLink,\n  buildVideoLink,\n\n  buildVideoWatchPath,\n  buildPlaylistWatchPath,\n\n  buildPlaylistEmbedPath,\n  buildVideoEmbedPath,\n\n  buildPlaylistEmbedLink,\n  buildVideoEmbedLink,\n\n  decorateVideoLink,\n  decoratePlaylistLink\n}\n\nfunction buildUrl (url: string, params: URLSearchParams) {\n  let hasParams = false\n  params.forEach(() => { hasParams = true })\n\n  if (hasParams) return url + '?' + params.toString()\n\n  return url\n}\n","export const TEXT_RULES = [\n  'linkify',\n  'autolink',\n  'emphasis',\n  'link',\n  'newline',\n  'entity',\n  'list'\n]\n\nexport const TEXT_WITH_HTML_RULES = TEXT_RULES.concat([\n  'html_inline',\n  'html_block'\n])\n\nexport const ENHANCED_RULES = TEXT_RULES.concat([ 'image' ])\nexport const ENHANCED_WITH_HTML_RULES = TEXT_WITH_HTML_RULES.concat([ 'image' ])\n\nexport const COMPLETE_RULES = ENHANCED_WITH_HTML_RULES.concat([\n  'block',\n  'inline',\n  'heading',\n  'paragraph'\n])\n"],"names":["_guid","UPDATE_REFRESH_INTERVAL","bind","context","fn","uid","guid","bound","throttle","wait","last","window","now","debounce","func","immediate","timeout","cancel","clearTimeout","debounced","self","this","args","arguments","later","apply","setTimeout","factory","videojs","version","console","log","registerPlugin","plugin","options","player","pEl","el","doc","document","volumeStep","mergeOptions","util","seekStep","enableMute","enableVolumeScroll","enableHoverScroll","enableFullscreen","enableNumbers","enableJogStyle","alwaysCaptureHotkeys","captureDocumentHotkeys","documentHotkeysFocusElementFilter","enableModifiersForNumbers","enableInactiveFocus","skipInitialFocus","playPauseKey","e","which","rewindKey","forwardKey","volumeUpKey","volumeDownKey","muteKey","fullscreenKey","customKeys","enableFull","videojsVer","VERSION","hasAttribute","setAttribute","style","outline","autoplay","one","focus","on","cancelFocusingPlayer","focusingPlayerTimeout","off","activeElement","controlBar","querySelector","parentElement","ifblocker","display","bottom","keyDown","event","wasPlaying","seekTime","value","ewhich","ePreventDefault","preventDefault","duration","controls","activeEl","checkKeys","stopPropagation","paused","play","then","pause","currentTime","seekStepD","volume","muted","isFullscreen","exitFullscreen","requestFullscreen","metaKey","ctrlKey","altKey","sub","number","customKey","customHotkey","key","handler","doubleClick","relatedTarget","toElement","volumeHover","volumeSelector","onmouseover","onmouseout","mouseScroll","delta","Math","max","min","wheelDelta","detail","active","addEventListener","removeEventListener","define","module","default","getStoredVolume","getLocalStorage","valueNumber","parseFloat","isNaN","getStoredMute","getStoredTheater","saveVolumeInStore","setLocalStorage","toString","saveMuteInStore","saveTheaterInStore","enabled","saveAverageBandwidth","getAverageBandwidthInStore","parseInt","saveLastSubtitle","language","getStoredLastSubtitle","saveVideoWatchHistory","videoUUID","JSON","stringify","data","parse","error","getStoredVideoWatchHistory","date","Date","toISOString","KEY_PREFIX","localStorage","getItem","setItem","Component","constructor","super","dashOffsetTotal","dashOffsetStart","interval","upNextEvents","ticks","totalTicks","options_","_","condition","addClass","showCard","canceled","removeClass","container","next","trigger","createEl","className","innerHTML","headText","cancelText","suspendedText","autoplayRing","getElementsByClassName","title","cancelButton","suspendedMessage","nextButton","onclick","cb","getTitle","goToPercent","percent","newOffset","tick","update","suspended","innerText","Plugin","settings","ready","addChild","StatsCard","metadataStore","intervalMs","playerNetworkInfo","containerEl","infoListEl","closeButton","tabindex","hide","appendChild","populateInfoBlocks","player_","mode","source","p2pStats","p2p","httpStats","http","downloadSpeed","join","uploadSpeed","totalDownloaded","downloaded","totalUploaded","uploaded","numPeers","averageBandwidth","bandwidthEstimate","downloadedFromServer","downloadedFromPeers","toggle","updateInterval","show","setInterval","async","buildHLSOptions","buildWebTorrentOptions","populateInfoValues","err","logger","clearInterval","p2pMediaLoader","level","getCurrentLevel","codecs","videoCodec","audioCodec","undefined","resolution","height","attrs","buffer","timeRangesToString","buffered","progress","latency","videoIsLive","getLiveLatency","bufferedPercent","videoFile","webtorrent","getCurrentVideoFile","fileUrl","fetch","metadataUrl","res","json","metadata","colorSpace","streams","stream","label","fps","getTorrent","playerMode","buildInfoRow","localize","uuid","viewport","color","connection","network","transferred","download","bufferProgress","bufferState","liveLatency","root","videoQuality","getVideoPlaybackQuality","frames","documentElement","clientWidth","innerWidth","clientHeight","innerHeight","devicePixelRatio","toFixed","droppedVideoFrames","totalVideoFrames","round","networkActivity","totalTransferred","downloadBreakdown","setInfoValue","p2pEnabled","labelText","valueHTML","r","result","i","length","start","floor","end","statsCard","seeking","ended","showBezel","debugLogger","CONSTANTS","USER_VIEW_VIDEO_INTERVAL","menuOpened","mouseInControlBar","mouseInSettings","videoViewUrl","authorizationHeader","startTime","initialInactivityTimeout","inactivityTimeout","playerOptions","defaultSubtitle","subtitle","stopTime","onTimeUpdate","textTracks","showing","tracks_","find","t","kind","videoDuration","initializePlayer","runUserViewing","dispose","videoViewInterval","onMenuOpened","alterInactivity","onMenuClosed","displayFatalError","hideFatalError","initSmoothProgressBar","listenControlBarMouse","listenFullScreenChange","lastViewEvent","lastCurrentTime","notifyUserIsWatching","abs","catch","viewEvent","Promise","resolve","body","headers","Headers","set","method","settingsButton","dialog","setInactivityTimeout","reportUserActivity","cache_","SeekBar","prototype","getPercent","handleMouseMove","newTime","calculateDistance","resolutions","autoResolutionEnabled","add","push","currentSelection","getSelected","sort","getResolutions","selected","getAutoResolutionChosen","id","autoResolutionChosenId","select","byEngine","selectCallback","disableAutoResolution","enabledAutoResolution","isAutoResolutionEnabeld","a","b","Button","NextPreviousVideoButton","nextPreviousVideoButtonOptions","type","button","nextIcon","handleClick","isDisabled","div","subDivWebtorrent","downloadIcon","downloadSpeedText","downloadSpeedNumber","downloadSpeedUnit","uploadIcon","uploadSpeedText","uploadSpeedNumber","uploadSpeedUnit","peersText","peersNumber","subDivHttp","subDivHttpText","textContent","MenuButton","controlText","buildElement","classList","registerComponent","torrent","TheaterButton","THEATER_MODE_CLASS","handleTheaterChange","theaterEnabled","buildCSSClass","isTheaterEnabled","toggleClass","hasClass","MenuItem","ResolutionMenuItem","selectable","autoResolutionChosen","resolutionId","peertubeResolutions","updateSelection","updateAutoResolution","selectedResolution","getLabel","Menu","buildQualities","labelEl_","updateARIAAttributes","createMenu","buildWrapperCSSClass","addClickListener","component","children","menu","child","d","m","uniqueId","tabIndex","role","SettingsMenuItem","menuButton","mainMenu","panel","getChild","panelChild","panelChildEl","size","menuToLoad","subMenuName","entry","SubMenuComponent","Error","newOptions","Object","assign","subMenu","subMenuClass","split","settingsSubMenuEl_","eventHandlers","build","submenuClickHandler","bindClickEvents","reset","onSubmenuClick","transitionEndHandler","onTransitionEnd","target","currentTarget","contains","loadMainMenu","settingsSubMenuTitleEl_","settingsSubMenuValueEl_","opacity","marginRight","setDialogSize","firstChild","createBackButton","PrefixedEvent","element","callback","action","prefix","p","toLowerCase","propertyName","setMargin","mainMenuEl","mainMenuAny","width","setSize","name","html","subMenuItem","children_","subMenuItemUntyped","hideDialog","item","getComponentSize","hideSubMenu","contentElType","settingsButtonOptions","dialogEl","addSettingsItemHandler","onAddSettingsItem","disposeSettingsItemHandler","onDisposeSettingsItem","documentClickHandler","onDocumentClick","userInactiveHandler","onUserInactive","buildMenu","bindEvents","removeChild","entries","isInIframe","addMenuItem","showDialog","peertube","resetChildren","offsetWidth","offsetHeight","offset","setup","maxHeightOffset","maxHeight","panelEl","settingsMenuItem","hideChildren","el_","menuChild","top","ClickableComponent","PlaylistButton","wrapper","icon","playlistInfoElement","getCurrentPosition","playlist","videosLength","displayName","getPlaylistMenu","open","playlistMenu","PlaylistMenuItem","emitTapEvents","switchPlaylistItem","handleKeyDown","li","video","positionBlock","position","buildAvailableVideo","buildUnavailableVideo","setSelected","getElement","videoElement","thumbnail","src","location","origin","thumbnailPath","infoBlock","channel","startTimestamp","stopTimestamp","timestamps","append","block","code","onClicked","PlaylistMenu","close","current","menuItems","getOptions","header","headerLeft","leftTitle","playlistChannel","videoChannel","leftSubtitle","list","playlistElement","elements","onItemClicked","updateSelected","newPosition","playlistButton","PeerTubeMobilePlugin","seekAmount","peerTubeMobileButtons","reportTouchActivity","screen","orientation","handleFullscreenRotation","userActions","click","initTouchStartEvents","isPortraitVideo","lock","videoWidth","videoHeight","handleTouchStart","tapTimeout","lastTapEvent","timeStamp","DOUBLE_TAP_DELAY_MS","onDoubleTap","newActiveState","userActive","passive","playerWidth","currentWidth","rect","findPlayerTarget","getBoundingClientRect","offsetX","targetTouches","pageX","left","displayFastSeek","scheduleSetCurrentTime","setCurrentTimeTimeout","SET_CURRENT_TIME_DELAY","mainButton","rewind","forward","rewindText","forwardText","amount","hideRewind","hideForward","displayForward","displayRewind","remove","PeerTubeHotkeysPlugin","handlers","buildHandlers","handleKeyFunction","onKeyDown","isValidKeyTarget","accept","isNaked","VOLUME_STEP","SEEK_STEP","playbackRate","eventEl","playerEl","currentElTagName","tagName","shiftKey","copyToClipboard","text","createElement","execCommand","ms","ControlBarOptionsBuilder","globalOptions","common","getChildrenOptions","previousVideo","getPreviousVideo","playToggle","nextVideo","getNextVideo","currentTimeDisplay","timeDivider","durationDisplay","liveDisplay","flexibleWidthSpacer","getProgressControl","p2PInfoButton","muteToggle","volumeControl","getSettingsButton","PictureInPictureBastyon","theaterButton","fullscreenToggle","settingEntries","progressControl","seekBar","mouseTimeDisplay","playProgressBar","previousVideoButton","hasPreviousVideo","nextVideoButton","hasNextVideo","RedundancyUrlManager","baseUrls","removeBySegmentUrl","segmentUrl","baseUrl","dirname","filter","u","buildUrl","url","getRandomInt","newBaseUrl","slashPart","endsWith","basename","countBaseUrls","random","segmentUrlBuilderFactory","redundancyUrlManager","segment","segmentValidatorFactory","segmentsSha256Url","isLive","segmentsJSON","fetchSha256Segments","regex","segmentValidator","_method","_peerId","retry","filename","segmentValue","hashShouldBe","range","captured","exec","calculatedSha","crypto","subtle","digest","s","h","Uint8Array","forEach","v","bufferToHex","sha256","Buffer","from","sha256Hex","HLSOptionsBuilder","p2pMediaLoaderModule","getPluginOptions","commonOptions","redundancyBaseUrls","p2pMediaLoaderConfig","getP2PMediaLoaderOptions","loader","Engine","createLoaderClass","playlistUrl","hlsjs","levelLabelHandler","file","videoFiles","f","html5","hlsjsConfig","getHLSJSOptions","consumeOnly","navigator","trackerAnnounce","startsWith","specificLiveOrVODOptions","getP2PMediaLoaderLiveOptions","getP2PMediaLoaderVODOptions","rtcConfig","simultaneousHttpDownloads","httpFailedSegmentTimeout","segmentUrlBuilder","useP2P","segmentsStorage","localTransport","segments","assetsStorage","swarmId","forwardSegmentCount","p2pDownloadMaxPriority","base","requiredSegmentsPriority","liveOptions","latencyMode","httpDownloadProbability","skipSegmentBuilderPriority","cachedSegmentExpiration","cachedSegmentsCount","httpDownloadMaxPriority","httpDownloadProbabilitySkipIfNoPeers","getHLSLiveOptions","getHLSVODOptions","capLevelToPlayerSize","autoStartLoad","abrEwmaDefaultEstimate","backBufferLength","startLevel","testBandwidth","debug","liveSyncDurationCount","WebTorrentOptionsBuilder","autoPlayValue","webtorrentOptions","p2pMediaLoaderOptions","playerRefusedP2P","playerElement","ManagerOptionsBuilder","getVideojsOptions","alreadyPlayed","getAutoPlayValue","preloadTextTracks","plugins","webtorrentOptionsBuilder","hotkeys","controlBarOptionsBuilder","videojsOptions","textTrackSettings","loop","poster","playbackRates","sources","getContextMenuOptions","content","isLoopEnabled","items","listener","shortUUID","videoShortUUID","magnetUri","stats","map","Fn","Slider","bar","getProgress","progress_","vertical","setEventHandlers_","update_","liveTracker","enableIntervalHandler_","enableInterval_","disableIntervalHandler_","disableInterval_","toggleVisibility_","visibilityState","CaptionsButton","controlText_","label_","PeertubePlayerManager","static","onPlayerChange","playerElementClassName","all","buildPlayer","videojsOptionsBuilder","alreadyFallback","tryToRecoverHLSError","addContextMenu","mobile","peertubeMobile","bezels","currentPlayer","videojsDecodeErrors","errorNotifier","maybeFallbackToWebTorrent","rebuildAndUpdateVideoElement","newPlayer","currentMode","newVideoElement","currentParentPlayerElement","parentNode","getElementById","insertBefore","onPlayerElementChange","optionsBuilder","contextmenuUI","toTitleCase","str","charAt","toUpperCase","slice","dictionaryBytes","decimals","bytes","format","videoFileMaxByResolution","files","videoFileMinByResolution","getRtcConfig","iceServers","urls","isIOS","test","platform","maxTouchPoints","includes","isSafari","userAgent","isMobile","exports","I18N_LOCALE_ALIAS","isDefaultLocale","locale","getCompleteLocale","keys","concat","l","timeToInt","time","matches","match","secondsToTime","seconds","full","symbol","hourSymbol","minuteSymbol","secondsSymbol","hours","minutes","pick","object","hasOwnProperty","call","buildVideoLink","buildVideoWatchPath","decorateVideoLink","params","URLSearchParams","startTimeInt","stopTimeInt","warningTitle","peertubeLink","hasParams","TEXT_RULES","TEXT_WITH_HTML_RULES"],"sourceRoot":""}
