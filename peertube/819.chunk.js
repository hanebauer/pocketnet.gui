/*! For license information please see 819.chunk.js.LICENSE.txt */
"use strict";(globalThis.webpackChunkpeertube_client=globalThis.webpackChunkpeertube_client||[]).push([[819],{6026:(t,e,i)=>{function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}i.r(e),i.d(e,{LineStream:()=>d,ParseStream:()=>p,Parser:()=>b});var r=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var i=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(i,1),i>-1},e.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var i=e.length,n=0;n<i;++n)e[n].call(this,arguments[1]);else for(var s=Array.prototype.slice.call(arguments,1),r=e.length,a=0;a<r;++a)e[a].apply(this,s)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",(function(e){t.push(e)}))},t}();function a(){return a=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},a.apply(this,arguments)}var o=i(7688),u=i.n(o),l=i(2236).Buffer;function g(t){for(var e,i=(e=t,u().atob?u().atob(e):l.from(e,"base64").toString("binary")),n=new Uint8Array(i.length),s=0;s<i.length;s++)n[s]=i.charCodeAt(s);return n}var d=function(t){function e(){var e;return(e=t.call(this)||this).buffer="",e}return s(e,t),e.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(r),h=String.fromCharCode(9),c=function(t){var e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),i={};return e[1]&&(i.length=parseInt(e[1],10)),e[2]&&(i.offset=parseInt(e[2],10)),i},f=function(t){for(var e,i=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),n={},s=i.length;s--;)""!==i[s]&&((e=/([^=]*)=(.*)/.exec(i[s]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),n[e[0]]=e[1]);return n},p=function(t){function e(){var e;return(e=t.call(this)||this).customParsers=[],e.tagMappers=[],e}s(e,t);var i=e.prototype;return i.push=function(t){var e,i,n=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce((function(e,i){var n=i(t);return n===t?e:e.concat([n])}),[t]).forEach((function(t){for(var s=0;s<n.customParsers.length;s++)if(n.customParsers[s].call(n,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))n.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return i={type:"tag",tagType:"inf"},e[1]&&(i.duration=parseFloat(e[1])),e[2]&&(i.title=e[2]),void n.trigger("data",i);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"targetduration"},e[1]&&(i.duration=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return i={type:"tag",tagType:"version"},e[1]&&(i.version=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"media-sequence"},e[1]&&(i.number=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return i={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(i.number=parseInt(e[1],10)),void n.trigger("data",i);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return i={type:"tag",tagType:"playlist-type"},e[1]&&(i.playlistType=e[1]),void n.trigger("data",i);if(e=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(t))return i=a(c(e[1]),{type:"tag",tagType:"byterange"}),void n.trigger("data",i);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return i={type:"tag",tagType:"allow-cache"},e[1]&&(i.allowed=!/NO/.test(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"map"},e[1]){var r=f(e[1]);r.URI&&(i.uri=r.URI),r.BYTERANGE&&(i.byterange=c(r.BYTERANGE))}n.trigger("data",i)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(i={type:"tag",tagType:"stream-inf"},e[1]){if(i.attributes=f(e[1]),i.attributes.RESOLUTION){var o=i.attributes.RESOLUTION.split("x"),u={};o[0]&&(u.width=parseInt(o[0],10)),o[1]&&(u.height=parseInt(o[1],10)),i.attributes.RESOLUTION=u}i.attributes.BANDWIDTH&&(i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)),i.attributes["PROGRAM-ID"]&&(i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10))}n.trigger("data",i)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return i={type:"tag",tagType:"media"},e[1]&&(i.attributes=f(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-ENDLIST/.exec(t))n.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))n.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return i={type:"tag",tagType:"program-date-time"},e[1]&&(i.dateTimeString=e[1],i.dateTimeObject=new Date(e[1])),void n.trigger("data",i);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return i={type:"tag",tagType:"key"},e[1]&&(i.attributes=f(e[1]),i.attributes.IV&&("0x"===i.attributes.IV.substring(0,2).toLowerCase()&&(i.attributes.IV=i.attributes.IV.substring(2)),i.attributes.IV=i.attributes.IV.match(/.{8}/g),i.attributes.IV[0]=parseInt(i.attributes.IV[0],16),i.attributes.IV[1]=parseInt(i.attributes.IV[1],16),i.attributes.IV[2]=parseInt(i.attributes.IV[2],16),i.attributes.IV[3]=parseInt(i.attributes.IV[3],16),i.attributes.IV=new Uint32Array(i.attributes.IV))),void n.trigger("data",i);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return i={type:"tag",tagType:"start"},e[1]&&(i.attributes=f(e[1]),i.attributes["TIME-OFFSET"]=parseFloat(i.attributes["TIME-OFFSET"]),i.attributes.PRECISE=/YES/.test(i.attributes.PRECISE)),void n.trigger("data",i);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return(i={type:"tag",tagType:"cue-out-cont"}).data=e[1]?e[1]:"",void n.trigger("data",i);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return(i={type:"tag",tagType:"cue-out"}).data=e[1]?e[1]:"",void n.trigger("data",i);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return(i={type:"tag",tagType:"cue-in"}).data=e[1]?e[1]:"",void n.trigger("data",i);if((e=/^#EXT-X-SKIP:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"skip"}).attributes=f(e[1]),i.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(i.attributes["SKIPPED-SEGMENTS"]=parseInt(i.attributes["SKIPPED-SEGMENTS"],10)),i.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(i.attributes["RECENTLY-REMOVED-DATERANGES"]=i.attributes["RECENTLY-REMOVED-DATERANGES"].split(h)),void n.trigger("data",i);if((e=/^#EXT-X-PART:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"part"}).attributes=f(e[1]),["DURATION"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))})),["INDEPENDENT","GAP"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=/YES/.test(i.attributes[t]))})),i.attributes.hasOwnProperty("BYTERANGE")&&(i.attributes.byterange=c(i.attributes.BYTERANGE)),void n.trigger("data",i);if((e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"server-control"}).attributes=f(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=/YES/.test(i.attributes[t]))})),void n.trigger("data",i);if((e=/^#EXT-X-PART-INF:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"part-inf"}).attributes=f(e[1]),["PART-TARGET"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseFloat(i.attributes[t]))})),void n.trigger("data",i);if((e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"preload-hint"}).attributes=f(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(t){if(i.attributes.hasOwnProperty(t)){i.attributes[t]=parseInt(i.attributes[t],10);var e="BYTERANGE-LENGTH"===t?"length":"offset";i.attributes.byterange=i.attributes.byterange||{},i.attributes.byterange[e]=i.attributes[t],delete i.attributes[t]}})),void n.trigger("data",i);if((e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t))&&e[1])return(i={type:"tag",tagType:"rendition-report"}).attributes=f(e[1]),["LAST-MSN","LAST-PART"].forEach((function(t){i.attributes.hasOwnProperty(t)&&(i.attributes[t]=parseInt(i.attributes[t],10))})),void n.trigger("data",i);n.trigger("data",{type:"tag",data:t.slice(4)})}}}else n.trigger("data",{type:"comment",text:t.slice(1)})})):this.trigger("data",{type:"uri",uri:t}))},i.addParser=function(t){var e=this,i=t.expression,n=t.customType,s=t.dataParser,r=t.segment;"function"!=typeof s&&(s=function(t){return t}),this.customParsers.push((function(t){if(i.exec(t))return e.trigger("data",{type:"custom",data:s(t),customType:n,segment:r}),!0}))},i.addTagMapper=function(t){var e=t.expression,i=t.map;this.tagMappers.push((function(t){return e.test(t)?i(t):t}))},e}(r),m=function(t){var e={};return Object.keys(t).forEach((function(i){var n;e[(n=i,n.toLowerCase().replace(/-(\w)/g,(function(t){return t[1].toUpperCase()})))]=t[i]})),e},y=function(t){var e=t.serverControl,i=t.targetDuration,n=t.partTargetDuration;if(e){var s="#EXT-X-SERVER-CONTROL",r="holdBack",a="partHoldBack",o=i&&3*i,u=n&&2*n;i&&!e.hasOwnProperty(r)&&(e[r]=o,this.trigger("info",{message:s+" defaulting HOLD-BACK to targetDuration * 3 ("+o+")."})),o&&e[r]<o&&(this.trigger("warn",{message:s+" clamping HOLD-BACK ("+e[r]+") to targetDuration * 3 ("+o+")"}),e[r]=o),n&&!e.hasOwnProperty(a)&&(e[a]=3*n,this.trigger("info",{message:s+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+e[a]+")."})),n&&e[a]<u&&(this.trigger("warn",{message:s+" clamping PART-HOLD-BACK ("+e[a]+") to partTargetDuration * 2 ("+u+")."}),e[a]=u)}},b=function(t){function e(){var e;(e=t.call(this)||this).lineStream=new d,e.parseStream=new p,e.lineStream.pipe(e.parseStream);var i,n,s=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e),r=[],o={},u=!1,l=function(){},h={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},c=0;e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var f=0,b=0;return e.on("end",(function(){o.uri||!o.parts&&!o.preloadHints||(!o.map&&i&&(o.map=i),!o.key&&n&&(o.key=n),o.timeline||"number"!=typeof c||(o.timeline=c),e.manifest.preloadSegment=o)})),e.parseStream.on("data",(function(t){var e,d;({tag:function(){({version:function(){t.version&&(this.manifest.version=t.version)},"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(o.byterange=e,e.length=t.length,"offset"in t||(t.offset=f)),"offset"in t&&(o.byterange=e,e.offset=t.offset),f=e.offset+e.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(o.duration=t.duration),0===t.duration&&(o.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=r},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("com.apple.streamingkeydelivery"===t.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:t.attributes});if("com.microsoft.playready"===t.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:t.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:g(t.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),n={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(n.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else n=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,c=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){i={},t.uri&&(i.uri=t.uri),t.byterange&&(i.byterange=t.byterange),n&&(i.key=n)},"stream-inf":function(){this.manifest.playlists=r,this.manifest.mediaGroups=this.manifest.mediaGroups||h,t.attributes?(o.attributes||(o.attributes={}),a(o.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||h,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var i=this.manifest.mediaGroups[t.attributes.TYPE];i[t.attributes["GROUP-ID"]]=i[t.attributes["GROUP-ID"]]||{},e=i[t.attributes["GROUP-ID"]],(d={default:/yes/i.test(t.attributes.DEFAULT)}).autoselect=!!d.default||/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(d.language=t.attributes.LANGUAGE),t.attributes.URI&&(d.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(d.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(d.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(d.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=d}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){c+=1,o.discontinuity=!0,this.manifest.discontinuityStarts.push(r.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),o.dateTimeString=t.dateTimeString,o.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):(this.manifest.targetDuration=t.duration,y.call(this,this.manifest))},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){o.cueOut=t.data},"cue-out-cont":function(){o.cueOutCont=t.data},"cue-in":function(){o.cueIn=t.data},skip:function(){this.manifest.skip=m(t.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;u=!0;var i=this.manifest.segments.length,n=m(t.attributes);o.parts=o.parts||[],o.parts.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=b),b=n.byterange.offset+n.byterange.length),this.warnOnMissingAttributes_("#EXT-X-PART #"+(o.parts.length-1)+" for segment #"+i,t.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((function(t,i){t.hasOwnProperty("lastPart")||e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+i+" lacks required attribute(s): LAST-PART"})}))},"server-control":function(){var e=this.manifest.serverControl=m(t.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),y.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length,i=m(t.attributes),n=i.type&&"PART"===i.type;o.preloadHints=o.preloadHints||[],o.preloadHints.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=n?b:0,n&&(b=i.byterange.offset+i.byterange.length)));var s=o.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+s+" for segment #"+e,t.attributes,["TYPE","URI"]),i.type)for(var r=0;r<o.preloadHints.length-1;r++){var a=o.preloadHints[r];a.type&&a.type===i.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+s+" for segment #"+e+" has the same TYPE "+i.type+" as preload hint #"+r})}},"rendition-report":function(){var e=m(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);var i=this.manifest.renditionReports.length-1,n=["LAST-MSN","URI"];u&&n.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+i,t.attributes,n)},"part-inf":function(){this.manifest.partInf=m(t.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),y.call(this,this.manifest)}}[t.tagType]||l).call(s)},uri:function(){o.uri=t.uri,r.push(o),this.manifest.targetDuration&&!("duration"in o)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),o.duration=this.manifest.targetDuration),n&&(o.key=n),o.timeline=c,i&&(o.map=i),b=0,o={}},comment:function(){},custom:function(){t.segment?(o.custom=o.custom||{},o.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(s)})),e}s(e,t);var i=e.prototype;return i.warnOnMissingAttributes_=function(t,e,i){var n=[];i.forEach((function(t){e.hasOwnProperty(t)||n.push(t)})),n.length&&this.trigger("warn",{message:t+" lacks required attribute(s): "+n.join(", ")})},i.push=function(t){this.lineStream.push(t)},i.end=function(){this.lineStream.push("\n"),this.trigger("end")},i.addParser=function(t){this.parseStream.addParser(t)},i.addTagMapper=function(t){this.parseStream.addTagMapper(t)},e}(r)},701:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.byteRangeToString=e.compareByteRanges=e.getByteRange=void 0,e.getByteRange=function(t){return t.rangeEnd&&void 0!==t.rangeStart?{offset:t.rangeStart,length:t.rangeEnd-t.rangeStart}:void 0},e.compareByteRanges=function(t,e){return void 0===t?void 0===e:void 0!==e&&t.length===e.length&&t.offset===e.offset},e.byteRangeToString=function(t){if(void 0!==t)return`bytes=${t.offset}-${t.offset+t.length-1}`}},9004:(t,e,i)=>{function n(t,e,i,n,s,r,a){try{var o=t[r](a),u=o.value}catch(l){return void i(l)}o.done?e(u):Promise.resolve(u).then(n,s)}function s(t){return function(){var e=this,i=arguments;return new Promise((function(s,r){var a=t.apply(e,i);function o(t){n(a,s,r,o,u,"next",t)}function u(t){n(a,s,r,o,u,"throw",t)}o(void 0)}))}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function l(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.Engine=void 0;let d=i(4575),h=i(7382),c=i(7986),f=i(8193);e.Engine=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(d,t);var e,i,n,a=(i=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=g(i);if(n){var s=g(this).constructor;t=Reflect.construct(e,arguments,s)}else t=e.apply(this,arguments);return l(this,t)});function d(){var t;let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(this,d),(t=a.call(this)).loader=new h.HybridLoader(e.loader),t.segmentManager=new c.SegmentManager(t.loader,e.segments,e.loader),Object.keys(h.Events).map((t=>h.Events[t])).forEach((e=>t.loader.on(e,(function(){for(var i,n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(i=t).emit.apply(i,[e].concat(s))})))),t}return o(d,[{key:"createLoaderClass",value:function(){var t;let e=this,i=(t=o((function t(){var i=this;r(this,t),this.load=function(){var t=s((function*(t,e,n){i.context=t,i.callbacks=n,yield i.impl.load(t,e,n)}));return function(e,i,n){return t.apply(this,arguments)}}(),this.abort=()=>{this.context&&this.impl.abort(this.context,this.callbacks)},this.destroy=()=>{this.context&&this.impl.abort(this.context)},this.getResponseHeader=()=>{},this.impl=new f.HlsJsLoader(e.segmentManager),e.setLatestLoaderImpl(this),this.stats=this.impl.stats})),t.getEngine=()=>e,t);return i}},{key:"destroy",value:(e=s((function*(){yield this.segmentManager.destroy()})),function(){return e.apply(this,arguments)})},{key:"abortCurrentRequest",value:function(){this.latestLoaderImpl&&(this.latestLoaderImpl.abort(),this.latestLoaderImpl=void 0)}},{key:"getSettings",value:function(){return{segments:this.segmentManager.getSettings(),loader:this.loader.getSettings()}}},{key:"getDetails",value:function(){return{loader:this.loader.getDetails()}}},{key:"setPlayingSegment",value:function(t,e,i,n){this.segmentManager.setPlayingSegment(t,e,i,n)}},{key:"setPlayingSegmentByCurrentTime",value:function(t){this.segmentManager.setPlayingSegmentByCurrentTime(t)}},{key:"setLatestLoaderImpl",value:function(t){this.latestLoaderImpl=t}}],[{key:"isSupported",value:function(){return h.HybridLoader.isSupported()}}]),d}(d.EventEmitter)},8193:function(t,e,i){function n(t,e,i,n,s,r,a){try{var o=t[r](a),u=o.value}catch(l){return void i(l)}o.done?e(u):Promise.resolve(u).then(n,s)}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.HlsJsLoader=void 0;let a=r(i(7642)),o=i(7382),u=i(701),l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.segmentManager=e,this.debug=(0,a.default)("p2pml:hlsjs-loader"),this.stats={loaded:0,total:0,aborted:!1,retry:0,chunkCount:0,bwEstimate:0,loading:{start:0,end:0,first:0},parsing:{start:0,end:0},buffering:{start:0,end:0,first:0}},this.boundOnSegmentAbort=this.onSegmentAbort.bind(this),this.boundOnUpdateSegmentSize=this.onUpdateSegmentSize.bind(this),this.boundOnUpdateLoaded=this.onUpdateLoaded.bind(this),this.boundOnSegmentStartLoad=this.onSegmentStartLoad.bind(this),this.debugId=""}var e,i,r,l,g;return e=t,i=[{key:"load",value:(l=function*(e,i,n){if(this.context=e,this.callbacks=n,t.updateStatsToStartLoading(this.stats),this.context.type){this.debug(`Loading playlist ${this.context.url}.`);try{let t=yield this.segmentManager.loadPlaylist(this.context.url);this.debug(`Playlist ${this.context.url} loaded.`),this.successPlaylist(t,this.context,this.callbacks)}catch(s){this.error(s,this.context,this.callbacks)}}else if(this.context.frag){this.loader=this.segmentManager.loader,this.byteRange=(0,u.getByteRange)(this.context),this.debugId=this.byteRange?`${this.context.url} / ${this.byteRange.offset}`:this.context.url,this.debug(`Loading fragment ${this.debugId}.`),this.interval=setInterval((()=>t.updateStatsToStartLoading(this.stats)),200),this.loader.on(o.Events.SegmentAbort,this.boundOnSegmentAbort),this.loader.on(o.Events.SegmentSize,this.boundOnUpdateSegmentSize),this.loader.on(o.Events.SegmentStartLoad,this.boundOnSegmentStartLoad);try{let t=yield this.segmentManager.loadSegment(this.context.url,this.byteRange),{content:e}=t;e?(this.successSegment(e,this.context,this.callbacks),this.debug(`Loaded fragment ${this.debugId}.`)):(this.cleanup(),this.debug(`Loaded empty fragment ${this.debugId} (aborted?).`))}catch(s){setTimeout((()=>this.error(s,this.context,this.callbacks)),0),this.debug(`Error in fragment ${this.debugId} loading.`,s)}}else console.warn("Unknown load request",this.context)},g=function(){var t=this,e=arguments;return new Promise((function(i,s){var r=l.apply(t,e);function a(t){n(r,i,s,a,o,"next",t)}function o(t){n(r,i,s,a,o,"throw",t)}a(void 0)}))},function(t,e,i){return g.apply(this,arguments)})},{key:"abort",value:function(t,e){if(this.stats.loaded||this.stats.aborted)return;this.debug(`Aborting by hls.js fragment ${this.debugId} loading.`),this.cleanup(),this.segmentManager.abortSegment(t.url,(0,u.getByteRange)(t)),this.stats.aborted=!0;let i=null==e?void 0:e.onAbort;i&&i(this.stats,t,void 0)}},{key:"successPlaylist",value:function(t,e,i){this.cleanup();let n=performance.now();this.stats.loading.end=n,this.stats.loaded=t.response.length,this.stats.total=t.response.length,i.onSuccess({url:t.responseURL,data:t.response},this.stats,e,void 0)}},{key:"successSegment",value:function(t,e,i){this.cleanup();let n=performance.now();this.stats.loading.end=n,this.stats.loaded=t.byteLength,this.stats.total=t.byteLength,i.onProgress&&i.onProgress(this.stats,e,t,void 0),i.onSuccess({url:e.url,data:t},this.stats,e,void 0)}},{key:"error",value:function(t,e,i){this.cleanup(),i.onError(t,e,void 0)}},{key:"cleanup",value:function(){this.interval&&(clearInterval(this.interval),this.interval=void 0),this.loader&&(this.loader.off(o.Events.SegmentStartLoad,this.boundOnSegmentStartLoad),this.loader.off(o.Events.SegmentSize,this.boundOnUpdateSegmentSize),this.loader.off(o.Events.PieceBytesDownloaded,this.boundOnUpdateLoaded),this.loader.off(o.Events.SegmentAbort,this.boundOnSegmentAbort))}},{key:"onSegmentAbort",value:function(t){var e;if(!this.isSegment(t))return;this.debug(`Aborting by p2p-media-loader fragment ${this.debugId||""}.`),this.stats.aborted=!0;let i=null===(e=this.callbacks)||void 0===e?void 0:e.onAbort;i&&i(this.stats,this.context,void 0),this.cleanup()}},{key:"onUpdateSegmentSize",value:function(t,e){this.isSegment(t)&&(this.stats.total=e)}},{key:"onUpdateLoaded",value:function(t,e,i){this.isSegment(e)&&(this.stats.loaded+=i)}},{key:"onSegmentStartLoad",value:function(e,i){this.interval&&"http"===e&&this.isSegment(i)&&(clearInterval(this.interval),this.interval=void 0,t.updateStatsToStartLoading(this.stats),this.loader.on(o.Events.PieceBytesDownloaded,this.boundOnUpdateLoaded))}},{key:"isSegment",value:function(t){return t.url===this.context.url&&t.range===(0,u.byteRangeToString)(this.byteRange)}}],r=[{key:"updateStatsToStartLoading",value:function(t){if(t.aborted)return;let e=performance.now();t.loading.start=e,t.loading.first=e}}],i&&s(e.prototype,i),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.HlsJsLoader=l},1819:function(t,e,i){function n(t,e,i,n,s,r,a){try{var o=t[r](a),u=o.value}catch(l){return void i(l)}o.done?e(u):Promise.resolve(u).then(n,s)}function s(t){return function(){var e=this,i=arguments;return new Promise((function(s,r){var a=t.apply(e,i);function o(t){n(a,s,r,o,u,"next",t)}function u(t){n(a,s,r,o,u,"throw",t)}o(void 0)}))}}var r=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(e,i);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,s)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),a=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.initJwPlayer=e.initMediaElementJsPlayer=e.initVideoJsHlsJsPlugin=e.initVideoJsContribHlsJsPlayer=e.initFlowplayerHlsJsPlayer=e.initClapprPlayer=e.initHlsJsPlayer=e.version=void 0,e.version="0.6.2",a(i(9004),e),a(i(7986),e);let u=(0,o(i(7642)).default)("p2pml:hlsjs-init");function l(t){t&&t.config&&t.config.loader&&"function"==typeof t.config.loader.getEngine&&g(t,t.config.loader.getEngine())}function g(t,e){t.on("hlsFragChanged",((t,i)=>{u("HLS Frag changed.",i);let n=i.frag;e.setPlayingSegment(n.url,2!==n.byteRange.length?void 0:{offset:n.byteRange[0],length:n.byteRange[1]-n.byteRange[0]},n.start,n.duration)})),t.on("hlsDestroying",s((function*(){yield e.destroy()}))),t.on("hlsError",((i,n)=>{if("bufferStalledError"===n.details){let i=void 0===t.media?t.el_:t.media;i&&e.setPlayingSegmentByCurrentTime(i.currentTime)}})),t.on("seeking",(()=>{u("Player seeking."),e.abortCurrentRequest()}))}e.initHlsJsPlayer=l,e.initClapprPlayer=function(t){t.on("play",(()=>{let e=t.core.getCurrentPlayback();e._hls&&!e._hls._p2pm_linitialized&&(e._hls._p2pm_linitialized=!0,l(t.core.getCurrentPlayback()._hls))}))},e.initFlowplayerHlsJsPlayer=function(t){t.on("ready",(()=>{var e;return l(null!==(e=t.engine.hlsjs)&&void 0!==e?e:t.engine.hls)}))},e.initVideoJsContribHlsJsPlayer=function(t){t.ready((()=>{let e=t.tech_.options_;e&&e.hlsjsConfig&&e.hlsjsConfig.loader&&"function"==typeof e.hlsjsConfig.loader.getEngine&&g(t.tech_,e.hlsjsConfig.loader.getEngine())}))},e.initVideoJsHlsJsPlugin=function(){null!=videojs&&null!=videojs.Html5Hlsjs&&videojs.Html5Hlsjs.addHook("beforeinitialize",((t,e)=>{e.config&&e.config.loader&&"function"==typeof e.config.loader.getEngine&&g(e,e.config.loader.getEngine())}))},e.initMediaElementJsPlayer=function(t){t.addEventListener("hlsFragChanged",(e=>{let i=t.hlsPlayer;if(i&&i.config&&i.config.loader&&"function"==typeof i.config.loader.getEngine){let t=i.config.loader.getEngine();if(e.data&&e.data.length>1){let i=e.data[1].frag;t.setPlayingSegment(i.url,2!==i.byteRange.length?void 0:{offset:i.byteRange[0],length:i.byteRange[1]-i.byteRange[0]},i.start,i.duration)}}})),t.addEventListener("hlsDestroying",s((function*(){let e=t.hlsPlayer;if(e&&e.config&&e.config.loader&&"function"==typeof e.config.loader.getEngine){let t=e.config.loader.getEngine();yield t.destroy()}}))),t.addEventListener("hlsError",(e=>{let i=t.hlsPlayer;i&&i.config&&i.config.loader&&"function"==typeof i.config.loader.getEngine&&void 0!==e.data&&"bufferStalledError"===e.data.details&&i.config.loader.getEngine().setPlayingSegmentByCurrentTime(i.media.currentTime)}))},e.initJwPlayer=function(t,e){let i=setInterval((()=>{t.hls&&t.hls.config&&(clearInterval(i),Object.assign(t.hls.config,e),l(t.hls))}),200)}},7986:function(t,e,i){function n(t,e,i,n,s,r,a){try{var o=t[r](a),u=o.value}catch(l){return void i(l)}o.done?e(u):Promise.resolve(u).then(n,s)}function s(t){return function(){var e=this,i=arguments;return new Promise((function(s,r){var a=t.apply(e,i);function o(t){n(a,s,r,o,u,"next",t)}function u(t){n(a,s,r,o,u,"throw",t)}o(void 0)}))}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.SegmentManager=void 0;let l=u(i(7642)),g=i(7382),d=i(6026),h=i(701),c={forwardSegmentCount:20,swarmId:void 0,assetsStorage:void 0},f=function(){function t(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,t),this.debug=(0,l.default)("p2pml:segment-manager"),this.masterPlaylist=null,this.variantPlaylists=new Map,this.segmentRequest=null,this.fetch=function(){return fetch.apply(void 0,arguments)},this.playQueue=[],this.onSegmentLoaded=t=>{this.segmentRequest&&this.segmentRequest.segmentUrl===t.url&&(0,h.byteRangeToString)(this.segmentRequest.segmentByteRange)===t.range&&(this.segmentRequest.onSuccess(t.data.slice(0),t.downloadBandwidth),this.segmentRequest=null)},this.onSegmentError=(t,e)=>{this.segmentRequest&&this.segmentRequest.segmentUrl===t.url&&(0,h.byteRangeToString)(this.segmentRequest.segmentByteRange)===t.range&&(this.segmentRequest.onError(e),this.segmentRequest=null)},this.onSegmentAbort=t=>{this.segmentRequest&&this.segmentRequest.segmentUrl===t.url&&(0,h.byteRangeToString)(this.segmentRequest.segmentByteRange)===t.range&&(this.segmentRequest.onError("Loading aborted: internal abort"),this.segmentRequest=null)},this.settings=Object.assign(Object.assign({},c),i),this.loader=e,this.loader.on(g.Events.SegmentLoaded,this.onSegmentLoaded),this.loader.on(g.Events.SegmentError,this.onSegmentError),this.loader.on(g.Events.SegmentAbort,this.onSegmentAbort),n.localTransport&&(this.fetch=n.localTransport)}var e,i,n,a,u;return o(t,[{key:"getSettings",value:function(){return this.settings}},{key:"processPlaylist",value:function(t,e,i){let n=new d.Parser;n.push(e),n.end();let s=new p(t,i,n.manifest);if(s.manifest.playlists){this.masterPlaylist=s;for(let[t,e]of this.variantPlaylists){let{streamSwarmId:i,found:n,index:s}=this.getStreamSwarmId(e.requestUrl);n?(e.streamSwarmId=i,e.streamId="V"+s.toString()):this.variantPlaylists.delete(t)}}else{let{streamSwarmId:e,found:i,index:n}=this.getStreamSwarmId(t);(i||null===this.masterPlaylist)&&(s.streamSwarmId=e,s.streamId=null===this.masterPlaylist?void 0:"V"+n.toString(),this.variantPlaylists.set(t,s),this.updateSegments())}}},{key:"loadPlaylist",value:(u=s((function*(t){let e,i=this.settings.assetsStorage;if(void 0!==i){let n;n=this.getMasterSwarmId(),void 0===n&&(n=t.split("?")[0]);let s=yield i.getAsset(t,void 0,n);if(void 0!==s)e={responseURL:s.responseUri,response:s.data};else{let s=yield this.loadContent(t);e={responseURL:s.url,response:yield s.text()},i.storeAsset({masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t,masterSwarmId:n,requestUri:t,responseUri:e.responseURL,data:e.response})}}else{let i=yield this.loadContent(t);e={responseURL:i.url,response:yield i.text()}}return this.processPlaylist(t,e.response,e.responseURL),e})),function(t){return u.apply(this,arguments)})},{key:"loadSegment",value:(a=s((function*(t,e){var i;let n=this.getSegmentLocation(t,e),s=(0,h.byteRangeToString)(e);if(!n){let e,n=this.settings.assetsStorage;if(void 0!==n){let r,a=null===(i=this.masterPlaylist)||void 0===i?void 0:i.requestUrl;if(r=this.getMasterSwarmId(),void 0===r&&1===this.variantPlaylists.size){let t=this.variantPlaylists.values().next();t.done||(r=t.value.requestUrl.split("?")[0])}if(void 0===a&&1===this.variantPlaylists.size){let t=this.variantPlaylists.values().next();t.done||(a=t.value.requestUrl)}if(void 0!==r&&void 0!==a){let i=yield n.getAsset(t,s,r);if(void 0!==i)e=i.data;else{let i=yield this.loadContent(t,s);e=yield i.arrayBuffer(),n.storeAsset({masterManifestUri:a,masterSwarmId:r,requestUri:t,requestRange:s,responseUri:i.url,data:e})}}}if(void 0===e){let i=yield this.loadContent(t,s);e=yield i.arrayBuffer()}return{content:e,downloadBandwidth:0}}let r=(n.playlist.manifest.mediaSequence?n.playlist.manifest.mediaSequence:0)+n.segmentIndex;this.playQueue.length>0&&this.playQueue[this.playQueue.length-1].segmentSequence!==r-1&&(this.playQueue=[]),this.segmentRequest&&this.segmentRequest.onError("Cancel segment request: simultaneous segment requests are not supported");let a=new Promise(((i,s)=>{this.segmentRequest=new m(t,e,r,n.playlist.requestUrl,((t,e)=>i({content:t,downloadBandwidth:e})),(t=>s(t)))}));return this.playQueue.push({segmentUrl:t,segmentByteRange:e,segmentSequence:r}),this.loadSegments(n.playlist,n.segmentIndex,!0),a})),function(t,e){return a.apply(this,arguments)})},{key:"setPlayingSegment",value:function(t,e,i,n){let s=this.playQueue.findIndex((i=>i.segmentUrl===t&&(0,h.compareByteRanges)(i.segmentByteRange,e)));this.debug("Set playing segment to index %d",s,this.playQueue),s>=0&&(this.playQueue=this.playQueue.slice(s),this.playQueue[0].playPosition={start:i,duration:n},this.updateSegments())}},{key:"setPlayingSegmentByCurrentTime",value:function(t){if(0===this.playQueue.length||!this.playQueue[0].playPosition)return;let e=this.playQueue[0].playPosition;e.start+e.duration-t<.2&&(this.playQueue=this.playQueue.slice(1),this.updateSegments())}},{key:"abortSegment",value:function(t,e){this.segmentRequest&&this.segmentRequest.segmentUrl===t&&(0,h.compareByteRanges)(this.segmentRequest.segmentByteRange,e)&&(this.segmentRequest.onSuccess(void 0,0),this.segmentRequest=null)}},{key:"abortCurrentSegment",value:function(){this.segmentRequest&&(this.segmentRequest.onSuccess(void 0,0),this.segmentRequest=null)}},{key:"destroy",value:(n=s((function*(){this.segmentRequest&&(this.segmentRequest.onError("Loading aborted: object destroyed"),this.segmentRequest=null),this.masterPlaylist=null,this.variantPlaylists.clear(),this.playQueue=[],void 0!==this.settings.assetsStorage&&(yield this.settings.assetsStorage.destroy()),yield this.loader.destroy()})),function(){return n.apply(this,arguments)})},{key:"updateSegments",value:function(){if(!this.segmentRequest)return;let t=this.getSegmentLocation(this.segmentRequest.segmentUrl,this.segmentRequest.segmentByteRange);this.debug("update segments",t),t&&this.loadSegments(t.playlist,t.segmentIndex,!1)}},{key:"getSegmentLocation",value:function(t,e){for(let i of this.variantPlaylists.values()){let n=i.getSegmentIndex(t,e);if(n>=0)return{playlist:i,segmentIndex:n}}}},{key:"loadSegments",value:(i=s((function*(t,e,i){var n;let s=[],r=t.manifest.segments,a=null!==(n=t.manifest.mediaSequence)&&void 0!==n?n:0,o=null,u=Math.max(0,this.playQueue.length-1),l=this.getMasterSwarmId();this.debug("load segments",u,e);for(let g=e;g<r.length&&s.length<this.settings.forwardSegmentCount;++g){let e=t.manifest.segments[g],n=t.getSegmentAbsoluteUrl(e.uri),r=e.byterange,d=this.getSegmentId(t,a+g);s.push({id:d,url:n,masterSwarmId:void 0!==l?l:t.streamSwarmId,masterManifestUri:null!==this.masterPlaylist?this.masterPlaylist.requestUrl:t.requestUrl,streamId:t.streamId,sequence:(a+g).toString(),range:(0,h.byteRangeToString)(r),priority:u++}),i&&!o&&(o=d)}if(this.loader.load(s,t.streamSwarmId),o){let t=yield this.loader.getSegment(o);t&&this.onSegmentLoaded(t)}})),function(t,e,n){return i.apply(this,arguments)})},{key:"getSegmentId",value:function(t,e){return`${t.streamSwarmId}+${e}`}},{key:"getMasterSwarmId",value:function(){let t=this.settings.swarmId&&0!==this.settings.swarmId.length?this.settings.swarmId:void 0;return void 0!==t?t:null!==this.masterPlaylist?this.masterPlaylist.requestUrl.split("?")[0]:void 0}},{key:"getStreamSwarmId",value:function(t){let e=this.getMasterSwarmId();if(this.masterPlaylist&&this.masterPlaylist.manifest.playlists&&e)for(let i=0;i<this.masterPlaylist.manifest.playlists.length;++i)if(new URL(this.masterPlaylist.manifest.playlists[i].uri,this.masterPlaylist.responseUrl).toString()===t)return{streamSwarmId:`${e}+V${i}`,found:!0,index:i};return{streamSwarmId:null!=e?e:t.split("?")[0],found:!1,index:-1}}},{key:"loadContent",value:(e=s((function*(t,e){let i=new Headers;return e&&i.append("Range",e),this.fetch(t,{headers:i})})),function(t,i){return e.apply(this,arguments)})}]),t}();e.SegmentManager=f;let p=function(){function t(e,i,n){r(this,t),this.requestUrl=e,this.responseUrl=i,this.manifest=n,this.streamSwarmId=""}return o(t,[{key:"getSegmentIndex",value:function(t,e){for(let i=0;i<this.manifest.segments.length;++i){let n=this.manifest.segments[i];if(t===this.getSegmentAbsoluteUrl(n.uri)&&(0,h.compareByteRanges)(n.byterange,e))return i}return-1}},{key:"getSegmentAbsoluteUrl",value:function(t){return new URL(t,this.responseUrl).toString()}}]),t}(),m=o((function t(e,i,n,s,a,o){r(this,t),this.segmentUrl=e,this.segmentByteRange=i,this.segmentSequence=n,this.playlistRequestUrl=s,this.onSuccess=a,this.onError=o}))}}]);
//# sourceMappingURL=819.chunk.js.map